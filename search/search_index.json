{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"index.html","text":"Desarrollo Web en Entorno Servidor \u00b6 Aqu\u00ed puedes encontrar los apuntes del m\u00f3dulo de Desarrollo web en entorno servidor , que se imparte en el segundo curso del ciclo formativo de grado superior de Desarrollo de Aplicaciones Web. La duraci\u00f3n del m\u00f3dulo es de 160 horas lectivas, a raz\u00f3n de 8 horas semanales , y se desarrolla a lo largo de los dos primeros trimestres del curso. Se ha planificado bas\u00e1ndose en 4 sesiones de 2 horas lectivas por semana. \u00bfQu\u00e9 voy a aprender? \u00b6 A desarrollar aplicaciones web din\u00e1micas, que obtienen la informaci\u00f3n a partir de una base de datos. Analizar la estructura de una aplicaci\u00f3n cliente/servidor, separando el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio Obtener informaci\u00f3n a partir de los datos almacenados, as\u00ed como modificarlos. Resultados de aprendizaje \u00b6 Selecciona las arquitecturas y tecnolog\u00edas de programaci\u00f3n Web en entorno servidor, analizando sus capacidades y caracter\u00edsticas propias. Escribe sentencias ejecutables por un servidor Web reconociendo y aplicando procedimientos de integraci\u00f3n del co\u0301digo en lenguajes de marcas. Escribe bloques de sentencias embebidos en lenguajes de marcas, seleccionando y utilizando las estructuras de programaci\u00f3n. Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el co\u0301digo de presentaci\u00f3n de la l\u00f3gica de negocio. Desarrolla aplicaciones de acceso a almacenes de datos, aplicando medidas para mantener la seguridad y la integridad de la informaci\u00f3n. Desarrolla servicios Web analizando su funcionamiento e implantando la estructura de sus componentes. Genera p\u00e1ginas Web dina\u0301micas analizando y utilizando tecnolog\u00edas del servidor Web que a\u00f1adan co\u0301digo al lenguaje de marcas. Desarrolla aplicaciones Web hi\u0301bridas seleccionando y utilizando librer\u00edas de co\u0301digo y repositorios heterog\u00e9neos de informaci\u00f3n. Unidades did\u00e1cticas / Temporalizaci\u00f3n \u00b6 A continuaci\u00f3n se muestran las unidades did\u00e1cticas y una estimaci\u00f3n temporal de cada una de ellas. La primera evaluaci\u00f3n contendr\u00eda las unidades comprendidas entre la 1 y 5, y parte de la unidades 6. As\u00ed pues, desde la mitad de la unidad 6 a la unidad 9 se ver\u00e1n en la segunda evaluaci\u00f3n. Primera evaluaci\u00f3n \u00b6 Duraci\u00f3n estimada: 72 sesiones Arquitecturas Web (4h) Cliente/Servidor. MVC. El lenguaje PHP (26h) Condiciones y bucles. Arrays. Orientaci\u00f3n a objetos con PHP (18h) Clases y objetos Namespaces Excepciones Programaci\u00f3n Web (12h) Formularios. Cookies y sesi\u00f3n. Herramientas Web (16h) Composer . Uso de logs con Monolog . Webscraping . Documentaci\u00f3n con phpDocumentor . Pruebas con PhpUnit . Segunda evaluaci\u00f3n \u00b6 Duraci\u00f3n estimada: 88 sesiones Acceso a datos (28h) SQL PDO Ficheros CSV y PDF. ORM con Eloquent . Frameworks PHP. Laravel b\u00e1sico (24h) Rutas. Vistas. Migraciones e integraci\u00f3n con Eloquent . Uso avanzado de Frameworks (22h) Plantillas con Blade . Autenticaci\u00f3n y autorizaci\u00f3n. i18n . Servicios REST (12h) Producci\u00f3n y consumo. AJAX con JSON . Interacci\u00f3n con Vue.js . Instrumentos de calificaci\u00f3n \u00b6 La nota de cada evaluaci\u00f3n se calcula mediante: 30% Trabajo en Clase / Actividades Se eval\u00faan todas las actividades realizadas en clase y en casa. Las actividades se eval\u00faan mediante tareas de Aules con calificaciones comprendidas entre 0 y 3 puntos: 0: No entregada 1: Entregada pero soluci\u00f3n err\u00f3nea o incompleta 2: Entregada y soluci\u00f3n aceptable, aunque tiene alg\u00fan apartado incompleto 3: Entregada y soluci\u00f3n correcta. 70% Actividad de evaluaci\u00f3n Una o dos pruebas por evaluaci\u00f3n. La nota final se calcula mediante la media de cada una de las evaluaciones.","title":"Inicio"},{"location":"index.html#desarrollo-web-en-entorno-servidor","text":"Aqu\u00ed puedes encontrar los apuntes del m\u00f3dulo de Desarrollo web en entorno servidor , que se imparte en el segundo curso del ciclo formativo de grado superior de Desarrollo de Aplicaciones Web. La duraci\u00f3n del m\u00f3dulo es de 160 horas lectivas, a raz\u00f3n de 8 horas semanales , y se desarrolla a lo largo de los dos primeros trimestres del curso. Se ha planificado bas\u00e1ndose en 4 sesiones de 2 horas lectivas por semana.","title":"Desarrollo Web en Entorno Servidor"},{"location":"index.html#que-voy-a-aprender","text":"A desarrollar aplicaciones web din\u00e1micas, que obtienen la informaci\u00f3n a partir de una base de datos. Analizar la estructura de una aplicaci\u00f3n cliente/servidor, separando el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio Obtener informaci\u00f3n a partir de los datos almacenados, as\u00ed como modificarlos.","title":"\u00bfQu\u00e9 voy a aprender?"},{"location":"index.html#resultados-de-aprendizaje","text":"Selecciona las arquitecturas y tecnolog\u00edas de programaci\u00f3n Web en entorno servidor, analizando sus capacidades y caracter\u00edsticas propias. Escribe sentencias ejecutables por un servidor Web reconociendo y aplicando procedimientos de integraci\u00f3n del co\u0301digo en lenguajes de marcas. Escribe bloques de sentencias embebidos en lenguajes de marcas, seleccionando y utilizando las estructuras de programaci\u00f3n. Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el co\u0301digo de presentaci\u00f3n de la l\u00f3gica de negocio. Desarrolla aplicaciones de acceso a almacenes de datos, aplicando medidas para mantener la seguridad y la integridad de la informaci\u00f3n. Desarrolla servicios Web analizando su funcionamiento e implantando la estructura de sus componentes. Genera p\u00e1ginas Web dina\u0301micas analizando y utilizando tecnolog\u00edas del servidor Web que a\u00f1adan co\u0301digo al lenguaje de marcas. Desarrolla aplicaciones Web hi\u0301bridas seleccionando y utilizando librer\u00edas de co\u0301digo y repositorios heterog\u00e9neos de informaci\u00f3n.","title":"Resultados de aprendizaje"},{"location":"index.html#unidades-didacticas-temporalizacion","text":"A continuaci\u00f3n se muestran las unidades did\u00e1cticas y una estimaci\u00f3n temporal de cada una de ellas. La primera evaluaci\u00f3n contendr\u00eda las unidades comprendidas entre la 1 y 5, y parte de la unidades 6. As\u00ed pues, desde la mitad de la unidad 6 a la unidad 9 se ver\u00e1n en la segunda evaluaci\u00f3n.","title":"Unidades did\u00e1cticas / Temporalizaci\u00f3n"},{"location":"index.html#primera-evaluacion","text":"Duraci\u00f3n estimada: 72 sesiones Arquitecturas Web (4h) Cliente/Servidor. MVC. El lenguaje PHP (26h) Condiciones y bucles. Arrays. Orientaci\u00f3n a objetos con PHP (18h) Clases y objetos Namespaces Excepciones Programaci\u00f3n Web (12h) Formularios. Cookies y sesi\u00f3n. Herramientas Web (16h) Composer . Uso de logs con Monolog . Webscraping . Documentaci\u00f3n con phpDocumentor . Pruebas con PhpUnit .","title":"Primera evaluaci\u00f3n"},{"location":"index.html#segunda-evaluacion","text":"Duraci\u00f3n estimada: 88 sesiones Acceso a datos (28h) SQL PDO Ficheros CSV y PDF. ORM con Eloquent . Frameworks PHP. Laravel b\u00e1sico (24h) Rutas. Vistas. Migraciones e integraci\u00f3n con Eloquent . Uso avanzado de Frameworks (22h) Plantillas con Blade . Autenticaci\u00f3n y autorizaci\u00f3n. i18n . Servicios REST (12h) Producci\u00f3n y consumo. AJAX con JSON . Interacci\u00f3n con Vue.js .","title":"Segunda evaluaci\u00f3n"},{"location":"index.html#instrumentos-de-calificacion","text":"La nota de cada evaluaci\u00f3n se calcula mediante: 30% Trabajo en Clase / Actividades Se eval\u00faan todas las actividades realizadas en clase y en casa. Las actividades se eval\u00faan mediante tareas de Aules con calificaciones comprendidas entre 0 y 3 puntos: 0: No entregada 1: Entregada pero soluci\u00f3n err\u00f3nea o incompleta 2: Entregada y soluci\u00f3n aceptable, aunque tiene alg\u00fan apartado incompleto 3: Entregada y soluci\u00f3n correcta. 70% Actividad de evaluaci\u00f3n Una o dos pruebas por evaluaci\u00f3n. La nota final se calcula mediante la media de cada una de las evaluaciones.","title":"Instrumentos de calificaci\u00f3n"},{"location":"01arquitecturas.html","text":"Arquitecturas Web \u00b6 Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 4 sesiones Resultado de aprendizaje: Selecciona las arquitecturas y tecnolog\u00edas de programaci\u00f3n Web en entorno servidor, analizando sus capacidades y caracter\u00edsticas propias. Criterios de evaluaci\u00f3n: Se han caracterizado y diferenciado los modelos de ejecuci\u00f3n de c\u00f3digo en el servidor y en el cliente Web. Se han reconocido las ventajas que proporciona la generaci\u00f3n din\u00e1mica de p\u00e1ginas Web y sus diferencias con la inclusi\u00f3n de sentencias de guiones en el interior de las p\u00e1ginas Web. Se han identificado los mecanismos de ejecuci\u00f3n de c\u00f3digo en los servidores Web. Se han reconocido las funcionalidades que aportan los servidores de aplicaciones y su integraci\u00f3n con los servidores Web. Se han identificado y caracterizado los principales lenguajes y tecnolog\u00edas relacionados con la programaci\u00f3n Web en entorno servidor. Se han verificado los mecanismos de integraci\u00f3n de los lenguajes de marcas con los lenguajes de programaci\u00f3n en entorno servidor. Se han reconocido y evaluado las herramientas de programaci\u00f3n en entorno servidor. Las arquitecturas web definen la forma en que las p\u00e1ginas de un sitio web est\u00e1n estructuradas y enlazadas entre s\u00ed. Las aplicaciones web se basan en en modelo cliente-servidor. Cliente / Servidor \u00b6 Arquitectura Cliente Servidor Uno o varios cliente acceden a un servidor. La nuevas arquitecturas sustituyen el servidor por un balanceador de carga de manera que N servidores dan respuesta a M clientes. En las aplicaciones web, el cliente es el navegador web. El cliente hace la petici\u00f3n ( request normalmente mediante el protocolo GET mediante el puerto 80/443) y el servidor responde ( response ). P\u00e1gina web din\u00e1mica \u00b6 Si la p\u00e1gina web \u00fanicamente contiene HTML + CSS se considera una p\u00e1gina est\u00e1tica. Para generar una p\u00e1gina din\u00e1mica, donde el contenido cambia, a d\u00eda de hoy tenemos dos alternativas: Utilizar un lenguaje de servidor que genere el contenido, ya sea mediante el acceso a una BD o servicios externos. Utilizar servicios REST de terceros invocados desde JS. P\u00e1gina web din\u00e1mica Las tecnolog\u00edas empleadadas (y los perfiles de desarrollo asociados) para la generaci\u00f3n de p\u00e1ginas din\u00e1micas son: Perfil Herramienta Tecnolog\u00eda Front-end / cliente Navegador Web HTML + CSS + JavaScript Back-end / servidor Servidor Web + BBDD PHP, Python, Ruby, Java / JSP, .Net / .asp Perfil Full-stack En las ofertas de trabajo cuando hacen referencia a un Full-stack developer , est\u00e1n buscando un perfil que domina tanto el front-end como el back-end . Single Page Application \u00b6 A d\u00eda de hoy, gran parte del desarrollo web est\u00e1 transicionando de una arquitectura web cliente-servidor cl\u00e1sica donde el cliente realiza una llamada al backend, por una arquitectura SPA donde el cliente gana mucho mayor peso y sigue una programaci\u00f3n reactiva que accede a servicios remotos REST que realizan las operaciones (comunicandose mediante JSON). Arquitectura tradicional vs SPA Arquitectura de 3 capas \u00b6 Hay que distinguir entre capas f\u00edsicas ( tier ) y capas l\u00f3gicas ( layer ). Tier \u00b6 Capa f\u00edsica de una arquitectura. Supone un nuevo elemento hardware separado f\u00edsicamente. Las capas f\u00edsicas m\u00e1s alejadas del cliente est\u00e1n m\u00e1s protegidas, tanto por firewalls como por VPN. Ejemplo de arquitectura en tres capas f\u00edsicas ( 3 tier ): Servidor Web Servidor de Aplicaciones Servidor de base de datos Arquitectura de tres capas f\u00edsicas Cluster en tiers No confundir las capas con la cantidad de servidores. Actualmente se trabaja con arquitecturas con m\u00faltiples servidores en una misma capa f\u00edsica mediante un cluster, para ofrecer tolerancia a errores y escalabilidad horizontal. Layer \u00b6 En cambio, las capas l\u00f3gicas ( layers ) organizan el c\u00f3digo respecto a su funcionalidad: Presentaci\u00f3n Negocio / Aplicaci\u00f3n / Proceso Datos / Persistencia Como se observa, cada una de las capas se puede implementar con diferentes lenguajes de programaci\u00f3n y/o herramientas. Arquitectura de tres capas f\u00edsicas en tres l\u00f3gicas MVC \u00b6 Model-View-Controller o Modelo-Vista-Controlador es un modelo de arquitectura que separa los datos y la l\u00f3gica de negocio respecto a la interfaz de usuario y el componente encargado de gestionar los eventos y las comunicaciones. Al separar los componentes en elementos conceptuales permite reutilizar el c\u00f3digo y mejorar su organizaci\u00f3n y mantenimiento. Sus elementos son: Modelo: representa la informaci\u00f3n y gestiona todos los accesos a \u00e9sta, tanto consultas como actualizaciones provenientes, normalmente, de una base de datos. Se accede via el controlador. Controlador: Responde a las acciones del usuario, y realiza peticiones al modelo para solicitar informaci\u00f3n. Tras recibir la respuesta del modelo, le env\u00eda los datos a la vista. Vista: Presenta al usuario de forma visual el modelo y los datos preparados por el controlador. El usuario interactura con la vista y realiza nuevas peticiones al controlador. Lo estudiaremos en m\u00e1s detalle al profundizar en el uso de los frameworks PHP. Decisiones de dise\u00f1o \u00b6 \u00bfQu\u00e9 tama\u00f1o tiene el proyecto? \u00bfQu\u00e9 lenguajes de programaci\u00f3n conozco? \u00bfVale la pena el esfuerzo de aprender uno nuevo? \u00bfVoy a usar herramientas de c\u00f3digo abierto o herramientas propietarias? \u00bfCu\u00e1l es el coste de utilizar soluciones comerciales? \u00bfVoy a programar la aplicaci\u00f3n yo solo o formar\u00e9 parte de un grupo de programadores? \u00bfCuento con alg\u00fan servidor web o gestor de base de datos disponible o puedo decidir libremente utilizar el que crea necesario? \u00bfQu\u00e9 tipo de licencia voy a aplicar a la aplicaci\u00f3n que desarrolle? Herramientas \u00b6 Servidor Web \u00b6 Software que recibe peticiones HTTP (GET, POST, DELETE, ...). Devuelve el recurso solicitado (HTML, CSS, JS, JSON, im\u00e1genes, etc...) El producto m\u00e1s implantando es Apache Web Server ( https://httpd.apache.org/ ), creado en 1995. Software libre y multiplataforma Sistema de m\u00f3dulos din\u00e1micos \u2192 PHP, Python, Perl Utiliza el archivo .htaccess para su configuraci\u00f3n En la actualidad, Apache est\u00e1 perdiendo mercado respecto a Nginx ( https://www.nginx.com ). Se trata de un producto m\u00e1s moderno (2004) y que en determinados escenarios tiene mejor rendimiento que Apache. Comparativa servidores web: https://w3techs.com/technologies/history_overview/web_server/ms/q Servidor de Aplicaciones \u00b6 Software que ofrece servicios adicionales a los de un servidor web: Clustering Balanceo de carga Tolerancia a fallos Tomcat ( http://tomcat.apache.org/ ) es el servidor de aplicaciones open source y multiplataforma de referencia para una arquitectura Java. Contiende un contenedor Web Java que interpreta Servlets y JSP. Info Tanto los servidores web como los servidores de aplicaciones los estudiaremos en profundidad en el m\u00f3dulo de \"Despliegue de Aplicaciones Web\" . Lenguajes en el servidor \u00b6 Las aplicaciones que generan las p\u00e1ginas web se programan en alguno de los siguientes lenguajes: PHP JavaEE: Servlets / JSP Python ASP.NET \u2192 Visual Basic .NET / C# Ruby ... JavaEE \u00b6 Java Enterprise Edition es la soluci\u00f3n Java para el desarrollo de aplicaciones enterprise . Ofrece una arquitectura muy completa y compleja, escalable y tolerante a fallos. Planteada para aplicaciones para grandes sistemas. PHP \u00b6 Lenguaje de prop\u00f3sito general dise\u00f1ado para el desarrollo de p\u00e1ginas web din\u00e1micas En un principio, lenguaje no tipado. Actualmente en la versi\u00f3n 8. Se recomienda al menos utilizar una versi\u00f3n superior a la 7.0. C\u00f3digo embebido en el HTML Instrucciones entre etiquetas <?php y ?> Para generar codigo dentro de PHP, podemos usar la instrucci\u00f3n echo Multitud de librer\u00edas y frameworks: Laravel, Symfony, Codeigniter, Zend Su documentaci\u00f3n es bastante completa: https://www.php.net/manual/es/index.php El siguiente mapa mental muestra un resumen de sus elementos: Elementos del lenguaje PHP Durante las siguientes unidades vamos a estudiar PHP en profundidad. Puesta en marcha \u00b6 Para poder trabajar con un entorno de desarrollo local, hemos de preparar nuestro entorno de desarrollo con las herramientas comentadas. A lo largo del curso vamos a utilizar la versi\u00f3n 8 de PHP. XAMPP \u00b6 XAMPP (https://www.apachefriends.org/es/index.html) es una distribuci\u00f3n compuesta con el software necesario para desarrollar en entorno servidor. Se compone de las siguientes herramientas en base a sus siglas: X para el sistema operativo (de ah\u00ed que se conozca tamnbi\u00e9n como LAMP o WAMP). A para Apache. M para MySQL / MariaDB. Tambi\u00e9n incluye phpMyAdmin para la administraci\u00f3n de la base de datos desde un interfaz web. P para PHP. la \u00faltima P para Perl. Desde la propia p\u00e1gina se puede descargar el archivo ejecutable para el sistema operativo de nuestro ordenador. Se recomienda leer la FAQ de cada sistema operativo con instrucciones para su puesta en marcha. XAMPP en Windows Si vas a trabajar con tu propio ordenador, XAMPP es una soluci\u00f3n m\u00e1s sencilla que Docker, sobre todo si trabajar con Windows como sistema operativo. Docker \u00b6 Docker ( https://www.docker.com ) es un gestor de contenedores, considerando un contenedor como un m\u00e9todo de virtualizaci\u00f3n del sistema operativo. El uso de contenedores requiere menos recursos que una m\u00e1quina virtual, por lo tanto, su lanzamiento y detenci\u00f3n son m\u00e1s r\u00e1pidos que las m\u00e1quinas virtuales. As\u00ed pues, Docker permite crear, probar e implementar aplicaciones r\u00e1pidamente, a partir de una serie de plantillas que se conocen como im\u00e1genes de Docker . Para ello es necesario tener instalado Docker Desktop ( https://www.docker.com/products/docker-desktop ) en nuestros entornos de desarrollo (el cual ya incluye en nucleo de Docker y la herramienta docker compose ). En los ordenadores del aula ya est\u00e1 instalado. Para instalarlo en casa, en el caso de Windows, es necesario instalar previamente WSL 2 , el cual es un subsistema de Linux dentro de Windows . A lo largo del curso iremos creando diferentes contenedores con los servicios necesarios, de manera que cada vez s\u00f3lo trabajemos con el software m\u00ednimo. Versiones A lo largo del curso vamos a usar PHP 8.0 . Respecto a Docker , para escribir los apuntes hemos utilizado la version 20.10 y la version 2.19 de docker compose . Finalmente, la versi\u00f3n de Docker Desktop que hemos utilizado es la 4.0 . Plantilla Servidor Web + PHP \u00b6 Docker se basa en el uso de im\u00e1genes para crear contenedores. Docker Compose simplifica el trabajo con m\u00faltiples contenedores, y por ello, para facilitar el arraque, nos centraremos en Docker Compose utilizando una plantilla que \u00fanicamente va a contener como servicios Apache/Nginx y PHP. Para ello, vamos a rellenar el archivo docker-compose.yaml con: Apache y PHP Nginx y PHP # Services services : # Apache + PHP apache_php : image : php:8-apache # Preparamos un volumen para almacenar nuestro c\u00f3digo volumes : - ./src/:/var/www/html expose : - 80 ports : - 80:80 # Services services : nginx : image : nginx:1.19 ports : - 80:80 volumes : - ./src:/var/www/php - ./.docker/nginx/conf.d:/etc/nginx/conf.d # cargamos la configuraci\u00f3n de un fichero externo depends_on : - php # enlazamos nginx con php php : image : php:8.0-fpm working_dir : /var/www/php volumes : - ./src:/var/www/php Dentro de la carpeta que contenga dicho archivo, hemos de crear una carpeta src donde colocaremos nuestro c\u00f3digo fuente. Para facilitar la puesta en marcha, ten\u00e9is la plantilla de Apache/PHP ( versi\u00f3n 2 con a2enmod rewrite ) o Nginx/PHP disponible para su descarga. Cuando estemos listos, lanzaremos el servicio mediante: docker-compose up -d Si queremos ver el contenido de los archivos de log del servicio utilizaremos: docker-compose logs -f Para copiar un archivo desde nuestro sistema al interior del contenedor: docker cp ./miFichero idContenedor:/tmp Y al rev\u00e9s, si queremos consultar un archivo contenido dentro de un contenedor, lo copiaremos a nuestro sistema: docker cp idContenedor:/tmp/archivoAConsultar.txt ./ Finalmente, si queremos acceder a un terminal interactivo dentro del contenedor: docker exec -it nombreContenedor bash Otros comandos que podemos llegar a utilizar son: docker ps : Ver los contenedores que se estan ejecutando docker ps -a : Ver todos los contenedores docker start nombreContenedor : Arrancar un contenedor docker images : Ver las im\u00e1genes que tenemos descargadas Otra forma m\u00e1s sencilla para lanzar de nuevo los contenedores y gestionarlos una vez creados es utilizar el interfaz gr\u00e1fico que ofrece Docker Desktop : Arranque de contenedor mediante Docker Desktop Docker stack Existen diversas opciones mediante Docker que ofrecen soluciones completas y empaquetas para todo el stack de desarrollo. En posteriores sesiones utilizaremos tanto Devilbox ( http://devilbox.org ) como Laradock ( https://laradock.io ) Pero quiero saber c\u00f3mo funciona... En el m\u00f3dulo de Despliegue de aplicaciones estudiar\u00e9is en profundidad, adem\u00e1s de Docker, Apache y otros servicios que nos servir\u00e1n de ayuda para el desarrollo en entorno servidor. Entorno de desarrollo \u00b6 En este curso vamos a emplear Visual Studio Code ( https://code.visualstudio.com ) como entorno de desarrollo (IDE). Existen otras alternativas, siendo PhpStorm la m\u00e1s conocida pero siendo de pago. Otra posibilidad es utilizar Eclipse , aunque es un entorno bastante pesado. VSCode es un editor de c\u00f3digo fuente que se complementa mediante extensiones. Para facilitar el trabajo a lo largo del curso vamos a utilizar las siguientes extensiones: PHP Intelephense Docker En la siguiente sesi\u00f3n comenzaremos a utilizar Intelephense pero en esta sesi\u00f3n nos vamos a centrar en Docker (m\u00e1s adelante instalaremos nuevas extensiones). Por ejemplo, si abrimos la extensi\u00f3n de Docker , podr\u00e9is visualizar tanto los contenedores como las im\u00e1genes de vuestro sistema. Desde cada contenedor, mediante clic derecho, podemos iniciar/detener/reiniciar cada contenedor, as\u00ed como ver su contenido o abrir un terminal dentro del mismo. Opciones mediante extensi\u00f3n Docker en VSCode Hola Mundo \u00b6 Y como no, nuestro primer ejemplo ser\u00e1 un Hola Mundo en PHP. Si nombramos el archivo como index.php , al acceder a http://localhost autom\u00e1ticamente cargar\u00e1 el resultado: <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > Hola Mundo </ title > </ head > < body > <?php echo \"Hola Mundo\" ; ?> </ body > </ html > Referencias \u00b6 Curso de introducci\u00f3n a Docker, por Sergi Garc\u00eda Barea : https://sergarb1.github.io/CursoIntroduccionADocker/ Art\u00edculo Arquitecturas Web y su evoluci\u00f3n Actividades \u00b6 Busca en internet cuales son los tres frameworks PHP m\u00e1s utilizados, y indica: Nombre y URL A\u00f1o de creaci\u00f3n \u00daltima versi\u00f3n Busca tres ofertas de trabajo de desarrollo de software en Infojobs en la provincia de Alicante que citen PHP y anota: Empresa + puesto + frameworks PHP + requ\u00edsitos + sueldo + enlace a la oferta. Una vez arrancado el servicio PHP (mediante XAMPP o Docker), crea el archivo info.php y a\u00f1ade el siguiente fragmento de c\u00f3digo: <?php phpinfo () ?> Anota los valores de: Versi\u00f3n de PHP Loaded Configuration File memory_limit DOCUMENT_ROOT Abre el archivo php.ini-production que est\u00e1 dentro del contenedor (puedes averiguar la ruta a partir de la propiedad Configuration File (php.ini) Path ) e indica para qu\u00e9 sirven las siguientes propiedades y qu\u00e9 valores contienen: file_uploads max_execution_time short_open_tag php.ini Es el archivo de configuraci\u00f3n de PHP, y en toda instalaci\u00f3n vienen dos plantillas ( php.ini-development y php.ini-production ) para que elijamos los valores m\u00e1s acordes a nuestro proyecto y creemos nuestro archivo propio de php.ini .","title":"1.- Arquitecturas Web"},{"location":"01arquitecturas.html#arquitecturas-web","text":"Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 4 sesiones Resultado de aprendizaje: Selecciona las arquitecturas y tecnolog\u00edas de programaci\u00f3n Web en entorno servidor, analizando sus capacidades y caracter\u00edsticas propias. Criterios de evaluaci\u00f3n: Se han caracterizado y diferenciado los modelos de ejecuci\u00f3n de c\u00f3digo en el servidor y en el cliente Web. Se han reconocido las ventajas que proporciona la generaci\u00f3n din\u00e1mica de p\u00e1ginas Web y sus diferencias con la inclusi\u00f3n de sentencias de guiones en el interior de las p\u00e1ginas Web. Se han identificado los mecanismos de ejecuci\u00f3n de c\u00f3digo en los servidores Web. Se han reconocido las funcionalidades que aportan los servidores de aplicaciones y su integraci\u00f3n con los servidores Web. Se han identificado y caracterizado los principales lenguajes y tecnolog\u00edas relacionados con la programaci\u00f3n Web en entorno servidor. Se han verificado los mecanismos de integraci\u00f3n de los lenguajes de marcas con los lenguajes de programaci\u00f3n en entorno servidor. Se han reconocido y evaluado las herramientas de programaci\u00f3n en entorno servidor. Las arquitecturas web definen la forma en que las p\u00e1ginas de un sitio web est\u00e1n estructuradas y enlazadas entre s\u00ed. Las aplicaciones web se basan en en modelo cliente-servidor.","title":"Arquitecturas Web"},{"location":"01arquitecturas.html#cliente-servidor","text":"Arquitectura Cliente Servidor Uno o varios cliente acceden a un servidor. La nuevas arquitecturas sustituyen el servidor por un balanceador de carga de manera que N servidores dan respuesta a M clientes. En las aplicaciones web, el cliente es el navegador web. El cliente hace la petici\u00f3n ( request normalmente mediante el protocolo GET mediante el puerto 80/443) y el servidor responde ( response ).","title":"Cliente / Servidor"},{"location":"01arquitecturas.html#pagina-web-dinamica","text":"Si la p\u00e1gina web \u00fanicamente contiene HTML + CSS se considera una p\u00e1gina est\u00e1tica. Para generar una p\u00e1gina din\u00e1mica, donde el contenido cambia, a d\u00eda de hoy tenemos dos alternativas: Utilizar un lenguaje de servidor que genere el contenido, ya sea mediante el acceso a una BD o servicios externos. Utilizar servicios REST de terceros invocados desde JS. P\u00e1gina web din\u00e1mica Las tecnolog\u00edas empleadadas (y los perfiles de desarrollo asociados) para la generaci\u00f3n de p\u00e1ginas din\u00e1micas son: Perfil Herramienta Tecnolog\u00eda Front-end / cliente Navegador Web HTML + CSS + JavaScript Back-end / servidor Servidor Web + BBDD PHP, Python, Ruby, Java / JSP, .Net / .asp Perfil Full-stack En las ofertas de trabajo cuando hacen referencia a un Full-stack developer , est\u00e1n buscando un perfil que domina tanto el front-end como el back-end .","title":"P\u00e1gina web din\u00e1mica"},{"location":"01arquitecturas.html#single-page-application","text":"A d\u00eda de hoy, gran parte del desarrollo web est\u00e1 transicionando de una arquitectura web cliente-servidor cl\u00e1sica donde el cliente realiza una llamada al backend, por una arquitectura SPA donde el cliente gana mucho mayor peso y sigue una programaci\u00f3n reactiva que accede a servicios remotos REST que realizan las operaciones (comunicandose mediante JSON). Arquitectura tradicional vs SPA","title":"Single Page Application"},{"location":"01arquitecturas.html#arquitectura-de-3-capas","text":"Hay que distinguir entre capas f\u00edsicas ( tier ) y capas l\u00f3gicas ( layer ).","title":"Arquitectura de 3 capas"},{"location":"01arquitecturas.html#tier","text":"Capa f\u00edsica de una arquitectura. Supone un nuevo elemento hardware separado f\u00edsicamente. Las capas f\u00edsicas m\u00e1s alejadas del cliente est\u00e1n m\u00e1s protegidas, tanto por firewalls como por VPN. Ejemplo de arquitectura en tres capas f\u00edsicas ( 3 tier ): Servidor Web Servidor de Aplicaciones Servidor de base de datos Arquitectura de tres capas f\u00edsicas Cluster en tiers No confundir las capas con la cantidad de servidores. Actualmente se trabaja con arquitecturas con m\u00faltiples servidores en una misma capa f\u00edsica mediante un cluster, para ofrecer tolerancia a errores y escalabilidad horizontal.","title":"Tier"},{"location":"01arquitecturas.html#layer","text":"En cambio, las capas l\u00f3gicas ( layers ) organizan el c\u00f3digo respecto a su funcionalidad: Presentaci\u00f3n Negocio / Aplicaci\u00f3n / Proceso Datos / Persistencia Como se observa, cada una de las capas se puede implementar con diferentes lenguajes de programaci\u00f3n y/o herramientas. Arquitectura de tres capas f\u00edsicas en tres l\u00f3gicas","title":"Layer"},{"location":"01arquitecturas.html#mvc","text":"Model-View-Controller o Modelo-Vista-Controlador es un modelo de arquitectura que separa los datos y la l\u00f3gica de negocio respecto a la interfaz de usuario y el componente encargado de gestionar los eventos y las comunicaciones. Al separar los componentes en elementos conceptuales permite reutilizar el c\u00f3digo y mejorar su organizaci\u00f3n y mantenimiento. Sus elementos son: Modelo: representa la informaci\u00f3n y gestiona todos los accesos a \u00e9sta, tanto consultas como actualizaciones provenientes, normalmente, de una base de datos. Se accede via el controlador. Controlador: Responde a las acciones del usuario, y realiza peticiones al modelo para solicitar informaci\u00f3n. Tras recibir la respuesta del modelo, le env\u00eda los datos a la vista. Vista: Presenta al usuario de forma visual el modelo y los datos preparados por el controlador. El usuario interactura con la vista y realiza nuevas peticiones al controlador. Lo estudiaremos en m\u00e1s detalle al profundizar en el uso de los frameworks PHP.","title":"MVC"},{"location":"01arquitecturas.html#decisiones-de-diseno","text":"\u00bfQu\u00e9 tama\u00f1o tiene el proyecto? \u00bfQu\u00e9 lenguajes de programaci\u00f3n conozco? \u00bfVale la pena el esfuerzo de aprender uno nuevo? \u00bfVoy a usar herramientas de c\u00f3digo abierto o herramientas propietarias? \u00bfCu\u00e1l es el coste de utilizar soluciones comerciales? \u00bfVoy a programar la aplicaci\u00f3n yo solo o formar\u00e9 parte de un grupo de programadores? \u00bfCuento con alg\u00fan servidor web o gestor de base de datos disponible o puedo decidir libremente utilizar el que crea necesario? \u00bfQu\u00e9 tipo de licencia voy a aplicar a la aplicaci\u00f3n que desarrolle?","title":"Decisiones de dise\u00f1o"},{"location":"01arquitecturas.html#herramientas","text":"","title":"Herramientas"},{"location":"01arquitecturas.html#servidor-web","text":"Software que recibe peticiones HTTP (GET, POST, DELETE, ...). Devuelve el recurso solicitado (HTML, CSS, JS, JSON, im\u00e1genes, etc...) El producto m\u00e1s implantando es Apache Web Server ( https://httpd.apache.org/ ), creado en 1995. Software libre y multiplataforma Sistema de m\u00f3dulos din\u00e1micos \u2192 PHP, Python, Perl Utiliza el archivo .htaccess para su configuraci\u00f3n En la actualidad, Apache est\u00e1 perdiendo mercado respecto a Nginx ( https://www.nginx.com ). Se trata de un producto m\u00e1s moderno (2004) y que en determinados escenarios tiene mejor rendimiento que Apache. Comparativa servidores web: https://w3techs.com/technologies/history_overview/web_server/ms/q","title":"Servidor Web"},{"location":"01arquitecturas.html#servidor-de-aplicaciones","text":"Software que ofrece servicios adicionales a los de un servidor web: Clustering Balanceo de carga Tolerancia a fallos Tomcat ( http://tomcat.apache.org/ ) es el servidor de aplicaciones open source y multiplataforma de referencia para una arquitectura Java. Contiende un contenedor Web Java que interpreta Servlets y JSP. Info Tanto los servidores web como los servidores de aplicaciones los estudiaremos en profundidad en el m\u00f3dulo de \"Despliegue de Aplicaciones Web\" .","title":"Servidor de Aplicaciones"},{"location":"01arquitecturas.html#lenguajes-en-el-servidor","text":"Las aplicaciones que generan las p\u00e1ginas web se programan en alguno de los siguientes lenguajes: PHP JavaEE: Servlets / JSP Python ASP.NET \u2192 Visual Basic .NET / C# Ruby ...","title":"Lenguajes en el servidor"},{"location":"01arquitecturas.html#puesta-en-marcha","text":"Para poder trabajar con un entorno de desarrollo local, hemos de preparar nuestro entorno de desarrollo con las herramientas comentadas. A lo largo del curso vamos a utilizar la versi\u00f3n 8 de PHP.","title":"Puesta en marcha"},{"location":"01arquitecturas.html#xampp","text":"XAMPP (https://www.apachefriends.org/es/index.html) es una distribuci\u00f3n compuesta con el software necesario para desarrollar en entorno servidor. Se compone de las siguientes herramientas en base a sus siglas: X para el sistema operativo (de ah\u00ed que se conozca tamnbi\u00e9n como LAMP o WAMP). A para Apache. M para MySQL / MariaDB. Tambi\u00e9n incluye phpMyAdmin para la administraci\u00f3n de la base de datos desde un interfaz web. P para PHP. la \u00faltima P para Perl. Desde la propia p\u00e1gina se puede descargar el archivo ejecutable para el sistema operativo de nuestro ordenador. Se recomienda leer la FAQ de cada sistema operativo con instrucciones para su puesta en marcha. XAMPP en Windows Si vas a trabajar con tu propio ordenador, XAMPP es una soluci\u00f3n m\u00e1s sencilla que Docker, sobre todo si trabajar con Windows como sistema operativo.","title":"XAMPP"},{"location":"01arquitecturas.html#docker","text":"Docker ( https://www.docker.com ) es un gestor de contenedores, considerando un contenedor como un m\u00e9todo de virtualizaci\u00f3n del sistema operativo. El uso de contenedores requiere menos recursos que una m\u00e1quina virtual, por lo tanto, su lanzamiento y detenci\u00f3n son m\u00e1s r\u00e1pidos que las m\u00e1quinas virtuales. As\u00ed pues, Docker permite crear, probar e implementar aplicaciones r\u00e1pidamente, a partir de una serie de plantillas que se conocen como im\u00e1genes de Docker . Para ello es necesario tener instalado Docker Desktop ( https://www.docker.com/products/docker-desktop ) en nuestros entornos de desarrollo (el cual ya incluye en nucleo de Docker y la herramienta docker compose ). En los ordenadores del aula ya est\u00e1 instalado. Para instalarlo en casa, en el caso de Windows, es necesario instalar previamente WSL 2 , el cual es un subsistema de Linux dentro de Windows . A lo largo del curso iremos creando diferentes contenedores con los servicios necesarios, de manera que cada vez s\u00f3lo trabajemos con el software m\u00ednimo. Versiones A lo largo del curso vamos a usar PHP 8.0 . Respecto a Docker , para escribir los apuntes hemos utilizado la version 20.10 y la version 2.19 de docker compose . Finalmente, la versi\u00f3n de Docker Desktop que hemos utilizado es la 4.0 .","title":"Docker"},{"location":"01arquitecturas.html#entorno-de-desarrollo","text":"En este curso vamos a emplear Visual Studio Code ( https://code.visualstudio.com ) como entorno de desarrollo (IDE). Existen otras alternativas, siendo PhpStorm la m\u00e1s conocida pero siendo de pago. Otra posibilidad es utilizar Eclipse , aunque es un entorno bastante pesado. VSCode es un editor de c\u00f3digo fuente que se complementa mediante extensiones. Para facilitar el trabajo a lo largo del curso vamos a utilizar las siguientes extensiones: PHP Intelephense Docker En la siguiente sesi\u00f3n comenzaremos a utilizar Intelephense pero en esta sesi\u00f3n nos vamos a centrar en Docker (m\u00e1s adelante instalaremos nuevas extensiones). Por ejemplo, si abrimos la extensi\u00f3n de Docker , podr\u00e9is visualizar tanto los contenedores como las im\u00e1genes de vuestro sistema. Desde cada contenedor, mediante clic derecho, podemos iniciar/detener/reiniciar cada contenedor, as\u00ed como ver su contenido o abrir un terminal dentro del mismo. Opciones mediante extensi\u00f3n Docker en VSCode","title":"Entorno de desarrollo"},{"location":"01arquitecturas.html#hola-mundo","text":"Y como no, nuestro primer ejemplo ser\u00e1 un Hola Mundo en PHP. Si nombramos el archivo como index.php , al acceder a http://localhost autom\u00e1ticamente cargar\u00e1 el resultado: <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > Hola Mundo </ title > </ head > < body > <?php echo \"Hola Mundo\" ; ?> </ body > </ html >","title":"Hola Mundo"},{"location":"01arquitecturas.html#referencias","text":"Curso de introducci\u00f3n a Docker, por Sergi Garc\u00eda Barea : https://sergarb1.github.io/CursoIntroduccionADocker/ Art\u00edculo Arquitecturas Web y su evoluci\u00f3n","title":"Referencias"},{"location":"01arquitecturas.html#actividades","text":"Busca en internet cuales son los tres frameworks PHP m\u00e1s utilizados, y indica: Nombre y URL A\u00f1o de creaci\u00f3n \u00daltima versi\u00f3n Busca tres ofertas de trabajo de desarrollo de software en Infojobs en la provincia de Alicante que citen PHP y anota: Empresa + puesto + frameworks PHP + requ\u00edsitos + sueldo + enlace a la oferta. Una vez arrancado el servicio PHP (mediante XAMPP o Docker), crea el archivo info.php y a\u00f1ade el siguiente fragmento de c\u00f3digo: <?php phpinfo () ?> Anota los valores de: Versi\u00f3n de PHP Loaded Configuration File memory_limit DOCUMENT_ROOT Abre el archivo php.ini-production que est\u00e1 dentro del contenedor (puedes averiguar la ruta a partir de la propiedad Configuration File (php.ini) Path ) e indica para qu\u00e9 sirven las siguientes propiedades y qu\u00e9 valores contienen: file_uploads max_execution_time short_open_tag php.ini Es el archivo de configuraci\u00f3n de PHP, y en toda instalaci\u00f3n vienen dos plantillas ( php.ini-development y php.ini-production ) para que elijamos los valores m\u00e1s acordes a nuestro proyecto y creemos nuestro archivo propio de php.ini .","title":"Actividades"},{"location":"02php.html","text":"El lenguaje PHP \u00b6 Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 26 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n: Escribe sentencias ejecutables por un servidor Web reconociendo y aplicando procedimientos de integraci\u00f3n del c\u00f3digo en lenguajes de marcas. Se han reconocido los mecanismos de generaci\u00f3n de p\u00e1ginas Web a partir de lenguajes de marcas con c\u00f3digo embebido. Se han identificado las principales tecnolog\u00edas asociadas. Se han utilizado etiquetas para la inclusi\u00f3n de c\u00f3digo en el lenguaje de marcas. Se ha reconocido la sintaxis del lenguaje de programaci\u00f3n que se ha de utilizar. Se han escrito sentencias simples y se han comprobado sus efectos en el documento resultante. Se han utilizado directivas para modificar el comportamiento predeterminado. Se han utilizado los distintos tipos de variables y operadores disponibles en el lenguaje. Se han identificado los \u00e1mbitos de utilizaci\u00f3n de las variables. Resultado de aprendizaje: Escribe bloques de sentencias embebidos en lenguajes de marcas, seleccionando y utilizando las estructuras de programaci\u00f3n. Criterios de evaluaci\u00f3n: Se han utilizado mecanismos de decisi\u00f3n en la creaci\u00f3n de bloques de sentencias. Se han utilizado bucles y se ha verificado su funcionamiento. Se han utilizado \u201carrays\u201d para almacenar y recuperar conjuntos de datos. Se han creado y utilizado funciones. Se han utilizado formularios web para interactuar con el usuario del navegador Web. Se han empleado m\u00e9todos para recuperar la informaci\u00f3n introducida en el formulario. Se han a\u00f1adido comentarios al c\u00f3digo. PHP \u00b6 Acr\u00f3nimo de Personal Home Page Lenguaje de prop\u00f3sito general, aunque su fuerte es el desarollo web. Sintaxis similar a C / Java El c\u00f3digo se ejecuta en el servidor (en Apache mediante mod_php ) El cliente recibe el resultado generado tras interpretar el c\u00f3digo en el servidor. El c\u00f3digo se almacena en archivo con extensi\u00f3n .php . La \u00faltima versi\u00f3n es la 8.0, de Noviembre de 2020 (y en menos de un par de meses tendremos la versi\u00f3n 8.1). La versi\u00f3n 7.0 sali\u00f3 en Diciembre de 2015. Adem\u00e1s de numerosas nuevas funcionalidades que iremos viendo durante el curso, tiene m\u00e1s de dos veces mejor rendimiento que PHP5. Su documentaci\u00f3n es extensa y est\u00e1 traducida: https://www.php.net/manual/es/ . C\u00f3digo embebido \u00b6 Los bloques de c\u00f3digo se escriben entre <?php y ?> , mientras que las sentencias se separan mediante ; . <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < title > PHP f\u00e1cil </ title > </ head > < body > <!-- Muestra una frase con HTML --> Hola mundo < br > <!-- Muestra una frase con PHP --> <?php echo \"Es muy f\u00e1cil programar en PHP.\" ; ?> </ body > </ html > S\u00f3lo etiquetas de apertura Si nuestro c\u00f3digo s\u00f3lo va a contener c\u00f3digo PHP y nada de html, como por ejemplo, cuando codifiquemos clases o interfaces, s\u00f3lo pondremos la etiqueta de apertura, para as\u00ed indicar que es una archivo de php puro. Generando contenido \u00b6 Tenemos tres posibilidades a la hora de generar contenido en nuestros documentos PHP: echo expresi\u00f3n; print (expresi\u00f3n); <?= expresi\u00f3n ?> Las que vamos a utilizar son echo cuando lo hagamos dentro de un bloque de instrucciones y <?= cuando s\u00f3lo vayamos a mostrar el valor de una variable dentro de un fragmento HTML. <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > Echo y print </ title > </ head > < body > < p > <?php echo \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\" ?> </ p > < p > <? = \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\" ?> </ p > < p > <?php print ( \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\" ) ?> </ p > </ body > </ html > Comentarios \u00b6 Podemos utilizar comentarios de una l\u00ednea o de bloque: <?php // Este es un comentario de una sola l\u00ednea /* Este es un comentario que ocupa varias l\u00edneas */ ?> Errores \u00b6 Si hay un error de ejecuci\u00f3n, se produce un Fatal Error . Fatal error: Uncaught Error: Call to undefined function plint() in C:\\xampp\\htdocs\\202echo.php:11 Stack trace: # 0 { main } thrown in C:\\xampp\\htdocs\\202echo.php on line 11 Desde PHP 5 se lanzan como una excepci\u00f3n. M\u00e1s adelante veremos el uso de try / catch . Variables \u00b6 No es necesario declararlas previamente. Comienzan por $ , por ejemplo $nombre . Tras el $ , el siguiente caracter debe ser una letra en min\u00fascula (recomendaci\u00f3n) o gui\u00f3n bajo _ . Luego ya se pueden poner n\u00fameros. Son case sensitive : $var != $vAR No se declara su tipo, el tipado es din\u00e1mico. Se asigna en tiempo de ejecuci\u00f3n dependiendo del valor asignado. Conveniente inicializarlas, sino dan error. <?php $nombre = \"Aitor\" ; $nombreCompleto = \"Aitor Medrano\" ; $numero = 123 ; $numero2 = 456 ; $pi = 3.14 ; $suerte = true ; $sinValor ; echo $sinValor ; ?> Tipos Aunque a priori no hay tipos de datos, internamente PHP trabaja con cuatro tipos escalares: boolean , integer , float y string y cuatro tipos compuestos: array , object , callable e iterable . Existe un tipo especial para null (m\u00e1s informaci\u00f3n en http://php.net/manual/es/language.types.null.php ). Constantes \u00b6 Son variables cuyo valor no var\u00edan. Existen dos posibilidades: define(NOMBRE, valor); const NOMBRE; // PHP > 5.3 <?php define ( \"PI\" , 3.1416 ); const IVA = 0.21 ; echo PI , \" \" , IVA ; // No se pone el s\u00edmbolo dolar ?> Se declaran siempre en MAY\u00daSCULAS Hay un conjunto de constantes ya predefinidas, tambi\u00e9n conocidas como magic constants : https://www.php.net/manual/es/language.constants.predefined.php Operadores \u00b6 Arim\u00e9ticos \u00b6 Ejemplo Nombre Resultado -$a Negaci\u00f3n Opuesto de $a . $a + $b Suma Suma de $a y $b . $a - $b Resta Diferencia de $a y $b . $a * $b Multiplicaci\u00f3n Producto de $a y $b . $a / $b Divisi\u00f3n Cociente de $a y $b . $a % $b M\u00f3dulo / Resto Resto de $a dividido por $b . $a ** $b Potencia Resultado de $a elevado a $b . PHP >= 5.6. En el caso de cadenas , si queremos concatenarlas, se utiliza el operador . : <?php $x = 33 ; $y = 11 ; $z = $x + $y ; echo \"La suma de 33 y 11 es \" . 44. \"<br />\" ; echo \"La suma de \" . $x . \" y \" . $y . \" es \" . ( 33 + 11 ) . \"<br />\" ; echo \"La suma de \" . $x . \" y \" . $y . \" es \" . $z . \"<br />\" ; ?> Realmente, en vez de concatenar cadenas con variables, podemos imprimirlas directamente ya que se expanden autom\u00e1ticamente: <?php echo \"La suma de $x y $y es $z <br />\" ; ?> En ocasiones, necesitamos rodear el nombre de la variable entre llaves para poder unir m\u00e1s texto al resultado: <?php $color = \"rojo\" ; echo \"El plural de $color el ${ color } s\" ; ?> M\u00e1s adelante estudiaremos algunas funciones para el tratamiento de cadenas. Comparaci\u00f3n \u00b6 Ejemplo Nombre Resultado $a == $b Igual true si $a es igual a $b tras de la conversi\u00f3n de tipos. $a === $b Id\u00e9ntico, Comparaci\u00f3n estricta true si $a es igual a $b , y son del mismo tipo de dato. $a != $b , $a <> $b Diferente true si $a no es igual a $b despu\u00e9s de la conversi\u00f3n de tipos. $a !== $b No id\u00e9ntico true si $a no es igual a $b , o si no son del mismo tipo. $a < $b Menor que true si $a es estrictamente menor que $b . $a > $b Mayor que true si $a es estrictamente mayor que $b . $a <= $b Menor o igual que true si $a es menor o igual que $b . $a >= $b Mayor o igual que true si $a es mayor o igual que $b . $a <=> $b Nave espacial Devuelve -1 , 0 o 1 cuando $a es respectivamente menor, igual, o mayor que $b . PHP >= 7. $a ?? $b ?? $c Fusi\u00f3n de null El primer operando de izquierda a derecha que exista y no sea null . null si no hay valores definidos y no son null . PHP >= 7. L\u00f3gicos \u00b6 Ejemplo Nombre Resultado $a and $b , $a && $b And (y) true si tanto $a como $b son true . $a or $b , $a || $b Or (o inclusivo) true si cualquiera de $a o $b es true . $a xor $b Xor (o exclusivo) true si $a o $b es true , pero no ambos. !$a Not (no) true si $a no es true . Asignaci\u00f3n \u00b6 Ejemplo Nombre Resultado $a = $b Asignaci\u00f3n Asigna a $a el valor de $b $a += $b Asignaci\u00f3n de la suma Le suma a $a el valor de $b . Equivalente a $a = $a + $b $a -= $b Asignaci\u00f3n de la resta Le resta a $a el valor de $b . Equivalente a $a = $a - $b $a *= $b Asignaci\u00f3n del producto Asigna a $a el producto de $a por $b . Equivalente a $a = $a * $b $a /= $b Asignaci\u00f3n de la divisi\u00f3n Asigna a $a el conciente de $a entre $b . Equivalente a $a = $a / $b $a %= $b Asignaci\u00f3n del resto Asigna a $a el resto de dividir $a entre $b . Equivalente a $a = $a % $b $a .= $b Concatenaci\u00f3n Concatena a $a la cadena $b . Equivalente a $a = $a . $b $a++ Incremento Incrementa $a en una unidad. Equivalente a $a = $a + 1 $a-- Decremento Decrementa $a en una unidad. Equivalente a $a = $a - 1 Prioridad de los operadores Recuerda la prioridad. Primero los par\u00e9ntesis, luego la negaci\u00f3n ( ! ), productos/divisiones, sumas/restas, comparaciones, l\u00f3gicos y por \u00faltimo se realiza la asignaci\u00f3n. M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.operators.precedence.php Autoevaluaci\u00f3n Si $a=5 y $b=4 , averigua el valor de $c si $c = $a*2 > $b+5 && !($b<>4) Trabajando con formularios \u00b6 Los datos se env\u00edan via URL con el formato var1=valor1&var2=valor2\u2026 . Por ejemplo: ejemplo.php?nombre=Bruce+apellido1=Wayne Se divide en dos pasos: Generar un formulario con action='archivo.php' method='GET' En el archivo .php leer los datos con $_GET['nombreVar'] Vamos a separar siempre que podamos el c\u00f3digo HTML del de PHP. Por ejemplo, el formulario lo colocamos en saluda.html : < form action = \"saluda.php\" method = \"get\" > < p >< label for = \"nombre\" > Nombre: </ label > < input type = \"text\" name = \"nombre\" id = \"nombre\" ></ p > < p >< label for = \"apellido1\" > Primer apellido: </ label > < input type = \"text\" name = \"apellido1\" id = \"apellido1\" ></ p > < p >< input type = \"submit\" value = \"enviar\" ></ p > </ form > Y recogemos los datos en saluda.php : <?php $nombre = $_GET [ \"nombre\" ]; $apellido1 = $_GET [ \"apellido1\" ]; echo \"Hola $nombre $apellido1 \" ; ?> Si lo quisi\u00e9ramos realizar todo en un \u00fanico archivo ( lo cual no es recomendable ), podemos hacerlo as\u00ed: < form action = \"\" method = \"get\" > < p >< label for = \"nombre\" > Nombre: </ label > < input type = \"text\" name = \"nombre\" id = \"nombre\" ></ p > < p >< label for = \"apellido1\" > Primer apellido: </ label > < input type = \"text\" name = \"apellido1\" id = \"apellido1\" ></ p > < input type = \"submit\" value = \"enviar\" > </ form > < p > <?php if ( isset ( $_GET [ 'nombre' ])) { $nombre = $_GET [ \"nombre\" ]; $apellido1 = $_GET [ \"apellido1\" ]; echo \"Hola $nombre $apellido1 \" ; } ?> </ p > El trabajo con formularios lo estudiaremos en profundidad en la unidad 4, y veremos que adem\u00e1s de GET , podemos enviar los datos con POST . Condiciones \u00b6 La condici\u00f3n simple se realiza mediante la instrucci\u00f3n if . Entre par\u00e9ntesis se pone la condici\u00f3n que se evalua a true o false . Si no se ponen llaves, en vez de abrir un bloque, se ejecutar\u00e1 s\u00f3lo la siguiente instrucci\u00f3n. Siempre llaves Es recomendable poner llaves siempre aunque en el momento de codificar s\u00f3lo haya una \u00fanica instrucci\u00f3n. De este modo, se queda preparado para a\u00f1adir m\u00e1s contenido en el futuro sin provocar bugs . <?php $hora = 8 ; // La hora en formato de 24 horas if ( $hora === 8 ) { echo \"Suena el despertador.\" ; } echo \"<br>\" ; if ( $hora === 8 ) echo \"Suena el despertador.\" ; ?> Las condiciones compuesta mediante if-else : <?php $hora = 17 ; // La hora en formato de 24 horas if ( $hora <= 12 ) { echo \"Son las \" . $hora . \" de la ma\u00f1ana\" ; } else { echo \"Son las \" . ( $hora - 12 ) . \" de la tarde\" ; } ?> Las condiciones anidadas mediante if-else if-else : <?php $hora = 14 ; // La hora en formato de 24 horas if ( $hora === 8 ) { echo \"Es la hora de desayunar.\" ; } else if ( $hora === 14 ) { echo \"Es la hora de la comida.\" ; } else if ( $hora === 21 ) { echo \"Es la hora de la cena.\" ; } else { echo \"Ahora no toca comer.\" ; } ?> La sentencia switch tambi\u00e9n permite trabajar con condiciones m\u00faltiples: <?php $hora = 14 ; // La hora en formato de 24 horas switch ( $hora ) { case 9 : echo \"Es la hora de desayunar.\" ; break ; case 14 : echo \"Es la hora de la comida.\" ; break ; case 21 : echo \"Es la hora de la cena.\" ; break ; default : echo \"Ahora no toca comer\" ; } ?> No olvides el break Un error muy com\u00fan es olvidar la instrucci\u00f3n break tras cada caso. Si no lo ponemos, ejecutar\u00e1 el siguiente caso autom\u00e1ticamente. Finalmente, tambi\u00e9n tenemos el operador ternario condici\u00f3n ? valorTrue : valorFalse : <?php $hora = 14 ; $formato = ( $hora > 12 ) ? 24 : 12 ; echo \"El formato es de $formato horas\" ?> Si queremos comprobar si una variable tiene valor y si no darle un valor determinado, usaremos el operador ?: (se conoce como el operador Elvis - https://en.wikipedia.org/wiki/Elvis_operator ) con la sint\u00e1xis expresi\u00f3n ?: valorSiVacio : <?php $nombre = $_GET [ 'nombre' ] ?: \"desconocido\" ?> Bucles \u00b6 Mediante la instrucci\u00f3n while : <?php $i = 1 ; while ( $i <= 10 ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; $i ++ ; } ?> Mediante la instrucci\u00f3n do-while : <?php do { $dado = rand ( 1 , 6 ); // rand() devuelve un valor aleatorio echo \"Tirando el dado... \" ; echo \"ha salido un \" . $dado . \".\" ; echo \"<br>\" ; } while ( $dado != 5 ); echo \"\u00a1Bien! Saco una ficha de casa.\" ; ?> Mediante la instrucci\u00f3n for : <?php // Bucle ascendente for ( $i = 1 ; $i <= 10 ; $i ++ ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; } // Bucle descendente for ( $i = 10 ; $i >= 0 ; $i -- ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; } ?> M\u00e1s adelante estudiaremos el bucle foreach para recorrer arrays. PHP, del mismo modo que Java y C, permite romper los bucles mediante la instrucci\u00f3n break . A su vez, continue permite saltar a la siguiente iteraci\u00f3n. Si puedes, evita break y continue Personalmente, no me gusta su uso. Prefiero el uso de variables flag para controlar la salida de los bucles. Por ejemplo: <?php $salir = false ; for ( $i = 1 ; $i <= 10 && ! $salir ; $i ++ ) { if ( $i === 5 ) { echo \"Salgo cuando i=5\" ; $salir = true ; } } ?> Arrays \u00b6 Para almacenar datos compuestos, podemos utilizar tanto arrays sencillos como arrays asociativos (similares a un mapa). En realidad todos los arrays son mapas ordenados compuestos de pares clave-valor. Cuidado con mezclar tipos Como el tipado es din\u00e1mico, nuestros arrays pueden contenedor datos de diferentes tipos. No se recomienda mezclar los tipos. Del mismo modo que Java, se definen mediante corchetes, son 0-index , y se puede asignar un valor a un posici\u00f3n determinada: <?php $frutas = array ( \"naranja\" , \"pera\" , \"manzana\" ); $frutas2 = [ \"naranja\" , \"pera\" , \"manzana\" ]; $frutas3 = []; $frutas3 [ 0 ] = \"naranja\" ; $frutas3 [ 1 ] = \"pera\" ; $frutas3 [] = \"manzana\" ; // lo a\u00f1ade al final Podemos obtener el tama\u00f1o del array mediante la funci\u00f3n count(array) . Para recorrer el array haremos uso de un bucle for : <?php $tam = count ( $frutas ); // tama\u00f1o del array for ( $i = 0 ; $i < count ( $frutas ); $i ++ ) { echo \"Elemento $i : $frutas[$i] <br />\" ; } Otra forma de recorrer los arrays, incluso m\u00e1s elegante, es hacer uso de foreach . Su sintaxis es foreach (array as elemento) : <?php // Mediante foreach no necesitamos saber el tama\u00f1o del array foreach ( $frutas as $fruta ) { echo \" $fruta <br />\" ; } Arrays asociativos \u00b6 Cada elemento es un par clave-valor. En vez de acceder por la posici\u00f3n, lo hacemos mediante una clave. As\u00ed pues, para cada clave se almacena un valor. A la hora de recorrer este tipo de arrays, mediante foreach separamos cada elemento en una pareja clave => valor : <?php $capitales = [ \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ]; $capitalFrancia = $capitales [ \"Francia\" ]; // se accede al elemento por la clave, no la posici\u00f3n $capitales [ \"Alemania\" ] = \"Berl\u00edn\" ; // a\u00f1adimos un elemento echo \"La capital de Francia es $capitalFrancia <br />\" ; echo \"La capital de Francia es { $capitales [ \"Francia\" ] } <br />\" ; $capitales [] = \"Madrid\" ; // se a\u00f1ade con la clave 0 !!! \u00a1\u00a1\u00a1No asignar valores sin clave!!! foreach ( $capitales as $valor ) { // si recorremos un array asociativo, mostraremos los valores echo \" $valor <br />\" ; } foreach ( $capitales as $pais => $ciudad ) { // separamos cada elemento en clave => valor echo \" $pais : $ciudad <br />\" ; } Operaciones \u00b6 Las operaciones m\u00e1s importantes que podemos realizar con arrays son: print_r($array) : muestra el contenido de todo el $array . Si queremos mostrar el contenido con un formato determinado, hemos de recorrer el array con foreach . var_dump($mixed) : muestra el contenido del elemento recibido. Muestra m\u00e1s informaci\u00f3n que print_r . $elem = array_pop($array) : elimina el \u00faltimo $elemento array_push($array, $elem) : a\u00f1ade un $elemento al final $booleano = in_array($elem, $array) : averigua si $elem est\u00e1 en el $array PHP Consola <?php $frutas = [ \"naranja\" , \"pera\" , \"manzana\" ]; array_push ( $frutas , \"pi\u00f1a\" ); print_r ( $frutas ); $ultFruta = array_pop ( $frutas ); if ( in_array ( \"pi\u00f1a\" , $frutas )) { echo \"<p>Queda pi\u00f1a</p>\" ; } else { echo \"<p>No queda pi\u00f1a</p>\" ; } print_r ( $frutas ); Array ( [0] => naranja [1] => pera [2] => manzana [3] => pi\u00f1a ) <p>No queda pi\u00f1a</p> Array ( [0] => naranja [1] => pera [2] => manzana ) $claves = array_keys($array) : devuelve las claves del $array asociativo $tam = count($array) : devuelve el tama\u00f1o de $array sort($array) : ordena los elementos del $array isset($array[elemento]) : indica si existe/tiene valor elemento dentro del array unset($array[elemento]) : elimina el elemento del array (deja un hueco) PHP Consola <?php $capitales = array ( \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ); $paises = array_keys ( $capitales ); print_r ( $paises ); sort ( $paises ); print_r ( $paises ); unset ( $capitales [ \"Francia\" ]); print_r ( $capitales ); Array ( [0] => Italia [1] => Francia [2] => Portugal ) Array ( [0] => Francia [1] => Italia [2] => Portugal ) Array ( [Italia] => Roma [Portugal] => Lisboa ) Al asignar un array a otro se realiza una copia. Cuidado con esta operaci\u00f3n que puede consumir muchos recursos. PHP Consola <?php $nombres = [ \"Juan\" , \"Ana\" , \"Pedro\" , \"Laura\" ]; $copia = $nombres ; sort ( $nombres ); print_r ( $nombres ); print_r ( $copia ); Array ( [0] => Ana [1] => Juan [2] => Laura [3] => Pedro ) Array ( [0] => Juan [1] => Ana [2] => Pedro [3] => Laura ) Existen much\u00edsimas m\u00e1s funciones para trabajar con arrays. Puedes consultar roda la informaci\u00f3n en la documentaci\u00f3n oficial . Art\u00edculos para profundizar en las operaciones con arrays Un art\u00edculo muy completo (en ingl\u00e9s) de C\u00f3mo trabajar con arrays en PHP de la manera correcta . Otro art\u00edculo recomendable (en ingl\u00e9s) es C\u00f3mo ordenar arrays en PHP . Arrays bidimensionales \u00b6 Consiste en un array de arrays, ya sean arrays secuenciales o asociativos. Puede haber N dimensiones. <?php $persona [ \"nombre\" ] = \"Bruce Wayne\" ; $persona [ \"telefonos\" ] = [ \"966 123 456\" , \"636 636 636\" ]; // array de arrays ordinarios $persona [ \"profesion\" ] = [ \"dia\" => \"fil\u00e1ntropo\" , \"noche\" => \"caballero oscuro\" ]; // array de arrays asociativos echo $persona [ 'nombre' ] . \" por la noche trabaja de \" . $persona [ 'profesion' ][ 'noche' ]; Combinando los arrays asociativos en varias dimensiones podemos almacenar la informaci\u00f3n como si fuera una tabla: <?php $menu1 = [ \"Plato1\" => \"Macarrones con queso\" , \"Plato2\" => \"Pescado asado\" , \"Bebida\" => \"Coca-Cola\" , \"Postre\" => \"Helado de vainilla\" ]; $menu2 = [ \"Plato1\" => \"Sopa\" , \"Plato2\" => \"Lomo con patatas\" , \"Bebida\" => \"Agua\" , \"Postre\" => \"Arroz con leche\" ]; $menus = [ $menu1 , $menu2 ]; // creamos un array a partir de arrays asociativos foreach ( $menus as $menudeldia ) { echo \"Men\u00fa del d\u00eda<br/>\" ; foreach ( $menudeldia as $platos => $comida ) { echo \" $platos : $comida <br/>\" ; } } // Para acceder a un elemento concreto se anidan los corchetes $postre0 = $menus [ 0 ][ \"Postre\" ]; Aunque pueda parecer una buena idea crear este tipo de estructuras, es mejor utilizar objetos conjuntamente con arrays (posiblemente arrays de otros objetos) para crear estructuras complejas que permitan modelar mejor los problemas. Funciones \u00b6 Al no declararse los tipos de datos, los par\u00e1metros de las funciones no tienen tipo ni se indica el tipo de dato que devuelven. El paso de par\u00e1metros se realiza por valor, es decir, se realiza una copia de la variable. <?php function nombreFuncion ( $par1 , $par2 , ... ) { // c\u00f3digo return $valor ; } $resultado = nombreFuncion ( $arg1 , $arg2 , \u2026 ); ?> Por ejemplo: <?php function diaSemana () { $semana = [ \"lunes\" , \"martes\" , \"mi\u00e9rcoles\" , \"jueves\" , \"viernes\" , \"s\u00e1bado\" , \"domingo\" ]; $dia = $semana [ rand ( 0 , 6 )]; return $dia ; } $diaCine = diaSemana (); echo \"El pr\u00f3ximo $diaCine voy al cine.\" ; ?> Par\u00e1metros por referencia \u00b6 Si queremos pasar un par\u00e1metro por referencia, en la declaraci\u00f3n de la funci\u00f3n, indicaremos los par\u00e1metros mediante el operador & para indicar la direcci\u00f3n de memoria de la variable. <?php function duplicarPorValor ( $argumento ) { $argumento = $argumento * 2 ; echo \"Dentro de la funci\u00f3n: $argumento .<br>\" ; } function duplicarPorReferencia ( & $argumento ) { $argumento = $argumento * 2 ; echo \"Dentro de la funci\u00f3n: $argumento .<br>\" ; } $numero1 = 5 ; echo \"Antes de llamar: $numero1 .<br>\" ; duplicarPorValor ( $numero1 ); echo \"Despu\u00e9s de llamar: $numero1 .<br>\" ; echo \"<br>\" ; $numero2 = 7 ; echo \"Antes de llamar: $numero2 .<br>\" ; duplicarPorReferencia ( $numero2 ); echo \"Despu\u00e9s de llamar: $numero2 .<br>\" ; ?> Par\u00e1metros por defecto / opcionales \u00b6 Permiten asignar valores en la declaraci\u00f3n, y posteriormente, dejar el argumento en blanco. <?php function obtenerCapital ( $pais = \"todos\" ) { $capitales = array ( \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ); if ( $pais == \"todos\" ) { return array_values ( $capitales ); } else { return $capitales [ $pais ]; } } print_r ( obtenerCapital ()); echo \"<br/>\" ; echo obtenerCapital ( \"Francia\" ); En el caso de convivir con otro tipo de par\u00e1metros, los par\u00e1metros que tienen el valor asignado por defecto siempre se colocan al final. <?php function saluda ( $nombre , $prefijo = \"Sr\" ) { echo \"Hola \" . $prefijo . \" \" . $nombre ; } saluda ( \"Aitor\" , \"Mr\" ); saluda ( \"Aitor\" ); saluda ( \"Marina\" , \"Srta\" ); Par\u00e1metros variables \u00b6 Podemos tener funciones donde en la declaraci\u00f3n no indiquemos la cantidad de datos de entrada. $arrayArgs = func_get_args(); \u2192 Obtiene un array con los par\u00e1metros $cantidad = func_num_args(); \u2192 Obtiene la cantidad de par\u00e1metros recibidos $valor = func_get_arg(numArgumento); \u2192 Obtiene el par\u00e1metro que ocupa la posici\u00f3n numArgumento . Estas funciones no se pueden pasar como par\u00e1metro a otra funci\u00f3n (como funciones variable, que veremos m\u00e1s adelante). Para ello, debemos guardar previamente la funci\u00f3n en una variable. <?php function sumaParametros () { if ( func_num_args () == 0 ) { return false ; } else { $suma = 0 ; for ( $i = 0 ; $i < func_num_args (); $i ++ ) { $suma += func_get_arg ( $i ); } return $suma ; } } echo sumaParametros ( 1 , 5 , 9 ); // 15 ?> Desde PHP 5.6, se puede utilizar el operador ... ( variadics ) el cual \"disfraza\" los par\u00e1metros como un array: <?php function sumaParametrosMejor ( ... $numeros ) { if ( count ( $numeros ) == 0 ) { return false ; } else { $suma = 0 ; foreach ( $numeros as $num ) { $suma += $num ; } return $suma ; } } echo sumaParametrosMejor ( 1 , 5 , 9 ); // 15 ?> M\u00e1s usos de ... Tambi\u00e9n se puede utilizar para dividir un array en variables separadas para proporcionar argumentos <?php function suma ( $a , $b ) { return $a + $b ; } echo suma ( ... [ 1 , 5 ]) . \"<br />\" ; $a = [ 1 , 5 ]; echo suma ( ... $a ); ?> Argumentos con nombre \u00b6 Desde PHP 8.0 podemos pasar los argumentos con el nombre (adem\u00e1s de por posici\u00f3n, como hemos hecho hasta ahora). Los argumentos con nombre se pasan poniendo el nombre como prefijo del par\u00e1metros separado por dos puntos: $resultado = funcion( arg1 : valor1, arg2 : valor2); Esta caracter\u00edstica complementa los parametros opcionales permitiendonos saltar su valor: <?php function funcionArgumentosNombre ( $a , $b = 2 , $c = 4 ) { echo \" $a $b $c \" ; } funcionArgumentosNombre ( c : 3 , a : 1 ); // \"1 2 3\" Tanto los par\u00e1metros opcionales como los obligatorios pueden tener nombre, pero lo argumentos con nombre se tienen que poner despu\u00e9s de los que no lo tienen. <?php funcionArgumentosNombre ( 1 , c : 3 ); // \"1 2 3\" Funciones tipadas \u00b6 Desde PHP7 en las funciones, tanto los par\u00e1metro como su devoluci\u00f3n, permiten la definici\u00f3n de tipos. Esto se conoce como strict_types (tipificaci\u00f3n estricta) y hay que definirlo en la primera l\u00ednea de cada archivo .php para que el propio interprete PHP compruebe los tipos y lance errores si los tipos son incorrectos, mediante la sentencia <?php declare ( strict_types = 1 ); As\u00ed pues, vamos a definir los tipos de los par\u00e1metros y de los valores devueltos mediante los tipos: int , float , string , bool , object y array . Si una funci\u00f3n no devuelve nada se indica mediante el tipo void . <?php declare ( strict_types = 1 ); function suma ( int $a , int $b ) : int { return $a + $b ; } $num = 33 ; echo suma ( 10 , 30 ); echo suma ( 10 , $num ); echo suma ( \"10\" , 30 ); // error por tipificaci\u00f3n estricta, sino dar\u00eda 40 ?> Alcance \u00b6 Las variables definidas fuera de las funciones tienen alcance global : accesibles desde cualquier funci\u00f3n. Los par\u00e1metros de una funci\u00f3n y las variables declaradas dentro de una funci\u00f3n (se conocen como variables locales) s\u00f3lo son accesibles desde dentro de la misma funci\u00f3n \u2192 alcance de funci\u00f3n . En caso de conflicto, tienen prioridad las variables locales. Para evitar el conflicto, dentro de la funci\u00f3n, podemos declarar la variable como global . Alcance local Alcance global <?php function miCiudad () { $ciudad = \"Elche\" ; echo \"Dentro de la funci\u00f3n: $ciudad .<br>\" ; } $ciudad = \"Alicante\" ; echo \"Antes de la funci\u00f3n: $ciudad .<br>\" ; miCiudad (); echo \"Despu\u00e9s de la funci\u00f3n: $ciudad .<br>\" ?> <?php function miCiudad () { global $ciudad ; $ciudad = \"Elche\" ; echo \"Dentro de la funci\u00f3n: $ciudad .<br>\" ; } $ciudad = \"Alicante\" ; echo \"Antes de llamar: $ciudad .<br>\" ; miCiudad (); echo \"Despu\u00e9s de llamar: $ciudad .<br>\" ?> No globales Por favor, hay que evitar el uso de variables globales dentro de las funciones. En el caso de necesitarlas, es mejor pasarlas como par\u00e1metro a las funciones. Funciones variable \u00b6 Permite asignar una funci\u00f3n a una variable. Nombre de la funci\u00f3n entre comillas. Si una variable va seguida de par\u00e9ntesis, PHP buscar\u00e1 una funci\u00f3n con su valor. <?php $miFuncionSuma = \"suma\" ; echo $miFuncionSuma ( 3 , 4 ); // invoca a la funci\u00f3n suma ?> Funciones an\u00f3nimas PHP permite la definici\u00f3n y uso de funciones an\u00f3nimas, es decir, funciones que no tienen nombre, y se utilizan principalmente para gestionar los callbacks . Este tipo de funciones se utiliza mucho en Javascript para gestionar los eventos y promesas. <?php $anonima = function () { echo \"Hola\" ; }; $anonima (); $anonimaConParametro = function ( $nombre ) { echo \"Hola \" . $nombre ; }; $anonimaConParametro ( \"Aitor\" ); // Uso de variables externas a la funci\u00f3n an\u00f3nima --> `use` $mensaje = \"Hola\" ; $miClosure = function () use ( $mensaje ) { echo $mensaje ; }; $miClosure (); // Uso de par\u00e1metros $holaPHP = function ( $arg ) use ( $mensaje ) { echo $mensaje . \" \" . $arg ; }; $holaPHP ( \"PHP\" ); ?> Desde PHP 7.4 se han introducido las funciones flecha ( arrow functions ) para simplificar su definici\u00f3n y uso. Ten\u00e9is m\u00e1s informaci\u00f3n sobre funciones an\u00f3nimas y flecha en el siguiente art\u00edculo (en ingl\u00e9s): Funciones an\u00f3nimas y flecha en PHP Biblioteca de funciones \u00b6 Podemos agrupar un conjunto de funciones en un archivo, para permitir su reutilizaci\u00f3n. Posteriormente, se incluye con: include(archivo); / include_once(archivo); require(archivo); / require_once(archivo); Si no encuentra el archivo, require lanza un error fatal, include lo ignora Las funciones _once s\u00f3lo se cargan una vez, si ya ha sido incluida previamente, no lo vuelve a hacer, evitando bucles. Por ejemplo, colocamos las funciones en el archivo biblioteca.php : <?php function suma ( int $a , int $b ) : int { return $a + $b ; } function resta ( int $a , int $b ) : int { return $a - $b ; } ?> Y posteriormente en otro archivo: <?php include_once ( \"biblioteca.php\" ); echo suma ( 10 , 20 ); echo resta ( 40 , 20 ); ?> Plantillas mediante include \u00b6 Mediante el uso de la instrucci\u00f3n include tambi\u00e9n podemos separar fragmentos de c\u00f3digo PHP/HTML que queramos reutilizar en nuestros sitios web y crear un sistema muy sencillo de plantillas. Por ejemplo, vamos a separar una p\u00e1gina en tres partes, primero la parte superior en encabezado.php : <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > <? = $titulo ?> </ title > </ head > < body > La parte de abajo, por ejemplo, solo va a contener HTML y la colocamos en pie.html : < footer > Aitor Medrano </ footer > </ body > </ html > Y luego nos centramos \u00fanicamente en el contenido que cambia en pagina.php : <?php $titulo = \"P\u00e1gina con includes\" ; include ( \"encabezado.php\" ); ?> < h1 > <? = $titulo ?> </ h1 > <?php include ( \"pie.html\" ); ?> Funciones predefinidas \u00b6 El lenguaje ofrece un abanico de funciones ya definidas, agrupadas por su funcionalidad: https://www.php.net/manual/es/funcref.php Cadenas \u00b6 Ya hemos visto que se pueden crear con comillas simples ( '' , sin interpretaci\u00f3n) o comillas dobles ( \"\" , interpretan el contenido y las secuencias de escape \\n , \\t , \\$ , { , \u2026 - magic quotes ) <?php \"Me llamo $nombre \" \"Son 30 { $moneda } s\" ?> Se acceden a los caracteres como si fuera un array. <?php $cadena = \u201cYo soy Batman\u201d ; $ygriega = $cadena [ 0 ]; ?> Adem\u00e1s de echo , podemos mostrar las cadenas mediante la funci\u00f3n printf . Esta funci\u00f3n viene heredada del lenguaje C, y en la cadena se indica el tipo de dato a formatear y genera una salida formateada. Si quiero guardar el resultado en una variable, podemos utilizar sprintf . <?php $num = 33 ; $nombre = \"Larry Bird\" ; printf ( \"%s llevaba el n\u00famero %d\" , $nombre , $num ); // %d -> n\u00famero decimal, %s -> string $frase = sprintf ( \"%s llevaba el n\u00famero %d\" , $nombre , $num ); echo $frase ?> Ten\u00e9is muchos m\u00e1s ejemplos en https://www.w3schools.com/php/func_string_printf.asp Operaciones b\u00e1sicas \u00b6 Todas las funciones se pueden consultar en https://www.php.net/manual/es/ref.strings.php Las m\u00e1s importantes son: strlen : obtiene la longitud de una cadena y devuelve un n\u00famero entero substr : devuelve una subcadena de la cadena original str_replace : reemplaza caracteres en una cadena strtolower y strtoupper : Transforman una cadena de caracteres en la misma cadena en min\u00fasculas o may\u00fasculas respectivamente. <?php $cadena = \"El caballero oscuro\" ; $tam = strlen ( $cadena ); echo \"La longitud de ' $cadena ' es: $tam <br />\" ; $oscuro = substr ( $cadena , 13 ); // desde 13 al final $caba = substr ( $cadena , 3 , 4 ); // desde 3, 4 letras $katman = str_replace ( \"c\" , \"k\" , $cadena ); echo \" $oscuro $caba ahora es $katman \" ; echo \"Grande \" . strtoupper ( $cadena ); ?> Si queremos trabajar con caracteres ASCII de forma individual, son \u00fatiles las funciones: chr : obtiene el car\u00e1cter a partir de un ASCII ord : obtiene el ASCII de un car\u00e1cter <?php function despues ( string $letra ) : string { $asciiLetra = ord ( $letra ); return chr ( $asciiLetra + 1 ); } echo despues ( \"B\" ); ?> Si queremos limpiar cadenas, tenemos las funciones: trim : elimina los espacios al principio y al final ltrim / rtrim o chop : Elimina los espacios iniciales / finales de una cadena. str_pad : rellena la cadenas hasta una longitud especificada y con el car\u00e1cter o caracteres especificados. <?php $cadena = \" Programando en PHP \" ; $limpia = trim ( $cadena ); // \"Programando en PHP\" $sucia = str_pad ( $limpia , 23 , \".\" ); // \"Programando en PHP.....\" ?> Comparando y buscando \u00b6 La comparaci\u00f3n de cadenas puede ser con conversi\u00f3n de tipos mediante == o estricta con === . Tambi\u00e9n funcionan los operadores < y > si ambas son cadenas. Al comparar cadenas con valores numericos podemos utilizar: strcmp : 0 iguales, <0 si a<b o >0 si a>b strcasecmp : las pasa a min\u00fasculas y compara strncmp / strncasecmp : compara los N primeros caracteres strnatcmp : comparaciones naturales <?php $frase1 = \"Alfa\" ; $frase2 = \"Alfa\" ; $frase3 = \"Beta\" ; $frase4 = \"Alfa5\" ; $frase5 = \"Alfa10\" ; var_dump ( $frase1 == $frase2 ); // true var_dump ( $frase1 === $frase2 ); // true var_dump ( strcmp ( $frase1 , $frase2 ) ); // 0 var_dump ( strncmp ( $frase1 , $frase5 , 3 ) ); // 0 var_dump ( $frase2 < $frase3 ); // true var_dump ( strcmp ( $frase2 , $frase3 ) ); // -1 var_dump ( $frase4 < $frase5 ); // false var_dump ( strcmp ( $frase4 , $frase5 ) ); // 4 \u2192 f4 > f5 var_dump ( strnatcmp ( $frase4 , $frase5 ) ); // -1 \u2192 f4 < f5 ?> Si lo que queremos es buscar dentro de una cadena, tenemos: strpos / strrpos : busca en una cadena y devuelve la posici\u00f3n de la primera/\u00faltima ocurrencia. strstr / strchr (alias) : busca una cadena y devuelve la subcadena a partir de donde la ha encontrado stristr : ignora las may\u00fasculas <?php $frase = \"Quien busca encuentra, eso dicen, a veces\" ; $pos1 = strpos ( $frase , \",\" ); // encuentra la primera coma $pos2 = strrpos ( $frase , \",\" ); // encuentra la \u00faltima coma $trasComa = strstr ( $frase , \",\" ); // \", eso dicen, a veces\" ?> Si queremos averiguar que contiene las cadenas, tenemos un conojunto de funciones de comprobaciones de tipo, se conocen como las funciones ctype que devuelven un booleano: ctype_alpha \u2192 letras ctype_alnum \u2192 alfanum\u00e9ricos ctype_digit \u2192 d\u00edgitos ctype_punct \u2192 caracteres de puntuaci\u00f3n, sin espacios ctype_space \u2192 son espacios, tabulador, salto de l\u00ednea <?php $prueba1 = \"hola\" ; $prueba2 = \"hola33\" ; $prueba3 = \"33\" ; $prueba4 = \",.()[]\" ; $prueba5 = \" ,.()[]\" ; echo ctype_alpha ( $prueba1 ) . \"<br>\" ; // true echo ctype_alnum ( $prueba2 ) . \"<br>\" ; // true echo ctype_digit ( $prueba3 ) . \"<br>\" ; // true echo ctype_punct ( $prueba4 ) . \"<br>\" ; // true echo ctype_space ( $prueba5 ) . \"<br>\" ; // false echo ctype_space ( $prueba5 [ 0 ]) . \"<br>\" ; // true ?> Trabajando con subcadenas \u00b6 Si queremos romper las cadenas en trozos, tenemos: explode : convierte en array la cadena mediante un separador. implode / join : pasa un array a cadena con un separador str_split / chunk_split : pasa una cadena a una array/cadena cada X caracteres <?php $frase = \"Quien busca encuentra, eso dicen, a veces\" ; $partes = explode ( \",\" , $frase ); $ciudades = [ \"Elche\" , \"Aspe\" , \"Alicante\" ]; $cadenaCiudades = implode ( \">\" , $ciudades ); $partes3cadena = chunk_split ( $frase , 3 ); // Qui // en // bus // ca // ... $partes3array = str_split ( $frase , 3 ); // [\"Qui\", \"en \", \"bus\", \"ca \", \"enc\", \u2026] ?> Si queremos trabajar con tokens: strtok(cadena, separador) y dentro del bucle: strtok(separador) Finalmente, para separarla en base al formato: sscanf : al rev\u00e9s que sprintf , crea un array a partir de la cadena y el patr\u00f3n. Finalmente, otras operaciones que podemos realizar para trabajar con subcadenas son: substr_count : n\u00famero de veces que aparece la subcadena dentro de la cadena substr_replace : reemplaza parte de la cadena a partir de su posici\u00f3n, y opcionalmente, longitud <?php $batman = \"Bruce Wayne es Batman\" ; $empresa = substr ( $batman , 6 , 5 ); // Wayne $bes = substr_count ( $batman , \"B\" ); // 2 // Bruce Wayne es camarero $camarero1 = substr_replace ( $batman , \"camarero\" , 15 ); $camarero2 = substr_replace ( $batman , \"camarero\" , - 6 ); // quita 6 desde el final // Bruno es Batman $bruno = substr_replace ( $batman , \"Bruno\" , 0 , 11 ); ?> Tambi\u00e9n disponemos de una serie de funciones que facilitan las codificaciones desde y hacia HTML: htmlentities : convierte a entidades HTML, por ejemplo, \u00e1 por &aacute; , \u00f1 por &ntilde; , < por &lt; , etc.. htmlspecialchars : idem pero solo con los caracteres especiales ( & , \" , ' , < , > , ...) striptags : elimina etiquetas HTML. nl2br : cambia saltos de l\u00ednea por <br /> . rawurlencode / rawurldecode : codifica/decodifica una URL (espacios, ...). Estas funciones las utilizaremos en la unidad 4.- Programaci\u00f3n Web. Matem\u00e1ticas \u00b6 Disponemos tanto de constantes como funciones ya definidas para trabajar con operaciones matem\u00e1ticas: https://www.php.net/manual/es/ref.math.php Constantes ya definidas M_PI , M_E , M_EULER , M_LN2 , M_LOG2E PHP_INT_MAX , PHP_FLOAT_MAX Funciones de c\u00e1lculo pow , sqrt , log , decbin , bindec , decoct , dechex , base_convert , max , min Funciones trigonom\u00e9tricas sin , cos , tan , deg2rad , rad2deg Funciones para trabajar con n\u00fameros aleatorios rand , mt_rand (m\u00e1s r\u00e1pida) Aunque la mayor\u00eda de ellas son muy espec\u00edficas de problemas matem\u00e1ticos / estad\u00edsticos, es muy com\u00fan que tengamos que redondear y/o formatear los c\u00e1lculos antes de mostrarlos al usuario. Mediante la funci\u00f3n number_format(numero, cantidadDecimales, separadorDecimales, separadorMiles) podermos pasar n\u00fameros a cadena con decimales y/o separadores de decimales y/o de miles. <?php $nf = 1234.5678 ; echo number_format ( $nf , 2 ); // 1,234.57 echo number_format ( $nf , 2 , \"M\" , \"#\" ); // 1#234M57 ?> Para redondear, tenemos abs para el valor absoluto y round para redondear, ceil para aproximaci\u00f3n por exceso y floor por defecto. <?php $num = 7.7 ; $siete = floor ( $num ); $ocho = ceil ( $num ); $otro = 4.49 ; $cuatro = round ( $otro ); $cuatrocinco = round ( $otro , 1 ); $cinco = round ( $cuatrocinco ); ?> Tipos de datos \u00b6 Finalmente, para realizar conversiones de datos o si queremos trabajar con tipos de datos, tenemos las siguientes funciones: floatval , intval , strval : devuelve una variable del tipo de la funci\u00f3n indicada settype : fuerza la conversi\u00f3n gettype : obtiene el tipo is_int , is_float , is_string , is_array , is_object : devuelve un booleano a partir del tipo recibido <?php $uno = 1 ; var_dump ( is_int ( $uno )); // true $unofloat = floatval ( $uno ); settype ( $uno , \"string\" ); var_dump ( is_int ( $uno )); // false var_dump ( is_string ( $uno )); // true settype ( $uno , \"float\" ); var_dump ( is_int ( $uno )); // false var_dump ( is_float ( $uno )); // true var_dump ( is_int ( intval ( $uno ))); // true ?> Referencias \u00b6 Manual de PHP PHP en 2020 , por Jes\u00fas Amieiro Apuntes de PHP de Bartolom\u00e9 Sintes, profesor del IES Abastos de Valencia Gu\u00eda de Estilo - PSR PHP - La manera correcta Actividades \u00b6 PHP b\u00e1sico \u00b6 Visualiza el v\u00eddeo de Jes\u00fas Amieiro sobre PHP en 2020 a partir del minuto 3:32 (son 40 minutos aproximadamente). \u00bfQu\u00e9 relaci\u00f3n existe entre PHP y Facebook? Respecto al rendimiento, \u00bfqu\u00e9 versi\u00f3n m\u00ednima deber\u00edamos utilizar? \u00bfPor qu\u00e9 PHP tiene mala fama? 201tresfrases.php : Muestra 3 frases, cada una en un p\u00e1rrafo utilizando las tres posibilidades que existen de mostrar contenido. Tras ello, introduce dos comentarios, uno de bloque y otro de una l\u00ednea. 202calculos.php : Escribe un programa que utilice las variables $x y $y . As\u00edgnales los valores 166 y 999 respectivamente. A continuaci\u00f3n, muestra por pantalla el valor de cada variable, la suma, la resta, la divisi\u00f3n y la multiplicaci\u00f3n. 203datosPersonales.php : Escribe un programa que almacene en variables tu nombre, primer apellido, segundo apellido, email, a\u00f1o de nacimiento y tel\u00e9fono. Luego mu\u00e9stralos por pantalla dentro de una tabla. 204datosPersonales.html y 204datosPersonales.php : Es el mismo ejercicio que el anterior, pero separando la l\u00f3gica. En el primer archivo crearemos el formulario para introducir los datos, y luego recogemos los datos y generamos la tabla en el segundo archivo. 205madlib.html y 205madlib.php : A partir de un nombre, un verbo, un adjetivo y un adverbio, crea una historia que contenga dichos elementos. Por ejemplo: Entrada: perro / caminar / azul / r\u00e1pidamente Salida: \u00bf Te gusta caminar con tu perro azul r\u00e1pidamente ? 205madlib2.html y 205madlib2.php Crea un madlib m\u00e1s extenso, leyendo m\u00e1s datos de entrada. 206anyos.php : Tras leer la edad de una persona, mostrar la edad que tendr\u00e1 dentro de 10 a\u00f1os y hace 10 a\u00f1os. Adem\u00e1s, muestra qu\u00e9 a\u00f1o ser\u00e1 en cada uno de los casos. Finalmente, muestra el a\u00f1o de jubilaci\u00f3n suponiendo que trabajar\u00e1s hasta los 67 a\u00f1os. En este caso, no hace falta que previamente crees un formulario, puedes probar el ejercicio via URL: 206anyos.php?edad=33 . Tip: $anyoActual = date(\"Y\"); 207dinero.php : A partir de una cantidad de dinero, mostrar su descomposici\u00f3n en billetes (500, 200, 100, 50, 20, 10, 5) y monedas (2, 1), para que el n\u00famero de elementos sea m\u00ednimo. No se utilizar ninguna instrucci\u00f3n condicional. Por ejemplo, al introducir 139 debe mostrar: 1 billete de 100 0 billete de 50 1 billete de 20 1 billete de 10 1 billete de 5 2 moneda de 2 Tip: Puedes forzar a realizar la divisi\u00f3n entera mediante la funci\u00f3n intdiv($dividendo, $divisor) o pasar un n\u00famero flotante a entero puedes usar la funci\u00f3n intval() 208posnegcero.php : A partir de un numero , muestra por pantalla si el n\u00famero es positivo , negativo o cero . 209mayor3.php : Sin hacer uso de condiciones que utilicen dentro la condici\u00f3n los operadores l\u00f3gicos, muestra el mayor de tres n\u00fameros ( a , b y c ). 209mayor3c.php : Utiliza en las condiciones los operadores l\u00f3gicos. 210nombreEdad.php : A partir de una edad muestra por pantalla: beb\u00e9 si tiene menos de 3 a\u00f1os ni\u00f1o si tiene entre 3 y 12 a\u00f1os adolescente entre 13 y 17 a\u00f1os adulto entre 18 y 66 jubilado a partir de 67 211reloj.php : Escribe un programa que funcione similar a un reloj, de manera que a partir de los valores de hora , minuto y segundo muestre la hora dentro de un segundo. Tras las 23:59:59 ser\u00e1n las 0:0:0 . 212calendario.php : Escribe un programa similar a un calendario de manera que a partir de dia , mes y anyo muestre la fecha dentro de un d\u00eda. Debes tener en cuenta que no todos los meses tienen 30 d\u00edas. En este caso, no vamos a tener en cuenta los a\u00f1os bisiestos. 213ecuacion2g.php : Crea un programa que resuelva una ecuaci\u00f3n de 2\u00ba grado del tipo ax\u00b2 + bx + c = 0 . Ten en cuenta que puede tener 2, 1 o no tener soluci\u00f3n dependiendo del valor del discriminante b\u00b2-4ac . Tip: Para calcular la ra\u00edz cuadrada deber\u00e1s utilizar la funci\u00f3n sqrt() Ejercicios de investigaci\u00f3n: Investiga para que sirve el operador nave espacial, disponible desde PHP7 ( https://www.php.net/manual/es/migration70.new-features.php ). Explica con un par de l\u00edneas su prop\u00f3sito y mediante c\u00f3digo demuestra su uso. Investiga para qu\u00e9 sirve la instrucci\u00f3n match() , disponible desde PHP8 ( https://www.php.net/manual/es/control-structures.match.php ). Explica con un par de l\u00edneas su prop\u00f3sito y mediante c\u00f3digo demuestra su uso. Bucles \u00b6 220pares050.php: Escribe un programa que muestre los n\u00fameros pares del 0 al 50 (dentro de una lista desordenada). 220paresAB.php : A partir del anterior, refactorizar para que funcione con inicio y fin . 221suma110.php : Escribe un programa que sume los n\u00fameros del 1 al 10. 221sumaAB.php : A partir del anterior, refactorizar para que funcione con inicio y fin . 222potencia.php : A partir de una base y exponente , mediante la acumulaci\u00f3n de productos, calcula la potencia utilizando la instrucci\u00f3n for . 222potenciaWhile.php : Reescribe el ejercicio anterior haciendo uso s\u00f3lo de while . 222potenciaDoWhile.php : Reescribe el ejercicio anterior haciendo uso s\u00f3lo de do-while . 223tablaMultiplicar.php : Muestra dentro de una tabla HTML la tabla de multiplicar del numero que reciba como par\u00e1metro. Utiliza <thead> con sus respectivos <th> y <tbody > para dibujar la tabla. Por ejemplo: a * b = a*b 7 * 1 = 7 7 * 2 = 14 ... 7 * 10 = 70 224formulario.html : Crea un formulario que permita leer una cantidad . Tip Para guardar un dato oculto puedes utilizar un campo de formulario de tipo oculto: <input type=\"hidden\" name=\"cantidad\" value=\"33\" /> 224leerDatos.php : a partir de cantidad , prepara un formulario con tantas cajas de datos como su valor. Finalmente, en 224sumarDatos.php : a partir de los datos de todas las cajas de la p\u00e1gina anterior, s\u00famalos y muestra el total. 225formulario.html y 225tabla.php : A partir de un n\u00famero de filas y columnas , crear una tabla con ese tama\u00f1o. Las celdas deben estar rellenadas con los valores de las coordenadas de cada celda. 226formulario.html y 226cuadrado.php : Bas\u00e1ndote en el ejercicio anterior, rellena la tabla de manera que solo los bordes tengan contenido, qued\u00e1ndose el resto de celdas en blanco. 227formulario.html y 227equis.php : Bas\u00e1ndote en el ejercicio anterior, ahora s\u00f3lo debe aparecer el contenido de los dos diagonales. 228cuadradoMultiplicar.php : Crea un programa que muestre por pantalla un cuadrado exactamente igual (f\u00edjate bien en los encabezados, tanto de las filas como de las columnas) al de la imagen con las tablas de multiplicar. Arrays \u00b6 230aleatorios50.php : Rellena un array con 50 n\u00fameros aleatorios comprendidos entre el 0 y el 99, y luego mu\u00e9stralo en una lista desordenada. Para crear un n\u00famero aleatorio, utiliza la funci\u00f3n rand(inicio, fin) . Por ejemplo: $num = rand(0, 99) 231bola8.html : Prepara un formulario con un caja de texto que realice a una pregunta al usuario. 231bola8.php : A partir del anterior, crea un programa que muestre la pregunta recibida y genere una respuesta de manera aleatoria entre un conjunto de respuestas predefinidas, almacenadas en un array: Si, no, quiz\u00e1s, claro que s\u00ed, por supuesto que no, no lo tengo claro, seguro, yo dir\u00eda que s\u00ed, ni de co\u00f1a, etc.. . Este ejercicio se basa en el juego de la Bola 8 m\u00e1gica . 232mates.php : A partir del ejercicio 230, genera un array aleatorio de 33 elementos con n\u00fameros comprendidos entre el 0 y 100 y calcula: El mayor El menor La media 233sexos.php : Rellena un array de 100 elementos de manera aleatoria con valores M o F (por ejemplo [\"M\", \"M\", \"F\", \"M\", ...] ). Una vez completado, vuelve a recorrerlo y calcula cuantos elementos hay de cada uno de los valores almacenando el resultado en un array asociativo ['M' => 44, 'F' => 66] ( no utilices variables para contar las M o las F ). Finalmente, muestra el resultado por pantalla 234monedas.php : Vuelve a realizar el ejercicio 207, el de las monedas (500, 200, 100, 50, 20, 10, 5, 2, 1), pero haciendo uso de arrays y un bucle. Almacena el resultado en un array asociativo. Muestra el resultado en una lista desordenada \u00fanicamente con las cantidades que tienen alg\u00fan valor. 235alturas.php : Mediante un array asociativo, almacena el nombre y la altura de 5 personas ( nombre => altura ). Posteriormente, recorre el array y mu\u00e9stralo en una tabla HTML. Finalmente a\u00f1ade una \u00faltima fila a la tabla con la altura media. 236personas.php : Mediante un array bidimensional, almacena el nombre, altura y email de 5 personas. Para ello, crea un array de personas, siendo cada persona un array asociativo: [ ['nombre'=>'Aitor', 'altura'=>182, 'email'=>'aitor@correo.com'],[\u2026],\u2026 ] Posteriormente, recorre el array y mu\u00e9stralo en una tabla HTML. 237leerCantidad.html y 237leerPersonas.php : a partir de un formulario con un campo de cantidad de personas, generar un nuevo formulario para leer el nombre, altura y email de cantidad personas. 237gestionarPersonas.php : A partir de las personas introducidas, mostrar sus datos en una tabla, y posteriormente, destacar los datos del m\u00e1s alto y el del m\u00e1s bajo. 238tablaDistintos.php : Rellena un array bidimensional de 6 filas por 9 columnas con n\u00fameros aleatorios comprendidos entre 100 y 999 (ambos incluidos). Todos los n\u00fameros deben ser distintos, es decir, no se puede repetir ninguno. Muestra a continuaci\u00f3n por pantalla el contenido del array de tal forma que: La columna del m\u00e1ximo debe aparecer en azul. La fila del m\u00ednimo debe aparecer en verde El resto de nu\u0301meros deben aparecer en negro. Funciones \u00b6 240arrayPar.php : Crea las siguientes funciones: Una funci\u00f3n que averig\u00fce si un n\u00famero es par: esPar(int $num): bool Una funci\u00f3n que devuelva un array de tama\u00f1o $tam con n\u00fameros aleatorios comprendido entre $min y $max : arrayAleatorio(int $tam, int $min, int $max) : array Una funci\u00f3n que reciba un $array por referencia y devuelva la cantidad de n\u00fameros pares que hay almacenados: arrayPares(array &$array): int 241parametrosVariables.php : Crea las siguientes funciones: Una funci\u00f3n que devuelva el mayor de todos los n\u00fameros recibidos como par\u00e1metros: function mayor(): int . Utiliza las funciones func_get_args() , etc... No puedes usar la funci\u00f3n max() . Una funci\u00f3n que concatene todos los par\u00e1metros recibidos separ\u00e1ndolos con un espacio: function concatenar(...$palabras) : string . Utiliza el operador ... . 242matematicas.php : A\u00f1ade las siguientes funciones: digitos(int $num): int \u2192 devuelve la cantidad de d\u00edgitos de un n\u00famero. digitoN(int $num, int $pos): int \u2192 devuelve el d\u00edgito que ocupa, empezando por la izquierda, la posici\u00f3n $pos . quitaPorDetras(int $num, int $cant): int \u2192 le quita por detr\u00e1s (derecha) $cant d\u00edgitos. quitaPorDelante(int $num, int $cant): int \u2192 le quita por delante (izquierda) $cant d\u00edgitos. Para probar las funciones, haz uso tanto de paso de argumentos posicionales como argumentos con nombre. 243biblioteca.php : crea un archivo con funciones para sumar, restar, multiplicar y dividir dos n\u00fameros. 243arrayFunciones.php : haciendo uso de un array que almacene el nombre de las funciones del archivo anterior, a partir de dos n\u00fameros recibidos por URL, recorre el array e invoca a las funciones de manera din\u00e1mica haciendo uso de funciones variable. 244euros.php : Crea una biblioteca con dos funciones: peseta2euros: pasa de pesetas a euros euros2pesetas: pasa de euros a pesetas Cada funci\u00f3n debe recibir dos par\u00e1metros: La cantidad a transformar La cotizaci\u00f3n, con un par\u00e1metro por defecto con el factor de transformaci\u00f3n. 244calculadoraEuros.php : utiliza 243euros.php y prueba las funciones pasando tanto cantidades con la cotizaci\u00f3n por defecto, como con nuevas cotizaciones. Recuerda que 1 euro son/eran 166.36 pesetas. 245preparaTiquetCompra.php : A partir de una cantidad de productos, leer el nombre y coste de la cantidad de productos indicados (similar al ejercicio 237, pero esta vez no hace falta crear el formulario con la cantidad, se recibe mediante un par\u00e1metro GET via URL). 245imprimeTiquetCompra.php : Tras leer los datos del tiquet de compra, enumera en una tabla los productos, con su precio en euros y pesetas, y finalmente, en una \u00faltima fila, totalizar en ambas monedas. A partir de los archivos creados en el ejercicio anterior, crea una plantilla mediante includes: 246preparaCompra.php : similar a 245preparaTiquetCompra.php , pero separando el encabezado ( Supermercado Severo en h1 ) y el pie ( Tu supermercado de confianza ) en ficheros externos y referenciando a ellos mediante include . 246listaCompra.php : recibe los datos del anterior, y reutiliza parte de 245imprimeTiquetCompra.php cambiando la tabla por una lista desordenada de los productos junto a su precio. Vamos a simular un formulario de acceso: 247login.php : el formulario de entrada, que solicita el usuario y contrase\u00f1a. 247compruebaLogin.php : recibe los datos y comprueba si son correctos (los usuarios se guardan en un array asociativo) pasando el control mediante el uso de include a: 247ok.php : El usuario introducido es correcto 247ko.php : El usuario es incorrecto. Informar si ambos est\u00e1n mal o solo la contrase\u00f1a. Volver a mostrar el formulario de acceso. Funciones predefinidas \u00b6 Todos los ejercicios se deben realizar creando nuevas funciones para encapsular el c\u00f3digo. Adem\u00e1s de la propia funci\u00f3n, el ejercicio debe contener c\u00f3digo para poder probarlo. 250fraseImpares.php : Lee una frase y devuelve una nueva con solo los caracteres de las posiciones impares. 251vocales.php : A partir de una frase, devuelve la cantidad de cada una de las vocales, y el total de ellas. 252analizador.php : A partir de una frase con palabras s\u00f3lo separadas por espacios, devolver Letras totales y cantidad de palabras Una l\u00ednea por cada palabra indicando su tama\u00f1o Nota: no se puede usar str_word_count 252analizadorWC.php : Investiga que hace la funci\u00f3n str_word_count , y vuelve a hacer el ejercicio. 253cani.php : EsCrIbE uNa FuNcI\u00f3N qUe TrAnSfOrMe UnA cAdEnA eN cAnI. 254palindromo.php : Escribe una funci\u00f3n que devuelva un booleano indicando si una palabra es pal\u00edndroma (se lee igual de izquierda a derecha que de derecha a izquierda, por ejemplo, \u201cligar es ser agil\u201d). 255codificar.php : Utilizando las funciones para trabajar con caracteres, a partir de una cadena y un desplazamiento: Si el desplazamiento es 1, sustituye la A por B, la B por C, etc. El desplazamiento no puede ser negativo Si se sale del abecedario, debe volver a empezar Hay que respetar los espacios, puntos y comas. 256filtrado.html : Crea un programa que permita al usuario leer un conjunto de n\u00fameros separados por espacios. 256filtrado.php : El programa filtrar\u00e1 los n\u00fameros le\u00eddos para volver a mostrar \u00fanicamente los n\u00fameros pares e indicar\u00e1 la cantidad existente. Dame n\u00fameros: 1 4 7 9 23 10 8 Los 3 n\u00fameros pares son: 4 10 8 257investiga.php : Investiga las siguientes funciones de cadena (explica para qu\u00e9 sirven mediante comentarios, y programa un peque\u00f1o ejemplo de cada una de ellas): ucwords , strrev , str_repeat y md5 . Los siguientes ejercicios se basan en la generaci\u00f3n de n\u00fameros aleatorios. 260generador.php : Crea una funci\u00f3n que permite generar una letra aleatoria, may\u00fascula o min\u00fascula. 261generaContrasenya.php : Crea una funci\u00f3n que a partir de un tama\u00f1o, genere una contrase\u00f1a aleatoria compuesta de letras y d\u00edgitos de manera aleatoria. 262quinielas.php : Crea las siguientes funciones: quinigol() : array \u2192 Genera un array multidimensional con 6 resultados aleatorios con combinaciones [012M, 012M] quiniela() : array \u2192 Genera un array con una combinaci\u00f3n de quiniela generada de manera aleatoria: 14 resultados con 1X2 y el pleno al quince con [012M, 012M] tabla(array $quiniela) : string \u2192 transforma un array de una quniela en una tabla HTML","title":"2.- El lenguaje PHP"},{"location":"02php.html#el-lenguaje-php","text":"Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 26 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n: Escribe sentencias ejecutables por un servidor Web reconociendo y aplicando procedimientos de integraci\u00f3n del c\u00f3digo en lenguajes de marcas. Se han reconocido los mecanismos de generaci\u00f3n de p\u00e1ginas Web a partir de lenguajes de marcas con c\u00f3digo embebido. Se han identificado las principales tecnolog\u00edas asociadas. Se han utilizado etiquetas para la inclusi\u00f3n de c\u00f3digo en el lenguaje de marcas. Se ha reconocido la sintaxis del lenguaje de programaci\u00f3n que se ha de utilizar. Se han escrito sentencias simples y se han comprobado sus efectos en el documento resultante. Se han utilizado directivas para modificar el comportamiento predeterminado. Se han utilizado los distintos tipos de variables y operadores disponibles en el lenguaje. Se han identificado los \u00e1mbitos de utilizaci\u00f3n de las variables. Resultado de aprendizaje: Escribe bloques de sentencias embebidos en lenguajes de marcas, seleccionando y utilizando las estructuras de programaci\u00f3n. Criterios de evaluaci\u00f3n: Se han utilizado mecanismos de decisi\u00f3n en la creaci\u00f3n de bloques de sentencias. Se han utilizado bucles y se ha verificado su funcionamiento. Se han utilizado \u201carrays\u201d para almacenar y recuperar conjuntos de datos. Se han creado y utilizado funciones. Se han utilizado formularios web para interactuar con el usuario del navegador Web. Se han empleado m\u00e9todos para recuperar la informaci\u00f3n introducida en el formulario. Se han a\u00f1adido comentarios al c\u00f3digo.","title":"El lenguaje PHP"},{"location":"02php.html#php","text":"Acr\u00f3nimo de Personal Home Page Lenguaje de prop\u00f3sito general, aunque su fuerte es el desarollo web. Sintaxis similar a C / Java El c\u00f3digo se ejecuta en el servidor (en Apache mediante mod_php ) El cliente recibe el resultado generado tras interpretar el c\u00f3digo en el servidor. El c\u00f3digo se almacena en archivo con extensi\u00f3n .php . La \u00faltima versi\u00f3n es la 8.0, de Noviembre de 2020 (y en menos de un par de meses tendremos la versi\u00f3n 8.1). La versi\u00f3n 7.0 sali\u00f3 en Diciembre de 2015. Adem\u00e1s de numerosas nuevas funcionalidades que iremos viendo durante el curso, tiene m\u00e1s de dos veces mejor rendimiento que PHP5. Su documentaci\u00f3n es extensa y est\u00e1 traducida: https://www.php.net/manual/es/ .","title":"PHP"},{"location":"02php.html#codigo-embebido","text":"Los bloques de c\u00f3digo se escriben entre <?php y ?> , mientras que las sentencias se separan mediante ; . <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < title > PHP f\u00e1cil </ title > </ head > < body > <!-- Muestra una frase con HTML --> Hola mundo < br > <!-- Muestra una frase con PHP --> <?php echo \"Es muy f\u00e1cil programar en PHP.\" ; ?> </ body > </ html > S\u00f3lo etiquetas de apertura Si nuestro c\u00f3digo s\u00f3lo va a contener c\u00f3digo PHP y nada de html, como por ejemplo, cuando codifiquemos clases o interfaces, s\u00f3lo pondremos la etiqueta de apertura, para as\u00ed indicar que es una archivo de php puro.","title":"C\u00f3digo embebido"},{"location":"02php.html#generando-contenido","text":"Tenemos tres posibilidades a la hora de generar contenido en nuestros documentos PHP: echo expresi\u00f3n; print (expresi\u00f3n); <?= expresi\u00f3n ?> Las que vamos a utilizar son echo cuando lo hagamos dentro de un bloque de instrucciones y <?= cuando s\u00f3lo vayamos a mostrar el valor de una variable dentro de un fragmento HTML. <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > Echo y print </ title > </ head > < body > < p > <?php echo \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\" ?> </ p > < p > <? = \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\" ?> </ p > < p > <?php print ( \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\" ) ?> </ p > </ body > </ html >","title":"Generando contenido"},{"location":"02php.html#comentarios","text":"Podemos utilizar comentarios de una l\u00ednea o de bloque: <?php // Este es un comentario de una sola l\u00ednea /* Este es un comentario que ocupa varias l\u00edneas */ ?>","title":"Comentarios"},{"location":"02php.html#errores","text":"Si hay un error de ejecuci\u00f3n, se produce un Fatal Error . Fatal error: Uncaught Error: Call to undefined function plint() in C:\\xampp\\htdocs\\202echo.php:11 Stack trace: # 0 { main } thrown in C:\\xampp\\htdocs\\202echo.php on line 11 Desde PHP 5 se lanzan como una excepci\u00f3n. M\u00e1s adelante veremos el uso de try / catch .","title":"Errores"},{"location":"02php.html#variables","text":"No es necesario declararlas previamente. Comienzan por $ , por ejemplo $nombre . Tras el $ , el siguiente caracter debe ser una letra en min\u00fascula (recomendaci\u00f3n) o gui\u00f3n bajo _ . Luego ya se pueden poner n\u00fameros. Son case sensitive : $var != $vAR No se declara su tipo, el tipado es din\u00e1mico. Se asigna en tiempo de ejecuci\u00f3n dependiendo del valor asignado. Conveniente inicializarlas, sino dan error. <?php $nombre = \"Aitor\" ; $nombreCompleto = \"Aitor Medrano\" ; $numero = 123 ; $numero2 = 456 ; $pi = 3.14 ; $suerte = true ; $sinValor ; echo $sinValor ; ?> Tipos Aunque a priori no hay tipos de datos, internamente PHP trabaja con cuatro tipos escalares: boolean , integer , float y string y cuatro tipos compuestos: array , object , callable e iterable . Existe un tipo especial para null (m\u00e1s informaci\u00f3n en http://php.net/manual/es/language.types.null.php ).","title":"Variables"},{"location":"02php.html#constantes","text":"Son variables cuyo valor no var\u00edan. Existen dos posibilidades: define(NOMBRE, valor); const NOMBRE; // PHP > 5.3 <?php define ( \"PI\" , 3.1416 ); const IVA = 0.21 ; echo PI , \" \" , IVA ; // No se pone el s\u00edmbolo dolar ?> Se declaran siempre en MAY\u00daSCULAS Hay un conjunto de constantes ya predefinidas, tambi\u00e9n conocidas como magic constants : https://www.php.net/manual/es/language.constants.predefined.php","title":"Constantes"},{"location":"02php.html#operadores","text":"","title":"Operadores"},{"location":"02php.html#arimeticos","text":"Ejemplo Nombre Resultado -$a Negaci\u00f3n Opuesto de $a . $a + $b Suma Suma de $a y $b . $a - $b Resta Diferencia de $a y $b . $a * $b Multiplicaci\u00f3n Producto de $a y $b . $a / $b Divisi\u00f3n Cociente de $a y $b . $a % $b M\u00f3dulo / Resto Resto de $a dividido por $b . $a ** $b Potencia Resultado de $a elevado a $b . PHP >= 5.6. En el caso de cadenas , si queremos concatenarlas, se utiliza el operador . : <?php $x = 33 ; $y = 11 ; $z = $x + $y ; echo \"La suma de 33 y 11 es \" . 44. \"<br />\" ; echo \"La suma de \" . $x . \" y \" . $y . \" es \" . ( 33 + 11 ) . \"<br />\" ; echo \"La suma de \" . $x . \" y \" . $y . \" es \" . $z . \"<br />\" ; ?> Realmente, en vez de concatenar cadenas con variables, podemos imprimirlas directamente ya que se expanden autom\u00e1ticamente: <?php echo \"La suma de $x y $y es $z <br />\" ; ?> En ocasiones, necesitamos rodear el nombre de la variable entre llaves para poder unir m\u00e1s texto al resultado: <?php $color = \"rojo\" ; echo \"El plural de $color el ${ color } s\" ; ?> M\u00e1s adelante estudiaremos algunas funciones para el tratamiento de cadenas.","title":"Arim\u00e9ticos"},{"location":"02php.html#comparacion","text":"Ejemplo Nombre Resultado $a == $b Igual true si $a es igual a $b tras de la conversi\u00f3n de tipos. $a === $b Id\u00e9ntico, Comparaci\u00f3n estricta true si $a es igual a $b , y son del mismo tipo de dato. $a != $b , $a <> $b Diferente true si $a no es igual a $b despu\u00e9s de la conversi\u00f3n de tipos. $a !== $b No id\u00e9ntico true si $a no es igual a $b , o si no son del mismo tipo. $a < $b Menor que true si $a es estrictamente menor que $b . $a > $b Mayor que true si $a es estrictamente mayor que $b . $a <= $b Menor o igual que true si $a es menor o igual que $b . $a >= $b Mayor o igual que true si $a es mayor o igual que $b . $a <=> $b Nave espacial Devuelve -1 , 0 o 1 cuando $a es respectivamente menor, igual, o mayor que $b . PHP >= 7. $a ?? $b ?? $c Fusi\u00f3n de null El primer operando de izquierda a derecha que exista y no sea null . null si no hay valores definidos y no son null . PHP >= 7.","title":"Comparaci\u00f3n"},{"location":"02php.html#logicos","text":"Ejemplo Nombre Resultado $a and $b , $a && $b And (y) true si tanto $a como $b son true . $a or $b , $a || $b Or (o inclusivo) true si cualquiera de $a o $b es true . $a xor $b Xor (o exclusivo) true si $a o $b es true , pero no ambos. !$a Not (no) true si $a no es true .","title":"L\u00f3gicos"},{"location":"02php.html#asignacion","text":"Ejemplo Nombre Resultado $a = $b Asignaci\u00f3n Asigna a $a el valor de $b $a += $b Asignaci\u00f3n de la suma Le suma a $a el valor de $b . Equivalente a $a = $a + $b $a -= $b Asignaci\u00f3n de la resta Le resta a $a el valor de $b . Equivalente a $a = $a - $b $a *= $b Asignaci\u00f3n del producto Asigna a $a el producto de $a por $b . Equivalente a $a = $a * $b $a /= $b Asignaci\u00f3n de la divisi\u00f3n Asigna a $a el conciente de $a entre $b . Equivalente a $a = $a / $b $a %= $b Asignaci\u00f3n del resto Asigna a $a el resto de dividir $a entre $b . Equivalente a $a = $a % $b $a .= $b Concatenaci\u00f3n Concatena a $a la cadena $b . Equivalente a $a = $a . $b $a++ Incremento Incrementa $a en una unidad. Equivalente a $a = $a + 1 $a-- Decremento Decrementa $a en una unidad. Equivalente a $a = $a - 1 Prioridad de los operadores Recuerda la prioridad. Primero los par\u00e9ntesis, luego la negaci\u00f3n ( ! ), productos/divisiones, sumas/restas, comparaciones, l\u00f3gicos y por \u00faltimo se realiza la asignaci\u00f3n. M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.operators.precedence.php Autoevaluaci\u00f3n Si $a=5 y $b=4 , averigua el valor de $c si $c = $a*2 > $b+5 && !($b<>4)","title":"Asignaci\u00f3n"},{"location":"02php.html#trabajando-con-formularios","text":"Los datos se env\u00edan via URL con el formato var1=valor1&var2=valor2\u2026 . Por ejemplo: ejemplo.php?nombre=Bruce+apellido1=Wayne Se divide en dos pasos: Generar un formulario con action='archivo.php' method='GET' En el archivo .php leer los datos con $_GET['nombreVar'] Vamos a separar siempre que podamos el c\u00f3digo HTML del de PHP. Por ejemplo, el formulario lo colocamos en saluda.html : < form action = \"saluda.php\" method = \"get\" > < p >< label for = \"nombre\" > Nombre: </ label > < input type = \"text\" name = \"nombre\" id = \"nombre\" ></ p > < p >< label for = \"apellido1\" > Primer apellido: </ label > < input type = \"text\" name = \"apellido1\" id = \"apellido1\" ></ p > < p >< input type = \"submit\" value = \"enviar\" ></ p > </ form > Y recogemos los datos en saluda.php : <?php $nombre = $_GET [ \"nombre\" ]; $apellido1 = $_GET [ \"apellido1\" ]; echo \"Hola $nombre $apellido1 \" ; ?> Si lo quisi\u00e9ramos realizar todo en un \u00fanico archivo ( lo cual no es recomendable ), podemos hacerlo as\u00ed: < form action = \"\" method = \"get\" > < p >< label for = \"nombre\" > Nombre: </ label > < input type = \"text\" name = \"nombre\" id = \"nombre\" ></ p > < p >< label for = \"apellido1\" > Primer apellido: </ label > < input type = \"text\" name = \"apellido1\" id = \"apellido1\" ></ p > < input type = \"submit\" value = \"enviar\" > </ form > < p > <?php if ( isset ( $_GET [ 'nombre' ])) { $nombre = $_GET [ \"nombre\" ]; $apellido1 = $_GET [ \"apellido1\" ]; echo \"Hola $nombre $apellido1 \" ; } ?> </ p > El trabajo con formularios lo estudiaremos en profundidad en la unidad 4, y veremos que adem\u00e1s de GET , podemos enviar los datos con POST .","title":"Trabajando con formularios"},{"location":"02php.html#condiciones","text":"La condici\u00f3n simple se realiza mediante la instrucci\u00f3n if . Entre par\u00e9ntesis se pone la condici\u00f3n que se evalua a true o false . Si no se ponen llaves, en vez de abrir un bloque, se ejecutar\u00e1 s\u00f3lo la siguiente instrucci\u00f3n. Siempre llaves Es recomendable poner llaves siempre aunque en el momento de codificar s\u00f3lo haya una \u00fanica instrucci\u00f3n. De este modo, se queda preparado para a\u00f1adir m\u00e1s contenido en el futuro sin provocar bugs . <?php $hora = 8 ; // La hora en formato de 24 horas if ( $hora === 8 ) { echo \"Suena el despertador.\" ; } echo \"<br>\" ; if ( $hora === 8 ) echo \"Suena el despertador.\" ; ?> Las condiciones compuesta mediante if-else : <?php $hora = 17 ; // La hora en formato de 24 horas if ( $hora <= 12 ) { echo \"Son las \" . $hora . \" de la ma\u00f1ana\" ; } else { echo \"Son las \" . ( $hora - 12 ) . \" de la tarde\" ; } ?> Las condiciones anidadas mediante if-else if-else : <?php $hora = 14 ; // La hora en formato de 24 horas if ( $hora === 8 ) { echo \"Es la hora de desayunar.\" ; } else if ( $hora === 14 ) { echo \"Es la hora de la comida.\" ; } else if ( $hora === 21 ) { echo \"Es la hora de la cena.\" ; } else { echo \"Ahora no toca comer.\" ; } ?> La sentencia switch tambi\u00e9n permite trabajar con condiciones m\u00faltiples: <?php $hora = 14 ; // La hora en formato de 24 horas switch ( $hora ) { case 9 : echo \"Es la hora de desayunar.\" ; break ; case 14 : echo \"Es la hora de la comida.\" ; break ; case 21 : echo \"Es la hora de la cena.\" ; break ; default : echo \"Ahora no toca comer\" ; } ?> No olvides el break Un error muy com\u00fan es olvidar la instrucci\u00f3n break tras cada caso. Si no lo ponemos, ejecutar\u00e1 el siguiente caso autom\u00e1ticamente. Finalmente, tambi\u00e9n tenemos el operador ternario condici\u00f3n ? valorTrue : valorFalse : <?php $hora = 14 ; $formato = ( $hora > 12 ) ? 24 : 12 ; echo \"El formato es de $formato horas\" ?> Si queremos comprobar si una variable tiene valor y si no darle un valor determinado, usaremos el operador ?: (se conoce como el operador Elvis - https://en.wikipedia.org/wiki/Elvis_operator ) con la sint\u00e1xis expresi\u00f3n ?: valorSiVacio : <?php $nombre = $_GET [ 'nombre' ] ?: \"desconocido\" ?>","title":"Condiciones"},{"location":"02php.html#bucles","text":"Mediante la instrucci\u00f3n while : <?php $i = 1 ; while ( $i <= 10 ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; $i ++ ; } ?> Mediante la instrucci\u00f3n do-while : <?php do { $dado = rand ( 1 , 6 ); // rand() devuelve un valor aleatorio echo \"Tirando el dado... \" ; echo \"ha salido un \" . $dado . \".\" ; echo \"<br>\" ; } while ( $dado != 5 ); echo \"\u00a1Bien! Saco una ficha de casa.\" ; ?> Mediante la instrucci\u00f3n for : <?php // Bucle ascendente for ( $i = 1 ; $i <= 10 ; $i ++ ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; } // Bucle descendente for ( $i = 10 ; $i >= 0 ; $i -- ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; } ?> M\u00e1s adelante estudiaremos el bucle foreach para recorrer arrays. PHP, del mismo modo que Java y C, permite romper los bucles mediante la instrucci\u00f3n break . A su vez, continue permite saltar a la siguiente iteraci\u00f3n. Si puedes, evita break y continue Personalmente, no me gusta su uso. Prefiero el uso de variables flag para controlar la salida de los bucles. Por ejemplo: <?php $salir = false ; for ( $i = 1 ; $i <= 10 && ! $salir ; $i ++ ) { if ( $i === 5 ) { echo \"Salgo cuando i=5\" ; $salir = true ; } } ?>","title":"Bucles"},{"location":"02php.html#arrays","text":"Para almacenar datos compuestos, podemos utilizar tanto arrays sencillos como arrays asociativos (similares a un mapa). En realidad todos los arrays son mapas ordenados compuestos de pares clave-valor. Cuidado con mezclar tipos Como el tipado es din\u00e1mico, nuestros arrays pueden contenedor datos de diferentes tipos. No se recomienda mezclar los tipos. Del mismo modo que Java, se definen mediante corchetes, son 0-index , y se puede asignar un valor a un posici\u00f3n determinada: <?php $frutas = array ( \"naranja\" , \"pera\" , \"manzana\" ); $frutas2 = [ \"naranja\" , \"pera\" , \"manzana\" ]; $frutas3 = []; $frutas3 [ 0 ] = \"naranja\" ; $frutas3 [ 1 ] = \"pera\" ; $frutas3 [] = \"manzana\" ; // lo a\u00f1ade al final Podemos obtener el tama\u00f1o del array mediante la funci\u00f3n count(array) . Para recorrer el array haremos uso de un bucle for : <?php $tam = count ( $frutas ); // tama\u00f1o del array for ( $i = 0 ; $i < count ( $frutas ); $i ++ ) { echo \"Elemento $i : $frutas[$i] <br />\" ; } Otra forma de recorrer los arrays, incluso m\u00e1s elegante, es hacer uso de foreach . Su sintaxis es foreach (array as elemento) : <?php // Mediante foreach no necesitamos saber el tama\u00f1o del array foreach ( $frutas as $fruta ) { echo \" $fruta <br />\" ; }","title":"Arrays"},{"location":"02php.html#arrays-asociativos","text":"Cada elemento es un par clave-valor. En vez de acceder por la posici\u00f3n, lo hacemos mediante una clave. As\u00ed pues, para cada clave se almacena un valor. A la hora de recorrer este tipo de arrays, mediante foreach separamos cada elemento en una pareja clave => valor : <?php $capitales = [ \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ]; $capitalFrancia = $capitales [ \"Francia\" ]; // se accede al elemento por la clave, no la posici\u00f3n $capitales [ \"Alemania\" ] = \"Berl\u00edn\" ; // a\u00f1adimos un elemento echo \"La capital de Francia es $capitalFrancia <br />\" ; echo \"La capital de Francia es { $capitales [ \"Francia\" ] } <br />\" ; $capitales [] = \"Madrid\" ; // se a\u00f1ade con la clave 0 !!! \u00a1\u00a1\u00a1No asignar valores sin clave!!! foreach ( $capitales as $valor ) { // si recorremos un array asociativo, mostraremos los valores echo \" $valor <br />\" ; } foreach ( $capitales as $pais => $ciudad ) { // separamos cada elemento en clave => valor echo \" $pais : $ciudad <br />\" ; }","title":"Arrays asociativos"},{"location":"02php.html#operaciones","text":"Las operaciones m\u00e1s importantes que podemos realizar con arrays son: print_r($array) : muestra el contenido de todo el $array . Si queremos mostrar el contenido con un formato determinado, hemos de recorrer el array con foreach . var_dump($mixed) : muestra el contenido del elemento recibido. Muestra m\u00e1s informaci\u00f3n que print_r . $elem = array_pop($array) : elimina el \u00faltimo $elemento array_push($array, $elem) : a\u00f1ade un $elemento al final $booleano = in_array($elem, $array) : averigua si $elem est\u00e1 en el $array PHP Consola <?php $frutas = [ \"naranja\" , \"pera\" , \"manzana\" ]; array_push ( $frutas , \"pi\u00f1a\" ); print_r ( $frutas ); $ultFruta = array_pop ( $frutas ); if ( in_array ( \"pi\u00f1a\" , $frutas )) { echo \"<p>Queda pi\u00f1a</p>\" ; } else { echo \"<p>No queda pi\u00f1a</p>\" ; } print_r ( $frutas ); Array ( [0] => naranja [1] => pera [2] => manzana [3] => pi\u00f1a ) <p>No queda pi\u00f1a</p> Array ( [0] => naranja [1] => pera [2] => manzana ) $claves = array_keys($array) : devuelve las claves del $array asociativo $tam = count($array) : devuelve el tama\u00f1o de $array sort($array) : ordena los elementos del $array isset($array[elemento]) : indica si existe/tiene valor elemento dentro del array unset($array[elemento]) : elimina el elemento del array (deja un hueco) PHP Consola <?php $capitales = array ( \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ); $paises = array_keys ( $capitales ); print_r ( $paises ); sort ( $paises ); print_r ( $paises ); unset ( $capitales [ \"Francia\" ]); print_r ( $capitales ); Array ( [0] => Italia [1] => Francia [2] => Portugal ) Array ( [0] => Francia [1] => Italia [2] => Portugal ) Array ( [Italia] => Roma [Portugal] => Lisboa ) Al asignar un array a otro se realiza una copia. Cuidado con esta operaci\u00f3n que puede consumir muchos recursos. PHP Consola <?php $nombres = [ \"Juan\" , \"Ana\" , \"Pedro\" , \"Laura\" ]; $copia = $nombres ; sort ( $nombres ); print_r ( $nombres ); print_r ( $copia ); Array ( [0] => Ana [1] => Juan [2] => Laura [3] => Pedro ) Array ( [0] => Juan [1] => Ana [2] => Pedro [3] => Laura ) Existen much\u00edsimas m\u00e1s funciones para trabajar con arrays. Puedes consultar roda la informaci\u00f3n en la documentaci\u00f3n oficial . Art\u00edculos para profundizar en las operaciones con arrays Un art\u00edculo muy completo (en ingl\u00e9s) de C\u00f3mo trabajar con arrays en PHP de la manera correcta . Otro art\u00edculo recomendable (en ingl\u00e9s) es C\u00f3mo ordenar arrays en PHP .","title":"Operaciones"},{"location":"02php.html#arrays-bidimensionales","text":"Consiste en un array de arrays, ya sean arrays secuenciales o asociativos. Puede haber N dimensiones. <?php $persona [ \"nombre\" ] = \"Bruce Wayne\" ; $persona [ \"telefonos\" ] = [ \"966 123 456\" , \"636 636 636\" ]; // array de arrays ordinarios $persona [ \"profesion\" ] = [ \"dia\" => \"fil\u00e1ntropo\" , \"noche\" => \"caballero oscuro\" ]; // array de arrays asociativos echo $persona [ 'nombre' ] . \" por la noche trabaja de \" . $persona [ 'profesion' ][ 'noche' ]; Combinando los arrays asociativos en varias dimensiones podemos almacenar la informaci\u00f3n como si fuera una tabla: <?php $menu1 = [ \"Plato1\" => \"Macarrones con queso\" , \"Plato2\" => \"Pescado asado\" , \"Bebida\" => \"Coca-Cola\" , \"Postre\" => \"Helado de vainilla\" ]; $menu2 = [ \"Plato1\" => \"Sopa\" , \"Plato2\" => \"Lomo con patatas\" , \"Bebida\" => \"Agua\" , \"Postre\" => \"Arroz con leche\" ]; $menus = [ $menu1 , $menu2 ]; // creamos un array a partir de arrays asociativos foreach ( $menus as $menudeldia ) { echo \"Men\u00fa del d\u00eda<br/>\" ; foreach ( $menudeldia as $platos => $comida ) { echo \" $platos : $comida <br/>\" ; } } // Para acceder a un elemento concreto se anidan los corchetes $postre0 = $menus [ 0 ][ \"Postre\" ]; Aunque pueda parecer una buena idea crear este tipo de estructuras, es mejor utilizar objetos conjuntamente con arrays (posiblemente arrays de otros objetos) para crear estructuras complejas que permitan modelar mejor los problemas.","title":"Arrays bidimensionales"},{"location":"02php.html#funciones","text":"Al no declararse los tipos de datos, los par\u00e1metros de las funciones no tienen tipo ni se indica el tipo de dato que devuelven. El paso de par\u00e1metros se realiza por valor, es decir, se realiza una copia de la variable. <?php function nombreFuncion ( $par1 , $par2 , ... ) { // c\u00f3digo return $valor ; } $resultado = nombreFuncion ( $arg1 , $arg2 , \u2026 ); ?> Por ejemplo: <?php function diaSemana () { $semana = [ \"lunes\" , \"martes\" , \"mi\u00e9rcoles\" , \"jueves\" , \"viernes\" , \"s\u00e1bado\" , \"domingo\" ]; $dia = $semana [ rand ( 0 , 6 )]; return $dia ; } $diaCine = diaSemana (); echo \"El pr\u00f3ximo $diaCine voy al cine.\" ; ?>","title":"Funciones"},{"location":"02php.html#parametros-por-referencia","text":"Si queremos pasar un par\u00e1metro por referencia, en la declaraci\u00f3n de la funci\u00f3n, indicaremos los par\u00e1metros mediante el operador & para indicar la direcci\u00f3n de memoria de la variable. <?php function duplicarPorValor ( $argumento ) { $argumento = $argumento * 2 ; echo \"Dentro de la funci\u00f3n: $argumento .<br>\" ; } function duplicarPorReferencia ( & $argumento ) { $argumento = $argumento * 2 ; echo \"Dentro de la funci\u00f3n: $argumento .<br>\" ; } $numero1 = 5 ; echo \"Antes de llamar: $numero1 .<br>\" ; duplicarPorValor ( $numero1 ); echo \"Despu\u00e9s de llamar: $numero1 .<br>\" ; echo \"<br>\" ; $numero2 = 7 ; echo \"Antes de llamar: $numero2 .<br>\" ; duplicarPorReferencia ( $numero2 ); echo \"Despu\u00e9s de llamar: $numero2 .<br>\" ; ?>","title":"Par\u00e1metros por referencia"},{"location":"02php.html#parametros-por-defecto-opcionales","text":"Permiten asignar valores en la declaraci\u00f3n, y posteriormente, dejar el argumento en blanco. <?php function obtenerCapital ( $pais = \"todos\" ) { $capitales = array ( \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ); if ( $pais == \"todos\" ) { return array_values ( $capitales ); } else { return $capitales [ $pais ]; } } print_r ( obtenerCapital ()); echo \"<br/>\" ; echo obtenerCapital ( \"Francia\" ); En el caso de convivir con otro tipo de par\u00e1metros, los par\u00e1metros que tienen el valor asignado por defecto siempre se colocan al final. <?php function saluda ( $nombre , $prefijo = \"Sr\" ) { echo \"Hola \" . $prefijo . \" \" . $nombre ; } saluda ( \"Aitor\" , \"Mr\" ); saluda ( \"Aitor\" ); saluda ( \"Marina\" , \"Srta\" );","title":"Par\u00e1metros por defecto / opcionales"},{"location":"02php.html#parametros-variables","text":"Podemos tener funciones donde en la declaraci\u00f3n no indiquemos la cantidad de datos de entrada. $arrayArgs = func_get_args(); \u2192 Obtiene un array con los par\u00e1metros $cantidad = func_num_args(); \u2192 Obtiene la cantidad de par\u00e1metros recibidos $valor = func_get_arg(numArgumento); \u2192 Obtiene el par\u00e1metro que ocupa la posici\u00f3n numArgumento . Estas funciones no se pueden pasar como par\u00e1metro a otra funci\u00f3n (como funciones variable, que veremos m\u00e1s adelante). Para ello, debemos guardar previamente la funci\u00f3n en una variable. <?php function sumaParametros () { if ( func_num_args () == 0 ) { return false ; } else { $suma = 0 ; for ( $i = 0 ; $i < func_num_args (); $i ++ ) { $suma += func_get_arg ( $i ); } return $suma ; } } echo sumaParametros ( 1 , 5 , 9 ); // 15 ?> Desde PHP 5.6, se puede utilizar el operador ... ( variadics ) el cual \"disfraza\" los par\u00e1metros como un array: <?php function sumaParametrosMejor ( ... $numeros ) { if ( count ( $numeros ) == 0 ) { return false ; } else { $suma = 0 ; foreach ( $numeros as $num ) { $suma += $num ; } return $suma ; } } echo sumaParametrosMejor ( 1 , 5 , 9 ); // 15 ?> M\u00e1s usos de ... Tambi\u00e9n se puede utilizar para dividir un array en variables separadas para proporcionar argumentos <?php function suma ( $a , $b ) { return $a + $b ; } echo suma ( ... [ 1 , 5 ]) . \"<br />\" ; $a = [ 1 , 5 ]; echo suma ( ... $a ); ?>","title":"Par\u00e1metros variables"},{"location":"02php.html#argumentos-con-nombre","text":"Desde PHP 8.0 podemos pasar los argumentos con el nombre (adem\u00e1s de por posici\u00f3n, como hemos hecho hasta ahora). Los argumentos con nombre se pasan poniendo el nombre como prefijo del par\u00e1metros separado por dos puntos: $resultado = funcion( arg1 : valor1, arg2 : valor2); Esta caracter\u00edstica complementa los parametros opcionales permitiendonos saltar su valor: <?php function funcionArgumentosNombre ( $a , $b = 2 , $c = 4 ) { echo \" $a $b $c \" ; } funcionArgumentosNombre ( c : 3 , a : 1 ); // \"1 2 3\" Tanto los par\u00e1metros opcionales como los obligatorios pueden tener nombre, pero lo argumentos con nombre se tienen que poner despu\u00e9s de los que no lo tienen. <?php funcionArgumentosNombre ( 1 , c : 3 ); // \"1 2 3\"","title":"Argumentos con nombre"},{"location":"02php.html#funciones-tipadas","text":"Desde PHP7 en las funciones, tanto los par\u00e1metro como su devoluci\u00f3n, permiten la definici\u00f3n de tipos. Esto se conoce como strict_types (tipificaci\u00f3n estricta) y hay que definirlo en la primera l\u00ednea de cada archivo .php para que el propio interprete PHP compruebe los tipos y lance errores si los tipos son incorrectos, mediante la sentencia <?php declare ( strict_types = 1 ); As\u00ed pues, vamos a definir los tipos de los par\u00e1metros y de los valores devueltos mediante los tipos: int , float , string , bool , object y array . Si una funci\u00f3n no devuelve nada se indica mediante el tipo void . <?php declare ( strict_types = 1 ); function suma ( int $a , int $b ) : int { return $a + $b ; } $num = 33 ; echo suma ( 10 , 30 ); echo suma ( 10 , $num ); echo suma ( \"10\" , 30 ); // error por tipificaci\u00f3n estricta, sino dar\u00eda 40 ?>","title":"Funciones tipadas"},{"location":"02php.html#alcance","text":"Las variables definidas fuera de las funciones tienen alcance global : accesibles desde cualquier funci\u00f3n. Los par\u00e1metros de una funci\u00f3n y las variables declaradas dentro de una funci\u00f3n (se conocen como variables locales) s\u00f3lo son accesibles desde dentro de la misma funci\u00f3n \u2192 alcance de funci\u00f3n . En caso de conflicto, tienen prioridad las variables locales. Para evitar el conflicto, dentro de la funci\u00f3n, podemos declarar la variable como global . Alcance local Alcance global <?php function miCiudad () { $ciudad = \"Elche\" ; echo \"Dentro de la funci\u00f3n: $ciudad .<br>\" ; } $ciudad = \"Alicante\" ; echo \"Antes de la funci\u00f3n: $ciudad .<br>\" ; miCiudad (); echo \"Despu\u00e9s de la funci\u00f3n: $ciudad .<br>\" ?> <?php function miCiudad () { global $ciudad ; $ciudad = \"Elche\" ; echo \"Dentro de la funci\u00f3n: $ciudad .<br>\" ; } $ciudad = \"Alicante\" ; echo \"Antes de llamar: $ciudad .<br>\" ; miCiudad (); echo \"Despu\u00e9s de llamar: $ciudad .<br>\" ?> No globales Por favor, hay que evitar el uso de variables globales dentro de las funciones. En el caso de necesitarlas, es mejor pasarlas como par\u00e1metro a las funciones.","title":"Alcance"},{"location":"02php.html#funciones-variable","text":"Permite asignar una funci\u00f3n a una variable. Nombre de la funci\u00f3n entre comillas. Si una variable va seguida de par\u00e9ntesis, PHP buscar\u00e1 una funci\u00f3n con su valor. <?php $miFuncionSuma = \"suma\" ; echo $miFuncionSuma ( 3 , 4 ); // invoca a la funci\u00f3n suma ?> Funciones an\u00f3nimas PHP permite la definici\u00f3n y uso de funciones an\u00f3nimas, es decir, funciones que no tienen nombre, y se utilizan principalmente para gestionar los callbacks . Este tipo de funciones se utiliza mucho en Javascript para gestionar los eventos y promesas. <?php $anonima = function () { echo \"Hola\" ; }; $anonima (); $anonimaConParametro = function ( $nombre ) { echo \"Hola \" . $nombre ; }; $anonimaConParametro ( \"Aitor\" ); // Uso de variables externas a la funci\u00f3n an\u00f3nima --> `use` $mensaje = \"Hola\" ; $miClosure = function () use ( $mensaje ) { echo $mensaje ; }; $miClosure (); // Uso de par\u00e1metros $holaPHP = function ( $arg ) use ( $mensaje ) { echo $mensaje . \" \" . $arg ; }; $holaPHP ( \"PHP\" ); ?> Desde PHP 7.4 se han introducido las funciones flecha ( arrow functions ) para simplificar su definici\u00f3n y uso. Ten\u00e9is m\u00e1s informaci\u00f3n sobre funciones an\u00f3nimas y flecha en el siguiente art\u00edculo (en ingl\u00e9s): Funciones an\u00f3nimas y flecha en PHP","title":"Funciones variable"},{"location":"02php.html#biblioteca-de-funciones","text":"Podemos agrupar un conjunto de funciones en un archivo, para permitir su reutilizaci\u00f3n. Posteriormente, se incluye con: include(archivo); / include_once(archivo); require(archivo); / require_once(archivo); Si no encuentra el archivo, require lanza un error fatal, include lo ignora Las funciones _once s\u00f3lo se cargan una vez, si ya ha sido incluida previamente, no lo vuelve a hacer, evitando bucles. Por ejemplo, colocamos las funciones en el archivo biblioteca.php : <?php function suma ( int $a , int $b ) : int { return $a + $b ; } function resta ( int $a , int $b ) : int { return $a - $b ; } ?> Y posteriormente en otro archivo: <?php include_once ( \"biblioteca.php\" ); echo suma ( 10 , 20 ); echo resta ( 40 , 20 ); ?>","title":"Biblioteca de funciones"},{"location":"02php.html#plantillas-mediante-include","text":"Mediante el uso de la instrucci\u00f3n include tambi\u00e9n podemos separar fragmentos de c\u00f3digo PHP/HTML que queramos reutilizar en nuestros sitios web y crear un sistema muy sencillo de plantillas. Por ejemplo, vamos a separar una p\u00e1gina en tres partes, primero la parte superior en encabezado.php : <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > <? = $titulo ?> </ title > </ head > < body > La parte de abajo, por ejemplo, solo va a contener HTML y la colocamos en pie.html : < footer > Aitor Medrano </ footer > </ body > </ html > Y luego nos centramos \u00fanicamente en el contenido que cambia en pagina.php : <?php $titulo = \"P\u00e1gina con includes\" ; include ( \"encabezado.php\" ); ?> < h1 > <? = $titulo ?> </ h1 > <?php include ( \"pie.html\" ); ?>","title":"Plantillas mediante include"},{"location":"02php.html#funciones-predefinidas","text":"El lenguaje ofrece un abanico de funciones ya definidas, agrupadas por su funcionalidad: https://www.php.net/manual/es/funcref.php","title":"Funciones predefinidas"},{"location":"02php.html#cadenas","text":"Ya hemos visto que se pueden crear con comillas simples ( '' , sin interpretaci\u00f3n) o comillas dobles ( \"\" , interpretan el contenido y las secuencias de escape \\n , \\t , \\$ , { , \u2026 - magic quotes ) <?php \"Me llamo $nombre \" \"Son 30 { $moneda } s\" ?> Se acceden a los caracteres como si fuera un array. <?php $cadena = \u201cYo soy Batman\u201d ; $ygriega = $cadena [ 0 ]; ?> Adem\u00e1s de echo , podemos mostrar las cadenas mediante la funci\u00f3n printf . Esta funci\u00f3n viene heredada del lenguaje C, y en la cadena se indica el tipo de dato a formatear y genera una salida formateada. Si quiero guardar el resultado en una variable, podemos utilizar sprintf . <?php $num = 33 ; $nombre = \"Larry Bird\" ; printf ( \"%s llevaba el n\u00famero %d\" , $nombre , $num ); // %d -> n\u00famero decimal, %s -> string $frase = sprintf ( \"%s llevaba el n\u00famero %d\" , $nombre , $num ); echo $frase ?> Ten\u00e9is muchos m\u00e1s ejemplos en https://www.w3schools.com/php/func_string_printf.asp","title":"Cadenas"},{"location":"02php.html#matematicas","text":"Disponemos tanto de constantes como funciones ya definidas para trabajar con operaciones matem\u00e1ticas: https://www.php.net/manual/es/ref.math.php Constantes ya definidas M_PI , M_E , M_EULER , M_LN2 , M_LOG2E PHP_INT_MAX , PHP_FLOAT_MAX Funciones de c\u00e1lculo pow , sqrt , log , decbin , bindec , decoct , dechex , base_convert , max , min Funciones trigonom\u00e9tricas sin , cos , tan , deg2rad , rad2deg Funciones para trabajar con n\u00fameros aleatorios rand , mt_rand (m\u00e1s r\u00e1pida) Aunque la mayor\u00eda de ellas son muy espec\u00edficas de problemas matem\u00e1ticos / estad\u00edsticos, es muy com\u00fan que tengamos que redondear y/o formatear los c\u00e1lculos antes de mostrarlos al usuario. Mediante la funci\u00f3n number_format(numero, cantidadDecimales, separadorDecimales, separadorMiles) podermos pasar n\u00fameros a cadena con decimales y/o separadores de decimales y/o de miles. <?php $nf = 1234.5678 ; echo number_format ( $nf , 2 ); // 1,234.57 echo number_format ( $nf , 2 , \"M\" , \"#\" ); // 1#234M57 ?> Para redondear, tenemos abs para el valor absoluto y round para redondear, ceil para aproximaci\u00f3n por exceso y floor por defecto. <?php $num = 7.7 ; $siete = floor ( $num ); $ocho = ceil ( $num ); $otro = 4.49 ; $cuatro = round ( $otro ); $cuatrocinco = round ( $otro , 1 ); $cinco = round ( $cuatrocinco ); ?>","title":"Matem\u00e1ticas"},{"location":"02php.html#tipos-de-datos","text":"Finalmente, para realizar conversiones de datos o si queremos trabajar con tipos de datos, tenemos las siguientes funciones: floatval , intval , strval : devuelve una variable del tipo de la funci\u00f3n indicada settype : fuerza la conversi\u00f3n gettype : obtiene el tipo is_int , is_float , is_string , is_array , is_object : devuelve un booleano a partir del tipo recibido <?php $uno = 1 ; var_dump ( is_int ( $uno )); // true $unofloat = floatval ( $uno ); settype ( $uno , \"string\" ); var_dump ( is_int ( $uno )); // false var_dump ( is_string ( $uno )); // true settype ( $uno , \"float\" ); var_dump ( is_int ( $uno )); // false var_dump ( is_float ( $uno )); // true var_dump ( is_int ( intval ( $uno ))); // true ?>","title":"Tipos de datos"},{"location":"02php.html#referencias","text":"Manual de PHP PHP en 2020 , por Jes\u00fas Amieiro Apuntes de PHP de Bartolom\u00e9 Sintes, profesor del IES Abastos de Valencia Gu\u00eda de Estilo - PSR PHP - La manera correcta","title":"Referencias"},{"location":"02php.html#actividades","text":"","title":"Actividades"},{"location":"02php.html#php-basico","text":"Visualiza el v\u00eddeo de Jes\u00fas Amieiro sobre PHP en 2020 a partir del minuto 3:32 (son 40 minutos aproximadamente). \u00bfQu\u00e9 relaci\u00f3n existe entre PHP y Facebook? Respecto al rendimiento, \u00bfqu\u00e9 versi\u00f3n m\u00ednima deber\u00edamos utilizar? \u00bfPor qu\u00e9 PHP tiene mala fama? 201tresfrases.php : Muestra 3 frases, cada una en un p\u00e1rrafo utilizando las tres posibilidades que existen de mostrar contenido. Tras ello, introduce dos comentarios, uno de bloque y otro de una l\u00ednea. 202calculos.php : Escribe un programa que utilice las variables $x y $y . As\u00edgnales los valores 166 y 999 respectivamente. A continuaci\u00f3n, muestra por pantalla el valor de cada variable, la suma, la resta, la divisi\u00f3n y la multiplicaci\u00f3n. 203datosPersonales.php : Escribe un programa que almacene en variables tu nombre, primer apellido, segundo apellido, email, a\u00f1o de nacimiento y tel\u00e9fono. Luego mu\u00e9stralos por pantalla dentro de una tabla. 204datosPersonales.html y 204datosPersonales.php : Es el mismo ejercicio que el anterior, pero separando la l\u00f3gica. En el primer archivo crearemos el formulario para introducir los datos, y luego recogemos los datos y generamos la tabla en el segundo archivo. 205madlib.html y 205madlib.php : A partir de un nombre, un verbo, un adjetivo y un adverbio, crea una historia que contenga dichos elementos. Por ejemplo: Entrada: perro / caminar / azul / r\u00e1pidamente Salida: \u00bf Te gusta caminar con tu perro azul r\u00e1pidamente ? 205madlib2.html y 205madlib2.php Crea un madlib m\u00e1s extenso, leyendo m\u00e1s datos de entrada. 206anyos.php : Tras leer la edad de una persona, mostrar la edad que tendr\u00e1 dentro de 10 a\u00f1os y hace 10 a\u00f1os. Adem\u00e1s, muestra qu\u00e9 a\u00f1o ser\u00e1 en cada uno de los casos. Finalmente, muestra el a\u00f1o de jubilaci\u00f3n suponiendo que trabajar\u00e1s hasta los 67 a\u00f1os. En este caso, no hace falta que previamente crees un formulario, puedes probar el ejercicio via URL: 206anyos.php?edad=33 . Tip: $anyoActual = date(\"Y\"); 207dinero.php : A partir de una cantidad de dinero, mostrar su descomposici\u00f3n en billetes (500, 200, 100, 50, 20, 10, 5) y monedas (2, 1), para que el n\u00famero de elementos sea m\u00ednimo. No se utilizar ninguna instrucci\u00f3n condicional. Por ejemplo, al introducir 139 debe mostrar: 1 billete de 100 0 billete de 50 1 billete de 20 1 billete de 10 1 billete de 5 2 moneda de 2 Tip: Puedes forzar a realizar la divisi\u00f3n entera mediante la funci\u00f3n intdiv($dividendo, $divisor) o pasar un n\u00famero flotante a entero puedes usar la funci\u00f3n intval() 208posnegcero.php : A partir de un numero , muestra por pantalla si el n\u00famero es positivo , negativo o cero . 209mayor3.php : Sin hacer uso de condiciones que utilicen dentro la condici\u00f3n los operadores l\u00f3gicos, muestra el mayor de tres n\u00fameros ( a , b y c ). 209mayor3c.php : Utiliza en las condiciones los operadores l\u00f3gicos. 210nombreEdad.php : A partir de una edad muestra por pantalla: beb\u00e9 si tiene menos de 3 a\u00f1os ni\u00f1o si tiene entre 3 y 12 a\u00f1os adolescente entre 13 y 17 a\u00f1os adulto entre 18 y 66 jubilado a partir de 67 211reloj.php : Escribe un programa que funcione similar a un reloj, de manera que a partir de los valores de hora , minuto y segundo muestre la hora dentro de un segundo. Tras las 23:59:59 ser\u00e1n las 0:0:0 . 212calendario.php : Escribe un programa similar a un calendario de manera que a partir de dia , mes y anyo muestre la fecha dentro de un d\u00eda. Debes tener en cuenta que no todos los meses tienen 30 d\u00edas. En este caso, no vamos a tener en cuenta los a\u00f1os bisiestos. 213ecuacion2g.php : Crea un programa que resuelva una ecuaci\u00f3n de 2\u00ba grado del tipo ax\u00b2 + bx + c = 0 . Ten en cuenta que puede tener 2, 1 o no tener soluci\u00f3n dependiendo del valor del discriminante b\u00b2-4ac . Tip: Para calcular la ra\u00edz cuadrada deber\u00e1s utilizar la funci\u00f3n sqrt() Ejercicios de investigaci\u00f3n: Investiga para que sirve el operador nave espacial, disponible desde PHP7 ( https://www.php.net/manual/es/migration70.new-features.php ). Explica con un par de l\u00edneas su prop\u00f3sito y mediante c\u00f3digo demuestra su uso. Investiga para qu\u00e9 sirve la instrucci\u00f3n match() , disponible desde PHP8 ( https://www.php.net/manual/es/control-structures.match.php ). Explica con un par de l\u00edneas su prop\u00f3sito y mediante c\u00f3digo demuestra su uso.","title":"PHP b\u00e1sico"},{"location":"02php.html#bucles_1","text":"220pares050.php: Escribe un programa que muestre los n\u00fameros pares del 0 al 50 (dentro de una lista desordenada). 220paresAB.php : A partir del anterior, refactorizar para que funcione con inicio y fin . 221suma110.php : Escribe un programa que sume los n\u00fameros del 1 al 10. 221sumaAB.php : A partir del anterior, refactorizar para que funcione con inicio y fin . 222potencia.php : A partir de una base y exponente , mediante la acumulaci\u00f3n de productos, calcula la potencia utilizando la instrucci\u00f3n for . 222potenciaWhile.php : Reescribe el ejercicio anterior haciendo uso s\u00f3lo de while . 222potenciaDoWhile.php : Reescribe el ejercicio anterior haciendo uso s\u00f3lo de do-while . 223tablaMultiplicar.php : Muestra dentro de una tabla HTML la tabla de multiplicar del numero que reciba como par\u00e1metro. Utiliza <thead> con sus respectivos <th> y <tbody > para dibujar la tabla. Por ejemplo: a * b = a*b 7 * 1 = 7 7 * 2 = 14 ... 7 * 10 = 70 224formulario.html : Crea un formulario que permita leer una cantidad . Tip Para guardar un dato oculto puedes utilizar un campo de formulario de tipo oculto: <input type=\"hidden\" name=\"cantidad\" value=\"33\" /> 224leerDatos.php : a partir de cantidad , prepara un formulario con tantas cajas de datos como su valor. Finalmente, en 224sumarDatos.php : a partir de los datos de todas las cajas de la p\u00e1gina anterior, s\u00famalos y muestra el total. 225formulario.html y 225tabla.php : A partir de un n\u00famero de filas y columnas , crear una tabla con ese tama\u00f1o. Las celdas deben estar rellenadas con los valores de las coordenadas de cada celda. 226formulario.html y 226cuadrado.php : Bas\u00e1ndote en el ejercicio anterior, rellena la tabla de manera que solo los bordes tengan contenido, qued\u00e1ndose el resto de celdas en blanco. 227formulario.html y 227equis.php : Bas\u00e1ndote en el ejercicio anterior, ahora s\u00f3lo debe aparecer el contenido de los dos diagonales. 228cuadradoMultiplicar.php : Crea un programa que muestre por pantalla un cuadrado exactamente igual (f\u00edjate bien en los encabezados, tanto de las filas como de las columnas) al de la imagen con las tablas de multiplicar.","title":"Bucles"},{"location":"02php.html#arrays_1","text":"230aleatorios50.php : Rellena un array con 50 n\u00fameros aleatorios comprendidos entre el 0 y el 99, y luego mu\u00e9stralo en una lista desordenada. Para crear un n\u00famero aleatorio, utiliza la funci\u00f3n rand(inicio, fin) . Por ejemplo: $num = rand(0, 99) 231bola8.html : Prepara un formulario con un caja de texto que realice a una pregunta al usuario. 231bola8.php : A partir del anterior, crea un programa que muestre la pregunta recibida y genere una respuesta de manera aleatoria entre un conjunto de respuestas predefinidas, almacenadas en un array: Si, no, quiz\u00e1s, claro que s\u00ed, por supuesto que no, no lo tengo claro, seguro, yo dir\u00eda que s\u00ed, ni de co\u00f1a, etc.. . Este ejercicio se basa en el juego de la Bola 8 m\u00e1gica . 232mates.php : A partir del ejercicio 230, genera un array aleatorio de 33 elementos con n\u00fameros comprendidos entre el 0 y 100 y calcula: El mayor El menor La media 233sexos.php : Rellena un array de 100 elementos de manera aleatoria con valores M o F (por ejemplo [\"M\", \"M\", \"F\", \"M\", ...] ). Una vez completado, vuelve a recorrerlo y calcula cuantos elementos hay de cada uno de los valores almacenando el resultado en un array asociativo ['M' => 44, 'F' => 66] ( no utilices variables para contar las M o las F ). Finalmente, muestra el resultado por pantalla 234monedas.php : Vuelve a realizar el ejercicio 207, el de las monedas (500, 200, 100, 50, 20, 10, 5, 2, 1), pero haciendo uso de arrays y un bucle. Almacena el resultado en un array asociativo. Muestra el resultado en una lista desordenada \u00fanicamente con las cantidades que tienen alg\u00fan valor. 235alturas.php : Mediante un array asociativo, almacena el nombre y la altura de 5 personas ( nombre => altura ). Posteriormente, recorre el array y mu\u00e9stralo en una tabla HTML. Finalmente a\u00f1ade una \u00faltima fila a la tabla con la altura media. 236personas.php : Mediante un array bidimensional, almacena el nombre, altura y email de 5 personas. Para ello, crea un array de personas, siendo cada persona un array asociativo: [ ['nombre'=>'Aitor', 'altura'=>182, 'email'=>'aitor@correo.com'],[\u2026],\u2026 ] Posteriormente, recorre el array y mu\u00e9stralo en una tabla HTML. 237leerCantidad.html y 237leerPersonas.php : a partir de un formulario con un campo de cantidad de personas, generar un nuevo formulario para leer el nombre, altura y email de cantidad personas. 237gestionarPersonas.php : A partir de las personas introducidas, mostrar sus datos en una tabla, y posteriormente, destacar los datos del m\u00e1s alto y el del m\u00e1s bajo. 238tablaDistintos.php : Rellena un array bidimensional de 6 filas por 9 columnas con n\u00fameros aleatorios comprendidos entre 100 y 999 (ambos incluidos). Todos los n\u00fameros deben ser distintos, es decir, no se puede repetir ninguno. Muestra a continuaci\u00f3n por pantalla el contenido del array de tal forma que: La columna del m\u00e1ximo debe aparecer en azul. La fila del m\u00ednimo debe aparecer en verde El resto de nu\u0301meros deben aparecer en negro.","title":"Arrays"},{"location":"02php.html#funciones_1","text":"240arrayPar.php : Crea las siguientes funciones: Una funci\u00f3n que averig\u00fce si un n\u00famero es par: esPar(int $num): bool Una funci\u00f3n que devuelva un array de tama\u00f1o $tam con n\u00fameros aleatorios comprendido entre $min y $max : arrayAleatorio(int $tam, int $min, int $max) : array Una funci\u00f3n que reciba un $array por referencia y devuelva la cantidad de n\u00fameros pares que hay almacenados: arrayPares(array &$array): int 241parametrosVariables.php : Crea las siguientes funciones: Una funci\u00f3n que devuelva el mayor de todos los n\u00fameros recibidos como par\u00e1metros: function mayor(): int . Utiliza las funciones func_get_args() , etc... No puedes usar la funci\u00f3n max() . Una funci\u00f3n que concatene todos los par\u00e1metros recibidos separ\u00e1ndolos con un espacio: function concatenar(...$palabras) : string . Utiliza el operador ... . 242matematicas.php : A\u00f1ade las siguientes funciones: digitos(int $num): int \u2192 devuelve la cantidad de d\u00edgitos de un n\u00famero. digitoN(int $num, int $pos): int \u2192 devuelve el d\u00edgito que ocupa, empezando por la izquierda, la posici\u00f3n $pos . quitaPorDetras(int $num, int $cant): int \u2192 le quita por detr\u00e1s (derecha) $cant d\u00edgitos. quitaPorDelante(int $num, int $cant): int \u2192 le quita por delante (izquierda) $cant d\u00edgitos. Para probar las funciones, haz uso tanto de paso de argumentos posicionales como argumentos con nombre. 243biblioteca.php : crea un archivo con funciones para sumar, restar, multiplicar y dividir dos n\u00fameros. 243arrayFunciones.php : haciendo uso de un array que almacene el nombre de las funciones del archivo anterior, a partir de dos n\u00fameros recibidos por URL, recorre el array e invoca a las funciones de manera din\u00e1mica haciendo uso de funciones variable. 244euros.php : Crea una biblioteca con dos funciones: peseta2euros: pasa de pesetas a euros euros2pesetas: pasa de euros a pesetas Cada funci\u00f3n debe recibir dos par\u00e1metros: La cantidad a transformar La cotizaci\u00f3n, con un par\u00e1metro por defecto con el factor de transformaci\u00f3n. 244calculadoraEuros.php : utiliza 243euros.php y prueba las funciones pasando tanto cantidades con la cotizaci\u00f3n por defecto, como con nuevas cotizaciones. Recuerda que 1 euro son/eran 166.36 pesetas. 245preparaTiquetCompra.php : A partir de una cantidad de productos, leer el nombre y coste de la cantidad de productos indicados (similar al ejercicio 237, pero esta vez no hace falta crear el formulario con la cantidad, se recibe mediante un par\u00e1metro GET via URL). 245imprimeTiquetCompra.php : Tras leer los datos del tiquet de compra, enumera en una tabla los productos, con su precio en euros y pesetas, y finalmente, en una \u00faltima fila, totalizar en ambas monedas. A partir de los archivos creados en el ejercicio anterior, crea una plantilla mediante includes: 246preparaCompra.php : similar a 245preparaTiquetCompra.php , pero separando el encabezado ( Supermercado Severo en h1 ) y el pie ( Tu supermercado de confianza ) en ficheros externos y referenciando a ellos mediante include . 246listaCompra.php : recibe los datos del anterior, y reutiliza parte de 245imprimeTiquetCompra.php cambiando la tabla por una lista desordenada de los productos junto a su precio. Vamos a simular un formulario de acceso: 247login.php : el formulario de entrada, que solicita el usuario y contrase\u00f1a. 247compruebaLogin.php : recibe los datos y comprueba si son correctos (los usuarios se guardan en un array asociativo) pasando el control mediante el uso de include a: 247ok.php : El usuario introducido es correcto 247ko.php : El usuario es incorrecto. Informar si ambos est\u00e1n mal o solo la contrase\u00f1a. Volver a mostrar el formulario de acceso.","title":"Funciones"},{"location":"02php.html#funciones-predefinidas_1","text":"Todos los ejercicios se deben realizar creando nuevas funciones para encapsular el c\u00f3digo. Adem\u00e1s de la propia funci\u00f3n, el ejercicio debe contener c\u00f3digo para poder probarlo. 250fraseImpares.php : Lee una frase y devuelve una nueva con solo los caracteres de las posiciones impares. 251vocales.php : A partir de una frase, devuelve la cantidad de cada una de las vocales, y el total de ellas. 252analizador.php : A partir de una frase con palabras s\u00f3lo separadas por espacios, devolver Letras totales y cantidad de palabras Una l\u00ednea por cada palabra indicando su tama\u00f1o Nota: no se puede usar str_word_count 252analizadorWC.php : Investiga que hace la funci\u00f3n str_word_count , y vuelve a hacer el ejercicio. 253cani.php : EsCrIbE uNa FuNcI\u00f3N qUe TrAnSfOrMe UnA cAdEnA eN cAnI. 254palindromo.php : Escribe una funci\u00f3n que devuelva un booleano indicando si una palabra es pal\u00edndroma (se lee igual de izquierda a derecha que de derecha a izquierda, por ejemplo, \u201cligar es ser agil\u201d). 255codificar.php : Utilizando las funciones para trabajar con caracteres, a partir de una cadena y un desplazamiento: Si el desplazamiento es 1, sustituye la A por B, la B por C, etc. El desplazamiento no puede ser negativo Si se sale del abecedario, debe volver a empezar Hay que respetar los espacios, puntos y comas. 256filtrado.html : Crea un programa que permita al usuario leer un conjunto de n\u00fameros separados por espacios. 256filtrado.php : El programa filtrar\u00e1 los n\u00fameros le\u00eddos para volver a mostrar \u00fanicamente los n\u00fameros pares e indicar\u00e1 la cantidad existente. Dame n\u00fameros: 1 4 7 9 23 10 8 Los 3 n\u00fameros pares son: 4 10 8 257investiga.php : Investiga las siguientes funciones de cadena (explica para qu\u00e9 sirven mediante comentarios, y programa un peque\u00f1o ejemplo de cada una de ellas): ucwords , strrev , str_repeat y md5 . Los siguientes ejercicios se basan en la generaci\u00f3n de n\u00fameros aleatorios. 260generador.php : Crea una funci\u00f3n que permite generar una letra aleatoria, may\u00fascula o min\u00fascula. 261generaContrasenya.php : Crea una funci\u00f3n que a partir de un tama\u00f1o, genere una contrase\u00f1a aleatoria compuesta de letras y d\u00edgitos de manera aleatoria. 262quinielas.php : Crea las siguientes funciones: quinigol() : array \u2192 Genera un array multidimensional con 6 resultados aleatorios con combinaciones [012M, 012M] quiniela() : array \u2192 Genera un array con una combinaci\u00f3n de quiniela generada de manera aleatoria: 14 resultados con 1X2 y el pleno al quince con [012M, 012M] tabla(array $quiniela) : string \u2192 transforma un array de una quniela en una tabla HTML","title":"Funciones predefinidas"},{"location":"03phpoo.html","text":"PHP Orientado a Objetos \u00b6 Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 18 sesiones Resultado de aprendizaje: Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. Criterios de evaluaci\u00f3n: Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. Se han aplicado los principios de la programaci\u00f3n orientada a objetos. Se ha probado y documentado el c\u00f3digo. Clases y Objetos \u00b6 PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Un clase es un plantilla que define las propiedades y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase. Tanto las propiedades como los m\u00e9todos se definen con una visibilidad (quien puede acceder) Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : <?php class NombreClase { // propiedades // y m\u00e9todos } $ob = new NombreClase (); Clases con may\u00fascula Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de las propiedades y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a una propiedad o un m\u00e9todo: $objeto->propiedad; $objeto->m\u00e9todo(par\u00e1metros); Si desde dentro de la clase, queremos acceder a una propiedad o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; $this->propiedad; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: <?php class Persona { private string $nombre ; public function setNombre ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero contedr\u00e1 una sola clase, y se nombrar\u00e1 con el nombre de la clase. Encapsulaci\u00f3n \u00b6 Las propiedades se definen privadas o protegidas (si queremos que las clases heredadas puedan acceder). Para cada propiedad, se a\u00f1aden m\u00e9todos p\u00fablicos ( getter/setter ): public setPropiedad(tipo $param) public getPropiedad() : tipo Las constantes se definen p\u00fablicas para que sean accesibles por todos los recursos. <?php class MayorMenor { private int $mayor ; private int $menor ; public function setMayor ( int $may ) { $this -> mayor = $may ; } public function setMenor ( int $men ) { $this -> menor = $men ; } public function getMayor () : int { return $this -> mayor ; } public function getMenor () : int { return $this -> menor ; } } Recibiendo y enviando objetos \u00b6 Es recomendable indicarlo en el tipo de par\u00e1metros. Si el objeto puede devolver nulos se pone ? delante del nombre de la clase. Objetos por referencia Los objetos que se env\u00edan y reciben como par\u00e1metros siempre se pasan por referencia. <?php function maymen ( array $numeros ) : ? MayorMenor { $a = max ( $numeros ); $b = min ( $numeros ); $result = new MayorMenor (); $result -> setMayor ( $a ); $result -> setMenor ( $b ); return $result ; } $resultado = maymen ([ 1 , 76 , 9 , 388 , 41 , 39 , 25 , 97 , 22 ]); echo \"<br>Mayor: \" . $resultado -> getMayor (); echo \"<br>Menor: \" . $resultado -> getMenor (); Constructor \u00b6 El constructor de los objetos se define mediante el m\u00e9todo m\u00e1gico __construct . Puede o no tener par\u00e1metros, pero s\u00f3lo puede haber un \u00fanico constructor. <?php class Persona { private string $nombre ; public function __construct ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Constructores en PHP 8 \u00b6 Una de las grandes novedades que ofrece PHP 8 es la simplificaci\u00f3n de los constructores con par\u00e1metros, lo que se conoce como promoci\u00f3n de las propiedades del constructor . Para ello, en vez de tener que declarar las propiedades como privadas o protegidas, y luego dentro del constructor tener que asignar los par\u00e1metros a est\u00e1s propiedades, el propio constructor promociona las propiedades. Ve\u00e1moslo mejor con un ejemplo. Imaginemos una clase Punto donde queramos almacenar sus coordenadas: <?php class Punto { protected float $x ; protected float $y ; protected float $z ; public function __construct ( float $x = 0.0 , float $y = 0.0 , float $z = 0.0 ) { $this -> x = $x ; $this -> y = $y ; $this -> z = $z ; } } En PHP 8, quedar\u00eda del siguiente modo (mucho m\u00e1s corto, lo que facilita su legibilidad): <?php class Punto { public function __construct ( protected float $x = 0.0 , protected float $y = 0.0 , protected float $z = 0.0 , ) {} } El orden importa A la hora de codificar el orden de los elementos debe ser: <?php declare ( strict_types = 1 ); class NombreClase { // propiedades // constructor // getters - setters // resto de m\u00e9todos } ?> Clases est\u00e1ticas \u00b6 Son aquellas que tienen propiedades y/o m\u00e9todos est\u00e1ticos (tambi\u00e9n se conocen como de clase , por que su valor se comparte entre todas las instancias de la misma clase). Se declaran con static y se referencian con :: . Si queremos acceder a un m\u00e9todo est\u00e1tico, se antepone el nombre de la clase: Producto::nuevoProducto() . Si desde un m\u00e9todo queremos acceder a una propiedad est\u00e1tica de la misma clase, se utiliza la referencia self : self::$numProductos <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; public static function nuevoProducto () { self :: $numProductos ++ ; } } Producto :: nuevoProducto (); $impuesto = Producto :: IVA ; Tambi\u00e9n podemos tener clases normales que tengan alguna propiedad est\u00e1tica: <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; private $codigo ; public function __construct ( string $cod ) { self :: $numProductos ++ ; $this -> codigo = $cod ; } public function mostrarResumen () : string { return \"El producto \" . $this -> codigo . \" es el n\u00famero \" . self :: $numProductos ; } } $prod1 = new Producto ( \"PS5\" ); $prod2 = new Producto ( \"XBOX Series X\" ); $prod3 = new Producto ( \"Nintendo Switch\" ); echo $prod3 -> mostrarResumen (); Introspecci\u00f3n \u00b6 Al trabajar con clases y objetos, existen un conjunto de funciones ya definidas por el lenguaje que permiten obtener informaci\u00f3n sobre los objetos: instanceof : permite comprobar si un objeto es de una determinada clase get_class : devuelve el nombre de la clase get_declared_class : devuelve un array con los nombres de las clases definidas class_alias : crea un alias class_exists / method_exists / property_exists : true si la clase / m\u00e9todo / propiedad est\u00e1 definida get_class_methods / get_class_vars / get_object_vars : Devuelve un array con los nombres de los m\u00e9todos / propiedades de una clase / propiedades de un objeto que son accesibles desde d\u00f3nde se hace la llamada. Un ejemplo de estas funciones puede ser el siguiente: <?php $p = new Producto ( \"PS5\" ); if ( $p instanceof Producto ) { echo \"Es un producto\" ; echo \"La clase es \" . get_class ( $p ); class_alias ( \"Producto\" , \"Articulo\" ); $c = new Articulo ( \"Nintendo Switch\" ); echo \"Un articulo es un \" . get_class ( $c ); print_r ( get_class_methods ( \"Producto\" )); print_r ( get_class_vars ( \"Producto\" )); print_r ( get_object_vars ( $p )); if ( method_exists ( $p , \"mostrarResumen\" )) { $p -> mostrarResumen (); } } Clonado Al asignar dos objetos no se copian, se crea una nueva referencia. Si queremos una copia, hay que clonarlo mediante el m\u00e9todo clone(object) : object Si queremos modificar el clonado por defecto, hay que definir el m\u00e9todo m\u00e1gico __clone() que se llamar\u00e1 despu\u00e9s de copiar todas las propiedades. M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.oop5.cloning.php Herencia \u00b6 PHP soporta herencia simple, de manera que una clase solo puede heredar de otra, no de dos clases a la vez. Para ello se utiliza la palabra clave extends . Si queremos que la clase A hereda de la clase B haremos: class A extends B El hijo hereda los atributos y m\u00e9todos p\u00fablicos y protegidos. Cada clase en un archivo Como ya hemos comentado, deber\u00edamos colocar cada clase en un archivo diferente para posteriormente utilizarlo mediante include . En los siguiente ejemplo los hemos colocado junto para facilitar su legibilidad. Por ejemplo, tenemos una clase Producto y una Tv que hereda de Producto : <?php class Producto { public $codigo ; public $nombre ; public $nombreCorto ; public $PVP ; public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; } Podemos utilizar las siguientes funciones para averiguar si hay relaci\u00f3n entre dos clases: get_parent_class(object): string is_subclass_of(object, string): bool <?php $t = new Tv (); $t -> codigo = 33 ; if ( $t instanceof Producto ) { echo $t -> mostrarResumen (); } $padre = get_parent_class ( $t ); echo \"<br>La clase padre es: \" . $padre ; $objetoPadre = new $padre ; echo $objetoPadre -> mostrarResumen (); if ( is_subclass_of ( $t , 'Producto' )) { echo \"<br>Soy un hijo de Producto\" ; } Sobreescribir m\u00e9todos \u00b6 Podemos crear m\u00e9todos en los hijos con el mismo nombre que el padre, cambiando su comportamiento. Para invocar a los m\u00e9todos del padre -> parent::nombreMetodo() <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } Constructor en hijos \u00b6 En los hijos no se crea ning\u00fan constructor de manera autom\u00e1tica. Por lo que si no lo hay, se invoca autom\u00e1ticamente al del padre. En cambio, si lo definimos en el hijo, hemos de invocar al del padre de manera expl\u00edcita. PHP7 PHP8 <?php class Producto { public string $codigo ; public function __construct ( string $codigo ) { $this -> codigo = $codigo ; } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function __construct ( string $codigo , int $pulgadas , string $tecnologia ) { parent :: __construct ( $codigo ); $this -> pulgadas = $pulgadas ; $this -> tecnologia = $tecnologia ; } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } <?php class Producto { public function __construct ( private string $codigo ) { } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public function __construct ( string $codigo , private int $pulgadas , private string $tecnologia ) { parent :: __construct ( $codigo ); } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } Clases abstractas \u00b6 Las clases abstractas obligan a heredar de una clase, ya que no se permite su instanciaci\u00f3n. Se define mediante abstract class NombreClase { . Una clase abstracta puede contener propiedades y m\u00e9todos no-abstractos, y/o m\u00e9todos abstractos. <?php // Clase abstracta abstract class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } // M\u00e9todo abstracto abstract public function mostrarResumen (); } Cuando una clase hereda de una clase abstracta, obligatoriamente debe implementar los m\u00e9todos que tiene el padre marcados como abstractos. <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { //obligado a implementarlo echo \"<p>C\u00f3digo \" . $this -> getCodigo () . \"</p>\" ; echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } $t = new Tv (); echo $t -> getCodigo (); Clases finales \u00b6 Son clases opuestas a abstractas, ya que evitan que se pueda heredar una clase o m\u00e9todo para sobreescribirlo. <?php class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } final public function mostrarResumen () : string { return \"Producto \" . $this -> codigo ; } } // No podremos heredar de Microondas final class Microondas extends Producto { private $potencia ; public function getPotencia () : int { return $this -> potencia ; } // No podemos implementar mostrarResumen() } Interfaces \u00b6 Permite definir un contrato con las firmas de los m\u00e9todos a cumplir. As\u00ed pues, s\u00f3lo contiene declaraciones de funciones y todas deben ser p\u00fablicas. Se declaran con la palabra clave interface y luego las clases que cumplan el contrato lo realizan mediante la palabra clave implements . <?php interface Nombreable { // declaraci\u00f3n de funciones } class NombreClase implements NombreInterfaz { // c\u00f3digo de la clase Se permite la herencia de interfaces. Adem\u00e1s, una clase puede implementar varios interfaces (en este caso, s\u00ed soporta la herecia m\u00faltiple, pero s\u00f3lo de interfaces). <?php interface Mostrable { public function mostrarResumen () : string ; } interface MostrableTodo extends Mostrable { public function mostrarTodo () : string ; } interface Facturable { public function generarFactura () : string ; } class Producto implements MostrableTodo , Facturable { // Implementaciones de los m\u00e9todos // Obligatoriamente deber\u00e1 implementar public function mostrarResumen, mostrarTodo y generarFactura } M\u00e9todos encadenados \u00b6 Sigue el planteamiento de la programaci\u00f3n funcional, y tambi\u00e9n se conoce como method chaining . Plantea que sobre un objeto se realizan varias llamadas. <?php $p1 = new Libro (); $p1 -> setNombre ( \"Harry Potter\" ); $p1 -> setAutor ( \"JK Rowling\" ); echo $p1 ; // Method chaining $p2 = new Libro (); $p2 -> setNombre ( \"Patria\" ) -> setAutor ( \"Aramburu\" ); echo $p2 ; Para facilitarlo, vamos a modificar todos sus m\u00e9todos mutadores (que modifican datos, setters , ...) para que devuelvan una referencia a $this : <?php class Libro { private string $nombre ; private string $autor ; public function getNombre () : string { return $this -> nombre ; } public function setNombre ( string $nombre ) : Libro { $this -> nombre = $nombre ; return $this ; } public function getAutor () : string { return $this -> autor ; } public function setAutor ( string $autor ) : Libro { $this -> autor = $autor ; return $this ; } public function __toString () : string { return $this -> nombre . \" de \" . $this -> autor ; } } M\u00e9todos m\u00e1gicos \u00b6 Todas las clases PHP ofrecen un conjunto de m\u00e9todos, tambi\u00e9n conocidos como magic methods que se pueden sobreescribir para sustituir su comportamiento. Algunos de ellos ya los hemos utilizado. Ante cualquier duda, es conveniente consultar la documentaci\u00f3n oficial . Los m\u00e1s destacables son: __construct() __destruct() \u2192 se invoca al perder la referencia. Se utiliza para cerrar una conexi\u00f3n a la BD, cerrar un fichero, ... __toString() \u2192 representaci\u00f3n del objeto como cadena. Es decir, cuando hacemos echo $objeto se ejecuta autom\u00e1ticamente este m\u00e9todo. __get(propiedad) , __set(propiedad, valor) \u2192 Permitir\u00eda acceder a las propiedad privadas, aunque siempre es m\u00e1s legible/mantenible codificar los getter/setter . __isset(propiedad) , __unset(propiedad) \u2192 Permite averiguar o quitar el valor a una propiedad. __sleep() , __wakeup() \u2192 Se ejecutan al recuperar ( unserialize^ ) o almacenar un objeto que se serializa ( serialize ), y se utilizan para permite definir qu\u00e9 propiedades se serializan. __call() , __callStatic() \u2192 Se ejecutan al llamar a un m\u00e9todo que no es p\u00fablico. Permiten sobrecargan m\u00e9todos. Espacio de nombres \u00b6 Desde PHP 5.3 y tambi\u00e9n conocidos como Namespaces , permiten organizar las clases/interfaces, funciones y/o constantes de forma similar a los paquetes en Java . Recomendaci\u00f3n Un s\u00f3lo namespace por archivo y crear una estructura de carpetas respectando los niveles/subniveles (igual que se hace en Java ) Se declaran en la primera l\u00ednea mediante la palabra clave namespace seguida del nombre del espacio de nombres asignado (cada subnivel se separa con la barra invertida \\ ): Por ejemplo, para colocar la clase Producto dentro del namespace Dwes\\Ejemplos lo har\u00edamos as\u00ed: <?php namespace Dwes\\Ejemplos ; const IVA = 0.21 ; class Producto { public $nombre ; public function muestra () : void { echo \"<p>Prod:\" . $this -> nombre . \"</p>\" ; } } Acceso \u00b6 Para referenciar a un recurso que contiene un namespace, primero hemos de tenerlo disponible haciendo uso de include o require . Si el recurso est\u00e1 en el mismo namespace , se realiza un acceso directo (se conoce como acceso sin cualificar). Realmente hay tres tipos de acceso: sin cualificar: recurso cualificado: rutaRelativa\\recurso \u2192 no hace falta poner el namespace completo totalmente cualificado: \\rutaAbsoluta\\recurso <?php namespace Dwes\\Ejemplos ; include_once ( \"Producto.php\" ); echo IVA ; // sin cualificar echo Utilidades\\IVA ; // acceso cualificado. Dar\u00eda error, no existe \\Dwes\\Ejemplos\\Utilidades\\IVA echo \\Dwes\\Ejemplos\\IVA ; // totalmente cualificado $p1 = new Producto (); // lo busca en el mismo namespace y encuentra \\Dwes\\Ejemplos\\Producto $p2 = new Model\\Producto (); // dar\u00eda error, no existe el namespace Model. Est\u00e1 buscando \\Dwes\\Ejemplos\\Model\\Producto $p3 = new \\Dwes\\Ejemplos\\Producto (); // \\Dwes\\Ejemplos\\Producto Para evitar la referencia cualificada podemos declarar el uso mediante use (similar a hacer import en Java ). Se hace en la cabecera, tras el namespace : Los tipos posibles son: use const nombreCualificadoConstante use function nombreCualificadoFuncion use nombreCualificadoClase use nombreCualificadoClase as NuevoNombre // para renombrar elementos Por ejemplo, si queremos utilizar la clase \\Dwes\\Ejemplos\\Producto desde un recurso que se encuentra en la ra\u00edz, por ejemplo en inicio.php , har\u00edamos: <?php include_once ( \"Dwes\\Ejemplo\\Producto.php\" ); use const Dwes\\Ejemplos\\IVA ; use \\Dwes\\Ejemplos\\Producto ; echo IVA ; $p1 = new Producto (); To use or not to use En resumen, use permite acceder sin cualificar a recursos que est\u00e1n en otro namespace . Si estamos en el mismo espacio de nombre, no necesitamos use . Organizaci\u00f3n \u00b6 Todo proyecto, conforme crece, necesita organizar su c\u00f3digo fuente. Se plantea una organizaci\u00f3n en la que los archivos que interactuan con el navegador se colocan en el ra\u00edz, y las clases que definamos van dentro de un namespace (y dentro de su propia carpeta src o app ). Organizaci\u00f3n del c\u00f3digo fuente Organizaci\u00f3n, includes y usos Colocaremos cada recurso en un fichero aparte. En la primera l\u00ednea indicaremos su namespace (si no est\u00e1 en el ra\u00edz). Si utilizamos otros recursos, haremos un include_once de esos recursos (clases, interfaces, etc...). Cada recurso debe incluir todos los otros recursos que referencie: la clase de la que hereda, interfaces que implementa, clases utilizadas/recibidas como par\u00e1metros, etc... Si los recursos est\u00e1n en un espacio de nombres diferente al que estamos, emplearemos use con la ruta completa para luego utilizar referencias sin cualificar. Autoload \u00b6 \u00bfNo es tedioso tener que hacer el include de las clases? El autoload viene al rescate. As\u00ed pues, permite cargar las clases (no las constantes ni las funciones) que se van a utilizar y evitar tener que hacer el include_once de cada una de ellas. Para ello, se utiliza la funci\u00f3n spl_autoload_register <?php spl_autoload_register ( function ( $nombreClase ) { include_once $nombreClase . '.php' ; } ); ?> \u00bfPor qu\u00e9 se llaman autoload ? Porque antes se realizaba mediante el m\u00e9todo m\u00e1gico __autoload() , el cual est\u00e1 deprecated desde PHP 7.2 Y \u00bfc\u00f3mo organizamos ahora nuestro c\u00f3digo aprovechando el autoload ? Organizaci\u00f3n con autoload Para facilitar la b\u00fasqueda de los recursos a incluir, es recomendable colocar todas las clases dentro de una misma carpeta. Nosotros la vamos a colocar dentro de app (m\u00e1s adelante, cuando estudiemos Laravel veremos el motivo de esta decisi\u00f3n). Otras carpetas que podemos crear son test para colocar las pruebas PhpUnit que luego realizaremos, o la carpeta vendor donde se almacenar\u00e1n las librer\u00edas del proyecto (esta carpeta es un est\u00e1ndard dentro de PHP, ya que Composer la crea autom\u00e1ticamente). Como hemos colocado todos nuestros recursos dentro de app , ahora nuestro autoload.php (el cual colocamos en la carpeta ra\u00edz) s\u00f3lo va a buscar dentro de esa carpeta: <?php spl_autoload_register ( function ( $nombreClase ) { include_once \"app/\" . $nombreClase . '.php' ; } ); ?> Autoload y rutas err\u00f3neas En Ubuntu al hacer el include de la clase que recibe como par\u00e1metro, las barras de los namespace ( \\ ) son diferentes a las de las rutas ( / ). Por ello, es mejor que utilicemos el fichero autoload: <?php spl_autoload_register ( function ( $nombreClase ) { $ruta = \"app \\\\ \" . $nombreClase . '.php' ; $ruta = str_replace ( \" \\\\ \" , \"/\" , $ruta ); // Sustituimos las barras include_once $ruta ' ; } ); ?> Gesti\u00f3n de Errores \u00b6 PHP clasifica los errores que ocurren en diferentes niveles. Cada nivel se identifica con una constante. Por ejemplo: E_ERROR : errores fatales, no recuperables. Se interrumpe el script. E_WARNING : advertencias en tiempo de ejecuci\u00f3n. El script no se interrumpe. E_NOTICE : avisos en tiempo de ejecuci\u00f3n. Pod\u00e9is comprobar el listado completo de constantes de https://www.php.net/manual/es/errorfunc.constants.php Para la configuraci\u00f3n de los errores podemos hacerlo de dos formas: A nivel de php.ini : error_reporting : indica los niveles de errores a notificar error_reporting = E_ALL & ~E_NOTICE -> Todos los errores menos los avisos en tiempo de ejecuci\u00f3n. display_errors : indica si mostrar o no los errores por pantalla. En entornos de producci\u00f3n es com\u00fan ponerlo a off mediante c\u00f3digo con las siguientes funciones: error_reporting(codigo) -> Controla qu\u00e9 errores notificar set_error_handler(nombreManejador) -> Indica que funci\u00f3n se invocar\u00e1 cada vez que se encuentre un error. El manejador recibe como par\u00e1metros el nivel del error y el mensaje A continuaci\u00f3n tenemos un ejemplo mediante c\u00f3digo: Funciones para la gesti\u00f3n de errores Consola <?php error_reporting ( E_ALL & ~ E_NOTICE & ~ E_WARNING ); $resultado = $dividendo / $divisor ; error_reporting ( E_ALL & ~ E_NOTICE ); set_error_handler ( \"miManejadorErrores\" ); $resultado = $dividendo / $divisor ; restore_error_handler (); // vuelve al anterior function miManejadorErrores ( $nivel , $mensaje ) { switch ( $nivel ) { case E_WARNING : echo \"<strong>Warning</strong>: $mensaje .<br/>\" ; break ; default : echo \"Error de tipo no especificado: $mensaje .<br/>\" ; } } Error de tipo no especificado: Undefined variable: dividendo. Error de tipo no especificado: Undefined variable: divisor. Error de tipo Warning: Division by zero. Excepciones \u00b6 La gesti\u00f3n de excepciones forma parte desde PHP 5. Su funcionamiento es similar a Java , haciendo uso de un bloque try / catch / finally . Si detectamos una situaci\u00f3n an\u00f3mala y queremos lanzar una excepci\u00f3n, deberemos realizar throw new Exception (adjuntando el mensaje que lo ha provocado). <?php try { if ( $divisor == 0 ) { throw new Exception ( \"Divisi\u00f3n por cero.\" ); } $resultado = $dividendo / $divisor ; } catch ( Exception $e ) { echo \"Se ha producido el siguiente error: \" . $e -> getMessage (); } La clase Exception es la clase padre de todas las excepciones. Su constructor recibe mensaje[,codigoError][,excepcionPrevia] . A partir de un objeto Exception , podemos acceder a los m\u00e9todos getMessage() y getCode() para obtener el mensaje y el c\u00f3digo de error de la excepci\u00f3n capturada. El propio lenguaje ofrece un conjunto de excepciones ya definidas, las cuales podemos capturar (y lanzar desde PHP 7). Se recomienda su consulta en la documentaci\u00f3n oficial . Creando excepciones \u00b6 Para crear una excepci\u00f3n, la forma m\u00e1s corta es crear una clase que \u00fanicamente herede de Exception . <?php class HolaExcepcion extends Exception {} Si queremos, y es recomendable dependiendo de los requisitos, podemos sobrecargar los m\u00e9todos m\u00e1gicos, por ejemplo, sobrecargando el constructor y llamando al constructor del padre, o rescribir el m\u00e9todo __toString para cambiar su mensaje: <?php class MiExcepcion extends Exception { public function __construct ( $msj , $codigo = 0 , Exception $previa = null ) { // c\u00f3digo propio parent :: __construct ( $msj , $codigo , $previa ); } public function __toString () { return __CLASS__ . \": [ { $this -> code } ]: { $this -> message } \\n \" ; } public function miFuncion () { echo \"Una funci\u00f3n personalizada para este tipo de excepci\u00f3n \\n \" ; } } Si definimos una excepci\u00f3n de aplicaci\u00f3n dentro de un namespace , cuando referenciemos a Exception , deberemos referenciarla mediante su nombre totalmente cualificado ( \\Exception ), o utilizando use : Mediante nombre totalmente cualificado Mediante use <?php namespace \\Dwes\\Ejemplos ; class AppExcepcion extends \\Exception {} <?php namespace \\Dwes\\Ejemplos ; use Exception ; class AppExcepcion extends Exception {} Excepciones m\u00faltiples \u00b6 Se pueden usar excepciones m\u00faltiples para comprobar diferentes condiciones. A la hora de capturarlas, se hace de m\u00e1s espec\u00edfica a m\u00e1s general. <?php $email = \"ejemplo@ejemplo.com\" ; try { // Comprueba si el email es v\u00e1lido if ( filter_var ( $email , FILTER_VALIDATE_EMAIL ) === FALSE ) { throw new MiExcepcion ( $email ); } // Comprueba la palabra ejemplo en la direcci\u00f3n email if ( strpos ( $email , \"ejemplo\" ) !== FALSE ) { throw new Exception ( \" $email es un email de ejemplo no v\u00e1lido\" ); } } catch ( MiExcepcion $e ) { echo $e -> miFuncion (); } catch ( Exception $e ) { echo $e -> getMessage (); } Autoevaluaci\u00f3n \u00bfQu\u00e9 pasar\u00eda al ejectuar el siguiente c\u00f3digo? <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException $e ) { echo \"Capturada MainException \" . $e -> getMessage (); } catch ( SubException $e ) { echo \"Capturada SubException \" . $e -> getMessage (); } catch ( Exception $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Si en el mismo catch queremos capturar varias excepciones, hemos de utilizar el operador | : <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException | SubException $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Desde PHP 7, existe el tipo Throwable , el cual es un interfaz que implementan tanto los errores como las excepciones, y nos permite capturar los dos tipos a la vez: <?php try { // tu codigo } catch ( Throwable $e ) { echo 'Forma de capturar errores y excepciones a la vez' ; } Si s\u00f3lo queremos capturar los errores fatales, podemos hacer uso de la clase Error : <?php try { // Genera una notificaci\u00f3n que no se captura echo $variableNoAsignada ; // Error fatal que se captura funcionQueNoExiste (); } catch ( Error $e ) { echo \"Error capturado: \" . $e -> getMessage (); } Relanzar excepciones \u00b6 En las aplicaciones reales, es muy com\u00fan capturar una excepci\u00f3n de sistema y lanzar una de aplicaci\u00f3n que hemos definido nostros. Tambi\u00e9n podemos lanzar las excepciones sin necesidad de estar dentro de un try/catch . <?php class AppException extends Exception {} try { // C\u00f3digo de negocio que falla } catch ( Exception $e ) { throw new AppException ( \"AppException: \" . $e -> getMessage (), $e -> getCode (), $e ); } SPL \u00b6 Standard PHP Library es el conjunto de funciones y utilidades que ofrece PHP, como: Estructuras de datos Pila, cola, cola de prioridad, lista doblemente enlazada, etc... Conjunto de iteradores dise\u00f1ados para recorrer estructuras agregadas arrays, resultados de bases de datos, \u00e1rboles XML, listados de directorios, etc. Pod\u00e9is consultar la documentaci\u00f3n en https://www.php.net/manual/es/book.spl.php o ver algunos ejemplos en https://diego.com.es/tutorial-de-la-libreria-spl-de-php Tambi\u00e9n define un conjunto de excepciones que podemos utilizar para que las lancen nuestras aplicaciones: LogicException ( extends Exception ) BadFunctionCallException BadMethodCallException DomainException InvalidArgumentException LengthException OutOfRangeException RuntimeException ( extends Exception ) OutOfBoundsException OverflowException RangeException UnderflowException UnexpectedValueException Tambi\u00e9n pod\u00e9is consultar la documentaci\u00f3n de estas excepciones en https://www.php.net/manual/es/spl.exceptions.php . Referencias \u00b6 Manual de PHP Manual de OO en PHP - www.desarrolloweb.com Actividades \u00b6 Investiga la diferencia entre un paradigma orientado a objetos basado en clases ( PHP ) respecto a uno basado en prototipos ( JavaScript ). Objetos \u00b6 301Empleado.php : Crea una clase Empleado con su nombre, apellidos y sueldo. Encapsula las propiedades mediante getters/setters y a\u00f1ade m\u00e9todos para: Obtener su nombre completo \u2192 getNombreCompleto(): string Que devuelva un booleano indicando si debe o no pagar impuestos (se pagan cuando el sueldo es superior a 3333\u20ac) \u2192 debePagarImpuestos(): bool 302EmpleadoTelefonos.php : Copia la clase del ejercicio anterior y modif\u00edcala. A\u00f1ade una propiedad privada que almacene un array de n\u00fameros de tel\u00e9fonos. A\u00f1ade los siguientes m\u00e9todos: public function anyadirTelefono(int $telefono) : void \u2192 A\u00f1ade un tel\u00e9fono al array public function listarTelefonos(): string \u2192 Muestra los tel\u00e9fonos separados por comas public function vaciarTelefonos(): void \u2192 Elimina todos los tel\u00e9fonos 303EmpleadoConstructor.php : Copia la clase del ejercicio anterior y modif\u00edcala. Elimina los setters de nombre y apellidos , de manera que dichos datos se asignan mediante el constructor (utiliza la sintaxis de PHP7). Si el constructor recibe un tercer par\u00e1metro, ser\u00e1 el sueldo del Empleado . Si no, se le asignar\u00e1 1000\u20ac como sueldo inicial. 303EmpleadoConstructor8.php : Modifica la clase y utiliza la sintaxis de PHP 8 de promoci\u00f3n de las propiedades del constructor. 304EmpleadoConstante.php : Copia la clase del ejercicio anterior y modif\u00edcala. A\u00f1ade una constante SUELDO_TOPE con el valor del sueldo que debe pagar impuestos, y modifica el c\u00f3digo para utilizar la constante. 305EmpleadoSueldo.php : Copia la clase del ejercicio anterior y modif\u00edcala. Cambia la constante por una variable est\u00e1tica sueldoTope , de manera que mediante getter/setter puedas modificar su valor. 306EmpleadoStatic.php : Copia la clase del ejercicio anterior y modif\u00edcala. Completa el siguiente m\u00e9todo con una cadena HTML que muestre los datos de un empleado dentro de un p\u00e1rrafo y todos los tel\u00e9fonos mediante una lista ordenada (para ello, deber\u00e1s crear un getter para los tel\u00e9fonos): public static function toHtml(Empleado $emp): string Ejercicio 307 307Persona.php : Copia la clase del ejercicio anterior en 307Empleado.php y modif\u00edcala. Crea una clase Persona que sea padre de Empleado , de manera que Persona contenga el nombre y los apellidos, y en Empleado quede el salario y los tel\u00e9fonos. 308PersonaH.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Crea en Persona el m\u00e9todo est\u00e1tico toHtml(Persona $p) , y modifica en Empleado el mismo m\u00e9todo toHtml(Persona $p) , pero cambia la firma para que reciba una Persona como par\u00e1metro. Para acceder a las propiedades del empleado con la persona que recibimos como par\u00e1metro, comprobaremos su tipo: <?php class Empleado extends Persona { /// resto del c\u00f3digo public static function toHtml ( Persona $p ) : string { if ( $p instanceof Empleado ) { // Aqui ya podemos acceder a las propiedades y m\u00e9todos de Empleado } } } 309PersonaE.php : Copia las clases del ejercicio anterior y modif\u00edcalas. A\u00f1ade en Persona un atributo edad A la hora de saber si un empleado debe pagar impuestos, lo har\u00e1 siempre y cuando tenga m\u00e1s de 21 a\u00f1os y dependa del valor de su sueldo. Modifica todo el c\u00f3digo necesario para mostrar y/o editar la edad cuando sea necesario. 310PersonaS.php : Copia las clases del ejercicio anterior y modif\u00edcalas. A\u00f1ade nuevos m\u00e9todos que hagan una representaci\u00f3n de todas las propiedades de las clases Persona y Empleado , de forma similar a los realizados en HTML, pero sin que sean est\u00e1ticos, de manera que obtenga los datos mediante $this . function public __toString(): string Magic methods El m\u00e9todo __toString() es un m\u00e9todo m\u00e1gico que se invoca autom\u00e1ticamente cuando queremos obtener la representaci\u00f3n en cadena de un objeto. 311PersonaA.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Transforma Persona a una clase abstracta donde su m\u00e9todo est\u00e1tico toHtml(Persona $p) tenga que ser redefinido en todos sus hijos. 312Trabajador.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Cambia la estructura de clases conforme al gr\u00e1fico respetando todos los m\u00e9todos que ya est\u00e1n hechos. Trabajador es una clase abstracta que ahora almacena los telefonos y donde calcularSueldo es un m\u00e9todo abstracto de manera que: El sueldo de un Empleado se calcula a partir de las horas trabajadas y lo que cobra por hora. Para los Gerente s, su sueldo se incrementa porcentualmente en base a su edad: salario + salario*edad/100 Ejercicio 312 313Empresa.php : Utilizando las clases de los ejercicios anteriores: Crea una clase Empresa que adem\u00e1s del nombre y la direcci\u00f3n, contenga una propiedad con un array de Trabajador es, ya sean Empleado s o Gerente s. A\u00f1ade getters/setters para el nombre y direcci\u00f3n. A\u00f1ade m\u00e9todos para a\u00f1adir y listar los trabajadores. public function anyadirTrabajador(Trabajador $t) public function listarTrabajadoresHtml() : string -> utiliza Trabajador::toHtml(Persona $p) A\u00f1ade un m\u00e9todo para obtener el coste total en n\u00f3minas. public function getCosteNominas(): float -> recorre los trabajadores e invoca al m\u00e9todo calcularSueldo() . 314EmpresaI.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Crea un interfaz JSerializable, de manera que ofrezca los m\u00e9todos: toJSON(): string \u2192 utiliza la funci\u00f3n json_encode(mixed) . Ten en cuenta que como tenemos las propiedades de los objetos privados, debes recorrer las propiedades y colocarlas en un mapa. Por ejemplo: <?php public function toJSON () : string { foreach ( $this as $clave => $valor ) { $mapa -> $clave = $valor ; } return json_encode ( $mapa ); } ?> toSerialize(): string \u2192 utiliza la funci\u00f3n serialize(mixed) Modifica todas las clases que no son abstractas para que implementen el interfaz creado. Proyecto Videoclub \u00b6 En los siguientes ejercicios vamos a simular un peque\u00f1o proyecto de un Videoclub (basado en la propuesta que hace el tutorial de desarrolloweb.com), el cual vamos a realizar mediante un desarrollo incremental y siguiendo la pr\u00e1ctica de programaci\u00f3n en parejas ( pair programming ). Antes de nada, crea un repositorio privado en GitHub y sube el proyecto actual de Videoclub . Una vez creado, invita a tu compa\u00f1ero al repositorio como colaborador. Inicializa en local tu repostorio de git, mediante git init A\u00f1ade y sube los cambios a tu repositorio, mediante git add . y luego git commit -m 'Inicializando proyecto'. Conecta tu repositorio con GitHub y sube los cambios (mira la instrucciones de GitHub: comandos git remote y git push ). Tu compa\u00f1ero deber\u00e1 descargar el proyecto con sus credenciales. Proyecto no real El siguiente proyecto est\u00e1 pensado desde un punto de vista formativo. Algunas de las decisiones que se toman no se deben usar (como hacer echo dentro de las clases) o probar el c\u00f3digo comparando el resultado en el navegador. Cada clase debe ir en un archivo php separado. Para facilitar su implementaci\u00f3n, se muestra la estructura UML del modelo y un fragmento de c\u00f3digo para probar las clases: Creamos el Soporte Crea una clase para almacenar soportes ( Soporte.php ). Esta clase ser\u00e1 la clase padre de los diferentes soportes con los que trabaje nuestro videoclub (cintas de v\u00eddeo, videojuegos, etc...): Crea el constructor que inicialice sus propiedades. F\u00edjate que la clase no tiene m\u00e9todos setters . Definir una constante mediante un propiedad privada y est\u00e1tica denominada `IVA con un valor del 21% Crear un archivo ( inicio.php ) para usar las clases y copia el siguiente fragmento: C\u00f3digo de prueba Navegador <?php include \"Soporte.php\" ; $soporte1 = new Soporte ( \"Tenet\" , 22 , 3 ); echo \"<strong>\" . $soporte1 -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $soporte1 -> getPrecio () . \" euros\" ; echo \"<br>Precio IVA incluido: \" . $soporte1 -> getPrecioConIVA () . \" euros\" ; $soporte1 -> muestraResumen (); Tenet Precio: 3 euros Precio IVA incluido: 3.48 euros Tenet 3 \u20ac (IVA no incluido) A\u00f1adimos Cinta de Video Crea la clase CintaVideo la cual hereda de Soporte . A\u00f1ade el atributo duracion y sobreescribe tanto el contructor como el m\u00e9todo muestraResumen (desde CintaVideo deber\u00e1s llamar al m\u00e9todo muestraResumen del padre). A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: C\u00f3digo de prueba Navegador <?php include \"CintaVideo.php\" ; $miCinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); echo \"<strong>\" . $miCinta -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miCinta -> getPrecio () . \" euros\" ; echo \"<br>Precio IVA incluido: \" . $miCinta -> getPrecioConIva () . \" euros\" ; $miCinta -> muestraResumen (); Los cazafantasmas Precio: 3.5 euros Precio IVA incluido: 4.06 euros Pel\u00edcula en VHS: Los cazafantasmas 3.5 \u20ac (IVA no incluido) Duraci\u00f3n: 107 minutos A\u00f1adimos Dvd Crea la clase Dvd la cual hereda de Soporte . A\u00f1ade los atributos idiomas y formatoPantalla . A continuaci\u00f3n sobreescribe tanto el contructor como el m\u00e9todo muestraResumen . A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: C\u00f3digo de prueba Navegador <?php include \"Dvd.php\" ; $miDvd = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); echo \"<strong>\" . $miDvd -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miDvd -> getPrecio () . \" euros\" ; echo \"<br>Precio IVA incluido: \" . $miDvd -> getPrecioConIva () . \" euros\" ; $miDvd -> muestraResumen (); Origen Precio: 15 euros Precio IVA incluido: 17.4 euros Pel\u00edcula en DVD: Origen 15 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 A\u00f1adimos Juego Crea la clase Juego la cual hereda de Soporte . A\u00f1ade los atributos consola , minNumJugadores y maxNumJugadores . A continuaci\u00f3n a\u00f1ade el m\u00e9todo muestraJugadoresPosibles , el cual debe mostrar Para un jugador , Para X jugadores o De X a Y jugadores dependiendo de los valores de las atributos creados. Finalmente, sobreescribe tanto el contructor como el m\u00e9todo muestraResumen . A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: C\u00f3digo de prueba Navegador <?php include \"Juego.php\" ; $miJuego = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); echo \"<strong>\" . $miJuego -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miJuego -> getPrecio () . \" euros\" ; echo \"<br>Precio IVA incluido: \" . $miJuego -> getPrecioConIva () . \" euros\" ; $miJuego -> muestraResumen (); The Last of Us Part II Precio: 49.99 euros Precio IVA incluido: 57.9884 euros Juego para: PS4 The Last of Us Part II 49.99 \u20ac (IVA no incluido) Para un jugador Llegados a este punto, nuestro modelo es similar al siguiente diagrama: Modelo inicial de Videoclub A\u00f1adimos Cliente Crear la clase Cliente . El constructor recibir\u00e1 el nombre , numero y maxAlquilerConcurrente , este \u00faltimo pudiendo ser opcional y tomando como valor por defecto 3. Tras ello, a\u00f1ade getter/setter \u00fanicamente a numero , y un getter a numSoportesAlquilados (este campo va a almacenar un contador del total de alquileres que ha realizado). El array de soportes alquilados contedr\u00e1 clases que hereden de Soporte . Finalmente, a\u00f1ade el m\u00e9todo muestraResumen que muestre el nombre y la cantidad de alquileres (tama\u00f1o del array soportesAlquilados ). Dentro de Cliente , a\u00f1ade las siguiente operaciones: tieneAlquilado(Soporte $s): bool \u2192 Recorre el array de soportes y comprueba si est\u00e1 el soporte alquilar(Soporte $s): bool -\u2192 Debe comprobar si el soporte est\u00e1 alquilado y si no ha superado el cupo de alquileres. Al alquilar, incrementar\u00e1 el numSoportesAlquilados y almacenar\u00e1 el soporte en el array. Para cada caso debe mostrar un mensaje informando de lo ocurrido. Seguimos con Cliente para a\u00f1adir las operaciones: devolver(int $numSoporte): bool \u2192 Debe comprobar que el soporte estaba alquilado y actualizar la cantidad de soportes alquilados. Para cada caso debe mostrar un mensaje informando de lo ocurrido listarAlquileres(): void \u2192 Informa de cuantos alquileres tiene el cliente y los muestra. Crea el archivo inicio2.php con el siguiente c\u00f3digo fuente para probar la clase: C\u00f3digo de prueba Navegador <?php include_once \"CintaVideo.php\" ; include_once \"Dvd.php\" ; include_once \"Juego.php\" ; include_once \"Cliente.php\" ; //instanciamos un par de objetos cliente $cliente1 = new Cliente ( \"Bruce Wayne\" , 23 ); $cliente2 = new Cliente ( \"Clark Kent\" , 33 ); //mostramos el n\u00famero de cada cliente creado echo \"<br>El identificador del cliente 1 es: \" . $cliente1 -> getNumero (); echo \"<br>El identificador del cliente 2 es: \" . $cliente2 -> getNumero (); //instancio algunos soportes $soporte1 = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $soporte2 = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); $soporte3 = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); $soporte4 = new Dvd ( \"El Imperio Contraataca\" , 4 , 3 , \"es,en\" , \"16:9\" ); //alquilo algunos soportes $cliente1 -> alquilar ( $soporte1 ); $cliente1 -> alquilar ( $soporte2 ); $cliente1 -> alquilar ( $soporte3 ); //voy a intentar alquilar de nuevo un soporte que ya tiene alquilado $cliente1 -> alquilar ( $soporte1 ); //el cliente tiene 3 soportes en alquiler como m\u00e1ximo //este soporte no lo va a poder alquilar $cliente1 -> alquilar ( $soporte4 ); //este soporte no lo tiene alquilado $cliente1 -> devolver ( 4 ); //devuelvo un soporte que s\u00ed que tiene alquilado $cliente1 -> devolver ( 2 ); //alquilo otro soporte $cliente1 -> alquilar ( $soporte4 ); //listo los elementos alquilados $cliente1 -> listaAlquileres (); //este cliente no tiene alquileres $cliente2 -> devolver ( 2 ); El identificador del cliente 1 es: 23 El identificador del cliente 2 es: 33 Alquilado soporte a : Bruce Wayne Pel\u00edcula en VHS: Los cazafantasmas 3.5 \u20ac (IVA no incluido) Duraci\u00f3n: 107 minutos Alquilado soporte a : Bruce Wayne Juego para: PS4 The Last of Us Part II 49.99 \u20ac (IVA no incluido) Para un jugador Alquilado soporte a : Bruce Wayne Pel\u00edcula en DVD: Origen 15 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 El cliente ya tiene alquilado el soporte Los cazafantasmas Este cliente tiene 3 elementos alquilados. No puede alquilar m\u00e1s en este videoclub hasta que no devuelva algo No se ha podido encontrar el soporte en los alquileres de este cliente No se ha podido encontrar el soporte en los alquileres de este cliente Este cliente tiene 3 elementos alquilados. No puede alquilar m\u00e1s en este videoclub hasta que no devuelva algo El cliente tiene 3 soportes alquilados Pel\u00edcula en VHS: Los cazafantasmas 3.5 \u20ac (IVA no incluido) Duraci\u00f3n: 107 minutos Juego para: PS4 The Last of Us Part II 49.99 \u20ac (IVA no incluido) Para un jugador Pel\u00edcula en DVD: Origen 15 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 Este cliente no tiene alquilado ning\u00fan elemento Llegado a este punto, vamos a relacionar los clientes y los soportes mediante la clase Videoclub . As\u00ed pues crea la clase que representa el gr\u00e1fico, teniendo en cuenta que: productos es un array de Soporte socios es una array de Cliente Los m\u00e9todos p\u00fablicos de incluir alg\u00fan soporte, crear\u00e1n la clase y llamar\u00e1n al m\u00e9todo privado de incluirProducto , el cual es el encargado de introducirlo dentro del array. El modelo completo quedar\u00e1 de la siguiente manera: Modelo completo de Videoclub Y para probar el proyecto, dentro inicio3.php colocaremos: C\u00f3digo de prueba Navegador <?php include_once \"Videoclub.php\" ; // No incluimos nada m\u00e1s $vc = new Videoclub ( \"Severo 8A\" ); //voy a incluir unos cuantos soportes de prueba $vc -> incluirJuego ( \"God of War\" , 19.99 , \"PS4\" , 1 , 1 ); $vc -> incluirJuego ( \"The Last of Us Part II\" , 49.99 , \"PS4\" , 1 , 1 ); $vc -> incluirDvd ( \"Torrente\" , 4.5 , \"es\" , \"16:9\" ); $vc -> incluirDvd ( \"Origen\" , 4.5 , \"es,en,fr\" , \"16:9\" ); $vc -> incluirDvd ( \"El Imperio Contraataca\" , 3 , \"es,en\" , \"16:9\" ); $vc -> incluirCintaVideo ( \"Los cazafantasmas\" , 3.5 , 107 ); $vc -> incluirCintaVideo ( \"El nombre de la Rosa\" , 1.5 , 140 ); //listo los productos $vc -> listarProductos (); //voy a crear algunos socios $vc -> incluirSocio ( \"Amancio Ortega\" ); $vc -> incluirSocio ( \"Pablo Picasso\" , 2 ); $vc -> alquilaSocioProducto ( 1 , 2 ); $vc -> alquilaSocioProducto ( 1 , 3 ); //alquilo otra vez el soporte 2 al socio 1. // no debe dejarme porque ya lo tiene alquilado $vc -> alquilaSocioProducto ( 1 , 2 ); //alquilo el soporte 6 al socio 1. //no se puede porque el socio 1 tiene 2 alquileres como m\u00e1ximo $vc -> alquilaSocioProducto ( 1 , 6 ); //listo los socios $vc -> listarSocios (); Incluido soporte 0 Incluido soporte 1 Incluido soporte 2 Incluido soporte 3 Incluido soporte 4 Incluido soporte 5 Incluido soporte 6 Listado de los 7 productos disponibles: 1.- Juego para: PS4 God of War 19.99 \u20ac (IVA no incluido) Para un jugador 2.- Juego para: PS4 The Last of Us Part II 49.99 \u20ac (IVA no incluido) Para un jugador 3.- Pel\u00edcula en DVD: Torrente 4.5 \u20ac (IVA no incluido) Idiomas:es Formato Pantalla:16:9 4.- Pel\u00edcula en DVD: Origen 4.5 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 5.- Pel\u00edcula en DVD: El Imperio Contraataca 3 \u20ac (IVA no incluido) Idiomas:es,en Formato Pantalla:16:9 6.- Pel\u00edcula en VHS: Los cazafantasmas 3.5 \u20ac (IVA no incluido) Duraci\u00f3n: 107 minutos 7.- Pel\u00edcula en VHS: El nombre de la Rosa 1.5 \u20ac (IVA no incluido) Duraci\u00f3n: 140 minutos Incluido socio 0 Incluido socio 1 Alquilado soporte a : Pablo Picasso Pel\u00edcula en DVD: Torrente 4.5 \u20ac (IVA no incluido) Idiomas:es Formato Pantalla:16:9 Alquilado soporte a : Pablo Picasso Pel\u00edcula en DVD: Origen 4.5 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 El cliente ya tiene alquilado el soporte Torrente Este cliente tiene 2 elementos alquilados. No puede alquilar m\u00e1s en este videoclub hasta que no devuelva algo Listado de 2 socios del videoclub: 1.- Cliente 0 : Amancio Ortega Alquileres actuales: 0 2.- Cliente 1 : Pablo Picasso Alquileres actuales: 2 Transforma Soporte a una clase abstracta y comprueba que todo sigue funcionando. \u00bfQu\u00e9 conseguimos al hacerla abstracta? Crea un interfaz Resumible , de manera que las clases que lo implementen deben ofrecer el m\u00e9todo muestraResumen() . Modifica la clase Soporte y haz que implemente el interfaz. \u00bfHace falta que tambi\u00e9n lo implementen los hijos? Proyecto Videoclub 2.0 \u00b6 Antes de comenzar con la segunda parte del videoclub, crea una etiqueta mediante git tag con el nombre v0.329 y sube los cambios a GitHub. Modifica las operaciones de alquilar, tanto en Cliente como en Videoclub , para dar soporte al encadenamiento de m\u00e9todos. Posteriormente, modifica el c\u00f3digo de prueba para utilizar esta t\u00e9cnica. Haciendo uso de namespaces : Coloca todas las clases/interfaces en Dwes\\ProyectoVideoclub Cada clase debe hacer include_once de los recursos que emplea Coloca el/los archivos de prueba en el ra\u00edz (sin espacio de nombres) Desde el archivo de pruebas, utiliza use para poder realizar accesos sin cualificar Etiqueta los cambios como v0.331 . Reorganiza las carpeta tal como hemos visto en los apuntes: app , test y vendor . Crea un fichero autoload.php para registrar la ruta donde encontrar las clases Modifica todo el c\u00f3digo necesario, incluyendo autoload.php donde sea necesario y borrando los includes previos. A continuaci\u00f3n vamos a crear un conjunto de excepciones de aplicaci\u00f3n. Estas excepciones son simples, no necesitan sobreescribir ning\u00fan m\u00e9todo. As\u00ed pues, crea la excepci\u00f3n de aplicaci\u00f3n VideoclubException en el namespace Dwes\\ProyectoVideoclub\\Util . Posteriormente crea los siguientes hijos (deben heredar de VideoclubException ), cada uno en su propio archivo: SoporteYaAlquiladoException CupoSuperadoException SoporteNoEncontradoException ClienteNoEncontradoException En Cliente , modifica los m\u00e9todos alquilar y devolver , para que hagan uso de las nuevas excepciones (lanz\u00e1ndolas cuando sea necesario) y funcionen como m\u00e9todos encadenados. Destacar que estos m\u00e9todos, no se capturar est\u00e1s excepciones, s\u00f3lo se lanzan. En Videoclub , modifica alquilarSocioPelicula para capturar todas las excepciones que ahora lanza Cliente e informar al usuario en consecuencia. Vamos a modificar el proyecto para que el videoclub sepa qu\u00e9 productos est\u00e1n o no alquilados: En Soporte , crea una propiedad p\u00fablica cuyo nombre sea alquilado que inicialmente estar\u00e1 a false . Cuando se alquile, se pondr\u00e1 a true . Al devolver, la volveremos a poner a false . En Videoclub , crea dos nuevas propiedades y sus getters: numProductosAlquilados numTotalAlquileres Crea un nuevo m\u00e9todo en Videoclub llamado alquilarSocioProductos(int numSocio, array numerosProductos) , el cual debe recibir un array con los productos a alquilar. Antes de alquilarlos, debe comprobar que todos los soportes est\u00e9n disponibles, de manera que si uno no lo est\u00e1, no se le alquile ninguno. Crea dos nuevos m\u00e9todos en Videoclub , y mediante la definici\u00f3n, deduce qu\u00e9 deben realizar: devolverSocioProducto(int numSocio, int numeroProducto) devolverSocioProductos(int numSocio, array numerosProductos) Deben soportar el encadenamiento de m\u00e9todos. Recuerda actualizar la propiedad alquilado de los diferentes soportes. Cuando hayas realizado todos los ejercicios, crea una etiqueta mediante git tag con el nombre v0.337 y sube los cambios a GitHub.","title":"3.- PHP Orientado a Objetos"},{"location":"03phpoo.html#php-orientado-a-objetos","text":"Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 18 sesiones Resultado de aprendizaje: Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. Criterios de evaluaci\u00f3n: Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. Se han aplicado los principios de la programaci\u00f3n orientada a objetos. Se ha probado y documentado el c\u00f3digo.","title":"PHP Orientado a Objetos"},{"location":"03phpoo.html#clases-y-objetos","text":"PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Un clase es un plantilla que define las propiedades y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase. Tanto las propiedades como los m\u00e9todos se definen con una visibilidad (quien puede acceder) Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : <?php class NombreClase { // propiedades // y m\u00e9todos } $ob = new NombreClase (); Clases con may\u00fascula Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de las propiedades y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a una propiedad o un m\u00e9todo: $objeto->propiedad; $objeto->m\u00e9todo(par\u00e1metros); Si desde dentro de la clase, queremos acceder a una propiedad o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; $this->propiedad; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: <?php class Persona { private string $nombre ; public function setNombre ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero contedr\u00e1 una sola clase, y se nombrar\u00e1 con el nombre de la clase.","title":"Clases y Objetos"},{"location":"03phpoo.html#encapsulacion","text":"Las propiedades se definen privadas o protegidas (si queremos que las clases heredadas puedan acceder). Para cada propiedad, se a\u00f1aden m\u00e9todos p\u00fablicos ( getter/setter ): public setPropiedad(tipo $param) public getPropiedad() : tipo Las constantes se definen p\u00fablicas para que sean accesibles por todos los recursos. <?php class MayorMenor { private int $mayor ; private int $menor ; public function setMayor ( int $may ) { $this -> mayor = $may ; } public function setMenor ( int $men ) { $this -> menor = $men ; } public function getMayor () : int { return $this -> mayor ; } public function getMenor () : int { return $this -> menor ; } }","title":"Encapsulaci\u00f3n"},{"location":"03phpoo.html#recibiendo-y-enviando-objetos","text":"Es recomendable indicarlo en el tipo de par\u00e1metros. Si el objeto puede devolver nulos se pone ? delante del nombre de la clase. Objetos por referencia Los objetos que se env\u00edan y reciben como par\u00e1metros siempre se pasan por referencia. <?php function maymen ( array $numeros ) : ? MayorMenor { $a = max ( $numeros ); $b = min ( $numeros ); $result = new MayorMenor (); $result -> setMayor ( $a ); $result -> setMenor ( $b ); return $result ; } $resultado = maymen ([ 1 , 76 , 9 , 388 , 41 , 39 , 25 , 97 , 22 ]); echo \"<br>Mayor: \" . $resultado -> getMayor (); echo \"<br>Menor: \" . $resultado -> getMenor ();","title":"Recibiendo y enviando objetos"},{"location":"03phpoo.html#constructor","text":"El constructor de los objetos se define mediante el m\u00e9todo m\u00e1gico __construct . Puede o no tener par\u00e1metros, pero s\u00f3lo puede haber un \u00fanico constructor. <?php class Persona { private string $nombre ; public function __construct ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona ( \"Bruno D\u00edaz\" ); $bruno -> imprimir ();","title":"Constructor"},{"location":"03phpoo.html#constructores-en-php-8","text":"Una de las grandes novedades que ofrece PHP 8 es la simplificaci\u00f3n de los constructores con par\u00e1metros, lo que se conoce como promoci\u00f3n de las propiedades del constructor . Para ello, en vez de tener que declarar las propiedades como privadas o protegidas, y luego dentro del constructor tener que asignar los par\u00e1metros a est\u00e1s propiedades, el propio constructor promociona las propiedades. Ve\u00e1moslo mejor con un ejemplo. Imaginemos una clase Punto donde queramos almacenar sus coordenadas: <?php class Punto { protected float $x ; protected float $y ; protected float $z ; public function __construct ( float $x = 0.0 , float $y = 0.0 , float $z = 0.0 ) { $this -> x = $x ; $this -> y = $y ; $this -> z = $z ; } } En PHP 8, quedar\u00eda del siguiente modo (mucho m\u00e1s corto, lo que facilita su legibilidad): <?php class Punto { public function __construct ( protected float $x = 0.0 , protected float $y = 0.0 , protected float $z = 0.0 , ) {} } El orden importa A la hora de codificar el orden de los elementos debe ser: <?php declare ( strict_types = 1 ); class NombreClase { // propiedades // constructor // getters - setters // resto de m\u00e9todos } ?>","title":"Constructores en PHP 8"},{"location":"03phpoo.html#clases-estaticas","text":"Son aquellas que tienen propiedades y/o m\u00e9todos est\u00e1ticos (tambi\u00e9n se conocen como de clase , por que su valor se comparte entre todas las instancias de la misma clase). Se declaran con static y se referencian con :: . Si queremos acceder a un m\u00e9todo est\u00e1tico, se antepone el nombre de la clase: Producto::nuevoProducto() . Si desde un m\u00e9todo queremos acceder a una propiedad est\u00e1tica de la misma clase, se utiliza la referencia self : self::$numProductos <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; public static function nuevoProducto () { self :: $numProductos ++ ; } } Producto :: nuevoProducto (); $impuesto = Producto :: IVA ; Tambi\u00e9n podemos tener clases normales que tengan alguna propiedad est\u00e1tica: <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; private $codigo ; public function __construct ( string $cod ) { self :: $numProductos ++ ; $this -> codigo = $cod ; } public function mostrarResumen () : string { return \"El producto \" . $this -> codigo . \" es el n\u00famero \" . self :: $numProductos ; } } $prod1 = new Producto ( \"PS5\" ); $prod2 = new Producto ( \"XBOX Series X\" ); $prod3 = new Producto ( \"Nintendo Switch\" ); echo $prod3 -> mostrarResumen ();","title":"Clases est\u00e1ticas"},{"location":"03phpoo.html#introspeccion","text":"Al trabajar con clases y objetos, existen un conjunto de funciones ya definidas por el lenguaje que permiten obtener informaci\u00f3n sobre los objetos: instanceof : permite comprobar si un objeto es de una determinada clase get_class : devuelve el nombre de la clase get_declared_class : devuelve un array con los nombres de las clases definidas class_alias : crea un alias class_exists / method_exists / property_exists : true si la clase / m\u00e9todo / propiedad est\u00e1 definida get_class_methods / get_class_vars / get_object_vars : Devuelve un array con los nombres de los m\u00e9todos / propiedades de una clase / propiedades de un objeto que son accesibles desde d\u00f3nde se hace la llamada. Un ejemplo de estas funciones puede ser el siguiente: <?php $p = new Producto ( \"PS5\" ); if ( $p instanceof Producto ) { echo \"Es un producto\" ; echo \"La clase es \" . get_class ( $p ); class_alias ( \"Producto\" , \"Articulo\" ); $c = new Articulo ( \"Nintendo Switch\" ); echo \"Un articulo es un \" . get_class ( $c ); print_r ( get_class_methods ( \"Producto\" )); print_r ( get_class_vars ( \"Producto\" )); print_r ( get_object_vars ( $p )); if ( method_exists ( $p , \"mostrarResumen\" )) { $p -> mostrarResumen (); } } Clonado Al asignar dos objetos no se copian, se crea una nueva referencia. Si queremos una copia, hay que clonarlo mediante el m\u00e9todo clone(object) : object Si queremos modificar el clonado por defecto, hay que definir el m\u00e9todo m\u00e1gico __clone() que se llamar\u00e1 despu\u00e9s de copiar todas las propiedades. M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.oop5.cloning.php","title":"Introspecci\u00f3n"},{"location":"03phpoo.html#herencia","text":"PHP soporta herencia simple, de manera que una clase solo puede heredar de otra, no de dos clases a la vez. Para ello se utiliza la palabra clave extends . Si queremos que la clase A hereda de la clase B haremos: class A extends B El hijo hereda los atributos y m\u00e9todos p\u00fablicos y protegidos. Cada clase en un archivo Como ya hemos comentado, deber\u00edamos colocar cada clase en un archivo diferente para posteriormente utilizarlo mediante include . En los siguiente ejemplo los hemos colocado junto para facilitar su legibilidad. Por ejemplo, tenemos una clase Producto y una Tv que hereda de Producto : <?php class Producto { public $codigo ; public $nombre ; public $nombreCorto ; public $PVP ; public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; } Podemos utilizar las siguientes funciones para averiguar si hay relaci\u00f3n entre dos clases: get_parent_class(object): string is_subclass_of(object, string): bool <?php $t = new Tv (); $t -> codigo = 33 ; if ( $t instanceof Producto ) { echo $t -> mostrarResumen (); } $padre = get_parent_class ( $t ); echo \"<br>La clase padre es: \" . $padre ; $objetoPadre = new $padre ; echo $objetoPadre -> mostrarResumen (); if ( is_subclass_of ( $t , 'Producto' )) { echo \"<br>Soy un hijo de Producto\" ; }","title":"Herencia"},{"location":"03phpoo.html#sobreescribir-metodos","text":"Podemos crear m\u00e9todos en los hijos con el mismo nombre que el padre, cambiando su comportamiento. Para invocar a los m\u00e9todos del padre -> parent::nombreMetodo() <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } }","title":"Sobreescribir m\u00e9todos"},{"location":"03phpoo.html#constructor-en-hijos","text":"En los hijos no se crea ning\u00fan constructor de manera autom\u00e1tica. Por lo que si no lo hay, se invoca autom\u00e1ticamente al del padre. En cambio, si lo definimos en el hijo, hemos de invocar al del padre de manera expl\u00edcita. PHP7 PHP8 <?php class Producto { public string $codigo ; public function __construct ( string $codigo ) { $this -> codigo = $codigo ; } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function __construct ( string $codigo , int $pulgadas , string $tecnologia ) { parent :: __construct ( $codigo ); $this -> pulgadas = $pulgadas ; $this -> tecnologia = $tecnologia ; } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } <?php class Producto { public function __construct ( private string $codigo ) { } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public function __construct ( string $codigo , private int $pulgadas , private string $tecnologia ) { parent :: __construct ( $codigo ); } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } }","title":"Constructor en hijos"},{"location":"03phpoo.html#clases-abstractas","text":"Las clases abstractas obligan a heredar de una clase, ya que no se permite su instanciaci\u00f3n. Se define mediante abstract class NombreClase { . Una clase abstracta puede contener propiedades y m\u00e9todos no-abstractos, y/o m\u00e9todos abstractos. <?php // Clase abstracta abstract class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } // M\u00e9todo abstracto abstract public function mostrarResumen (); } Cuando una clase hereda de una clase abstracta, obligatoriamente debe implementar los m\u00e9todos que tiene el padre marcados como abstractos. <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { //obligado a implementarlo echo \"<p>C\u00f3digo \" . $this -> getCodigo () . \"</p>\" ; echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } $t = new Tv (); echo $t -> getCodigo ();","title":"Clases abstractas"},{"location":"03phpoo.html#clases-finales","text":"Son clases opuestas a abstractas, ya que evitan que se pueda heredar una clase o m\u00e9todo para sobreescribirlo. <?php class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } final public function mostrarResumen () : string { return \"Producto \" . $this -> codigo ; } } // No podremos heredar de Microondas final class Microondas extends Producto { private $potencia ; public function getPotencia () : int { return $this -> potencia ; } // No podemos implementar mostrarResumen() }","title":"Clases finales"},{"location":"03phpoo.html#interfaces","text":"Permite definir un contrato con las firmas de los m\u00e9todos a cumplir. As\u00ed pues, s\u00f3lo contiene declaraciones de funciones y todas deben ser p\u00fablicas. Se declaran con la palabra clave interface y luego las clases que cumplan el contrato lo realizan mediante la palabra clave implements . <?php interface Nombreable { // declaraci\u00f3n de funciones } class NombreClase implements NombreInterfaz { // c\u00f3digo de la clase Se permite la herencia de interfaces. Adem\u00e1s, una clase puede implementar varios interfaces (en este caso, s\u00ed soporta la herecia m\u00faltiple, pero s\u00f3lo de interfaces). <?php interface Mostrable { public function mostrarResumen () : string ; } interface MostrableTodo extends Mostrable { public function mostrarTodo () : string ; } interface Facturable { public function generarFactura () : string ; } class Producto implements MostrableTodo , Facturable { // Implementaciones de los m\u00e9todos // Obligatoriamente deber\u00e1 implementar public function mostrarResumen, mostrarTodo y generarFactura }","title":"Interfaces"},{"location":"03phpoo.html#metodos-encadenados","text":"Sigue el planteamiento de la programaci\u00f3n funcional, y tambi\u00e9n se conoce como method chaining . Plantea que sobre un objeto se realizan varias llamadas. <?php $p1 = new Libro (); $p1 -> setNombre ( \"Harry Potter\" ); $p1 -> setAutor ( \"JK Rowling\" ); echo $p1 ; // Method chaining $p2 = new Libro (); $p2 -> setNombre ( \"Patria\" ) -> setAutor ( \"Aramburu\" ); echo $p2 ; Para facilitarlo, vamos a modificar todos sus m\u00e9todos mutadores (que modifican datos, setters , ...) para que devuelvan una referencia a $this : <?php class Libro { private string $nombre ; private string $autor ; public function getNombre () : string { return $this -> nombre ; } public function setNombre ( string $nombre ) : Libro { $this -> nombre = $nombre ; return $this ; } public function getAutor () : string { return $this -> autor ; } public function setAutor ( string $autor ) : Libro { $this -> autor = $autor ; return $this ; } public function __toString () : string { return $this -> nombre . \" de \" . $this -> autor ; } }","title":"M\u00e9todos encadenados"},{"location":"03phpoo.html#metodos-magicos","text":"Todas las clases PHP ofrecen un conjunto de m\u00e9todos, tambi\u00e9n conocidos como magic methods que se pueden sobreescribir para sustituir su comportamiento. Algunos de ellos ya los hemos utilizado. Ante cualquier duda, es conveniente consultar la documentaci\u00f3n oficial . Los m\u00e1s destacables son: __construct() __destruct() \u2192 se invoca al perder la referencia. Se utiliza para cerrar una conexi\u00f3n a la BD, cerrar un fichero, ... __toString() \u2192 representaci\u00f3n del objeto como cadena. Es decir, cuando hacemos echo $objeto se ejecuta autom\u00e1ticamente este m\u00e9todo. __get(propiedad) , __set(propiedad, valor) \u2192 Permitir\u00eda acceder a las propiedad privadas, aunque siempre es m\u00e1s legible/mantenible codificar los getter/setter . __isset(propiedad) , __unset(propiedad) \u2192 Permite averiguar o quitar el valor a una propiedad. __sleep() , __wakeup() \u2192 Se ejecutan al recuperar ( unserialize^ ) o almacenar un objeto que se serializa ( serialize ), y se utilizan para permite definir qu\u00e9 propiedades se serializan. __call() , __callStatic() \u2192 Se ejecutan al llamar a un m\u00e9todo que no es p\u00fablico. Permiten sobrecargan m\u00e9todos.","title":"M\u00e9todos m\u00e1gicos"},{"location":"03phpoo.html#espacio-de-nombres","text":"Desde PHP 5.3 y tambi\u00e9n conocidos como Namespaces , permiten organizar las clases/interfaces, funciones y/o constantes de forma similar a los paquetes en Java . Recomendaci\u00f3n Un s\u00f3lo namespace por archivo y crear una estructura de carpetas respectando los niveles/subniveles (igual que se hace en Java ) Se declaran en la primera l\u00ednea mediante la palabra clave namespace seguida del nombre del espacio de nombres asignado (cada subnivel se separa con la barra invertida \\ ): Por ejemplo, para colocar la clase Producto dentro del namespace Dwes\\Ejemplos lo har\u00edamos as\u00ed: <?php namespace Dwes\\Ejemplos ; const IVA = 0.21 ; class Producto { public $nombre ; public function muestra () : void { echo \"<p>Prod:\" . $this -> nombre . \"</p>\" ; } }","title":"Espacio de nombres"},{"location":"03phpoo.html#acceso","text":"Para referenciar a un recurso que contiene un namespace, primero hemos de tenerlo disponible haciendo uso de include o require . Si el recurso est\u00e1 en el mismo namespace , se realiza un acceso directo (se conoce como acceso sin cualificar). Realmente hay tres tipos de acceso: sin cualificar: recurso cualificado: rutaRelativa\\recurso \u2192 no hace falta poner el namespace completo totalmente cualificado: \\rutaAbsoluta\\recurso <?php namespace Dwes\\Ejemplos ; include_once ( \"Producto.php\" ); echo IVA ; // sin cualificar echo Utilidades\\IVA ; // acceso cualificado. Dar\u00eda error, no existe \\Dwes\\Ejemplos\\Utilidades\\IVA echo \\Dwes\\Ejemplos\\IVA ; // totalmente cualificado $p1 = new Producto (); // lo busca en el mismo namespace y encuentra \\Dwes\\Ejemplos\\Producto $p2 = new Model\\Producto (); // dar\u00eda error, no existe el namespace Model. Est\u00e1 buscando \\Dwes\\Ejemplos\\Model\\Producto $p3 = new \\Dwes\\Ejemplos\\Producto (); // \\Dwes\\Ejemplos\\Producto Para evitar la referencia cualificada podemos declarar el uso mediante use (similar a hacer import en Java ). Se hace en la cabecera, tras el namespace : Los tipos posibles son: use const nombreCualificadoConstante use function nombreCualificadoFuncion use nombreCualificadoClase use nombreCualificadoClase as NuevoNombre // para renombrar elementos Por ejemplo, si queremos utilizar la clase \\Dwes\\Ejemplos\\Producto desde un recurso que se encuentra en la ra\u00edz, por ejemplo en inicio.php , har\u00edamos: <?php include_once ( \"Dwes\\Ejemplo\\Producto.php\" ); use const Dwes\\Ejemplos\\IVA ; use \\Dwes\\Ejemplos\\Producto ; echo IVA ; $p1 = new Producto (); To use or not to use En resumen, use permite acceder sin cualificar a recursos que est\u00e1n en otro namespace . Si estamos en el mismo espacio de nombre, no necesitamos use .","title":"Acceso"},{"location":"03phpoo.html#organizacion","text":"Todo proyecto, conforme crece, necesita organizar su c\u00f3digo fuente. Se plantea una organizaci\u00f3n en la que los archivos que interactuan con el navegador se colocan en el ra\u00edz, y las clases que definamos van dentro de un namespace (y dentro de su propia carpeta src o app ). Organizaci\u00f3n del c\u00f3digo fuente Organizaci\u00f3n, includes y usos Colocaremos cada recurso en un fichero aparte. En la primera l\u00ednea indicaremos su namespace (si no est\u00e1 en el ra\u00edz). Si utilizamos otros recursos, haremos un include_once de esos recursos (clases, interfaces, etc...). Cada recurso debe incluir todos los otros recursos que referencie: la clase de la que hereda, interfaces que implementa, clases utilizadas/recibidas como par\u00e1metros, etc... Si los recursos est\u00e1n en un espacio de nombres diferente al que estamos, emplearemos use con la ruta completa para luego utilizar referencias sin cualificar.","title":"Organizaci\u00f3n"},{"location":"03phpoo.html#autoload","text":"\u00bfNo es tedioso tener que hacer el include de las clases? El autoload viene al rescate. As\u00ed pues, permite cargar las clases (no las constantes ni las funciones) que se van a utilizar y evitar tener que hacer el include_once de cada una de ellas. Para ello, se utiliza la funci\u00f3n spl_autoload_register <?php spl_autoload_register ( function ( $nombreClase ) { include_once $nombreClase . '.php' ; } ); ?> \u00bfPor qu\u00e9 se llaman autoload ? Porque antes se realizaba mediante el m\u00e9todo m\u00e1gico __autoload() , el cual est\u00e1 deprecated desde PHP 7.2 Y \u00bfc\u00f3mo organizamos ahora nuestro c\u00f3digo aprovechando el autoload ? Organizaci\u00f3n con autoload Para facilitar la b\u00fasqueda de los recursos a incluir, es recomendable colocar todas las clases dentro de una misma carpeta. Nosotros la vamos a colocar dentro de app (m\u00e1s adelante, cuando estudiemos Laravel veremos el motivo de esta decisi\u00f3n). Otras carpetas que podemos crear son test para colocar las pruebas PhpUnit que luego realizaremos, o la carpeta vendor donde se almacenar\u00e1n las librer\u00edas del proyecto (esta carpeta es un est\u00e1ndard dentro de PHP, ya que Composer la crea autom\u00e1ticamente). Como hemos colocado todos nuestros recursos dentro de app , ahora nuestro autoload.php (el cual colocamos en la carpeta ra\u00edz) s\u00f3lo va a buscar dentro de esa carpeta: <?php spl_autoload_register ( function ( $nombreClase ) { include_once \"app/\" . $nombreClase . '.php' ; } ); ?> Autoload y rutas err\u00f3neas En Ubuntu al hacer el include de la clase que recibe como par\u00e1metro, las barras de los namespace ( \\ ) son diferentes a las de las rutas ( / ). Por ello, es mejor que utilicemos el fichero autoload: <?php spl_autoload_register ( function ( $nombreClase ) { $ruta = \"app \\\\ \" . $nombreClase . '.php' ; $ruta = str_replace ( \" \\\\ \" , \"/\" , $ruta ); // Sustituimos las barras include_once $ruta ' ; } ); ?>","title":"Autoload"},{"location":"03phpoo.html#gestion-de-errores","text":"PHP clasifica los errores que ocurren en diferentes niveles. Cada nivel se identifica con una constante. Por ejemplo: E_ERROR : errores fatales, no recuperables. Se interrumpe el script. E_WARNING : advertencias en tiempo de ejecuci\u00f3n. El script no se interrumpe. E_NOTICE : avisos en tiempo de ejecuci\u00f3n. Pod\u00e9is comprobar el listado completo de constantes de https://www.php.net/manual/es/errorfunc.constants.php Para la configuraci\u00f3n de los errores podemos hacerlo de dos formas: A nivel de php.ini : error_reporting : indica los niveles de errores a notificar error_reporting = E_ALL & ~E_NOTICE -> Todos los errores menos los avisos en tiempo de ejecuci\u00f3n. display_errors : indica si mostrar o no los errores por pantalla. En entornos de producci\u00f3n es com\u00fan ponerlo a off mediante c\u00f3digo con las siguientes funciones: error_reporting(codigo) -> Controla qu\u00e9 errores notificar set_error_handler(nombreManejador) -> Indica que funci\u00f3n se invocar\u00e1 cada vez que se encuentre un error. El manejador recibe como par\u00e1metros el nivel del error y el mensaje A continuaci\u00f3n tenemos un ejemplo mediante c\u00f3digo: Funciones para la gesti\u00f3n de errores Consola <?php error_reporting ( E_ALL & ~ E_NOTICE & ~ E_WARNING ); $resultado = $dividendo / $divisor ; error_reporting ( E_ALL & ~ E_NOTICE ); set_error_handler ( \"miManejadorErrores\" ); $resultado = $dividendo / $divisor ; restore_error_handler (); // vuelve al anterior function miManejadorErrores ( $nivel , $mensaje ) { switch ( $nivel ) { case E_WARNING : echo \"<strong>Warning</strong>: $mensaje .<br/>\" ; break ; default : echo \"Error de tipo no especificado: $mensaje .<br/>\" ; } } Error de tipo no especificado: Undefined variable: dividendo. Error de tipo no especificado: Undefined variable: divisor. Error de tipo Warning: Division by zero.","title":"Gesti\u00f3n de Errores"},{"location":"03phpoo.html#excepciones","text":"La gesti\u00f3n de excepciones forma parte desde PHP 5. Su funcionamiento es similar a Java , haciendo uso de un bloque try / catch / finally . Si detectamos una situaci\u00f3n an\u00f3mala y queremos lanzar una excepci\u00f3n, deberemos realizar throw new Exception (adjuntando el mensaje que lo ha provocado). <?php try { if ( $divisor == 0 ) { throw new Exception ( \"Divisi\u00f3n por cero.\" ); } $resultado = $dividendo / $divisor ; } catch ( Exception $e ) { echo \"Se ha producido el siguiente error: \" . $e -> getMessage (); } La clase Exception es la clase padre de todas las excepciones. Su constructor recibe mensaje[,codigoError][,excepcionPrevia] . A partir de un objeto Exception , podemos acceder a los m\u00e9todos getMessage() y getCode() para obtener el mensaje y el c\u00f3digo de error de la excepci\u00f3n capturada. El propio lenguaje ofrece un conjunto de excepciones ya definidas, las cuales podemos capturar (y lanzar desde PHP 7). Se recomienda su consulta en la documentaci\u00f3n oficial .","title":"Excepciones"},{"location":"03phpoo.html#creando-excepciones","text":"Para crear una excepci\u00f3n, la forma m\u00e1s corta es crear una clase que \u00fanicamente herede de Exception . <?php class HolaExcepcion extends Exception {} Si queremos, y es recomendable dependiendo de los requisitos, podemos sobrecargar los m\u00e9todos m\u00e1gicos, por ejemplo, sobrecargando el constructor y llamando al constructor del padre, o rescribir el m\u00e9todo __toString para cambiar su mensaje: <?php class MiExcepcion extends Exception { public function __construct ( $msj , $codigo = 0 , Exception $previa = null ) { // c\u00f3digo propio parent :: __construct ( $msj , $codigo , $previa ); } public function __toString () { return __CLASS__ . \": [ { $this -> code } ]: { $this -> message } \\n \" ; } public function miFuncion () { echo \"Una funci\u00f3n personalizada para este tipo de excepci\u00f3n \\n \" ; } } Si definimos una excepci\u00f3n de aplicaci\u00f3n dentro de un namespace , cuando referenciemos a Exception , deberemos referenciarla mediante su nombre totalmente cualificado ( \\Exception ), o utilizando use : Mediante nombre totalmente cualificado Mediante use <?php namespace \\Dwes\\Ejemplos ; class AppExcepcion extends \\Exception {} <?php namespace \\Dwes\\Ejemplos ; use Exception ; class AppExcepcion extends Exception {}","title":"Creando excepciones"},{"location":"03phpoo.html#excepciones-multiples","text":"Se pueden usar excepciones m\u00faltiples para comprobar diferentes condiciones. A la hora de capturarlas, se hace de m\u00e1s espec\u00edfica a m\u00e1s general. <?php $email = \"ejemplo@ejemplo.com\" ; try { // Comprueba si el email es v\u00e1lido if ( filter_var ( $email , FILTER_VALIDATE_EMAIL ) === FALSE ) { throw new MiExcepcion ( $email ); } // Comprueba la palabra ejemplo en la direcci\u00f3n email if ( strpos ( $email , \"ejemplo\" ) !== FALSE ) { throw new Exception ( \" $email es un email de ejemplo no v\u00e1lido\" ); } } catch ( MiExcepcion $e ) { echo $e -> miFuncion (); } catch ( Exception $e ) { echo $e -> getMessage (); } Autoevaluaci\u00f3n \u00bfQu\u00e9 pasar\u00eda al ejectuar el siguiente c\u00f3digo? <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException $e ) { echo \"Capturada MainException \" . $e -> getMessage (); } catch ( SubException $e ) { echo \"Capturada SubException \" . $e -> getMessage (); } catch ( Exception $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Si en el mismo catch queremos capturar varias excepciones, hemos de utilizar el operador | : <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException | SubException $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Desde PHP 7, existe el tipo Throwable , el cual es un interfaz que implementan tanto los errores como las excepciones, y nos permite capturar los dos tipos a la vez: <?php try { // tu codigo } catch ( Throwable $e ) { echo 'Forma de capturar errores y excepciones a la vez' ; } Si s\u00f3lo queremos capturar los errores fatales, podemos hacer uso de la clase Error : <?php try { // Genera una notificaci\u00f3n que no se captura echo $variableNoAsignada ; // Error fatal que se captura funcionQueNoExiste (); } catch ( Error $e ) { echo \"Error capturado: \" . $e -> getMessage (); }","title":"Excepciones m\u00faltiples"},{"location":"03phpoo.html#relanzar-excepciones","text":"En las aplicaciones reales, es muy com\u00fan capturar una excepci\u00f3n de sistema y lanzar una de aplicaci\u00f3n que hemos definido nostros. Tambi\u00e9n podemos lanzar las excepciones sin necesidad de estar dentro de un try/catch . <?php class AppException extends Exception {} try { // C\u00f3digo de negocio que falla } catch ( Exception $e ) { throw new AppException ( \"AppException: \" . $e -> getMessage (), $e -> getCode (), $e ); }","title":"Relanzar excepciones"},{"location":"03phpoo.html#spl","text":"Standard PHP Library es el conjunto de funciones y utilidades que ofrece PHP, como: Estructuras de datos Pila, cola, cola de prioridad, lista doblemente enlazada, etc... Conjunto de iteradores dise\u00f1ados para recorrer estructuras agregadas arrays, resultados de bases de datos, \u00e1rboles XML, listados de directorios, etc. Pod\u00e9is consultar la documentaci\u00f3n en https://www.php.net/manual/es/book.spl.php o ver algunos ejemplos en https://diego.com.es/tutorial-de-la-libreria-spl-de-php Tambi\u00e9n define un conjunto de excepciones que podemos utilizar para que las lancen nuestras aplicaciones: LogicException ( extends Exception ) BadFunctionCallException BadMethodCallException DomainException InvalidArgumentException LengthException OutOfRangeException RuntimeException ( extends Exception ) OutOfBoundsException OverflowException RangeException UnderflowException UnexpectedValueException Tambi\u00e9n pod\u00e9is consultar la documentaci\u00f3n de estas excepciones en https://www.php.net/manual/es/spl.exceptions.php .","title":"SPL"},{"location":"03phpoo.html#referencias","text":"Manual de PHP Manual de OO en PHP - www.desarrolloweb.com","title":"Referencias"},{"location":"03phpoo.html#actividades","text":"Investiga la diferencia entre un paradigma orientado a objetos basado en clases ( PHP ) respecto a uno basado en prototipos ( JavaScript ).","title":"Actividades"},{"location":"03phpoo.html#objetos","text":"301Empleado.php : Crea una clase Empleado con su nombre, apellidos y sueldo. Encapsula las propiedades mediante getters/setters y a\u00f1ade m\u00e9todos para: Obtener su nombre completo \u2192 getNombreCompleto(): string Que devuelva un booleano indicando si debe o no pagar impuestos (se pagan cuando el sueldo es superior a 3333\u20ac) \u2192 debePagarImpuestos(): bool 302EmpleadoTelefonos.php : Copia la clase del ejercicio anterior y modif\u00edcala. A\u00f1ade una propiedad privada que almacene un array de n\u00fameros de tel\u00e9fonos. A\u00f1ade los siguientes m\u00e9todos: public function anyadirTelefono(int $telefono) : void \u2192 A\u00f1ade un tel\u00e9fono al array public function listarTelefonos(): string \u2192 Muestra los tel\u00e9fonos separados por comas public function vaciarTelefonos(): void \u2192 Elimina todos los tel\u00e9fonos 303EmpleadoConstructor.php : Copia la clase del ejercicio anterior y modif\u00edcala. Elimina los setters de nombre y apellidos , de manera que dichos datos se asignan mediante el constructor (utiliza la sintaxis de PHP7). Si el constructor recibe un tercer par\u00e1metro, ser\u00e1 el sueldo del Empleado . Si no, se le asignar\u00e1 1000\u20ac como sueldo inicial. 303EmpleadoConstructor8.php : Modifica la clase y utiliza la sintaxis de PHP 8 de promoci\u00f3n de las propiedades del constructor. 304EmpleadoConstante.php : Copia la clase del ejercicio anterior y modif\u00edcala. A\u00f1ade una constante SUELDO_TOPE con el valor del sueldo que debe pagar impuestos, y modifica el c\u00f3digo para utilizar la constante. 305EmpleadoSueldo.php : Copia la clase del ejercicio anterior y modif\u00edcala. Cambia la constante por una variable est\u00e1tica sueldoTope , de manera que mediante getter/setter puedas modificar su valor. 306EmpleadoStatic.php : Copia la clase del ejercicio anterior y modif\u00edcala. Completa el siguiente m\u00e9todo con una cadena HTML que muestre los datos de un empleado dentro de un p\u00e1rrafo y todos los tel\u00e9fonos mediante una lista ordenada (para ello, deber\u00e1s crear un getter para los tel\u00e9fonos): public static function toHtml(Empleado $emp): string Ejercicio 307 307Persona.php : Copia la clase del ejercicio anterior en 307Empleado.php y modif\u00edcala. Crea una clase Persona que sea padre de Empleado , de manera que Persona contenga el nombre y los apellidos, y en Empleado quede el salario y los tel\u00e9fonos. 308PersonaH.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Crea en Persona el m\u00e9todo est\u00e1tico toHtml(Persona $p) , y modifica en Empleado el mismo m\u00e9todo toHtml(Persona $p) , pero cambia la firma para que reciba una Persona como par\u00e1metro. Para acceder a las propiedades del empleado con la persona que recibimos como par\u00e1metro, comprobaremos su tipo: <?php class Empleado extends Persona { /// resto del c\u00f3digo public static function toHtml ( Persona $p ) : string { if ( $p instanceof Empleado ) { // Aqui ya podemos acceder a las propiedades y m\u00e9todos de Empleado } } } 309PersonaE.php : Copia las clases del ejercicio anterior y modif\u00edcalas. A\u00f1ade en Persona un atributo edad A la hora de saber si un empleado debe pagar impuestos, lo har\u00e1 siempre y cuando tenga m\u00e1s de 21 a\u00f1os y dependa del valor de su sueldo. Modifica todo el c\u00f3digo necesario para mostrar y/o editar la edad cuando sea necesario. 310PersonaS.php : Copia las clases del ejercicio anterior y modif\u00edcalas. A\u00f1ade nuevos m\u00e9todos que hagan una representaci\u00f3n de todas las propiedades de las clases Persona y Empleado , de forma similar a los realizados en HTML, pero sin que sean est\u00e1ticos, de manera que obtenga los datos mediante $this . function public __toString(): string Magic methods El m\u00e9todo __toString() es un m\u00e9todo m\u00e1gico que se invoca autom\u00e1ticamente cuando queremos obtener la representaci\u00f3n en cadena de un objeto. 311PersonaA.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Transforma Persona a una clase abstracta donde su m\u00e9todo est\u00e1tico toHtml(Persona $p) tenga que ser redefinido en todos sus hijos. 312Trabajador.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Cambia la estructura de clases conforme al gr\u00e1fico respetando todos los m\u00e9todos que ya est\u00e1n hechos. Trabajador es una clase abstracta que ahora almacena los telefonos y donde calcularSueldo es un m\u00e9todo abstracto de manera que: El sueldo de un Empleado se calcula a partir de las horas trabajadas y lo que cobra por hora. Para los Gerente s, su sueldo se incrementa porcentualmente en base a su edad: salario + salario*edad/100 Ejercicio 312 313Empresa.php : Utilizando las clases de los ejercicios anteriores: Crea una clase Empresa que adem\u00e1s del nombre y la direcci\u00f3n, contenga una propiedad con un array de Trabajador es, ya sean Empleado s o Gerente s. A\u00f1ade getters/setters para el nombre y direcci\u00f3n. A\u00f1ade m\u00e9todos para a\u00f1adir y listar los trabajadores. public function anyadirTrabajador(Trabajador $t) public function listarTrabajadoresHtml() : string -> utiliza Trabajador::toHtml(Persona $p) A\u00f1ade un m\u00e9todo para obtener el coste total en n\u00f3minas. public function getCosteNominas(): float -> recorre los trabajadores e invoca al m\u00e9todo calcularSueldo() . 314EmpresaI.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Crea un interfaz JSerializable, de manera que ofrezca los m\u00e9todos: toJSON(): string \u2192 utiliza la funci\u00f3n json_encode(mixed) . Ten en cuenta que como tenemos las propiedades de los objetos privados, debes recorrer las propiedades y colocarlas en un mapa. Por ejemplo: <?php public function toJSON () : string { foreach ( $this as $clave => $valor ) { $mapa -> $clave = $valor ; } return json_encode ( $mapa ); } ?> toSerialize(): string \u2192 utiliza la funci\u00f3n serialize(mixed) Modifica todas las clases que no son abstractas para que implementen el interfaz creado.","title":"Objetos"},{"location":"03phpoo.html#proyecto-videoclub","text":"En los siguientes ejercicios vamos a simular un peque\u00f1o proyecto de un Videoclub (basado en la propuesta que hace el tutorial de desarrolloweb.com), el cual vamos a realizar mediante un desarrollo incremental y siguiendo la pr\u00e1ctica de programaci\u00f3n en parejas ( pair programming ). Antes de nada, crea un repositorio privado en GitHub y sube el proyecto actual de Videoclub . Una vez creado, invita a tu compa\u00f1ero al repositorio como colaborador. Inicializa en local tu repostorio de git, mediante git init A\u00f1ade y sube los cambios a tu repositorio, mediante git add . y luego git commit -m 'Inicializando proyecto'. Conecta tu repositorio con GitHub y sube los cambios (mira la instrucciones de GitHub: comandos git remote y git push ). Tu compa\u00f1ero deber\u00e1 descargar el proyecto con sus credenciales. Proyecto no real El siguiente proyecto est\u00e1 pensado desde un punto de vista formativo. Algunas de las decisiones que se toman no se deben usar (como hacer echo dentro de las clases) o probar el c\u00f3digo comparando el resultado en el navegador. Cada clase debe ir en un archivo php separado. Para facilitar su implementaci\u00f3n, se muestra la estructura UML del modelo y un fragmento de c\u00f3digo para probar las clases: Creamos el Soporte Crea una clase para almacenar soportes ( Soporte.php ). Esta clase ser\u00e1 la clase padre de los diferentes soportes con los que trabaje nuestro videoclub (cintas de v\u00eddeo, videojuegos, etc...): Crea el constructor que inicialice sus propiedades. F\u00edjate que la clase no tiene m\u00e9todos setters . Definir una constante mediante un propiedad privada y est\u00e1tica denominada `IVA con un valor del 21% Crear un archivo ( inicio.php ) para usar las clases y copia el siguiente fragmento: C\u00f3digo de prueba Navegador <?php include \"Soporte.php\" ; $soporte1 = new Soporte ( \"Tenet\" , 22 , 3 ); echo \"<strong>\" . $soporte1 -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $soporte1 -> getPrecio () . \" euros\" ; echo \"<br>Precio IVA incluido: \" . $soporte1 -> getPrecioConIVA () . \" euros\" ; $soporte1 -> muestraResumen (); Tenet Precio: 3 euros Precio IVA incluido: 3.48 euros Tenet 3 \u20ac (IVA no incluido) A\u00f1adimos Cinta de Video Crea la clase CintaVideo la cual hereda de Soporte . A\u00f1ade el atributo duracion y sobreescribe tanto el contructor como el m\u00e9todo muestraResumen (desde CintaVideo deber\u00e1s llamar al m\u00e9todo muestraResumen del padre). A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: C\u00f3digo de prueba Navegador <?php include \"CintaVideo.php\" ; $miCinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); echo \"<strong>\" . $miCinta -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miCinta -> getPrecio () . \" euros\" ; echo \"<br>Precio IVA incluido: \" . $miCinta -> getPrecioConIva () . \" euros\" ; $miCinta -> muestraResumen (); Los cazafantasmas Precio: 3.5 euros Precio IVA incluido: 4.06 euros Pel\u00edcula en VHS: Los cazafantasmas 3.5 \u20ac (IVA no incluido) Duraci\u00f3n: 107 minutos A\u00f1adimos Dvd Crea la clase Dvd la cual hereda de Soporte . A\u00f1ade los atributos idiomas y formatoPantalla . A continuaci\u00f3n sobreescribe tanto el contructor como el m\u00e9todo muestraResumen . A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: C\u00f3digo de prueba Navegador <?php include \"Dvd.php\" ; $miDvd = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); echo \"<strong>\" . $miDvd -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miDvd -> getPrecio () . \" euros\" ; echo \"<br>Precio IVA incluido: \" . $miDvd -> getPrecioConIva () . \" euros\" ; $miDvd -> muestraResumen (); Origen Precio: 15 euros Precio IVA incluido: 17.4 euros Pel\u00edcula en DVD: Origen 15 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 A\u00f1adimos Juego Crea la clase Juego la cual hereda de Soporte . A\u00f1ade los atributos consola , minNumJugadores y maxNumJugadores . A continuaci\u00f3n a\u00f1ade el m\u00e9todo muestraJugadoresPosibles , el cual debe mostrar Para un jugador , Para X jugadores o De X a Y jugadores dependiendo de los valores de las atributos creados. Finalmente, sobreescribe tanto el contructor como el m\u00e9todo muestraResumen . A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: C\u00f3digo de prueba Navegador <?php include \"Juego.php\" ; $miJuego = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); echo \"<strong>\" . $miJuego -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miJuego -> getPrecio () . \" euros\" ; echo \"<br>Precio IVA incluido: \" . $miJuego -> getPrecioConIva () . \" euros\" ; $miJuego -> muestraResumen (); The Last of Us Part II Precio: 49.99 euros Precio IVA incluido: 57.9884 euros Juego para: PS4 The Last of Us Part II 49.99 \u20ac (IVA no incluido) Para un jugador Llegados a este punto, nuestro modelo es similar al siguiente diagrama: Modelo inicial de Videoclub A\u00f1adimos Cliente Crear la clase Cliente . El constructor recibir\u00e1 el nombre , numero y maxAlquilerConcurrente , este \u00faltimo pudiendo ser opcional y tomando como valor por defecto 3. Tras ello, a\u00f1ade getter/setter \u00fanicamente a numero , y un getter a numSoportesAlquilados (este campo va a almacenar un contador del total de alquileres que ha realizado). El array de soportes alquilados contedr\u00e1 clases que hereden de Soporte . Finalmente, a\u00f1ade el m\u00e9todo muestraResumen que muestre el nombre y la cantidad de alquileres (tama\u00f1o del array soportesAlquilados ). Dentro de Cliente , a\u00f1ade las siguiente operaciones: tieneAlquilado(Soporte $s): bool \u2192 Recorre el array de soportes y comprueba si est\u00e1 el soporte alquilar(Soporte $s): bool -\u2192 Debe comprobar si el soporte est\u00e1 alquilado y si no ha superado el cupo de alquileres. Al alquilar, incrementar\u00e1 el numSoportesAlquilados y almacenar\u00e1 el soporte en el array. Para cada caso debe mostrar un mensaje informando de lo ocurrido. Seguimos con Cliente para a\u00f1adir las operaciones: devolver(int $numSoporte): bool \u2192 Debe comprobar que el soporte estaba alquilado y actualizar la cantidad de soportes alquilados. Para cada caso debe mostrar un mensaje informando de lo ocurrido listarAlquileres(): void \u2192 Informa de cuantos alquileres tiene el cliente y los muestra. Crea el archivo inicio2.php con el siguiente c\u00f3digo fuente para probar la clase: C\u00f3digo de prueba Navegador <?php include_once \"CintaVideo.php\" ; include_once \"Dvd.php\" ; include_once \"Juego.php\" ; include_once \"Cliente.php\" ; //instanciamos un par de objetos cliente $cliente1 = new Cliente ( \"Bruce Wayne\" , 23 ); $cliente2 = new Cliente ( \"Clark Kent\" , 33 ); //mostramos el n\u00famero de cada cliente creado echo \"<br>El identificador del cliente 1 es: \" . $cliente1 -> getNumero (); echo \"<br>El identificador del cliente 2 es: \" . $cliente2 -> getNumero (); //instancio algunos soportes $soporte1 = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $soporte2 = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); $soporte3 = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); $soporte4 = new Dvd ( \"El Imperio Contraataca\" , 4 , 3 , \"es,en\" , \"16:9\" ); //alquilo algunos soportes $cliente1 -> alquilar ( $soporte1 ); $cliente1 -> alquilar ( $soporte2 ); $cliente1 -> alquilar ( $soporte3 ); //voy a intentar alquilar de nuevo un soporte que ya tiene alquilado $cliente1 -> alquilar ( $soporte1 ); //el cliente tiene 3 soportes en alquiler como m\u00e1ximo //este soporte no lo va a poder alquilar $cliente1 -> alquilar ( $soporte4 ); //este soporte no lo tiene alquilado $cliente1 -> devolver ( 4 ); //devuelvo un soporte que s\u00ed que tiene alquilado $cliente1 -> devolver ( 2 ); //alquilo otro soporte $cliente1 -> alquilar ( $soporte4 ); //listo los elementos alquilados $cliente1 -> listaAlquileres (); //este cliente no tiene alquileres $cliente2 -> devolver ( 2 ); El identificador del cliente 1 es: 23 El identificador del cliente 2 es: 33 Alquilado soporte a : Bruce Wayne Pel\u00edcula en VHS: Los cazafantasmas 3.5 \u20ac (IVA no incluido) Duraci\u00f3n: 107 minutos Alquilado soporte a : Bruce Wayne Juego para: PS4 The Last of Us Part II 49.99 \u20ac (IVA no incluido) Para un jugador Alquilado soporte a : Bruce Wayne Pel\u00edcula en DVD: Origen 15 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 El cliente ya tiene alquilado el soporte Los cazafantasmas Este cliente tiene 3 elementos alquilados. No puede alquilar m\u00e1s en este videoclub hasta que no devuelva algo No se ha podido encontrar el soporte en los alquileres de este cliente No se ha podido encontrar el soporte en los alquileres de este cliente Este cliente tiene 3 elementos alquilados. No puede alquilar m\u00e1s en este videoclub hasta que no devuelva algo El cliente tiene 3 soportes alquilados Pel\u00edcula en VHS: Los cazafantasmas 3.5 \u20ac (IVA no incluido) Duraci\u00f3n: 107 minutos Juego para: PS4 The Last of Us Part II 49.99 \u20ac (IVA no incluido) Para un jugador Pel\u00edcula en DVD: Origen 15 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 Este cliente no tiene alquilado ning\u00fan elemento Llegado a este punto, vamos a relacionar los clientes y los soportes mediante la clase Videoclub . As\u00ed pues crea la clase que representa el gr\u00e1fico, teniendo en cuenta que: productos es un array de Soporte socios es una array de Cliente Los m\u00e9todos p\u00fablicos de incluir alg\u00fan soporte, crear\u00e1n la clase y llamar\u00e1n al m\u00e9todo privado de incluirProducto , el cual es el encargado de introducirlo dentro del array. El modelo completo quedar\u00e1 de la siguiente manera: Modelo completo de Videoclub Y para probar el proyecto, dentro inicio3.php colocaremos: C\u00f3digo de prueba Navegador <?php include_once \"Videoclub.php\" ; // No incluimos nada m\u00e1s $vc = new Videoclub ( \"Severo 8A\" ); //voy a incluir unos cuantos soportes de prueba $vc -> incluirJuego ( \"God of War\" , 19.99 , \"PS4\" , 1 , 1 ); $vc -> incluirJuego ( \"The Last of Us Part II\" , 49.99 , \"PS4\" , 1 , 1 ); $vc -> incluirDvd ( \"Torrente\" , 4.5 , \"es\" , \"16:9\" ); $vc -> incluirDvd ( \"Origen\" , 4.5 , \"es,en,fr\" , \"16:9\" ); $vc -> incluirDvd ( \"El Imperio Contraataca\" , 3 , \"es,en\" , \"16:9\" ); $vc -> incluirCintaVideo ( \"Los cazafantasmas\" , 3.5 , 107 ); $vc -> incluirCintaVideo ( \"El nombre de la Rosa\" , 1.5 , 140 ); //listo los productos $vc -> listarProductos (); //voy a crear algunos socios $vc -> incluirSocio ( \"Amancio Ortega\" ); $vc -> incluirSocio ( \"Pablo Picasso\" , 2 ); $vc -> alquilaSocioProducto ( 1 , 2 ); $vc -> alquilaSocioProducto ( 1 , 3 ); //alquilo otra vez el soporte 2 al socio 1. // no debe dejarme porque ya lo tiene alquilado $vc -> alquilaSocioProducto ( 1 , 2 ); //alquilo el soporte 6 al socio 1. //no se puede porque el socio 1 tiene 2 alquileres como m\u00e1ximo $vc -> alquilaSocioProducto ( 1 , 6 ); //listo los socios $vc -> listarSocios (); Incluido soporte 0 Incluido soporte 1 Incluido soporte 2 Incluido soporte 3 Incluido soporte 4 Incluido soporte 5 Incluido soporte 6 Listado de los 7 productos disponibles: 1.- Juego para: PS4 God of War 19.99 \u20ac (IVA no incluido) Para un jugador 2.- Juego para: PS4 The Last of Us Part II 49.99 \u20ac (IVA no incluido) Para un jugador 3.- Pel\u00edcula en DVD: Torrente 4.5 \u20ac (IVA no incluido) Idiomas:es Formato Pantalla:16:9 4.- Pel\u00edcula en DVD: Origen 4.5 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 5.- Pel\u00edcula en DVD: El Imperio Contraataca 3 \u20ac (IVA no incluido) Idiomas:es,en Formato Pantalla:16:9 6.- Pel\u00edcula en VHS: Los cazafantasmas 3.5 \u20ac (IVA no incluido) Duraci\u00f3n: 107 minutos 7.- Pel\u00edcula en VHS: El nombre de la Rosa 1.5 \u20ac (IVA no incluido) Duraci\u00f3n: 140 minutos Incluido socio 0 Incluido socio 1 Alquilado soporte a : Pablo Picasso Pel\u00edcula en DVD: Torrente 4.5 \u20ac (IVA no incluido) Idiomas:es Formato Pantalla:16:9 Alquilado soporte a : Pablo Picasso Pel\u00edcula en DVD: Origen 4.5 \u20ac (IVA no incluido) Idiomas:es,en,fr Formato Pantalla:16:9 El cliente ya tiene alquilado el soporte Torrente Este cliente tiene 2 elementos alquilados. No puede alquilar m\u00e1s en este videoclub hasta que no devuelva algo Listado de 2 socios del videoclub: 1.- Cliente 0 : Amancio Ortega Alquileres actuales: 0 2.- Cliente 1 : Pablo Picasso Alquileres actuales: 2 Transforma Soporte a una clase abstracta y comprueba que todo sigue funcionando. \u00bfQu\u00e9 conseguimos al hacerla abstracta? Crea un interfaz Resumible , de manera que las clases que lo implementen deben ofrecer el m\u00e9todo muestraResumen() . Modifica la clase Soporte y haz que implemente el interfaz. \u00bfHace falta que tambi\u00e9n lo implementen los hijos?","title":"Proyecto Videoclub"},{"location":"03phpoo.html#proyecto-videoclub-20","text":"Antes de comenzar con la segunda parte del videoclub, crea una etiqueta mediante git tag con el nombre v0.329 y sube los cambios a GitHub. Modifica las operaciones de alquilar, tanto en Cliente como en Videoclub , para dar soporte al encadenamiento de m\u00e9todos. Posteriormente, modifica el c\u00f3digo de prueba para utilizar esta t\u00e9cnica. Haciendo uso de namespaces : Coloca todas las clases/interfaces en Dwes\\ProyectoVideoclub Cada clase debe hacer include_once de los recursos que emplea Coloca el/los archivos de prueba en el ra\u00edz (sin espacio de nombres) Desde el archivo de pruebas, utiliza use para poder realizar accesos sin cualificar Etiqueta los cambios como v0.331 . Reorganiza las carpeta tal como hemos visto en los apuntes: app , test y vendor . Crea un fichero autoload.php para registrar la ruta donde encontrar las clases Modifica todo el c\u00f3digo necesario, incluyendo autoload.php donde sea necesario y borrando los includes previos. A continuaci\u00f3n vamos a crear un conjunto de excepciones de aplicaci\u00f3n. Estas excepciones son simples, no necesitan sobreescribir ning\u00fan m\u00e9todo. As\u00ed pues, crea la excepci\u00f3n de aplicaci\u00f3n VideoclubException en el namespace Dwes\\ProyectoVideoclub\\Util . Posteriormente crea los siguientes hijos (deben heredar de VideoclubException ), cada uno en su propio archivo: SoporteYaAlquiladoException CupoSuperadoException SoporteNoEncontradoException ClienteNoEncontradoException En Cliente , modifica los m\u00e9todos alquilar y devolver , para que hagan uso de las nuevas excepciones (lanz\u00e1ndolas cuando sea necesario) y funcionen como m\u00e9todos encadenados. Destacar que estos m\u00e9todos, no se capturar est\u00e1s excepciones, s\u00f3lo se lanzan. En Videoclub , modifica alquilarSocioPelicula para capturar todas las excepciones que ahora lanza Cliente e informar al usuario en consecuencia. Vamos a modificar el proyecto para que el videoclub sepa qu\u00e9 productos est\u00e1n o no alquilados: En Soporte , crea una propiedad p\u00fablica cuyo nombre sea alquilado que inicialmente estar\u00e1 a false . Cuando se alquile, se pondr\u00e1 a true . Al devolver, la volveremos a poner a false . En Videoclub , crea dos nuevas propiedades y sus getters: numProductosAlquilados numTotalAlquileres Crea un nuevo m\u00e9todo en Videoclub llamado alquilarSocioProductos(int numSocio, array numerosProductos) , el cual debe recibir un array con los productos a alquilar. Antes de alquilarlos, debe comprobar que todos los soportes est\u00e9n disponibles, de manera que si uno no lo est\u00e1, no se le alquile ninguno. Crea dos nuevos m\u00e9todos en Videoclub , y mediante la definici\u00f3n, deduce qu\u00e9 deben realizar: devolverSocioProducto(int numSocio, int numeroProducto) devolverSocioProductos(int numSocio, array numerosProductos) Deben soportar el encadenamiento de m\u00e9todos. Recuerda actualizar la propiedad alquilado de los diferentes soportes. Cuando hayas realizado todos los ejercicios, crea una etiqueta mediante git tag con el nombre v0.337 y sube los cambios a GitHub.","title":"Proyecto Videoclub 2.0"},{"location":"04web.html","text":"Programaci\u00f3n Web \u00b6 Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 12 sesiones Resultado de aprendizaje Criterios de evaluaci\u00f3n 4. Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. a) Se han identificado los mecanismos disponibles para el mantenimiento de la informaci\u00f3n que concierne a un cliente web concreto y se han se\u00f1alado sus ventajas. b) Se han utilizado sesiones para mantener el estado de las aplicaciones Web. c) Se han utilizado cookies para almacenar informaci\u00f3n en el cliente Web y para recuperar su contenido. d) Se han identificado y caracterizado los mecanismos disponibles para la autentificaci\u00f3n de usuarios. e) Se han escrito aplicaciones que integren mecanismos de autentificaci\u00f3n de usuarios. f) Se han realizado adaptaciones a aplicaciones Web existentes como gestores de contenidos u otras. g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo. Variables de servidor \u00b6 PHP almacena la informaci\u00f3n del servidor y de las peticiones HTTP en seis arrays globales: $_ENV : informaci\u00f3n sobre las variables de entorno $_GET : par\u00e1metros enviados en la petici\u00f3n GET $_POST : par\u00e1metros enviados en el envio POST $_COOKIE : contiene las cookies de la petici\u00f3n, las claves del array son los nombres de las cookies $_SERVER : informaci\u00f3n sobre el servidor $_FILES : informaci\u00f3n sobre los ficheros cargados via upload Si nos centramos en el array $_SERVER podemos consultar las siguientes propiedades: PHP_SELF : nombre del script ejecutado, relativo al document root (p.ej: /tienda/carrito.php ) SERVER_SOFTWARE : (p.ej: Apache) SERVER_NAME : dominio, alias DNS (p.ej: www.elche.es ) REQUEST_METHOD : GET REQUEST_URI : URI, sin el dominio QUERY_STRING : todo lo que va despu\u00e9s de ? en la URL (p.ej: heroe=Batman&nombre=Bruce ) M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/reserved.variables.server.php <?php echo $_SERVER [ \"PHP_SELF\" ] . \"<br>\" ; // /u4/401server.php echo $_SERVER [ \"SERVER_SOFTWARE\" ] . \"<br>\" ; // Apache/2.4.46 (Win64) OpenSSL/1.1.1g PHP/7.4.9 echo $_SERVER [ \"SERVER_NAME\" ] . \"<br>\" ; // localhost echo $_SERVER [ \"REQUEST_METHOD\" ] . \"<br>\" ; // GET echo $_SERVER [ \"REQUEST_URI\" ] . \"<br>\" ; // /u4/401server.php?heroe=Batman echo $_SERVER [ \"QUERY_STRING\" ] . \"<br>\" ; // heroe=Batman Otras propiedades relacionadas: PATH_INFO : ruta extra tras la petici\u00f3n. Si la URL es http://www.php.com/php/pathInfo.php/algo/cosa?foo=bar , entonces $_SERVER['PATH_INFO'] ser\u00e1 /algo/cosa . REMOTE_HOST : hostname que hizo la petici\u00f3n REMOTE_ADDR : IP del cliente AUTH_TYPE : tipo de autenticaci\u00f3n (p.ej: Basic) REMOTE_USER : nombre del usuario autenticado Apache crea una clave para cada cabecera HTTP, en may\u00fasculas y sustituyendo los guiones por subrayados: HTTP_USER_AGENT : agente (navegador) HTTP_REFERER : p\u00e1gina desde la que se hizo la petici\u00f3n <?php echo $_SERVER [ \"HTTP_USER_AGENT\" ] . \"<br>\" ; // Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 Formularios \u00b6 A la hora de enviar un formulario, debemos tener claro cuando usar GET o POST GET: los par\u00e1metros se pasan en la URL <2048 caracteres, s\u00f3lo ASCII Permite almacenar la direcci\u00f3n completa (marcador / historial) Idempotente: dos llamadas con los mismos datos siempre debe dar el mismo resultado El navegador puede cachear las llamadas POST: par\u00e1metros ocultos (no encriptados) Sin l\u00edmite de datos, permite datos binarios. No se pueden cachear No idempotente \u2192 actualizar la BBDD As\u00ed pues, para recoger los datos accederemos al array dependiendo del m\u00e9todo del formulario que nos ha invocado: <?php $par = $_GET [ \"parametro\" ] $par = $_POST [ \"parametro\" ] Para los siguientes apartados nos vamos a basar en el siguiente ejemplo: < form action = \"formulario.php\" method = \"GET\" > < p >< label for = \"nombre\" > Nombre del alumno: </ label > < input type = \"text\" name = \"nombre\" id = \"nombre\" value = \"\" /> </ p > < p >< input type = \"checkbox\" name = \"modulos[]\" id = \"modulosDWES\" value = \"DWES\" /> < label for = \"modulosDWES\" > Desarrollo web en entorno servidor </ label > </ p > < p >< input type = \"checkbox\" name = \"modulos[]\" id = \"modulosDWEC\" value = \"DWEC\" /> < label for = \"modulosDWEC\" > Desarrollo web en entorno cliente </ label > </ p > < input type = \"submit\" value = \"Enviar\" name = \"enviar\" /> </ form > Validaci\u00f3n \u00b6 Respecto a la validaci\u00f3n, es conveniente siempre hacer validaci\u00f3n doble : En el cliente mediante JS En servidor, antes de llamar a negocio, es conveniente volver a validar los datos. <?php if ( isset ( $_GET [ \"parametro\" ])) { $par = $_GET [ \"parametro\" ]; // comprobar si $par tiene el formato adecuado, su valor, etc... } Librer\u00edas de validaci\u00f3n Existen diversas librer\u00edas que facilitan la validaci\u00f3n de los formularios, como son respect/validation o particle/validator . Cuando estudiemos Laravel profundizaremos en la validaci\u00f3n de forma declarativa. Par\u00e1metro multivalor \u00b6 Existen elementos HTML que env\u00edan varios valores: select multiple checkbox Para recoger los datos, el nombre del elemento debe ser un array. < select name = \"lenguajes[]\" multiple = \"true\" > < option value = \"c\" > C </ option > < option value = \"java\" > Java </ option > < option value = \"php\" > PHP </ option > < option value = \"python\" > Python </ option > </ select > < input type = \"checkbox\" name = \"lenguajes[]\" value = \"c\" /> C < br /> < input type = \"checkbox\" name = \"lenguajes[]\" value = \"java\" /> Java < br /> < input type = \"checkbox\" name = \"lenguajes[]\" value = \"php\" /> Php < br /> < input type = \"checkbox\" name = \"lenguajes[]\" value = \"python\" /> Python < br /> De manera que luego al recoger los datos: <?php $lenguajes = $_GET [ \"lenguajes\" ]; foreach ( $lenguajes as $lenguaje ) { echo \" $lenguaje <br />\" ; } Volviendo a rellenar un formulario \u00b6 Un sticky form es un formulario que recuerda sus valores. Para ello, hemos de rellenar los atributos value de los elementos HTML con la informaci\u00f3n que conten\u00edan: <?php if ( ! empty ( $_POST [ 'modulos' ]) && ! empty ( $_POST [ 'nombre' ])) { // Aqu\u00ed se incluye el c\u00f3digo a ejecutar cuando los datos son correctos } else { // Generamos el formulario $nombre = $_POST [ 'nombre' ] ?? \"\" ; $modulos = $_POST [ 'modulos' ] ?? []; ?> < form action = \" <?php echo $_SERVER [ 'PHP_SELF' ]; ?> \" method = \"POST\" > < p >< label for = \"nombre\" > Nombre del alumno: </ label > < input type = \"text\" name = \"nombre\" id = \"nombre\" value = \" <? = $nombre ?> \" /> </ p > < p >< input type = \"checkbox\" name = \"modulos[]\" id = \"modulosDWES\" value = \"DWES\" <?php if ( in_array ( \"DWES\" , $modulos )) echo 'checked=\"checked\"' ; ?> /> < label for = \"modulosDWES\" > Desarrollo web en entorno servidor </ label > </ p > < p >< input type = \"checkbox\" name = \"modulos[]\" id = \"modulosDWEC\" value = \"DWEC\" <?php if ( in_array ( \"DWEC\" , $modulos )) echo 'checked=\"checked\"' ; ?> /> < label for = \"modulosDWEC\" > Desarrollo web en entorno cliente </ label > </ p > < input type = \"submit\" value = \"Enviar\" name = \"enviar\" /> </ form > <?php } ?> Subiendo archivos \u00b6 Se almacenan en el servidor en el array $_FILES con el nombre del campo del tipo file del formulario. < form enctype = \"multipart/form-data\" action = \"<?php echo $_SERVER['PHP_SELF']; ?>\" method = \"POST\" > Archivo: < input name = \"archivoEnviado\" type = \"file\" /> < br /> < input type = \"submit\" name = \"btnSubir\" value = \"Subir\" /> </ form > Configuraci\u00f3n en php.ini file_uploads : on / off upload_max_filesize : 2M upload_tmp_dir : directorio temporal. No es necesario configurarlo, coger\u00e1 el predeterminado del sistema post_max_size : tama\u00f1o m\u00e1ximo de los datos POST. Debe ser mayor a upload_max_filesize. max_file_uploads : n\u00famero m\u00e1ximo de archivos que se pueden cargar a la vez. max_input_time : tiempo m\u00e1ximo empleado en la carga (GET/POST y upload \u2192 normalmente se configura en 60) memory_limit : 128M max_execution_time : tiempo de ejecuci\u00f3n de un script (no tiene en cuenta el upload) Para cargar los archivos, accedemos al array $_FILES : <?php if ( isset ( $_POST [ 'btnSubir' ]) && $_POST [ 'btnSubir' ] == 'Subir' ) { if ( is_uploaded_file ( $_FILES [ 'archivoEnviado' ][ 'tmp_name' ])) { // subido con \u00e9xito $nombre = $_FILES [ 'archivoEnviado' ][ 'name' ]; move_uploaded_file ( $_FILES [ 'archivoEnviado' ][ 'tmp_name' ], \"./uploads/ { $nombre } \" ); echo \"<p>Archivo $nombre subido con \u00e9xito</p>\" ; } } Cada archivo cargado en $_FILES tiene: name : nombre tmp_name : ruta temporal size : tama\u00f1o en bytes type : tipo MIME error : si hay error, contiene un mensaje. Si ok \u2192 0. Cabeceras de respuesta \u00b6 Debe ser lo primero a devolver. Se devuelven mediante la funci\u00f3n header(cadena) . Mediante las cabeceras podemos configurar el tipo de contenido, tiempo de expiraci\u00f3n, redireccionar el navegador, especificar errores HTTP, etc. <?php header ( \"Content-Type: text/plain\" ); ?> <?php header ( \"Location: http://www.ejemplo.com/inicio.html\" ); exit (); Se puede comprobar en las herramientas del desarrollador de los navegadores web mediante Developer Tools \u2192 Network \u2192 Headers . Es muy com\u00fan configurar las cabeceras para evitar consultas a la cach\u00e9 o provocar su renovaci\u00f3n: <?php header ( \"Expires: Sun, 31 Jan 2021 23:59:59 GMT\" ); // tres horas $now = time (); $horas3 = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" , $now + 60 * 60 * 3 ); header ( \"Expires: { $horas3 } \" ); // un a\u00f1o $now = time (); $anyo1 = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" , $now + 365 * 86440 ); header ( \"Expires: { $anyo1 } \" ); // se marca como expirado (fecha en el pasado) $pasado = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" ); header ( \"Expires: { $pasado } \" ); // evitamos cache de navegador y/o proxy header ( \"Expires: Mon, 26 Jul 1997 05:00:00 GMT\" ); header ( \"Last-Modified: \" . gmdate ( \"D, d M Y H:i:s\" ) . \" GMT\" ); header ( \"Cache-Control: no-store, no-cache, must-revalidate\" ); header ( \"Cache-Control: post-check=0, pre-check=0\" , false ); header ( \"Pragma: no-cache\" ); Gesti\u00f3n del estado \u00b6 HTTP es un protocolo stateless , sin estado. Por ello, se simula el estado mediante el uso de cookies, tokens o la sesi\u00f3n. El estado es necesario para procesos tales como el carrito de la compra, operaciones asociadas a un usuario, etc... El mecanismo de PHP para gestionar la sesi\u00f3n emplea cookies de forma interna. Las cookies se almacenan en el navegador, y la sesi\u00f3n en el servidor web. Cookies \u00b6 Las cookies se almacenan en el array global $_COOKIE . Lo que coloquemos dentro del array, se guardar\u00e1 en el cliente. Hay que tener presente que el cliente puede no querer almacenarlas. Existe una limitaci\u00f3 de 20 cookies por dominio y 300 en total en el navegador. En PHP, para crear una cookie se utiliza la funci\u00f3n setcookie : <?php setcookie ( nombre [, valor [, expira [, ruta [, dominio [, seguro [, httponly ]]]]]]); setcookie ( nombre [, valor = \"\" [, opciones = [] ]] ) ?> Destacar que el nombre no puede contener espacios ni el caracter ; . Respecto al contenido de la cookie, no puede superar los 4 KB. Por ejemplo, mediante cookies podemos comprobar la cantidad de visitas diferentes que realiza un usuario: <?php $accesosPagina = 0 ; if ( isset ( $_COOKIE [ 'accesos' ])) { $accesosPagina = $_COOKIE [ 'accesos' ]; // recuperamos una cookie setcookie ( 'accesos' , ++ $accesosPagina ); // le asignamos un valor } ?> Inspeccionando las cookies Si queremos ver que contienen las cookies que tenemos almacenadas en el navegador, se puede comprobar su valor en Dev Tools \u2192 Application \u2192 Storage El tiempo de vida de las cookies puede ser tan largo como el sitio web en el que residen. Ellas seguir\u00e1n ah\u00ed, incluso si el navegador est\u00e1 cerrado o abierto. Para borrar una cookie se puede poner que expiren en el pasado: <?php setcookie ( nombre , \"\" , 1 ) // pasado O que caduquen dentro de un periodo de tiempo deteminado: <?php setcookie ( nombre , valor , time () + 3600 ) // Caducan dentro de una hora Comunicaci\u00f3n con cookies Se utilizan para: Recordar los inicios de sesi\u00f3n Almacenar valores temporales de usuario Si un usuario est\u00e1 navegando por una lista paginada de art\u00edculos, ordenados de cierta manera, podemos almacenar el ajuste de la clasificaci\u00f3n. La alternativa en el cliente para almacenar informaci\u00f3n en el navegador es el objeto LocalStorage . Sesi\u00f3n \u00b6 La sesi\u00f3n a\u00f1ade la gesti\u00f3n del estado a HTTP, almacenando en este caso la informaci\u00f3n en el servidor. Cada visitante tiene un ID de sesi\u00f3n \u00fanico, el cual por defecto se almacena en una cookie denominada PHPSESSID . Si el cliente no tiene las cookies activas, el ID se propaga en cada URL dentro del mismo dominio. Cada sesi\u00f3n tiene asociado un almac\u00e9n de datos mediante el array global $_SESSION , en el cual podemos almacenar y recuperar informaci\u00f3n. La sesi\u00f3n comienza al ejecutar un script PHP. Se genera un nuevo ID y se cargan los datos del almac\u00e9n: Comunicaci\u00f3n con sesi\u00f3n Las operaciones que podemos realizar con la sesi\u00f3n son: <?php session_start (); // carga la sesi\u00f3n session_id () // devuelve el id $_SESSION [ clave ] = valor ; // inserci\u00f3n session_destroy (); // destruye la sesi\u00f3n unset ( $_SESSION [ clave ]; // borrado Vamos a ver mediante un ejemplo como podemos insertar en un p\u00e1gina datos en la sesi\u00f3n para posteriormente en otra p\u00e1gina acceder a esos datos. Por ejemplo, en sesion1.php tendr\u00edamos <?php session_start (); // inicializamos $_SESSION [ \"ies\" ] = \"IES Severo Ochoa\" ; // asignaci\u00f3n $instituto = $_SESSION [ \"ies\" ]; // recuperaci\u00f3n echo \"Estamos en el $instituto \" ; ?> <br /> <a href=\"sesion2.php\">Y luego</a> Y posteriormente podemos acceder a la sesi\u00f3n en sesion2.php : <?php session_start (); $instituto = $_SESSION [ \"ies\" ]; // recuperaci\u00f3n echo \"Otra vez, en el $instituto \" ; ?> Configurando la sesi\u00f3n en php.ini Las siguiente propiedades de php.ini permiten configurar algunos aspectos de la sesi\u00f3n: session.save_handler : controlador que gestiona c\u00f3mo se almacena ( files ) session.save_path : ruta donde se almacenan los archivos con los datos (si tenemos un cluster, podr\u00edamos usar /mnt/sessions en todos los servidor de manera que apuntan a una carpeta compartida) session.name : nombre de la sesi\u00f3n ( PHSESSID ) session.auto_start : Se puede hacer que se autocargue con cada script. Por defecto est\u00e1 deshabilitado session.cookie_lifetime : tiempo de vida por defecto M\u00e1s informaci\u00f3n en la documentaci\u00f3n oficial . Autentificaci\u00f3n de usuarios \u00b6 Una sesi\u00f3n establece una relaci\u00f3n an\u00f3nima con un usuario particular, de manera que podemos saber si es el mismo usuario entre dos peticiones distintas. Si preparamos un sistema de login, podremos saber quien utiliza nuestra aplicaci\u00f3n. Para ello, preparemos un sencillo sistema de autenticaci\u00f3n: Mostrar el formulario login/password Comprobar los datos enviados A\u00f1adir el login a la sesi\u00f3n Comprobar el login en la sesi\u00f3n para realizar tareas espec\u00edficas del usuario Eliminar el login de la sesi\u00f3n cuando el usuario la cierra. Vamos a ver en c\u00f3digo cada paso del proceso. Comenzamos con el archivo index.php : < form action = 'login.php' method = 'post' > < fieldset > < legend > Login </ legend > < div >< span class = 'error' > <?php echo $error; ?> </ span ></ div > < div class = 'fila' > < label for = 'usuario' > Usuario: </ label >< br /> < input type = 'text' name = 'inputUsuario' id = 'usuario' maxlength = \"50\" />< br /> </ div > < div class = 'fila' > < label for = 'password' > Contrase\u00f1a: </ label >< br /> < input type = 'password' name = 'inputPassword' id = 'password' maxlength = \"50\" />< br /> </ div > < div class = 'fila' > < input type = 'submit' name = 'enviar' value = 'Enviar' /> </ div > </ fieldset > </ form > Al hacer submit nos lleva a login.php , el cual hace de controlador: <?php // Comprobamos si ya se ha enviado el formulario if ( isset ( $_POST [ 'enviar' ])) { $usuario = $_POST [ 'inputUsuario' ]; $password = $_POST [ 'inputPassword' ]; // validamos que recibimos ambos par\u00e1metros if ( empty ( $usuario ) || empty ( $password )) { $error = \"Debes introducir un usuario y contrase\u00f1a\" ; include \"index.php\" ; } else { if ( $usuario == \"admin\" && $password == \"admin\" ) { // almacenamos el usuario en la sesi\u00f3n session_start (); $_SESSION [ 'usuario' ] = $usuario ; // cargamos la p\u00e1gina principal include \"main.php\" ; } else { // Si las credenciales no son v\u00e1lidas, se vuelven a pedir $error = \"Usuario o contrase\u00f1a no v\u00e1lidos!\" ; include \"index.php\" ; } } } Dependiendo del usuario que se haya logueado, vamos a ir a una vista o a otra. Por ejemplo, en main.php tendr\u00edamos: <?php // Recuperamos la informaci\u00f3n de la sesi\u00f3n if ( ! isset ( $_SESSION )) { session_start (); } // Y comprobamos que el usuario se haya autentificado if ( ! isset ( $_SESSION [ 'usuario' ])) { die ( \"Error - debe <a href='index.php'>identificarse</a>.<br />\" ); } ?> <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > Listado de productos </ title > </ head > < body > < h1 > Bienvenido <? = $_SESSION [ 'usuario' ] ?> </ h1 > < p > Pulse < a href = \"logout.php\" > aqu\u00ed </ a > para salir </ p > < p > Volver al < a href = \"main.php\" > inicio </ a ></ p > < h2 > Listado de productos </ h2 > < ul > < li > Producto 1 </ li > < li > Producto 2 </ li > < li > Producto 3 </ li > </ ul > </ body > </ html > Finalmente, necesitamos la opci\u00f3n de cerrar la sesi\u00f3n que colocamos en logout.php : <?php // Recuperamos la informaci\u00f3n de la sesi\u00f3n session_start (); // Y la destruimos session_destroy (); header ( \"Location: index.php\" ); ?> Autenticaci\u00f3n en producci\u00f3n En la actualidad la autenticaci\u00f3n de usuario no se realiza gestionando la sesi\u00f3n direcamente, sino que se realiza mediante alg\u00fan framekwork que abstrae todo el proceso o la integraci\u00f3n de mecanismos de autenticaci\u00f3n tipo OAuth , como estudiaremos en la \u00faltima unidad mediante Laravel . Referencias \u00b6 Cookies en PHP Manejo de sesiones en PHP Actividades \u00b6 401server.php : igual que el ejemplo visto en los apuntes, muestra los valores de $_SERVER al ejecutar un script en tu ordenador. Prueba a pasarle par\u00e1metros por GET (y a no pasarle ninguno). Prepara un formulario ( 401post.html ) que haga un env\u00edo por POST y compru\u00e9balo de nuevo. Crea una p\u00e1gina ( 401enlace.html ) que tenga un enlace a 401server.php y comprueba el valor de HTTP_REFERER . Formularios \u00b6 402formulario.html y 402formulario.php : Crea un formulario que solicite: Nombre y apellidos. Email. URL p\u00e1gina personal. Sexo (radio). N\u00famero de convivientes en el domicilio. Aficiones (checkboxes) \u2013 poner m\u00ednimo 4 valores. Men\u00fa favorito (lista selecci\u00f3n m\u00faltiple) \u2013 poner m\u00ednimo 4 valores. Muestra los valores cargados en una tabla-resumen. 403validacion.php : A partir del formulario anterior, introduce validaciones en HTML mediante el atributo required de los campos (uso los tipos adecuados para cada campo), y en comprueba los tipos de los datos y que cumplen los valores esperados (por ejemplo, en los checkboxes que los valores recogidos forman parte de todos los posibles). Puedes probar a pasarle datos erroneos via URL y comprobar su comportamiento. Tip: Investiga el uso de la funci\u00f3n filter_var . 404subida.html y 404subida.php : Crea un formulario que permita subir un archivo al servidor. Adem\u00e1s del fichero, debe pedir en el mismo formulario dos campos num\u00e9ricos que soliciten la anchura y la altura. Comprueba que tanto el fichero como los datos llegan correctamente. 405subidaImagen.php : Modifica el ejercicio anterior para que \u00fanicamente permita subir im\u00e1genes (comprueba la propiedad type del archivo subido). Si el usuario selecciona otro tipo de archivos, se le debe informar del error y permitir que suba un nuevo archivo. En el caso de subir el tipo correcto, visualizar la imagen con el tama\u00f1o de anchura y altura recibido como par\u00e1metro. Cookies y Sesi\u00f3n \u00b6 406contadorVisitas.php : Mediante el uso de cookies, informa al usuario de si es su primera visita, o si no lo es, muestre su valor (valor de un contador). Adem\u00e1s, debes permitir que el usuario reinicialice su contador de visitas. 407fondo.php : Mediante el uso de cookies, crea una p\u00e1gina con un desplegable con varios colores, de manera que el usuario pueda cambiar el color de fondo de la p\u00e1gina (atributo bgcolor ). Al cerrar la p\u00e1gina, \u00e9sta debe recordar, al menos durante 24h, el color elegido y la pr\u00f3xima vez que se cargue la pagina, lo haga con el \u00faltimo color seleccionado. 408fondoSesion1.php : Modifica el ejercicio anterior para almacenar el color de fondo en la sesi\u00f3n y no emplear cookies. Adem\u00e1s, debe contener un enlace al siguiente archivo. 408fondoSesion2.php : Debe mostrar el color y dar la posibilidad de: volver a la p\u00e1gina anterior mediante un enlace y mediante otro enlace, vaciar la sesi\u00f3n y volver a la p\u00e1gina anterior. Haciendo uso de la sesi\u00f3n, vamos a dividir el formulario del ejercicio 402formulario.php en 2 subformularios: 409formulario1.php env\u00eda los datos (nombre y apellidos, email, url y sexo) a 409formulario2.php . 409formulario2.php lee los datos y los mete en la sesi\u00f3n. A continuaci\u00f3n, muestra el resto de campos del formulario a rellenar (convivientes, aficiones y men\u00fa). Env\u00eda estos datos a 409formulario3.php . 409formulario3.php recoge los datos enviados en el paso anterior y junto a los que ya estaban en la sesi\u00f3n, se muestran todos los datos en una tabla/lista desordenada. Autenticaci\u00f3n \u00b6 En los siguientes ejercicios vamos a montar una estructura de inicio de sesi\u00f3n similar a la vista en los apuntes. 410index.php : formulario de inicio de sesi\u00f3n 411login.php : hace de controlador, por lo que debe comprobar los datos recibidos (solo permite la entrada de usuario/usuario y si todo es correcto, ceder el control a la vista del siguiente ejercicio. No contiene c\u00f3digo HTML. 412peliculas.php : vista que muestra como t\u00edtulo \"Listado de Pel\u00edculas\", y una lista desordenada con tres pel\u00edculas. 413logout.php : vac\u00eda la sesi\u00f3n y nos lleva de nuevo al formulario de inicio de sesi\u00f3n. No contiene c\u00f3digo HTML 414series.php : A\u00f1ade un nueva vista similar a 412peliculas.php que muestra un \"Listado de Series\" con una lista desordenada con tres series. Tanto 412pelicuas.php como la vista recien creadas, deben tener un peque\u00f1o men\u00fa (sencillo, mediante enlaces) que permita pasar de un listado a otro. Comprueba que si se accede directamente a cualquiera de las vistas sin tener un usuario logueado via URL del navegador, no se muestra el listado. Modifica tanto el controlador como las vistas para que: los datos los obtenga el controlador (almacena en la sesi\u00f3n un array de pel\u00edculas y otro de series) coloque los datos en la sesi\u00f3n En las vistas, los datos se recuperan de la sesi\u00f3n y se pintan en la lista desordenada recorriendo el array correspondiente. Proyecto Videoclub 3.0 \u00b6 Para el Videoclub, vamos a crear una p\u00e1gina index.php con un formulario que contenga un formulario de login/password. Se comprobar\u00e1n los datos en login.php . Los posibles usuarios son admin/admin o usuario/usuario Si el usuario es correcto, en main.php mostrar un mensaje de bienvenida con el nombre del usuario, junto a un enlace para cerrar la sesi\u00f3n, que lo llevar\u00eda de nuevo al login. Si el usuario es incorrecto, debe volver a cargar el formulario dando informaci\u00f3n al usuario de acceso incorrecto. Si el usuario es administrador, se cargar\u00e1n en la sesi\u00f3n los datos de soportes y clientes del videoclub que ten\u00edamos en nuestras pruebas. En la siguiente unidad los obtendremos de la base de datos. En mainAdmin.php , adem\u00e1s de la bienvenida, debe mostrar: Listado de clientes Listado de soportes Esquema navegaci\u00f3n ejercicio 423 Vamos a modificar la clase Cliente para almacenar el user y la password de cada cliente. Tras codificar los cambios, modificar el listado de clientes de mainAdmin.php para a\u00f1adir al listado el usuario. Si el usuario que accede no es administrador y coincide con alguno de los clientes que tenemos cargados tras el login, debe cargar mainCliente.php donde se mostrar\u00e1 un listado de los alquileres del cliente. Para ello, modificaremos la clase Cliente para ofrecer el m\u00e9todo getAlquileres() : array , el cual llamaremos y luego recorreremos para mostrar el listado solicitado. Ahora volvemos a la parte de administraci\u00f3n Adem\u00e1s de mostrar el listado de clientes, vamos a ofrecer la opci\u00f3n de dar de alta a un nuevo cliente en formCreateCliente.php . Los datos se enviar\u00e1n mediante POST a createCliente.php que los introducir\u00e1 en la sesi\u00f3n. Una vez creado el cliente, debe volver a cargar mainAdmin.php donde se podr\u00e1 ver el cliente insertado. Si hay alg\u00fan dato incorrecto, debe volver a cargar el formulario de alta. Crea en formUpdateCliente.php un formulario que permita editar los datos de un cliente. Debes recoger los datos en updateCliente.php Los datos de cliente se deben poder modificar desde la propia p\u00e1gina de un cliente, as\u00ed como desde el listado del administrador. Desde el listado de clientes del administrador debes ofrecer la posibilidad de borrar un cliente. En el navegador, antes de redirigir al servidor, el usuario debe confirmar mediante JS que realmente desea eliminar al cliente. Finalmente, en removeCliente.php elimina al cliente de la sesi\u00f3n. Una vez eliminado, debe volver al listado de clientes. Esquema navegaci\u00f3n Videoclub 3.0","title":"4.- Programaci\u00f3n Web"},{"location":"04web.html#programacion-web","text":"Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 12 sesiones Resultado de aprendizaje Criterios de evaluaci\u00f3n 4. Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. a) Se han identificado los mecanismos disponibles para el mantenimiento de la informaci\u00f3n que concierne a un cliente web concreto y se han se\u00f1alado sus ventajas. b) Se han utilizado sesiones para mantener el estado de las aplicaciones Web. c) Se han utilizado cookies para almacenar informaci\u00f3n en el cliente Web y para recuperar su contenido. d) Se han identificado y caracterizado los mecanismos disponibles para la autentificaci\u00f3n de usuarios. e) Se han escrito aplicaciones que integren mecanismos de autentificaci\u00f3n de usuarios. f) Se han realizado adaptaciones a aplicaciones Web existentes como gestores de contenidos u otras. g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo.","title":"Programaci\u00f3n Web"},{"location":"04web.html#variables-de-servidor","text":"PHP almacena la informaci\u00f3n del servidor y de las peticiones HTTP en seis arrays globales: $_ENV : informaci\u00f3n sobre las variables de entorno $_GET : par\u00e1metros enviados en la petici\u00f3n GET $_POST : par\u00e1metros enviados en el envio POST $_COOKIE : contiene las cookies de la petici\u00f3n, las claves del array son los nombres de las cookies $_SERVER : informaci\u00f3n sobre el servidor $_FILES : informaci\u00f3n sobre los ficheros cargados via upload Si nos centramos en el array $_SERVER podemos consultar las siguientes propiedades: PHP_SELF : nombre del script ejecutado, relativo al document root (p.ej: /tienda/carrito.php ) SERVER_SOFTWARE : (p.ej: Apache) SERVER_NAME : dominio, alias DNS (p.ej: www.elche.es ) REQUEST_METHOD : GET REQUEST_URI : URI, sin el dominio QUERY_STRING : todo lo que va despu\u00e9s de ? en la URL (p.ej: heroe=Batman&nombre=Bruce ) M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/reserved.variables.server.php <?php echo $_SERVER [ \"PHP_SELF\" ] . \"<br>\" ; // /u4/401server.php echo $_SERVER [ \"SERVER_SOFTWARE\" ] . \"<br>\" ; // Apache/2.4.46 (Win64) OpenSSL/1.1.1g PHP/7.4.9 echo $_SERVER [ \"SERVER_NAME\" ] . \"<br>\" ; // localhost echo $_SERVER [ \"REQUEST_METHOD\" ] . \"<br>\" ; // GET echo $_SERVER [ \"REQUEST_URI\" ] . \"<br>\" ; // /u4/401server.php?heroe=Batman echo $_SERVER [ \"QUERY_STRING\" ] . \"<br>\" ; // heroe=Batman Otras propiedades relacionadas: PATH_INFO : ruta extra tras la petici\u00f3n. Si la URL es http://www.php.com/php/pathInfo.php/algo/cosa?foo=bar , entonces $_SERVER['PATH_INFO'] ser\u00e1 /algo/cosa . REMOTE_HOST : hostname que hizo la petici\u00f3n REMOTE_ADDR : IP del cliente AUTH_TYPE : tipo de autenticaci\u00f3n (p.ej: Basic) REMOTE_USER : nombre del usuario autenticado Apache crea una clave para cada cabecera HTTP, en may\u00fasculas y sustituyendo los guiones por subrayados: HTTP_USER_AGENT : agente (navegador) HTTP_REFERER : p\u00e1gina desde la que se hizo la petici\u00f3n <?php echo $_SERVER [ \"HTTP_USER_AGENT\" ] . \"<br>\" ; // Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36","title":"Variables de servidor"},{"location":"04web.html#formularios","text":"A la hora de enviar un formulario, debemos tener claro cuando usar GET o POST GET: los par\u00e1metros se pasan en la URL <2048 caracteres, s\u00f3lo ASCII Permite almacenar la direcci\u00f3n completa (marcador / historial) Idempotente: dos llamadas con los mismos datos siempre debe dar el mismo resultado El navegador puede cachear las llamadas POST: par\u00e1metros ocultos (no encriptados) Sin l\u00edmite de datos, permite datos binarios. No se pueden cachear No idempotente \u2192 actualizar la BBDD As\u00ed pues, para recoger los datos accederemos al array dependiendo del m\u00e9todo del formulario que nos ha invocado: <?php $par = $_GET [ \"parametro\" ] $par = $_POST [ \"parametro\" ] Para los siguientes apartados nos vamos a basar en el siguiente ejemplo: < form action = \"formulario.php\" method = \"GET\" > < p >< label for = \"nombre\" > Nombre del alumno: </ label > < input type = \"text\" name = \"nombre\" id = \"nombre\" value = \"\" /> </ p > < p >< input type = \"checkbox\" name = \"modulos[]\" id = \"modulosDWES\" value = \"DWES\" /> < label for = \"modulosDWES\" > Desarrollo web en entorno servidor </ label > </ p > < p >< input type = \"checkbox\" name = \"modulos[]\" id = \"modulosDWEC\" value = \"DWEC\" /> < label for = \"modulosDWEC\" > Desarrollo web en entorno cliente </ label > </ p > < input type = \"submit\" value = \"Enviar\" name = \"enviar\" /> </ form >","title":"Formularios"},{"location":"04web.html#validacion","text":"Respecto a la validaci\u00f3n, es conveniente siempre hacer validaci\u00f3n doble : En el cliente mediante JS En servidor, antes de llamar a negocio, es conveniente volver a validar los datos. <?php if ( isset ( $_GET [ \"parametro\" ])) { $par = $_GET [ \"parametro\" ]; // comprobar si $par tiene el formato adecuado, su valor, etc... } Librer\u00edas de validaci\u00f3n Existen diversas librer\u00edas que facilitan la validaci\u00f3n de los formularios, como son respect/validation o particle/validator . Cuando estudiemos Laravel profundizaremos en la validaci\u00f3n de forma declarativa.","title":"Validaci\u00f3n"},{"location":"04web.html#parametro-multivalor","text":"Existen elementos HTML que env\u00edan varios valores: select multiple checkbox Para recoger los datos, el nombre del elemento debe ser un array. < select name = \"lenguajes[]\" multiple = \"true\" > < option value = \"c\" > C </ option > < option value = \"java\" > Java </ option > < option value = \"php\" > PHP </ option > < option value = \"python\" > Python </ option > </ select > < input type = \"checkbox\" name = \"lenguajes[]\" value = \"c\" /> C < br /> < input type = \"checkbox\" name = \"lenguajes[]\" value = \"java\" /> Java < br /> < input type = \"checkbox\" name = \"lenguajes[]\" value = \"php\" /> Php < br /> < input type = \"checkbox\" name = \"lenguajes[]\" value = \"python\" /> Python < br /> De manera que luego al recoger los datos: <?php $lenguajes = $_GET [ \"lenguajes\" ]; foreach ( $lenguajes as $lenguaje ) { echo \" $lenguaje <br />\" ; }","title":"Par\u00e1metro multivalor"},{"location":"04web.html#volviendo-a-rellenar-un-formulario","text":"Un sticky form es un formulario que recuerda sus valores. Para ello, hemos de rellenar los atributos value de los elementos HTML con la informaci\u00f3n que conten\u00edan: <?php if ( ! empty ( $_POST [ 'modulos' ]) && ! empty ( $_POST [ 'nombre' ])) { // Aqu\u00ed se incluye el c\u00f3digo a ejecutar cuando los datos son correctos } else { // Generamos el formulario $nombre = $_POST [ 'nombre' ] ?? \"\" ; $modulos = $_POST [ 'modulos' ] ?? []; ?> < form action = \" <?php echo $_SERVER [ 'PHP_SELF' ]; ?> \" method = \"POST\" > < p >< label for = \"nombre\" > Nombre del alumno: </ label > < input type = \"text\" name = \"nombre\" id = \"nombre\" value = \" <? = $nombre ?> \" /> </ p > < p >< input type = \"checkbox\" name = \"modulos[]\" id = \"modulosDWES\" value = \"DWES\" <?php if ( in_array ( \"DWES\" , $modulos )) echo 'checked=\"checked\"' ; ?> /> < label for = \"modulosDWES\" > Desarrollo web en entorno servidor </ label > </ p > < p >< input type = \"checkbox\" name = \"modulos[]\" id = \"modulosDWEC\" value = \"DWEC\" <?php if ( in_array ( \"DWEC\" , $modulos )) echo 'checked=\"checked\"' ; ?> /> < label for = \"modulosDWEC\" > Desarrollo web en entorno cliente </ label > </ p > < input type = \"submit\" value = \"Enviar\" name = \"enviar\" /> </ form > <?php } ?>","title":"Volviendo a rellenar un formulario"},{"location":"04web.html#subiendo-archivos","text":"Se almacenan en el servidor en el array $_FILES con el nombre del campo del tipo file del formulario. < form enctype = \"multipart/form-data\" action = \"<?php echo $_SERVER['PHP_SELF']; ?>\" method = \"POST\" > Archivo: < input name = \"archivoEnviado\" type = \"file\" /> < br /> < input type = \"submit\" name = \"btnSubir\" value = \"Subir\" /> </ form > Configuraci\u00f3n en php.ini file_uploads : on / off upload_max_filesize : 2M upload_tmp_dir : directorio temporal. No es necesario configurarlo, coger\u00e1 el predeterminado del sistema post_max_size : tama\u00f1o m\u00e1ximo de los datos POST. Debe ser mayor a upload_max_filesize. max_file_uploads : n\u00famero m\u00e1ximo de archivos que se pueden cargar a la vez. max_input_time : tiempo m\u00e1ximo empleado en la carga (GET/POST y upload \u2192 normalmente se configura en 60) memory_limit : 128M max_execution_time : tiempo de ejecuci\u00f3n de un script (no tiene en cuenta el upload) Para cargar los archivos, accedemos al array $_FILES : <?php if ( isset ( $_POST [ 'btnSubir' ]) && $_POST [ 'btnSubir' ] == 'Subir' ) { if ( is_uploaded_file ( $_FILES [ 'archivoEnviado' ][ 'tmp_name' ])) { // subido con \u00e9xito $nombre = $_FILES [ 'archivoEnviado' ][ 'name' ]; move_uploaded_file ( $_FILES [ 'archivoEnviado' ][ 'tmp_name' ], \"./uploads/ { $nombre } \" ); echo \"<p>Archivo $nombre subido con \u00e9xito</p>\" ; } } Cada archivo cargado en $_FILES tiene: name : nombre tmp_name : ruta temporal size : tama\u00f1o en bytes type : tipo MIME error : si hay error, contiene un mensaje. Si ok \u2192 0.","title":"Subiendo archivos"},{"location":"04web.html#cabeceras-de-respuesta","text":"Debe ser lo primero a devolver. Se devuelven mediante la funci\u00f3n header(cadena) . Mediante las cabeceras podemos configurar el tipo de contenido, tiempo de expiraci\u00f3n, redireccionar el navegador, especificar errores HTTP, etc. <?php header ( \"Content-Type: text/plain\" ); ?> <?php header ( \"Location: http://www.ejemplo.com/inicio.html\" ); exit (); Se puede comprobar en las herramientas del desarrollador de los navegadores web mediante Developer Tools \u2192 Network \u2192 Headers . Es muy com\u00fan configurar las cabeceras para evitar consultas a la cach\u00e9 o provocar su renovaci\u00f3n: <?php header ( \"Expires: Sun, 31 Jan 2021 23:59:59 GMT\" ); // tres horas $now = time (); $horas3 = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" , $now + 60 * 60 * 3 ); header ( \"Expires: { $horas3 } \" ); // un a\u00f1o $now = time (); $anyo1 = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" , $now + 365 * 86440 ); header ( \"Expires: { $anyo1 } \" ); // se marca como expirado (fecha en el pasado) $pasado = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" ); header ( \"Expires: { $pasado } \" ); // evitamos cache de navegador y/o proxy header ( \"Expires: Mon, 26 Jul 1997 05:00:00 GMT\" ); header ( \"Last-Modified: \" . gmdate ( \"D, d M Y H:i:s\" ) . \" GMT\" ); header ( \"Cache-Control: no-store, no-cache, must-revalidate\" ); header ( \"Cache-Control: post-check=0, pre-check=0\" , false ); header ( \"Pragma: no-cache\" );","title":"Cabeceras de respuesta"},{"location":"04web.html#gestion-del-estado","text":"HTTP es un protocolo stateless , sin estado. Por ello, se simula el estado mediante el uso de cookies, tokens o la sesi\u00f3n. El estado es necesario para procesos tales como el carrito de la compra, operaciones asociadas a un usuario, etc... El mecanismo de PHP para gestionar la sesi\u00f3n emplea cookies de forma interna. Las cookies se almacenan en el navegador, y la sesi\u00f3n en el servidor web.","title":"Gesti\u00f3n del estado"},{"location":"04web.html#cookies","text":"Las cookies se almacenan en el array global $_COOKIE . Lo que coloquemos dentro del array, se guardar\u00e1 en el cliente. Hay que tener presente que el cliente puede no querer almacenarlas. Existe una limitaci\u00f3 de 20 cookies por dominio y 300 en total en el navegador. En PHP, para crear una cookie se utiliza la funci\u00f3n setcookie : <?php setcookie ( nombre [, valor [, expira [, ruta [, dominio [, seguro [, httponly ]]]]]]); setcookie ( nombre [, valor = \"\" [, opciones = [] ]] ) ?> Destacar que el nombre no puede contener espacios ni el caracter ; . Respecto al contenido de la cookie, no puede superar los 4 KB. Por ejemplo, mediante cookies podemos comprobar la cantidad de visitas diferentes que realiza un usuario: <?php $accesosPagina = 0 ; if ( isset ( $_COOKIE [ 'accesos' ])) { $accesosPagina = $_COOKIE [ 'accesos' ]; // recuperamos una cookie setcookie ( 'accesos' , ++ $accesosPagina ); // le asignamos un valor } ?> Inspeccionando las cookies Si queremos ver que contienen las cookies que tenemos almacenadas en el navegador, se puede comprobar su valor en Dev Tools \u2192 Application \u2192 Storage El tiempo de vida de las cookies puede ser tan largo como el sitio web en el que residen. Ellas seguir\u00e1n ah\u00ed, incluso si el navegador est\u00e1 cerrado o abierto. Para borrar una cookie se puede poner que expiren en el pasado: <?php setcookie ( nombre , \"\" , 1 ) // pasado O que caduquen dentro de un periodo de tiempo deteminado: <?php setcookie ( nombre , valor , time () + 3600 ) // Caducan dentro de una hora Comunicaci\u00f3n con cookies Se utilizan para: Recordar los inicios de sesi\u00f3n Almacenar valores temporales de usuario Si un usuario est\u00e1 navegando por una lista paginada de art\u00edculos, ordenados de cierta manera, podemos almacenar el ajuste de la clasificaci\u00f3n. La alternativa en el cliente para almacenar informaci\u00f3n en el navegador es el objeto LocalStorage .","title":"Cookies"},{"location":"04web.html#sesion","text":"La sesi\u00f3n a\u00f1ade la gesti\u00f3n del estado a HTTP, almacenando en este caso la informaci\u00f3n en el servidor. Cada visitante tiene un ID de sesi\u00f3n \u00fanico, el cual por defecto se almacena en una cookie denominada PHPSESSID . Si el cliente no tiene las cookies activas, el ID se propaga en cada URL dentro del mismo dominio. Cada sesi\u00f3n tiene asociado un almac\u00e9n de datos mediante el array global $_SESSION , en el cual podemos almacenar y recuperar informaci\u00f3n. La sesi\u00f3n comienza al ejecutar un script PHP. Se genera un nuevo ID y se cargan los datos del almac\u00e9n: Comunicaci\u00f3n con sesi\u00f3n Las operaciones que podemos realizar con la sesi\u00f3n son: <?php session_start (); // carga la sesi\u00f3n session_id () // devuelve el id $_SESSION [ clave ] = valor ; // inserci\u00f3n session_destroy (); // destruye la sesi\u00f3n unset ( $_SESSION [ clave ]; // borrado Vamos a ver mediante un ejemplo como podemos insertar en un p\u00e1gina datos en la sesi\u00f3n para posteriormente en otra p\u00e1gina acceder a esos datos. Por ejemplo, en sesion1.php tendr\u00edamos <?php session_start (); // inicializamos $_SESSION [ \"ies\" ] = \"IES Severo Ochoa\" ; // asignaci\u00f3n $instituto = $_SESSION [ \"ies\" ]; // recuperaci\u00f3n echo \"Estamos en el $instituto \" ; ?> <br /> <a href=\"sesion2.php\">Y luego</a> Y posteriormente podemos acceder a la sesi\u00f3n en sesion2.php : <?php session_start (); $instituto = $_SESSION [ \"ies\" ]; // recuperaci\u00f3n echo \"Otra vez, en el $instituto \" ; ?> Configurando la sesi\u00f3n en php.ini Las siguiente propiedades de php.ini permiten configurar algunos aspectos de la sesi\u00f3n: session.save_handler : controlador que gestiona c\u00f3mo se almacena ( files ) session.save_path : ruta donde se almacenan los archivos con los datos (si tenemos un cluster, podr\u00edamos usar /mnt/sessions en todos los servidor de manera que apuntan a una carpeta compartida) session.name : nombre de la sesi\u00f3n ( PHSESSID ) session.auto_start : Se puede hacer que se autocargue con cada script. Por defecto est\u00e1 deshabilitado session.cookie_lifetime : tiempo de vida por defecto M\u00e1s informaci\u00f3n en la documentaci\u00f3n oficial .","title":"Sesi\u00f3n"},{"location":"04web.html#autentificacion-de-usuarios","text":"Una sesi\u00f3n establece una relaci\u00f3n an\u00f3nima con un usuario particular, de manera que podemos saber si es el mismo usuario entre dos peticiones distintas. Si preparamos un sistema de login, podremos saber quien utiliza nuestra aplicaci\u00f3n. Para ello, preparemos un sencillo sistema de autenticaci\u00f3n: Mostrar el formulario login/password Comprobar los datos enviados A\u00f1adir el login a la sesi\u00f3n Comprobar el login en la sesi\u00f3n para realizar tareas espec\u00edficas del usuario Eliminar el login de la sesi\u00f3n cuando el usuario la cierra. Vamos a ver en c\u00f3digo cada paso del proceso. Comenzamos con el archivo index.php : < form action = 'login.php' method = 'post' > < fieldset > < legend > Login </ legend > < div >< span class = 'error' > <?php echo $error; ?> </ span ></ div > < div class = 'fila' > < label for = 'usuario' > Usuario: </ label >< br /> < input type = 'text' name = 'inputUsuario' id = 'usuario' maxlength = \"50\" />< br /> </ div > < div class = 'fila' > < label for = 'password' > Contrase\u00f1a: </ label >< br /> < input type = 'password' name = 'inputPassword' id = 'password' maxlength = \"50\" />< br /> </ div > < div class = 'fila' > < input type = 'submit' name = 'enviar' value = 'Enviar' /> </ div > </ fieldset > </ form > Al hacer submit nos lleva a login.php , el cual hace de controlador: <?php // Comprobamos si ya se ha enviado el formulario if ( isset ( $_POST [ 'enviar' ])) { $usuario = $_POST [ 'inputUsuario' ]; $password = $_POST [ 'inputPassword' ]; // validamos que recibimos ambos par\u00e1metros if ( empty ( $usuario ) || empty ( $password )) { $error = \"Debes introducir un usuario y contrase\u00f1a\" ; include \"index.php\" ; } else { if ( $usuario == \"admin\" && $password == \"admin\" ) { // almacenamos el usuario en la sesi\u00f3n session_start (); $_SESSION [ 'usuario' ] = $usuario ; // cargamos la p\u00e1gina principal include \"main.php\" ; } else { // Si las credenciales no son v\u00e1lidas, se vuelven a pedir $error = \"Usuario o contrase\u00f1a no v\u00e1lidos!\" ; include \"index.php\" ; } } } Dependiendo del usuario que se haya logueado, vamos a ir a una vista o a otra. Por ejemplo, en main.php tendr\u00edamos: <?php // Recuperamos la informaci\u00f3n de la sesi\u00f3n if ( ! isset ( $_SESSION )) { session_start (); } // Y comprobamos que el usuario se haya autentificado if ( ! isset ( $_SESSION [ 'usuario' ])) { die ( \"Error - debe <a href='index.php'>identificarse</a>.<br />\" ); } ?> <!DOCTYPE html> < html lang = \"es\" > < head > < meta charset = \"UTF-8\" > < meta name = \"viewport\" content = \"width=device-width, initial-scale=1.0\" > < title > Listado de productos </ title > </ head > < body > < h1 > Bienvenido <? = $_SESSION [ 'usuario' ] ?> </ h1 > < p > Pulse < a href = \"logout.php\" > aqu\u00ed </ a > para salir </ p > < p > Volver al < a href = \"main.php\" > inicio </ a ></ p > < h2 > Listado de productos </ h2 > < ul > < li > Producto 1 </ li > < li > Producto 2 </ li > < li > Producto 3 </ li > </ ul > </ body > </ html > Finalmente, necesitamos la opci\u00f3n de cerrar la sesi\u00f3n que colocamos en logout.php : <?php // Recuperamos la informaci\u00f3n de la sesi\u00f3n session_start (); // Y la destruimos session_destroy (); header ( \"Location: index.php\" ); ?> Autenticaci\u00f3n en producci\u00f3n En la actualidad la autenticaci\u00f3n de usuario no se realiza gestionando la sesi\u00f3n direcamente, sino que se realiza mediante alg\u00fan framekwork que abstrae todo el proceso o la integraci\u00f3n de mecanismos de autenticaci\u00f3n tipo OAuth , como estudiaremos en la \u00faltima unidad mediante Laravel .","title":"Autentificaci\u00f3n de usuarios"},{"location":"04web.html#referencias","text":"Cookies en PHP Manejo de sesiones en PHP","title":"Referencias"},{"location":"04web.html#actividades","text":"401server.php : igual que el ejemplo visto en los apuntes, muestra los valores de $_SERVER al ejecutar un script en tu ordenador. Prueba a pasarle par\u00e1metros por GET (y a no pasarle ninguno). Prepara un formulario ( 401post.html ) que haga un env\u00edo por POST y compru\u00e9balo de nuevo. Crea una p\u00e1gina ( 401enlace.html ) que tenga un enlace a 401server.php y comprueba el valor de HTTP_REFERER .","title":"Actividades"},{"location":"04web.html#formularios_1","text":"402formulario.html y 402formulario.php : Crea un formulario que solicite: Nombre y apellidos. Email. URL p\u00e1gina personal. Sexo (radio). N\u00famero de convivientes en el domicilio. Aficiones (checkboxes) \u2013 poner m\u00ednimo 4 valores. Men\u00fa favorito (lista selecci\u00f3n m\u00faltiple) \u2013 poner m\u00ednimo 4 valores. Muestra los valores cargados en una tabla-resumen. 403validacion.php : A partir del formulario anterior, introduce validaciones en HTML mediante el atributo required de los campos (uso los tipos adecuados para cada campo), y en comprueba los tipos de los datos y que cumplen los valores esperados (por ejemplo, en los checkboxes que los valores recogidos forman parte de todos los posibles). Puedes probar a pasarle datos erroneos via URL y comprobar su comportamiento. Tip: Investiga el uso de la funci\u00f3n filter_var . 404subida.html y 404subida.php : Crea un formulario que permita subir un archivo al servidor. Adem\u00e1s del fichero, debe pedir en el mismo formulario dos campos num\u00e9ricos que soliciten la anchura y la altura. Comprueba que tanto el fichero como los datos llegan correctamente. 405subidaImagen.php : Modifica el ejercicio anterior para que \u00fanicamente permita subir im\u00e1genes (comprueba la propiedad type del archivo subido). Si el usuario selecciona otro tipo de archivos, se le debe informar del error y permitir que suba un nuevo archivo. En el caso de subir el tipo correcto, visualizar la imagen con el tama\u00f1o de anchura y altura recibido como par\u00e1metro.","title":"Formularios"},{"location":"04web.html#cookies-y-sesion","text":"406contadorVisitas.php : Mediante el uso de cookies, informa al usuario de si es su primera visita, o si no lo es, muestre su valor (valor de un contador). Adem\u00e1s, debes permitir que el usuario reinicialice su contador de visitas. 407fondo.php : Mediante el uso de cookies, crea una p\u00e1gina con un desplegable con varios colores, de manera que el usuario pueda cambiar el color de fondo de la p\u00e1gina (atributo bgcolor ). Al cerrar la p\u00e1gina, \u00e9sta debe recordar, al menos durante 24h, el color elegido y la pr\u00f3xima vez que se cargue la pagina, lo haga con el \u00faltimo color seleccionado. 408fondoSesion1.php : Modifica el ejercicio anterior para almacenar el color de fondo en la sesi\u00f3n y no emplear cookies. Adem\u00e1s, debe contener un enlace al siguiente archivo. 408fondoSesion2.php : Debe mostrar el color y dar la posibilidad de: volver a la p\u00e1gina anterior mediante un enlace y mediante otro enlace, vaciar la sesi\u00f3n y volver a la p\u00e1gina anterior. Haciendo uso de la sesi\u00f3n, vamos a dividir el formulario del ejercicio 402formulario.php en 2 subformularios: 409formulario1.php env\u00eda los datos (nombre y apellidos, email, url y sexo) a 409formulario2.php . 409formulario2.php lee los datos y los mete en la sesi\u00f3n. A continuaci\u00f3n, muestra el resto de campos del formulario a rellenar (convivientes, aficiones y men\u00fa). Env\u00eda estos datos a 409formulario3.php . 409formulario3.php recoge los datos enviados en el paso anterior y junto a los que ya estaban en la sesi\u00f3n, se muestran todos los datos en una tabla/lista desordenada.","title":"Cookies y Sesi\u00f3n"},{"location":"04web.html#autenticacion","text":"En los siguientes ejercicios vamos a montar una estructura de inicio de sesi\u00f3n similar a la vista en los apuntes. 410index.php : formulario de inicio de sesi\u00f3n 411login.php : hace de controlador, por lo que debe comprobar los datos recibidos (solo permite la entrada de usuario/usuario y si todo es correcto, ceder el control a la vista del siguiente ejercicio. No contiene c\u00f3digo HTML. 412peliculas.php : vista que muestra como t\u00edtulo \"Listado de Pel\u00edculas\", y una lista desordenada con tres pel\u00edculas. 413logout.php : vac\u00eda la sesi\u00f3n y nos lleva de nuevo al formulario de inicio de sesi\u00f3n. No contiene c\u00f3digo HTML 414series.php : A\u00f1ade un nueva vista similar a 412peliculas.php que muestra un \"Listado de Series\" con una lista desordenada con tres series. Tanto 412pelicuas.php como la vista recien creadas, deben tener un peque\u00f1o men\u00fa (sencillo, mediante enlaces) que permita pasar de un listado a otro. Comprueba que si se accede directamente a cualquiera de las vistas sin tener un usuario logueado via URL del navegador, no se muestra el listado. Modifica tanto el controlador como las vistas para que: los datos los obtenga el controlador (almacena en la sesi\u00f3n un array de pel\u00edculas y otro de series) coloque los datos en la sesi\u00f3n En las vistas, los datos se recuperan de la sesi\u00f3n y se pintan en la lista desordenada recorriendo el array correspondiente.","title":"Autenticaci\u00f3n"},{"location":"04web.html#proyecto-videoclub-30","text":"Para el Videoclub, vamos a crear una p\u00e1gina index.php con un formulario que contenga un formulario de login/password. Se comprobar\u00e1n los datos en login.php . Los posibles usuarios son admin/admin o usuario/usuario Si el usuario es correcto, en main.php mostrar un mensaje de bienvenida con el nombre del usuario, junto a un enlace para cerrar la sesi\u00f3n, que lo llevar\u00eda de nuevo al login. Si el usuario es incorrecto, debe volver a cargar el formulario dando informaci\u00f3n al usuario de acceso incorrecto. Si el usuario es administrador, se cargar\u00e1n en la sesi\u00f3n los datos de soportes y clientes del videoclub que ten\u00edamos en nuestras pruebas. En la siguiente unidad los obtendremos de la base de datos. En mainAdmin.php , adem\u00e1s de la bienvenida, debe mostrar: Listado de clientes Listado de soportes Esquema navegaci\u00f3n ejercicio 423 Vamos a modificar la clase Cliente para almacenar el user y la password de cada cliente. Tras codificar los cambios, modificar el listado de clientes de mainAdmin.php para a\u00f1adir al listado el usuario. Si el usuario que accede no es administrador y coincide con alguno de los clientes que tenemos cargados tras el login, debe cargar mainCliente.php donde se mostrar\u00e1 un listado de los alquileres del cliente. Para ello, modificaremos la clase Cliente para ofrecer el m\u00e9todo getAlquileres() : array , el cual llamaremos y luego recorreremos para mostrar el listado solicitado. Ahora volvemos a la parte de administraci\u00f3n Adem\u00e1s de mostrar el listado de clientes, vamos a ofrecer la opci\u00f3n de dar de alta a un nuevo cliente en formCreateCliente.php . Los datos se enviar\u00e1n mediante POST a createCliente.php que los introducir\u00e1 en la sesi\u00f3n. Una vez creado el cliente, debe volver a cargar mainAdmin.php donde se podr\u00e1 ver el cliente insertado. Si hay alg\u00fan dato incorrecto, debe volver a cargar el formulario de alta. Crea en formUpdateCliente.php un formulario que permita editar los datos de un cliente. Debes recoger los datos en updateCliente.php Los datos de cliente se deben poder modificar desde la propia p\u00e1gina de un cliente, as\u00ed como desde el listado del administrador. Desde el listado de clientes del administrador debes ofrecer la posibilidad de borrar un cliente. En el navegador, antes de redirigir al servidor, el usuario debe confirmar mediante JS que realmente desea eliminar al cliente. Finalmente, en removeCliente.php elimina al cliente de la sesi\u00f3n. Una vez eliminado, debe volver al listado de clientes. Esquema navegaci\u00f3n Videoclub 3.0","title":"Proyecto Videoclub 3.0"},{"location":"05herramientas.html","text":"Herramientas \u00b6 Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 16 sesiones Resultado de aprendizaje Criterios de evaluaci\u00f3n 4.- Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo. En esta unidad vamos a estudiar algunas de las herramientas m\u00e1s utilizadas en PHP. Composer \u00b6 Logo Composer Herramienta por excelencia en PHP para la gesti\u00f3n de librer\u00edas y dependencias, de manera que instala y las actualiza asegurando que todo el equipo de desarrollo tiene el mismo entorno y versiones. Adem\u00e1s, ofrece autoloading de nuestro c\u00f3digo, de manera que no tengamos que hacerlo nosotros \"a mano\". Est\u00e1 escrito en PHP, y pod\u00e9is consultar toda su documentaci\u00f3n en https://getcomposer.org/ . Utiliza Packagist como repositorio de librer\u00edas. Funcionalmente, es similar a Maven (Java) / npm (JS). Instalaci\u00f3n \u00b6 Si estamos usando XAMPP, hemos de instalar Composer en el propio sistema operativo. Se recomienda seguir las instrucciones oficiales seg\u00fan el sistema operativo a emplear. En cambio, si usamos Docker , necesitamos modificar la configuraci\u00f3n de nuestro contenedor. En nuestro caso, hemos decidido modificar el archivo Dockerfile y a\u00f1adir el siguiente comando: COPY --from = composer:2.0 /usr/bin/composer /usr/local/bin/composer Para facilitar el trabajo, hemos creado una plantilla ya preparada . Es importante que dentro del contenedor comprobemos que tenemos la v2: composer -V Primeros pasos \u00b6 Cuando creemos un proyecto por primera vez, hemos de inicializar el repositorio. Para ello, ejecutaremos el comando composer init donde: Configuramos el nombre del paquete, descripci\u00f3n, autor (nombre ), tipo de paquete (project), etc... Definimos las dependencias del proyecto ( require ) y las de desarrollo ( require-dev ) de manera interactiva. En las de desarrollo se indica aquellas que no se instalar\u00e1n en el entorno de producci\u00f3n, por ejemplo, las librer\u00edas de pruebas. Tras su configuraci\u00f3n, se crear\u00e1 autom\u00e1ticamente el archivo composer.json con los datos introducidos y descarga las librer\u00edas en la carpeta vendor . La instalaci\u00f3n de las librer\u00edas siempre se realiza de manera local para cada proyecto. { \"name\" : \"dwes/log\" , \"description\" : \"Pruebas con Monolog\" , \"type\" : \"project\" , \"require\" : { \"monolog/monolog\" : \"^2.1\" }, \"license\" : \"MIT\" , \"authors\" : [ { \"name\" : \"Aitor Medrano\" , \"email\" : \"a.medrano@edu.gva.es\" } ] } A la hora de indicar cada librer\u00eda introduciremos: el nombre de la librer\u00eda, compuesta tanto por el creador o \"vendor\", como por el nombre del proyecto. Ejemplos: monolog/monolog o laravel/installer . la versi\u00f3n de cada librer\u00eda. Tenemos diversas opciones para indicarla: Directamente: 1.4.2 Con comodines: 1.* A partir de: >= 2.0.3 Sin rotura de cambios: ^1.3.2 // >=1.3.2 <2.0.0 Actualizar librer\u00edas \u00b6 Podemos definir las dependencias via el archivo composer.json o mediante comandos con el formato composer require vendor/package:version . Por ejemplo, si queremos a\u00f1adir phpUnit como librer\u00eda de desarrollo, haremos: composer require phpunit/phpunit \u2013dev Tras a\u00f1adir nuevas librer\u00edas, hemos de actualizar nuestro proyecto: composer update Si creamos el archivo composer.json nosotros directamente sin inicializar el repositorio, hemos de instalar las dependencias: composer install Al hacer este paso (tanto instalar como actualizar), como ya hemos comentado, se descargan las librer\u00edas en dentro de la carpeta vendor . Es muy importante a\u00f1adir esta carpeta al archivo .gitignore para no subirlas a GitHub. Adem\u00e1s se crea el archivo composer.lock , que almacena la versi\u00f3n exacta que se ha instalado de cada librer\u00eda (este archivo no se toca). autoload.php \u00b6 Composer crea de forma autom\u00e1tica en vendor/autoload.php el c\u00f3digo para incluir de forma autom\u00e1tica todas las librer\u00edas que tengamos configuradas en composer.json . Para utilizarlo, en la cabecera de nuestro archivos pondremos: <?php require 'vendor/autoload.php' ; En nuestro caso, de momento s\u00f3lo lo podremos en los archivos donde probamos las clases Si queremos que Composer tambi\u00e9n se encargue de cargar de forma autom\u00e1tica nuestras clases de dominio, dentro del archivo composer.json , definiremos la propiedad autoload : \"autoload\" : { \"psr-4\" : { \"Dwes\\\\\" : \"app/Dwes\" } }, Posteriormente, hemos de volver a generar el autoload de Composer mediante la opci\u00f3n dump-autoload (o du ): composer dump-autoload Monolog \u00b6 Vamos a probar Composer a\u00f1adiendo la librer\u00eda de Monolog a nuestro proyecto. Se trata de un librer\u00eda para la gesti\u00f3n de logs de nuestras aplicaciones, soportando diferentes niveles (info, warning, etc...), salidas (ficheros, sockets, BBDD, Web Services, email, etc) y formatos (texto plano, HTML, JSON, etc...). Para ello, incluiremos la librer\u00eda en nuestro proyecto con: composer require monolog/monolog Monolog 2 requiere al menos PHP 7.2, cumple con el estandar de logging PSR-3, y es la librer\u00eda empleada por Laravel y Symfony para la gesti\u00f3n de logs. Cuando usar un log Seguir las acciones/movimientos de los usuarios Registrar las transacciones Rastrear los errores de usuario Fallos/avisos a nivel de sistema Interpretar y coleccionar datos para posterior investigaci\u00f3n de patrones Niveles \u00b6 A continuaci\u00f3n mostramos los diferentes niveles de menos a m\u00e1s restrictivo: debug -100 : Informaci\u00f3n detallada con prop\u00f3sitos de debug. No usar en entornos de producci\u00f3n. info - 200 : Eventos interesantes como el inicio de sesi\u00f3n de usuarios. notice - 250 : Eventos normales pero significativos. warning - 300 : Ocurrencias excepcionales que no llegan a ser error. error - 400 : Errores de ejecuci\u00f3n que permiten continuar con la ejecuci\u00f3n de la aplicaci\u00f3n pero que deben ser monitorizados. critical - 500 : Situaciones importantes donde se generan excepciones no esperadas o no hay disponible un componente. alert - 550 : Se deben tomar medidas inmediatamente. Ca\u00edda completa de la web, base de datos no disponible, etc... Adem\u00e1s, se suelen enviar mensajes por email. emergency - 600 : Es el error m\u00e1s grave e indica que todo el sistema est\u00e1 inutilizable. Hola Monolog \u00b6 Por ejemplo, en el archivo pruebaLog.php que colocar\u00edamos en el ra\u00edz, primero incluimos el autoload , importamos las clases a utilizar para finalmente usar los m\u00e9todos de Monolog : <?php include __DIR__ . \"/vendor/autoload.php\" ; use Monolog\\Logger ; use Monolog\\Handler\\StreamHandler ; $log = new Logger ( \"MiLogger\" ); $log -> pushHandler ( new StreamHandler ( \"logs/milog.log\" , Logger :: DEBUG )); $log -> debug ( \"Esto es un mensaje de DEBUG\" ); $log -> info ( \"Esto es un mensaje de INFO\" ); $log -> warning ( \"Esto es un mensaje de WARNING\" ); $log -> error ( \"Esto es un mensaje de ERROR\" ); $log -> critical ( \"Esto es un mensaje de CRITICAL\" ); $log -> alert ( \"Esto es un mensaje de ALERT\" ); En todos los m\u00e9todos de registro de mensajes ( debug , info , ...), adem\u00e1s del propio mensaje, le podemos pasar informaci\u00f3n como el contenido de alguna variable, usuario de la aplicaci\u00f3n, etc.. como segundo par\u00e1metro dentro de un array, el cual se conoce como array de contexto . Es conveniente hacerlo mediante un array asociativo para facilitar la lectura del log. <?php $log -> warning ( \"Producto no encontrado\" , [ $producto ]); $log -> warning ( \"Producto no encontrado\" , [ \"datos\" => $producto ]); Funcionamiento \u00b6 Cada instancia Logger tiene un nombre de canal y una pila de manejadores ( handler ). Cada mensaje que mandamos al log atraviesa la pila de manejadores, y cada uno decide si debe registrar la informaci\u00f3n, y si se da el caso, finalizar la propagaci\u00f3n. Por ejemplo, un StreamHandler en el fondo de la pila que lo escriba todo en disco, y en el tope a\u00f1ade un MailHandler que env\u00ede un mail s\u00f3lo cuando haya un error. Manejadores \u00b6 Cada manejador tambien tiene un formateador ( Formatter ). Si no se indica ninguno, se le asigna uno por defecto. El \u00faltimo manejador insertado ser\u00e1 el primero en ejecutarse. Luego se van ejecutando conforme a la pila. Los manejadores m\u00e1s utilizados son: StreamHandler(ruta, nivel) RotatingFileHandler(ruta, maxFiles, nivel) NativeMailerHandler(para, asunto, desde, nivel) FirePHPHandler(nivel) Si queremos que los mensajes de la aplicaci\u00f3n salgan por el log del servidor, en nuestro caso el archivo error.log de Apache utilizaremos como ruta la salida de error: <?php // error.log $log -> pushHandler ( new StreamHandler ( \"php://stderr\" , Logger :: DEBUG )); FirePHP Por ejemplo, mediante FirePHPHandler , podemos utilizar FirePHP , la cual es una herramienta para hacer debug en la consola de Firefox . Tras instalar la extensi\u00f3n en Firefox, habilitar las opciones y configurar el Handler , podemos ver los mensajes coloreados con sus datos: <?php $log = new Logger ( \"MiFirePHPLogger\" ); $log -> pushHandler ( new FirePHPHandler ( Logger :: INFO )); $datos = [ \"real\" => \"Bruce Wayne\" , \"personaje\" => \"Batman\" ]; $log -> debug ( \"Esto es un mensaje de DEBUG\" , $datos ); $log -> info ( \"Esto es un mensaje de INFO\" , $datos ); $log -> warning ( \"Esto es un mensaje de WARNING\" , $datos ); // ... Ejemplo de uso de FirePHP Canales \u00b6 Se les asigna al crear el Logger . En grandes aplicaciones, se crea un canal por cada subsistema: ventas, contabilidad, almac\u00e9n. No es una buena pr\u00e1ctica usar el nombre de la clase como canal, esto se hace con un procesador . Para su uso, es recomiendo asignar el log a una propiedad privada a Logger, y posteriormente, en el constructor de la clase, asignar el canal, manejadores y formato. <?php $this -> log = new Logger ( \"MiApp\" ); $this -> log -> pushHandler ( new StreamHandler ( \"logs/milog.log\" , Logger :: DEBUG )); $this -> log -> pushHandler ( new FirePHPHandler ( Logger :: DEBUG )); Y dentro de los m\u00e9todos para escribir en el log: <?php $this -> log -> warning ( \"Producto no encontrado\" , [ $producto ]); Procesadores \u00b6 Los procesadores permiten a\u00f1adir informaci\u00f3n a los mensajes. Para ello, se apilan despu\u00e9s de cada manejador mediante el m\u00e9todo pushProcessor($procesador) . Algunos procesadores conocidos son IntrospectionProcessor (muestran la linea, fichero, clase y metodo desde el que se invoca el log), WebProcessor (a\u00f1ade la URI, m\u00e9todo e IP) o GitProcessor (a\u00f1ade la rama y el commit). PHP Consola en formato texto <?php $log = new Logger ( \"MiLogger\" ); $log -> pushHandler ( new RotatingFileHandler ( \"logs/milog.log\" , 0 , Logger :: DEBUG )); $log -> pushProcessor ( new IntrospectionProcessor ()); $log -> pushHandler ( new StreamHandler ( \"php://stderr\" , Logger :: WARNING )); // no usa Introspection pq lo hemos apilado despu\u00e9s, le asigno otro $log -> pushProcessor ( new WebProcessor ()); [2020-11-26T13:35:31.076138+01:00] MiLogger.DEBUG: Esto es un mensaje de DEBUG [] {\"file\":\"C:\\\\xampp\\\\htdocs\\\\log\\\\procesador.php\",\"line\":12,\"class\":null,\"function\":null} [2020-11-26T13:35:31.078344+01:00] MiLogger.INFO: Esto es un mensaje de INFO [] {\"file\":\"C:\\\\xampp\\\\htdocs\\\\log\\\\procesador.php\",\"line\":13,\"class\":null,\"function\":null} Formateadores \u00b6 Se asocian a los manejadores con setFormatter . Los formateadores m\u00e1s utilizados son LineFormatter , HtmlFormatter o JsonFormatter . PHP Consola en JSON <?php $log = new Logger ( \"MiLogger\" ); $rfh = new RotatingFileHandler ( \"logs/milog.log\" , Logger :: DEBUG ); $rfh -> setFormatter ( new JsonFormatter ()); $log -> pushHandler ( $rfh ); { \"message\" : \"Esto es un mensaje de DEBUG\" , \"context\" :{}, \"level\" : 100 , \"level_name\" : \"DEBUG\" , \"channel\" : \"MiLogger\" , \"datetime\" : \"2020-11-27T15:36:52.747211+01:00\" , \"extra\" :{}} { \"message\" : \"Esto es un mensaje de INFO\" , \"context\" :{}, \"level\" : 200 , \"level_name\" : \"INFO\" , \"channel\" : \"MiLogger\" , \"datetime\" : \"2020-11-27T15:36:52.747538+01:00\" , \"extra\" :{}} M\u00e1s informaci\u00f3n M\u00e1s informaci\u00f3n sobre manejadores, formateadores y procesadores en https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md Uso de Factor\u00edas \u00b6 En vez de instanciar un log en cada clase, es conveniente crear una factor\u00eda (por ejemplo, siguiendo la idea del patr\u00f3n de dise\u00f1o Factory Method ). Para el siguiente ejemplo, vamos a suponer que creamos la factor\u00eda en el namespace Dwes\\Ejemplos\\Util . <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Logger ; use Monolog\\Handler\\StreamHandler ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : Logger { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"logs/miApp.log\" , Logger :: DEBUG )); return $log ; } } Si en vez de devolver un Monolog\\Logger utilizamos el interfaz de PSR, si en el futuro cambiamos la implementaci\u00f3n del log, no tendremos que modificar nuestro codigo. As\u00ed pues, la factor\u00eda ahora devolver\u00e1 Psr\\Log\\LoggerInterface : <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Handler\\StreamHandler ; use Monolog\\Logger ; use Psr\\Log\\LoggerInterface ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : LoggerInterface { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"log/miApp.log\" , Logger :: DEBUG )); return $log ; } } Finalmente, para utilizar la factor\u00eda, s\u00f3lo cambiamos el c\u00f3digo que ten\u00edamos en el constructor de las clases que usan el log, quedando algo asi: <?php namespace Dwes\\Ejemplos\\Model ; use Dwes\\Ejemplos\\Util\\LogFactory ; use Monolog\\Logger ; class Cliente { private $codigo ; private Logger $log ; function __construct ( $codigo ){ $this -> codigo = $codigo ; $this -> log = LogFactory :: getLogger (); } /// ... resto del c\u00f3digo } Documentaci\u00f3n con phpDocumentor \u00b6 phpDocumentor es la herramienta de facto para documentar el c\u00f3digo PHP. Es similar en prop\u00f3sito y funcionamiento a Javadoc . As\u00ed pues, es un herramienta que facilita la documentaci\u00f3n del c\u00f3digo PHP, creando un sitio web con el API de la aplicaci\u00f3n. Se basa en el uso de anotaciones sobre los docblocks. Para ponerlo en marcha, en nuestro caso nos decantaremos por utilizar la imagen que ya existe de Docker. Instalaci\u00f3n como binario \u00b6 Otra opci\u00f3n es seguir los pasos que recomienda la documentaci\u00f3n oficial para instalarlo como un ejecutable, que son descargar el archivo phpDocumentor.phar y darles permisos de ejecuci\u00f3n: wget https://phpdoc.org/phpDocumentor.phar chmod +x phpDocumentor.phar mv phpDocumentor.phar /usr/local/bin/phpdoc phpdoc --version Una vez instalado, desde el ra\u00edz del proyecto, suponiendo que tenemos nuestro c\u00f3digo dentro de app y que queremos la documentaci\u00f3n dentro de docs/api ejecutamos: phpdoc -d ./app -t docs/api Uso en Docker \u00b6 En el caso de usar Docker , usaremos el siguiente comando para ejecutarlo (crea el contenedor, ejecuta el comando que le pidamos, y autom\u00e1ticamente lo borra): docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 A dicho comando, le adjuntaremos los diferentes par\u00e1metros que admite phpDocumentor, por ejemplo: # Muestra la versi\u00f3n docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 --version # Mediante -d se indica el origen a parsear # Mediante -t se indica el destino donde generar la documentaci\u00f3n docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 -d ./src/app -t ./docs/api DocBlock \u00b6 Un docblock es el bloque de c\u00f3digo que se coloca encima de un recurso. Su formato es: <?php /** * *Sumario*, una sola l\u00ednea * * *Descripci\u00f3n* que puede utilizar varias l\u00edneas * y que ofrece detalles del elemento o referencias * para ampliar la informaci\u00f3n * * @param string $miArgumento con una *descripci\u00f3n* del argumento * que puede usar varias l\u00edneas. * * @return void */ function miFuncion ( tipo $miArgumento ) { } Documentando el c\u00f3digo \u00b6 En todos los elementos, ademas del sumario y/o descripci\u00f3n, pondremos: En las clases: @author nombre @package ruta del namespace En las propiedades: @var tipo descripci\u00f3n En los m\u00e9todos: @param tipo $nombre descripci\u00f3n @throws ClaseException descripci\u00f3n @return tipo descripci\u00f3n Ve\u00e1moslo con un ejemplo. Supongamos que tenemos una clase que representa un cliente: <?php /** * Clase que representa un cliente * * El cliente se encarga de almacenar los soportes que tiene alquilado, * de manera que podemos alquilar y devolver productos mediante las operaciones * hom\u00f3nimas. * * @package Dwes\\Videoclub\\Model * @author Aitor Medrano <a.medrano@edu.gva.es> */ class Cliente { public string $nombre ; private string $numero ; /** * Colecci\u00f3n de soportes alquilados * @var array<Soporte> */ private $soportesAlquilados []; /** * Comprueba si el soporte recibido ya lo tiene alquilado el cliente * @param Soporte $soporte Soporte a comprobar * @return bool true si lo tiene alquilado */ public function tieneAlquilado ( Soporte $soporte ) : bool { // ... } Si generamos la documentaci\u00f3n y abrimos con un navegador el archivo docs/api/index.html podremos navegar hasta la clase `Cliente: phpDocumentor de Cliente Web Scraping \u00b6 Consiste en navegar a una p\u00e1gina web y extraer informaci\u00f3n autom\u00e1ticamente, a partir del c\u00f3digo HTML generado, y organizar la informaci\u00f3n p\u00fablica disponible en Internet. Esta pr\u00e1ctica requiere el uso de una librer\u00eda que facilite la descarga de la informaci\u00f3n deseada imitando la interacci\u00f3n de un navegador web. Este \"robot\" puede acceder a varias p\u00e1ginas simult\u00e1neamente. \u00bfEs legal? Si el sitio web indica que tiene el contenido protegido por derechos de autor o en las normas de acceso via usuario/contrase\u00f1a nos avisa de su prohibici\u00f3n, estar\u00edamos incurriendo en un delito. Es recomendable estudiar el archivo robots.txt que se encuentra en el ra\u00edz de cada sitio web. M\u00e1s informaci\u00f3n en el art\u00edculo El manual completo para el web scraping legal y \u00e9tico en 2021 Goutte \u00b6 Goutte es un sencillo cliente HTTP para PHP creado espec\u00edficamente para hacer web scraping. Lo desarroll\u00f3 el mismo autor del framework Symfony y ofrece un API sencilla para extraer datos de las respuestas HTML/XML de los sitios web. FIXME: Revisar https://godofredo.ninja/web-scraping-con-php-utilizando-goutte/ Los componentes principales que abstrae Goutte sobre Symfony son: BrowserKit : simula el comportamiento de un navegador web. CssSelector : traduce consultas CSS en consultas XPath. DomCrawler : facilita el uso del DOM y XPath. Para poder utilizar Goutte en nuestro proyecto, ejecutaremos el siguiente comando en el terminal: composer require fabpot/goutte Goutte con selectores CSS \u00b6 A continuaci\u00f3n vamos a hacer un ejemplo muy sencillo utilizando los selectores CSS, extrayendo informaci\u00f3n de la web https://books.toscrape.com/ , la cual es una p\u00e1gina para pruebas que no rechazar\u00e1 nuestras peticiones. Tras crear un cliente con Goutte , hemos de realizar un petici\u00f3n a una URL. Con la respuesta obtenida, podemos utilizar el m\u00e9todo filter para indicarle la ruta CSS que queremos recorrer e iterar sobre los resultados mediante una funci\u00f3n an\u00f3nima. Una vez estamos dentro de un determinado nodo, el m\u00e9todo text() nos devolver\u00e1 el contenido del propio nodo. En concreto, vamos a meter en un array asociativo el t\u00edtulo y el precio de todos los libros de la categor\u00eda Classics . <?php require '../vendor/autoload.php' ; $httpClient = new \\Goutte\\Client (); $response = $httpClient -> request ( 'GET' , 'https://books.toscrape.com/catalogue/category/books/classics_6/index.html' ); // colocamos los precios en un array $precios = []; $response -> filter ( '.row li article div.product_price p.price_color' ) -> each ( // le pasamos $precios por referencia para poder editarla dentro del closure function ( $node ) use ( & $precios ) { $precios [] = $node -> text (); } ); // colocamos el nombre y el precio en un array asociativo $contadorPrecios = 0 ; $libros = []; $response -> filter ( '.row li article h3 a' ) -> each ( function ( $node ) use ( $precios , & $contadorPrecios , & $libros ) { $libros [ $node -> text ()] = $precios [ $contadorPrecios ]; $contadorPrecios ++ ; } ); Crawler \u00b6 Un caso muy com\u00fan es obtener la informaci\u00f3n de una p\u00e1gina que tiene los resultados paginados, de manera que vayamos recorriendo los enlaces y accediendo a cada uno de los resultados. En este caso vamos a coger todos los precios de los libros de fantas\u00eda, y vamos a sumarlos: <?php require '../vendor/autoload.php' ; use Goutte\\Client ; use Symfony\\Component\\HttpClient\\HttpClient ; $client = new Client ( HttpClient :: create ([ 'timeout' => 60 ])); $crawler = $client -> request ( 'GET' , 'https://books.toscrape.com/catalogue/category/books/fantasy_19/index.html' ); $salir = false ; $precios = []; while ( ! $salir ) { $crawler -> filter ( '.row li article div.product_price p.price_color' ) -> each ( function ( $node ) use ( & $precios ) { $texto = $node -> text (); $cantidad = substr ( $texto , 2 ); // Le quitamos las libras \u00bf2 posiciones? $precios [] = floatval ( $cantidad ); } ); $enlace = $crawler -> selectLink ( 'next' ); if ( $enlace -> count () != 0 ) { // el enlace next existe $sigPag = $crawler -> selectLink ( 'next' ) -> link (); $crawler = $client -> click ( $sigPag ); // hacemos click } else { // ya no hay enlace next $salir = true ; } } $precioTotal = array_sum ( $precios ); echo $precioTotal ; Pruebas con PHPUnit \u00b6 El curso pasado, dentro del m\u00f3dulo de Entornos de Desarrollo , estudiamos la importancia de la realizaci\u00f3n de pruebas, as\u00ed como las pruebas unitarias mediante JUnit . Test Driven Development A d\u00eda de hoy es de gran importancia seguir una buena metodolog\u00eda de pruebas, siendo el desarrollo dirigido por las pruebas ( Test Driven Development / TDD) uno de los enfoques m\u00e1s empleados, el cual consiste en: Escribir el test, y como no hay c\u00f3digo implementado, la prueba falle (rojo). Escribir el c\u00f3digo de aplicaci\u00f3n para que la prueba funcione (verde). Refactorizar el c\u00f3digo de la aplicaci\u00f3n con la ayuda de la prueba para comprobar que no rompemos nada (refactor). En el caso de PHP, la herramienta que se utiliza es PHPUnit ( https://phpunit.de/ ), que como su nombre indica, est\u00e1 basada en JUnit. La versi\u00f3n actual es la 9.0 Se recomienda consultar su documentaci\u00f3n en https://phpunit.readthedocs.io/es/latest/index.html . Puesta en marcha \u00b6 Vamos a colocar todas las pruebas en una carpeta tests en el ra\u00edz de nuestro proyecto. En el archivo composer.json , a\u00f1adimos: \"require-dev\" : { \"phpunit/phpunit\" : \"^9\" }, \"scripts\" : { \"test\" : \"phpunit --testdox --colors tests\" } Si quisi\u00e9ramos a\u00f1adir la librer\u00eda desde un comando del terminal, tambi\u00e9n podr\u00edamos ejecutar: composer require --dev phpunit/phpunit ^9 Librer\u00edas de desarrollo Las librer\u00edas que se colocan en require-dev son las de desarrollo y testing , de manera que no se instalar\u00e1n en un entorno de producci\u00f3n. Como hemos creado un script , podemos lanzar las pruebas mediante: composer test Vasmos a realizar nuestra primera prueba: <?php use PHPUnit\\Framework\\TestCase ; class PilaTest extends TestCase { public function testPushAndPop () { $pila = []; $this -> assertSame ( 0 , count ( $pila )); array_push ( $pila , 'batman' ); $this -> assertSame ( 'batman' , $pila [ count ( $pila ) - 1 ]); $this -> assertSame ( 1 , count ( $pila )); $this -> assertSame ( 'batman' , array_pop ( $pila )); $this -> assertSame ( 0 , count ( $pila )); } } Tenemos diferentes formas de ejecutar una prueba: ./vendor/bin/phpunit tests/PilaTest.php ./vendor/bin/phpunit tests ./vendor/bin/phpunit --testdox tests ./vendor/bin/phpunit --testdox --colors tests Dise\u00f1ando pruebas \u00b6 Tal como hemos visto en el ejemplo, la clase de prueba debe heredar de TestCase , y el nombre de la clase debe acabar en Test , de ah\u00ed que hayamos llamado la clase de prueba como PilaTest . Una prueba implica un m\u00e9todo de prueba (p\u00fablico) por cada funcionalidad a probar. Cada un de los m\u00e9todos se les asocia un caso de prueba. Los m\u00e9todos deben nombrarse con el prefijo test , por ejemplo, testPushAndPop . Es muy importante que el nombre sea muy claro y descriptivo del prop\u00f3sito de la prueba. ( camelCase ). En los casos de prueba prepararemos varias aserciones para toda la casu\u00edstica: rangos de valores, tipos de datos, excepciones, etc... Aserciones \u00b6 Las aserciones permiten comprobar el resultado de los m\u00e9todos que queremos probar. Las aserciones esperan que el predicado siempre sea verdadero. PHPUnit ofrece las siguiente aserciones: assertTrue / assertFalse : Comprueba que la condici\u00f3n dada sea evaluada como true / false assertEquals / assertSame : Comprueba que dos variables sean iguales assertNotEquals / assertNotSame : Comprueba que dos variables NO sean iguales Same \u2192 comprueba los tipos. Si no coinciden los tipos y los valores, la aserci\u00f3n fallar\u00e1 Equals \u2192 sin comprobaci\u00f3n estricta assertArrayHasKey / assertArrayNotHasKey : Comprueba que un array posea un key determinado / o NO lo posea assertArraySubset : Comprueba que un array posea otro array como subset del mismo assertAttributeContains / assertAttributeNotContains : Comprueba que un atributo de una clase contenga una variable determinada / o NO contenga una variable determinada assertAttributeEquals : Comprueba que un atributo de una clase sea igual a una variable determinada. Comparando la salida \u00b6 Si los m\u00e9todos a probar generan contenido mediante echo o una instrucci\u00f3n similar, disponemos de las siguiente expectativas: expectOutputString(salidaEsperada) expectOutputRegex(expresionRegularEsperada) Las expectativas difieren de las aserciones que informan del resultado que se espera antes de invocar al m\u00e9todo. Tras definir la expectativa, se invoca al m\u00e9todo que realiza el echo / print . <?php namespace Dwes\\Videoclub\\Model ; use PHPUnit\\Framework\\TestCase ; use Dwes\\Videoclub\\Model\\CintaVideo ; class CintaVideoTest extends TestCase { public function testConstructor () { $cinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $this -> assertSame ( $cinta -> getNumero (), 23 ); } public function testMuestraResumen () { $cinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $resultado = \"<br>Pel\u00edcula en VHS:\" ; $resultado .= \"<br>Los cazafantasmas<br>3.5 (IVA no incluido)\" ; $resultado .= \"<br>Duraci\u00f3n: 107 minutos\" ; // definimos la expectativa $this -> expectOutputString ( $resultado ); // invocamos al m\u00e9todo que har\u00e1 echo $cinta -> muestraResumen (); } } Proveedores de datos \u00b6 Cuando tenemos pruebas que solo cambian respecto a los datos de entrada y de salida, es \u00fatil utilizar proveedores de datos. Se declaran en el docblock mediante @dataProvider nombreMetodo , donde se indica el nombre de un m\u00e9todo p\u00fablico que devuelve un array de arrays, donde cada elemento es un caso de prueba. La clase de prueba recibe como par\u00e1metros los datos a probar y el resultado de la prueba como \u00faltimo par\u00e1metro. El siguiente ejemplo comprueba con diferentes datos el funcionamiento de muestraResumen : <?php /** * @dataProvider cintasProvider */ public function testMuestraResumenConProvider ( $titulo , $id , $precio , $duracion , $esperado ) { $cinta = new CintaVideo ( $titulo , $id , $precio , $duracion ); $this -> expectOutputString ( $esperado ); $cinta -> muestraResumen (); } public function cintasProvider () { return [ \"cazafantasmas\" => [ \"Los cazafantasmas\" , 23 , 3.5 , 107 , \"<br>Pel\u00edcula en VHS:<br>Los cazafantasmas<br>3.5 \u20ac(IVA no incluido)<br>Duraci\u00f3n: 107 minutos\" ], \"superman\" => [ \"Superman\" , 24 , 3 , 188 , \"<br>Pel\u00edcula en VHS:<br>Superman<br>3 \u20ac (IVA no incluido)<br>Duraci\u00f3n: 188 minutos\" ], ]; } Probando excepciones \u00b6 Las pruebas adem\u00e1s de comprobar que las clases funcionan como se espera, han de cubrir todos los casos posibles. As\u00ed pues, debemos poder hacer pruebas que esperen que se lance una excepci\u00f3n (y que el mensaje contenga cierta informaci\u00f3n): Para ello, se utilizan las siguiente expectativas: expectException(Excepcion::class) expectExceptionCode(codigoExcepcion) expectExceptionMessage(mensaje) Del mismo modo que antes, primero se pone la expectativa, y luego se provoca que se lance la excepci\u00f3n: <?php public function testAlquilarCupoLleno () { $soporte1 = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $soporte2 = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); $soporte3 = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); $soporte4 = new Dvd ( \"El Imperio Contraataca\" , 4 , 3 , \"es,en\" , \"16:9\" ); $cliente1 = new Cliente ( \"Bruce Wayne\" , 23 ); $cliente1 -> alquilar ( $soporte1 ); $cliente1 -> alquilar ( $soporte2 ); $cliente1 -> alquilar ( $soporte3 ); $this -> expectException ( CupoSuperadoException :: class ); $cliente1 -> alquilar ( $soporte4 ); } Cobertura de c\u00f3digo \u00b6 La cobertura de pruebas indica la cantidad de c\u00f3digo que las pruebas cubren, siendo recomendable que cubran entre el 95 y el 100%. Una de las m\u00e9tricas asociadas a los informes de cobertura es el CRAP (An\u00e1lisis y Predicciones sobre el Riesgo en Cambios), el cual mide la cantidad de esfuerzo, dolor y tiempo requerido para mantener una porci\u00f3n de c\u00f3digo. Esta m\u00e9trica debe mantenerse con un valor inferior a 5. Requisito xdebug Aunque ya viene instalado dentro de PHPUnit, para que funcione la cobertura del c\u00f3digo, es necesario que el c\u00f3digo PHP se ejecute con XDEBUG, y e indicarle a Apache que as\u00ed es (colocando en el archivo de configuraci\u00f3n php.ini la directiva xdebug.mode=coverage ). A\u00f1adimos en composer.json un nuevo script : \"coverage\" : \"phpunit --coverage-html coverage --coverage-filter app tests\" Y posteriormente ejecutamos composer coverage Por ejemplo, si accedemos a la clase CintaVideo con la prueba que hab\u00edamos realizado anteriormente, podemos observar la cobertura que tiene al 100% y que su CRAP es 2. Informe de cobertura de la clase CintaVideo Temas pendientes Dependencia entre casos de prueba con el atributo @depends Completamente configurable mediante el archivo phpxml.xml : https://phpunit.readthedocs.io/es/latest/configuration.html Preparando las pruebas con setUpBeforeClass() y tearDownAfterClass() Objetos y pruebas Mock (dobles) con createMock() Referencias \u00b6 Tutorial de Composer Web Scraping with PHP \u2013 How to Crawl Web Pages Using Open Source Tools PHP Monolog Unit Testing con PHPUnit \u2014 Parte 1 , de Emiliano Zublena. Actividades \u00b6 Monolog \u00b6 Crea un nuevo proyecto con Composer llamado Monologos : Incluye como librer\u00eda la \u00faltima versi\u00f3n de Monolog. Crea la clase Dwes\\Monologos\\HolaMonolog . Define una propiedad privada nombrada miLog para guardar el log. Define en el constructor un RotatingFileHandler que escriba en la carpeta logs del proyecto, y que almacene los mensajes a partir de debug . Crea los m\u00e9todos saludar y despedir que hagan un log de tipo info con la acci\u00f3n correspondiente. Siguiendo con el proyecto Monologos : Crea un archivo llamado inicio.php que permita probar HolaMonolog . Comprueba que los mensajes aparecen en el log . Cambia el nivel para que el manejador solo muestre los mensajes a partir de warning . Vuelve a ejectuar inicio.php y comprueba el archivo de log. Modifica la clase HolaMonolog : En el constructor, a\u00f1ade a la pila un manejador que escriba a la salida de error conjunto al procesador de introspecci\u00f3n, mostrando mensajes desde el nivel debug . A\u00f1ade una propiedad denominada hora , la cual se inicializa \u00fanicamente como par\u00e1metro del constructor. Si la hora es inferior a 0 o mayor de 24, debe escribir un log de warning con un mensaje apropiado. Modifica los m\u00e9todos saludar y despedir para hacerlo acorde a la propiedad hora (buenos d\u00edas, buenas tardes, hasta ma\u00f1ana, etc...) Proyecto Videoclub IV \u00b6 Como ya tenemos Composer instalado: Inicial\u00edzalo dentro de tu proyecto Videoclub Incluye Monolog y PhpUnit , cada una en su lugar adecuado. A\u00f1ade el autoload al archivo composer.json , y haz los cambios necesarios en las clases para utilizar el autoload de Composer . Sube los cambios a GitHub y crea la etiqueta v0.511 . Modifica la clase Cliente para introducir un Logger de Monolog . A\u00f1ade el log como una propiedad de la clase e inicial\u00edzalo en el constructor, con el nombre del canal VideoclubLogger . Se debe almacenar en logs/videoclub.log mostrando todos los mensajes desde debug . Antes de lanzar cualquier excepci\u00f3n, debe escribir un log de tipo warning . Sustituir los echo que haya en el c\u00f3digo, que ahora pasar\u00e1n por el log con el nivel info, a excepci\u00f3n del m\u00e9todo muestraResumen que seguir\u00e1 haciendo echo . Vuelve a hacer lo mismo que en el ejercicio anterior, pero ahora con la clase Videoclub . Adem\u00e1s: Siempre que se llame a un m\u00e9todo del log, se le pasar\u00e1 como segundo par\u00e1metro la informaci\u00f3n que dispongamos. Ejecuta el archivo de prueba y comprueba que el log se rellena correctamente. Vamos a refactorizar el c\u00f3digo com\u00fan de inicializaci\u00f3n de Monolog que tenemos repetidos en los constructores a una factor\u00eda de Monolog , la cual colocaremos en \\Dwes\\Videoclub\\Util\\LogFactory . Comprueba que sigue funcionando correctamente. Modifica la factor\u00eda para que devuelva LogInterface y comprueba que sigue funcionando. Sube los cambios a GitHub con la etiqueta v0.515 . phpDocumentor \u00b6 Comprueba que en el contenedor de Docker funciona phpDocumentor . Ejecuta phpdoc sobre tu proyecto Monolog y comprueba el api que se crea. Comenta tanto la clase como los m\u00e9todos, y posteriormente, vuelve a ejecutar phpdoc. Documenta el proyecto Videoclub , y genera la documentaci\u00f3n. Empieza por las clases de Soporte y sus hijos. Comprueba el resultado. Luego sigue con Cliente y finalmente Videoclub . Web Scraping \u00b6 A partir de los datos de http://www.seleccionbaloncesto.es , calcula la altura y edad media del equipo de baloncesto masculino. Observa que tienes los datos dentro de una tabla debajo de las noticias. Volviendo al Videoclub, en Soporte a\u00f1ade una propiedad llamada metacritic para almacenar la URL de cada soporte. A continuaci\u00f3n, modifica los m\u00e9todos incluirXXX de Videoclub para que admitan como primer par\u00e1metro dicha URL. Tras ello, modifica el fichero inicio3.php para pasarle la URL de cada soporte (para ello deber\u00e1s consultarlos en Metacritic haciendo b\u00fasquedas manuales). Por ejemplo, en el caso de la pel\u00edcula Cazafantasmas, su URL es https://www.metacritic.com/movie/ghostbusters . Finalmente, a\u00f1ade un m\u00e9todo abstracto en Soporte llamado getPuntuacion , que haciendo uso de Web Scraping se conecte a Metacritic y obtenga su puntuaci\u00f3n. Modifica inicio3.php para obtener todos los alquileres de un cliente mediante getAlquileres() : array , y para cada uno de ellos, adem\u00e1s del t\u00edtulo, muestra su puntuaci\u00f3n. phpUnit \u00b6 A partir de la clase HolaMonolog , modifica los m\u00e9todos para que adem\u00e1s de escribir en en log, devuelvan el saludo como una cadena. Crea la clase HolaMonologTest y a\u00f1ade diferentes casos de prueba para comprobar que los saludos y despedidas son acordes a la hora con la que se crea la clase. Vamos a simular Test Driven Development . Queremos que nuestra aplicaci\u00f3n almacene los \u00faltimos tres saludos que ha realizado. Para ello: Crea las prueba necesarias (invoca al m\u00e9todo saludar varias veces y llama al m\u00e9todo que te devuelva los saludos almacenados) Implementa el c\u00f3digo para pasar las pruebas Refactoriza el c\u00f3digo Crea una nueva prueba que utilice proveedores de datos para comprobar esta \u00faltima funcionalidad, pas\u00e1ndole: Un saludo. Tres saludos. Cuatro saludos. \u00bfRecuerdas que si la hora es negativa o superior a 24 escrib\u00edamos en el log un warning ? Ahora debe lanzar una excepci\u00f3n de tipo InvalidArgumentException (como la excepci\u00f3n forma para de PHP, hay que poner su FQN: \\InvalidArgumentException ). Vuelve a aplicar TDD y completa tus casos de prueba. Comenta la \u00faltima prueba realizada (la comprobaci\u00f3n de las excepciones) y realiza un informe de cobertura de pruebas. Analiza los resultados obtenidos. Elimina los \u00faltimos comentarios sobre la \u00faltima prueba y vuelve a generar y analizar el informe de cobertura. Proyecto Videoclub V \u00b6 El objetivo de los siguientes ejercicios es conseguir de manera incremental una cobertura de pruebas superior al 95%. Crea pruebas dentro de la carpeta tests para las clases Soporte , CintaVideo , Dvd y Juego . Recuerda respetar el espacio de nombres. Los m\u00e9todos muestraResumen , tras hacer echo de los mensajes, deben devolver una cadena con el propio mensaje. Crea pruebas para la clase Cliente , aprovechando todo el c\u00f3digo que ten\u00edamos para comprobar la funcionalidad. Utiliza proveedores de datos para a\u00f1adir conjuntos de datos mayores que los empleados. Comprueba que funciona con diferentes cupos, que al intentar alquilar un soporte marcado como ya alquilado debe lanzar una excepci\u00f3n, que no coincidan los ids de los soportes, etc... Crea las pruebas para la clase Videoclub . Ten en cuenta los \u00faltimos m\u00e9todos a\u00f1adidos que permit\u00edan alquilar y devolver soportes, tanto de manera individual como mediante un array. Crea el informe de cobertura. Una vez creado, analiza los datos de cobertura (>= 90%) y comprueba el valor de CRAP, de manera que siempre sea <= 5. En caso de no cumplirse, crea nuevos casos de prueba y/o refactoriza el c\u00f3digo de tu aplicaci\u00f3n. Sube los cambios a GitHub con la etiqueta v0.554 . Ampliaci\u00f3n \u00b6 Queremos que en Videoclub , cuando un cliente no existe (tanto al alquilar como al devolver) se lance una nueva excepci\u00f3n: ClienteNoExisteException . Adem\u00e1s, dado el n\u00famero creciente de excepciones, queremos mover las excepciones al namespace Dwes\\Videoclub\\Exception . Siguiendo TDD, primero crea las pruebas, y luego modifica el c\u00f3digo de aplicaci\u00f3n. Vuelve a generar el informe de cobertura y comprueba la calidad de nuestras pruebas. \u00bfNadie se ha dado cuenta que en los Dvd no estamos almacenando su duraci\u00f3n? Haz todos los cambios necesarios, primero en las pruebas y luego en el c\u00f3digo. Tras a\u00f1os luchando contra la tecnolog\u00eda, decidimos introducir los Blu-ray en nuestra empresa. Hemos decido que Bluray herede de Soporte . Adem\u00e1s del t\u00edtulo y la duracion , nos interesa almacenar si es4k . Haz todos los cambios necesarios, primero en las pruebas y luego en el c\u00f3digo. Sube los cambios a GitHub con la etiqueta v0.563 .","title":"5.- Herramientas Web"},{"location":"05herramientas.html#herramientas","text":"Duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada: 16 sesiones Resultado de aprendizaje Criterios de evaluaci\u00f3n 4.- Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo. En esta unidad vamos a estudiar algunas de las herramientas m\u00e1s utilizadas en PHP.","title":"Herramientas"},{"location":"05herramientas.html#composer","text":"Logo Composer Herramienta por excelencia en PHP para la gesti\u00f3n de librer\u00edas y dependencias, de manera que instala y las actualiza asegurando que todo el equipo de desarrollo tiene el mismo entorno y versiones. Adem\u00e1s, ofrece autoloading de nuestro c\u00f3digo, de manera que no tengamos que hacerlo nosotros \"a mano\". Est\u00e1 escrito en PHP, y pod\u00e9is consultar toda su documentaci\u00f3n en https://getcomposer.org/ . Utiliza Packagist como repositorio de librer\u00edas. Funcionalmente, es similar a Maven (Java) / npm (JS).","title":"Composer"},{"location":"05herramientas.html#instalacion","text":"Si estamos usando XAMPP, hemos de instalar Composer en el propio sistema operativo. Se recomienda seguir las instrucciones oficiales seg\u00fan el sistema operativo a emplear. En cambio, si usamos Docker , necesitamos modificar la configuraci\u00f3n de nuestro contenedor. En nuestro caso, hemos decidido modificar el archivo Dockerfile y a\u00f1adir el siguiente comando: COPY --from = composer:2.0 /usr/bin/composer /usr/local/bin/composer Para facilitar el trabajo, hemos creado una plantilla ya preparada . Es importante que dentro del contenedor comprobemos que tenemos la v2: composer -V","title":"Instalaci\u00f3n"},{"location":"05herramientas.html#primeros-pasos","text":"Cuando creemos un proyecto por primera vez, hemos de inicializar el repositorio. Para ello, ejecutaremos el comando composer init donde: Configuramos el nombre del paquete, descripci\u00f3n, autor (nombre ), tipo de paquete (project), etc... Definimos las dependencias del proyecto ( require ) y las de desarrollo ( require-dev ) de manera interactiva. En las de desarrollo se indica aquellas que no se instalar\u00e1n en el entorno de producci\u00f3n, por ejemplo, las librer\u00edas de pruebas. Tras su configuraci\u00f3n, se crear\u00e1 autom\u00e1ticamente el archivo composer.json con los datos introducidos y descarga las librer\u00edas en la carpeta vendor . La instalaci\u00f3n de las librer\u00edas siempre se realiza de manera local para cada proyecto. { \"name\" : \"dwes/log\" , \"description\" : \"Pruebas con Monolog\" , \"type\" : \"project\" , \"require\" : { \"monolog/monolog\" : \"^2.1\" }, \"license\" : \"MIT\" , \"authors\" : [ { \"name\" : \"Aitor Medrano\" , \"email\" : \"a.medrano@edu.gva.es\" } ] } A la hora de indicar cada librer\u00eda introduciremos: el nombre de la librer\u00eda, compuesta tanto por el creador o \"vendor\", como por el nombre del proyecto. Ejemplos: monolog/monolog o laravel/installer . la versi\u00f3n de cada librer\u00eda. Tenemos diversas opciones para indicarla: Directamente: 1.4.2 Con comodines: 1.* A partir de: >= 2.0.3 Sin rotura de cambios: ^1.3.2 // >=1.3.2 <2.0.0","title":"Primeros pasos"},{"location":"05herramientas.html#actualizar-librerias","text":"Podemos definir las dependencias via el archivo composer.json o mediante comandos con el formato composer require vendor/package:version . Por ejemplo, si queremos a\u00f1adir phpUnit como librer\u00eda de desarrollo, haremos: composer require phpunit/phpunit \u2013dev Tras a\u00f1adir nuevas librer\u00edas, hemos de actualizar nuestro proyecto: composer update Si creamos el archivo composer.json nosotros directamente sin inicializar el repositorio, hemos de instalar las dependencias: composer install Al hacer este paso (tanto instalar como actualizar), como ya hemos comentado, se descargan las librer\u00edas en dentro de la carpeta vendor . Es muy importante a\u00f1adir esta carpeta al archivo .gitignore para no subirlas a GitHub. Adem\u00e1s se crea el archivo composer.lock , que almacena la versi\u00f3n exacta que se ha instalado de cada librer\u00eda (este archivo no se toca).","title":"Actualizar librer\u00edas"},{"location":"05herramientas.html#autoloadphp","text":"Composer crea de forma autom\u00e1tica en vendor/autoload.php el c\u00f3digo para incluir de forma autom\u00e1tica todas las librer\u00edas que tengamos configuradas en composer.json . Para utilizarlo, en la cabecera de nuestro archivos pondremos: <?php require 'vendor/autoload.php' ; En nuestro caso, de momento s\u00f3lo lo podremos en los archivos donde probamos las clases Si queremos que Composer tambi\u00e9n se encargue de cargar de forma autom\u00e1tica nuestras clases de dominio, dentro del archivo composer.json , definiremos la propiedad autoload : \"autoload\" : { \"psr-4\" : { \"Dwes\\\\\" : \"app/Dwes\" } }, Posteriormente, hemos de volver a generar el autoload de Composer mediante la opci\u00f3n dump-autoload (o du ): composer dump-autoload","title":"autoload.php"},{"location":"05herramientas.html#monolog","text":"Vamos a probar Composer a\u00f1adiendo la librer\u00eda de Monolog a nuestro proyecto. Se trata de un librer\u00eda para la gesti\u00f3n de logs de nuestras aplicaciones, soportando diferentes niveles (info, warning, etc...), salidas (ficheros, sockets, BBDD, Web Services, email, etc) y formatos (texto plano, HTML, JSON, etc...). Para ello, incluiremos la librer\u00eda en nuestro proyecto con: composer require monolog/monolog Monolog 2 requiere al menos PHP 7.2, cumple con el estandar de logging PSR-3, y es la librer\u00eda empleada por Laravel y Symfony para la gesti\u00f3n de logs. Cuando usar un log Seguir las acciones/movimientos de los usuarios Registrar las transacciones Rastrear los errores de usuario Fallos/avisos a nivel de sistema Interpretar y coleccionar datos para posterior investigaci\u00f3n de patrones","title":"Monolog"},{"location":"05herramientas.html#niveles","text":"A continuaci\u00f3n mostramos los diferentes niveles de menos a m\u00e1s restrictivo: debug -100 : Informaci\u00f3n detallada con prop\u00f3sitos de debug. No usar en entornos de producci\u00f3n. info - 200 : Eventos interesantes como el inicio de sesi\u00f3n de usuarios. notice - 250 : Eventos normales pero significativos. warning - 300 : Ocurrencias excepcionales que no llegan a ser error. error - 400 : Errores de ejecuci\u00f3n que permiten continuar con la ejecuci\u00f3n de la aplicaci\u00f3n pero que deben ser monitorizados. critical - 500 : Situaciones importantes donde se generan excepciones no esperadas o no hay disponible un componente. alert - 550 : Se deben tomar medidas inmediatamente. Ca\u00edda completa de la web, base de datos no disponible, etc... Adem\u00e1s, se suelen enviar mensajes por email. emergency - 600 : Es el error m\u00e1s grave e indica que todo el sistema est\u00e1 inutilizable.","title":"Niveles"},{"location":"05herramientas.html#hola-monolog","text":"Por ejemplo, en el archivo pruebaLog.php que colocar\u00edamos en el ra\u00edz, primero incluimos el autoload , importamos las clases a utilizar para finalmente usar los m\u00e9todos de Monolog : <?php include __DIR__ . \"/vendor/autoload.php\" ; use Monolog\\Logger ; use Monolog\\Handler\\StreamHandler ; $log = new Logger ( \"MiLogger\" ); $log -> pushHandler ( new StreamHandler ( \"logs/milog.log\" , Logger :: DEBUG )); $log -> debug ( \"Esto es un mensaje de DEBUG\" ); $log -> info ( \"Esto es un mensaje de INFO\" ); $log -> warning ( \"Esto es un mensaje de WARNING\" ); $log -> error ( \"Esto es un mensaje de ERROR\" ); $log -> critical ( \"Esto es un mensaje de CRITICAL\" ); $log -> alert ( \"Esto es un mensaje de ALERT\" ); En todos los m\u00e9todos de registro de mensajes ( debug , info , ...), adem\u00e1s del propio mensaje, le podemos pasar informaci\u00f3n como el contenido de alguna variable, usuario de la aplicaci\u00f3n, etc.. como segundo par\u00e1metro dentro de un array, el cual se conoce como array de contexto . Es conveniente hacerlo mediante un array asociativo para facilitar la lectura del log. <?php $log -> warning ( \"Producto no encontrado\" , [ $producto ]); $log -> warning ( \"Producto no encontrado\" , [ \"datos\" => $producto ]);","title":"Hola Monolog"},{"location":"05herramientas.html#funcionamiento","text":"Cada instancia Logger tiene un nombre de canal y una pila de manejadores ( handler ). Cada mensaje que mandamos al log atraviesa la pila de manejadores, y cada uno decide si debe registrar la informaci\u00f3n, y si se da el caso, finalizar la propagaci\u00f3n. Por ejemplo, un StreamHandler en el fondo de la pila que lo escriba todo en disco, y en el tope a\u00f1ade un MailHandler que env\u00ede un mail s\u00f3lo cuando haya un error.","title":"Funcionamiento"},{"location":"05herramientas.html#manejadores","text":"Cada manejador tambien tiene un formateador ( Formatter ). Si no se indica ninguno, se le asigna uno por defecto. El \u00faltimo manejador insertado ser\u00e1 el primero en ejecutarse. Luego se van ejecutando conforme a la pila. Los manejadores m\u00e1s utilizados son: StreamHandler(ruta, nivel) RotatingFileHandler(ruta, maxFiles, nivel) NativeMailerHandler(para, asunto, desde, nivel) FirePHPHandler(nivel) Si queremos que los mensajes de la aplicaci\u00f3n salgan por el log del servidor, en nuestro caso el archivo error.log de Apache utilizaremos como ruta la salida de error: <?php // error.log $log -> pushHandler ( new StreamHandler ( \"php://stderr\" , Logger :: DEBUG )); FirePHP Por ejemplo, mediante FirePHPHandler , podemos utilizar FirePHP , la cual es una herramienta para hacer debug en la consola de Firefox . Tras instalar la extensi\u00f3n en Firefox, habilitar las opciones y configurar el Handler , podemos ver los mensajes coloreados con sus datos: <?php $log = new Logger ( \"MiFirePHPLogger\" ); $log -> pushHandler ( new FirePHPHandler ( Logger :: INFO )); $datos = [ \"real\" => \"Bruce Wayne\" , \"personaje\" => \"Batman\" ]; $log -> debug ( \"Esto es un mensaje de DEBUG\" , $datos ); $log -> info ( \"Esto es un mensaje de INFO\" , $datos ); $log -> warning ( \"Esto es un mensaje de WARNING\" , $datos ); // ... Ejemplo de uso de FirePHP","title":"Manejadores"},{"location":"05herramientas.html#canales","text":"Se les asigna al crear el Logger . En grandes aplicaciones, se crea un canal por cada subsistema: ventas, contabilidad, almac\u00e9n. No es una buena pr\u00e1ctica usar el nombre de la clase como canal, esto se hace con un procesador . Para su uso, es recomiendo asignar el log a una propiedad privada a Logger, y posteriormente, en el constructor de la clase, asignar el canal, manejadores y formato. <?php $this -> log = new Logger ( \"MiApp\" ); $this -> log -> pushHandler ( new StreamHandler ( \"logs/milog.log\" , Logger :: DEBUG )); $this -> log -> pushHandler ( new FirePHPHandler ( Logger :: DEBUG )); Y dentro de los m\u00e9todos para escribir en el log: <?php $this -> log -> warning ( \"Producto no encontrado\" , [ $producto ]);","title":"Canales"},{"location":"05herramientas.html#procesadores","text":"Los procesadores permiten a\u00f1adir informaci\u00f3n a los mensajes. Para ello, se apilan despu\u00e9s de cada manejador mediante el m\u00e9todo pushProcessor($procesador) . Algunos procesadores conocidos son IntrospectionProcessor (muestran la linea, fichero, clase y metodo desde el que se invoca el log), WebProcessor (a\u00f1ade la URI, m\u00e9todo e IP) o GitProcessor (a\u00f1ade la rama y el commit). PHP Consola en formato texto <?php $log = new Logger ( \"MiLogger\" ); $log -> pushHandler ( new RotatingFileHandler ( \"logs/milog.log\" , 0 , Logger :: DEBUG )); $log -> pushProcessor ( new IntrospectionProcessor ()); $log -> pushHandler ( new StreamHandler ( \"php://stderr\" , Logger :: WARNING )); // no usa Introspection pq lo hemos apilado despu\u00e9s, le asigno otro $log -> pushProcessor ( new WebProcessor ()); [2020-11-26T13:35:31.076138+01:00] MiLogger.DEBUG: Esto es un mensaje de DEBUG [] {\"file\":\"C:\\\\xampp\\\\htdocs\\\\log\\\\procesador.php\",\"line\":12,\"class\":null,\"function\":null} [2020-11-26T13:35:31.078344+01:00] MiLogger.INFO: Esto es un mensaje de INFO [] {\"file\":\"C:\\\\xampp\\\\htdocs\\\\log\\\\procesador.php\",\"line\":13,\"class\":null,\"function\":null}","title":"Procesadores"},{"location":"05herramientas.html#formateadores","text":"Se asocian a los manejadores con setFormatter . Los formateadores m\u00e1s utilizados son LineFormatter , HtmlFormatter o JsonFormatter . PHP Consola en JSON <?php $log = new Logger ( \"MiLogger\" ); $rfh = new RotatingFileHandler ( \"logs/milog.log\" , Logger :: DEBUG ); $rfh -> setFormatter ( new JsonFormatter ()); $log -> pushHandler ( $rfh ); { \"message\" : \"Esto es un mensaje de DEBUG\" , \"context\" :{}, \"level\" : 100 , \"level_name\" : \"DEBUG\" , \"channel\" : \"MiLogger\" , \"datetime\" : \"2020-11-27T15:36:52.747211+01:00\" , \"extra\" :{}} { \"message\" : \"Esto es un mensaje de INFO\" , \"context\" :{}, \"level\" : 200 , \"level_name\" : \"INFO\" , \"channel\" : \"MiLogger\" , \"datetime\" : \"2020-11-27T15:36:52.747538+01:00\" , \"extra\" :{}} M\u00e1s informaci\u00f3n M\u00e1s informaci\u00f3n sobre manejadores, formateadores y procesadores en https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md","title":"Formateadores"},{"location":"05herramientas.html#uso-de-factorias","text":"En vez de instanciar un log en cada clase, es conveniente crear una factor\u00eda (por ejemplo, siguiendo la idea del patr\u00f3n de dise\u00f1o Factory Method ). Para el siguiente ejemplo, vamos a suponer que creamos la factor\u00eda en el namespace Dwes\\Ejemplos\\Util . <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Logger ; use Monolog\\Handler\\StreamHandler ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : Logger { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"logs/miApp.log\" , Logger :: DEBUG )); return $log ; } } Si en vez de devolver un Monolog\\Logger utilizamos el interfaz de PSR, si en el futuro cambiamos la implementaci\u00f3n del log, no tendremos que modificar nuestro codigo. As\u00ed pues, la factor\u00eda ahora devolver\u00e1 Psr\\Log\\LoggerInterface : <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Handler\\StreamHandler ; use Monolog\\Logger ; use Psr\\Log\\LoggerInterface ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : LoggerInterface { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"log/miApp.log\" , Logger :: DEBUG )); return $log ; } } Finalmente, para utilizar la factor\u00eda, s\u00f3lo cambiamos el c\u00f3digo que ten\u00edamos en el constructor de las clases que usan el log, quedando algo asi: <?php namespace Dwes\\Ejemplos\\Model ; use Dwes\\Ejemplos\\Util\\LogFactory ; use Monolog\\Logger ; class Cliente { private $codigo ; private Logger $log ; function __construct ( $codigo ){ $this -> codigo = $codigo ; $this -> log = LogFactory :: getLogger (); } /// ... resto del c\u00f3digo }","title":"Uso de Factor\u00edas"},{"location":"05herramientas.html#documentacion-con-phpdocumentor","text":"phpDocumentor es la herramienta de facto para documentar el c\u00f3digo PHP. Es similar en prop\u00f3sito y funcionamiento a Javadoc . As\u00ed pues, es un herramienta que facilita la documentaci\u00f3n del c\u00f3digo PHP, creando un sitio web con el API de la aplicaci\u00f3n. Se basa en el uso de anotaciones sobre los docblocks. Para ponerlo en marcha, en nuestro caso nos decantaremos por utilizar la imagen que ya existe de Docker.","title":"Documentaci\u00f3n con phpDocumentor"},{"location":"05herramientas.html#instalacion-como-binario","text":"Otra opci\u00f3n es seguir los pasos que recomienda la documentaci\u00f3n oficial para instalarlo como un ejecutable, que son descargar el archivo phpDocumentor.phar y darles permisos de ejecuci\u00f3n: wget https://phpdoc.org/phpDocumentor.phar chmod +x phpDocumentor.phar mv phpDocumentor.phar /usr/local/bin/phpdoc phpdoc --version Una vez instalado, desde el ra\u00edz del proyecto, suponiendo que tenemos nuestro c\u00f3digo dentro de app y que queremos la documentaci\u00f3n dentro de docs/api ejecutamos: phpdoc -d ./app -t docs/api","title":"Instalaci\u00f3n como binario"},{"location":"05herramientas.html#uso-en-docker","text":"En el caso de usar Docker , usaremos el siguiente comando para ejecutarlo (crea el contenedor, ejecuta el comando que le pidamos, y autom\u00e1ticamente lo borra): docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 A dicho comando, le adjuntaremos los diferentes par\u00e1metros que admite phpDocumentor, por ejemplo: # Muestra la versi\u00f3n docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 --version # Mediante -d se indica el origen a parsear # Mediante -t se indica el destino donde generar la documentaci\u00f3n docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 -d ./src/app -t ./docs/api","title":"Uso en Docker"},{"location":"05herramientas.html#docblock","text":"Un docblock es el bloque de c\u00f3digo que se coloca encima de un recurso. Su formato es: <?php /** * *Sumario*, una sola l\u00ednea * * *Descripci\u00f3n* que puede utilizar varias l\u00edneas * y que ofrece detalles del elemento o referencias * para ampliar la informaci\u00f3n * * @param string $miArgumento con una *descripci\u00f3n* del argumento * que puede usar varias l\u00edneas. * * @return void */ function miFuncion ( tipo $miArgumento ) { }","title":"DocBlock"},{"location":"05herramientas.html#documentando-el-codigo","text":"En todos los elementos, ademas del sumario y/o descripci\u00f3n, pondremos: En las clases: @author nombre @package ruta del namespace En las propiedades: @var tipo descripci\u00f3n En los m\u00e9todos: @param tipo $nombre descripci\u00f3n @throws ClaseException descripci\u00f3n @return tipo descripci\u00f3n Ve\u00e1moslo con un ejemplo. Supongamos que tenemos una clase que representa un cliente: <?php /** * Clase que representa un cliente * * El cliente se encarga de almacenar los soportes que tiene alquilado, * de manera que podemos alquilar y devolver productos mediante las operaciones * hom\u00f3nimas. * * @package Dwes\\Videoclub\\Model * @author Aitor Medrano <a.medrano@edu.gva.es> */ class Cliente { public string $nombre ; private string $numero ; /** * Colecci\u00f3n de soportes alquilados * @var array<Soporte> */ private $soportesAlquilados []; /** * Comprueba si el soporte recibido ya lo tiene alquilado el cliente * @param Soporte $soporte Soporte a comprobar * @return bool true si lo tiene alquilado */ public function tieneAlquilado ( Soporte $soporte ) : bool { // ... } Si generamos la documentaci\u00f3n y abrimos con un navegador el archivo docs/api/index.html podremos navegar hasta la clase `Cliente: phpDocumentor de Cliente","title":"Documentando el c\u00f3digo"},{"location":"05herramientas.html#web-scraping","text":"Consiste en navegar a una p\u00e1gina web y extraer informaci\u00f3n autom\u00e1ticamente, a partir del c\u00f3digo HTML generado, y organizar la informaci\u00f3n p\u00fablica disponible en Internet. Esta pr\u00e1ctica requiere el uso de una librer\u00eda que facilite la descarga de la informaci\u00f3n deseada imitando la interacci\u00f3n de un navegador web. Este \"robot\" puede acceder a varias p\u00e1ginas simult\u00e1neamente. \u00bfEs legal? Si el sitio web indica que tiene el contenido protegido por derechos de autor o en las normas de acceso via usuario/contrase\u00f1a nos avisa de su prohibici\u00f3n, estar\u00edamos incurriendo en un delito. Es recomendable estudiar el archivo robots.txt que se encuentra en el ra\u00edz de cada sitio web. M\u00e1s informaci\u00f3n en el art\u00edculo El manual completo para el web scraping legal y \u00e9tico en 2021","title":"Web Scraping"},{"location":"05herramientas.html#goutte","text":"Goutte es un sencillo cliente HTTP para PHP creado espec\u00edficamente para hacer web scraping. Lo desarroll\u00f3 el mismo autor del framework Symfony y ofrece un API sencilla para extraer datos de las respuestas HTML/XML de los sitios web. FIXME: Revisar https://godofredo.ninja/web-scraping-con-php-utilizando-goutte/ Los componentes principales que abstrae Goutte sobre Symfony son: BrowserKit : simula el comportamiento de un navegador web. CssSelector : traduce consultas CSS en consultas XPath. DomCrawler : facilita el uso del DOM y XPath. Para poder utilizar Goutte en nuestro proyecto, ejecutaremos el siguiente comando en el terminal: composer require fabpot/goutte","title":"Goutte"},{"location":"05herramientas.html#goutte-con-selectores-css","text":"A continuaci\u00f3n vamos a hacer un ejemplo muy sencillo utilizando los selectores CSS, extrayendo informaci\u00f3n de la web https://books.toscrape.com/ , la cual es una p\u00e1gina para pruebas que no rechazar\u00e1 nuestras peticiones. Tras crear un cliente con Goutte , hemos de realizar un petici\u00f3n a una URL. Con la respuesta obtenida, podemos utilizar el m\u00e9todo filter para indicarle la ruta CSS que queremos recorrer e iterar sobre los resultados mediante una funci\u00f3n an\u00f3nima. Una vez estamos dentro de un determinado nodo, el m\u00e9todo text() nos devolver\u00e1 el contenido del propio nodo. En concreto, vamos a meter en un array asociativo el t\u00edtulo y el precio de todos los libros de la categor\u00eda Classics . <?php require '../vendor/autoload.php' ; $httpClient = new \\Goutte\\Client (); $response = $httpClient -> request ( 'GET' , 'https://books.toscrape.com/catalogue/category/books/classics_6/index.html' ); // colocamos los precios en un array $precios = []; $response -> filter ( '.row li article div.product_price p.price_color' ) -> each ( // le pasamos $precios por referencia para poder editarla dentro del closure function ( $node ) use ( & $precios ) { $precios [] = $node -> text (); } ); // colocamos el nombre y el precio en un array asociativo $contadorPrecios = 0 ; $libros = []; $response -> filter ( '.row li article h3 a' ) -> each ( function ( $node ) use ( $precios , & $contadorPrecios , & $libros ) { $libros [ $node -> text ()] = $precios [ $contadorPrecios ]; $contadorPrecios ++ ; } );","title":"Goutte con selectores CSS"},{"location":"05herramientas.html#crawler","text":"Un caso muy com\u00fan es obtener la informaci\u00f3n de una p\u00e1gina que tiene los resultados paginados, de manera que vayamos recorriendo los enlaces y accediendo a cada uno de los resultados. En este caso vamos a coger todos los precios de los libros de fantas\u00eda, y vamos a sumarlos: <?php require '../vendor/autoload.php' ; use Goutte\\Client ; use Symfony\\Component\\HttpClient\\HttpClient ; $client = new Client ( HttpClient :: create ([ 'timeout' => 60 ])); $crawler = $client -> request ( 'GET' , 'https://books.toscrape.com/catalogue/category/books/fantasy_19/index.html' ); $salir = false ; $precios = []; while ( ! $salir ) { $crawler -> filter ( '.row li article div.product_price p.price_color' ) -> each ( function ( $node ) use ( & $precios ) { $texto = $node -> text (); $cantidad = substr ( $texto , 2 ); // Le quitamos las libras \u00bf2 posiciones? $precios [] = floatval ( $cantidad ); } ); $enlace = $crawler -> selectLink ( 'next' ); if ( $enlace -> count () != 0 ) { // el enlace next existe $sigPag = $crawler -> selectLink ( 'next' ) -> link (); $crawler = $client -> click ( $sigPag ); // hacemos click } else { // ya no hay enlace next $salir = true ; } } $precioTotal = array_sum ( $precios ); echo $precioTotal ;","title":"Crawler"},{"location":"05herramientas.html#pruebas-con-phpunit","text":"El curso pasado, dentro del m\u00f3dulo de Entornos de Desarrollo , estudiamos la importancia de la realizaci\u00f3n de pruebas, as\u00ed como las pruebas unitarias mediante JUnit . Test Driven Development A d\u00eda de hoy es de gran importancia seguir una buena metodolog\u00eda de pruebas, siendo el desarrollo dirigido por las pruebas ( Test Driven Development / TDD) uno de los enfoques m\u00e1s empleados, el cual consiste en: Escribir el test, y como no hay c\u00f3digo implementado, la prueba falle (rojo). Escribir el c\u00f3digo de aplicaci\u00f3n para que la prueba funcione (verde). Refactorizar el c\u00f3digo de la aplicaci\u00f3n con la ayuda de la prueba para comprobar que no rompemos nada (refactor). En el caso de PHP, la herramienta que se utiliza es PHPUnit ( https://phpunit.de/ ), que como su nombre indica, est\u00e1 basada en JUnit. La versi\u00f3n actual es la 9.0 Se recomienda consultar su documentaci\u00f3n en https://phpunit.readthedocs.io/es/latest/index.html .","title":"Pruebas con PHPUnit"},{"location":"05herramientas.html#puesta-en-marcha","text":"Vamos a colocar todas las pruebas en una carpeta tests en el ra\u00edz de nuestro proyecto. En el archivo composer.json , a\u00f1adimos: \"require-dev\" : { \"phpunit/phpunit\" : \"^9\" }, \"scripts\" : { \"test\" : \"phpunit --testdox --colors tests\" } Si quisi\u00e9ramos a\u00f1adir la librer\u00eda desde un comando del terminal, tambi\u00e9n podr\u00edamos ejecutar: composer require --dev phpunit/phpunit ^9 Librer\u00edas de desarrollo Las librer\u00edas que se colocan en require-dev son las de desarrollo y testing , de manera que no se instalar\u00e1n en un entorno de producci\u00f3n. Como hemos creado un script , podemos lanzar las pruebas mediante: composer test Vasmos a realizar nuestra primera prueba: <?php use PHPUnit\\Framework\\TestCase ; class PilaTest extends TestCase { public function testPushAndPop () { $pila = []; $this -> assertSame ( 0 , count ( $pila )); array_push ( $pila , 'batman' ); $this -> assertSame ( 'batman' , $pila [ count ( $pila ) - 1 ]); $this -> assertSame ( 1 , count ( $pila )); $this -> assertSame ( 'batman' , array_pop ( $pila )); $this -> assertSame ( 0 , count ( $pila )); } } Tenemos diferentes formas de ejecutar una prueba: ./vendor/bin/phpunit tests/PilaTest.php ./vendor/bin/phpunit tests ./vendor/bin/phpunit --testdox tests ./vendor/bin/phpunit --testdox --colors tests","title":"Puesta en marcha"},{"location":"05herramientas.html#disenando-pruebas","text":"Tal como hemos visto en el ejemplo, la clase de prueba debe heredar de TestCase , y el nombre de la clase debe acabar en Test , de ah\u00ed que hayamos llamado la clase de prueba como PilaTest . Una prueba implica un m\u00e9todo de prueba (p\u00fablico) por cada funcionalidad a probar. Cada un de los m\u00e9todos se les asocia un caso de prueba. Los m\u00e9todos deben nombrarse con el prefijo test , por ejemplo, testPushAndPop . Es muy importante que el nombre sea muy claro y descriptivo del prop\u00f3sito de la prueba. ( camelCase ). En los casos de prueba prepararemos varias aserciones para toda la casu\u00edstica: rangos de valores, tipos de datos, excepciones, etc...","title":"Dise\u00f1ando pruebas"},{"location":"05herramientas.html#aserciones","text":"Las aserciones permiten comprobar el resultado de los m\u00e9todos que queremos probar. Las aserciones esperan que el predicado siempre sea verdadero. PHPUnit ofrece las siguiente aserciones: assertTrue / assertFalse : Comprueba que la condici\u00f3n dada sea evaluada como true / false assertEquals / assertSame : Comprueba que dos variables sean iguales assertNotEquals / assertNotSame : Comprueba que dos variables NO sean iguales Same \u2192 comprueba los tipos. Si no coinciden los tipos y los valores, la aserci\u00f3n fallar\u00e1 Equals \u2192 sin comprobaci\u00f3n estricta assertArrayHasKey / assertArrayNotHasKey : Comprueba que un array posea un key determinado / o NO lo posea assertArraySubset : Comprueba que un array posea otro array como subset del mismo assertAttributeContains / assertAttributeNotContains : Comprueba que un atributo de una clase contenga una variable determinada / o NO contenga una variable determinada assertAttributeEquals : Comprueba que un atributo de una clase sea igual a una variable determinada.","title":"Aserciones"},{"location":"05herramientas.html#comparando-la-salida","text":"Si los m\u00e9todos a probar generan contenido mediante echo o una instrucci\u00f3n similar, disponemos de las siguiente expectativas: expectOutputString(salidaEsperada) expectOutputRegex(expresionRegularEsperada) Las expectativas difieren de las aserciones que informan del resultado que se espera antes de invocar al m\u00e9todo. Tras definir la expectativa, se invoca al m\u00e9todo que realiza el echo / print . <?php namespace Dwes\\Videoclub\\Model ; use PHPUnit\\Framework\\TestCase ; use Dwes\\Videoclub\\Model\\CintaVideo ; class CintaVideoTest extends TestCase { public function testConstructor () { $cinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $this -> assertSame ( $cinta -> getNumero (), 23 ); } public function testMuestraResumen () { $cinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $resultado = \"<br>Pel\u00edcula en VHS:\" ; $resultado .= \"<br>Los cazafantasmas<br>3.5 (IVA no incluido)\" ; $resultado .= \"<br>Duraci\u00f3n: 107 minutos\" ; // definimos la expectativa $this -> expectOutputString ( $resultado ); // invocamos al m\u00e9todo que har\u00e1 echo $cinta -> muestraResumen (); } }","title":"Comparando la salida"},{"location":"05herramientas.html#proveedores-de-datos","text":"Cuando tenemos pruebas que solo cambian respecto a los datos de entrada y de salida, es \u00fatil utilizar proveedores de datos. Se declaran en el docblock mediante @dataProvider nombreMetodo , donde se indica el nombre de un m\u00e9todo p\u00fablico que devuelve un array de arrays, donde cada elemento es un caso de prueba. La clase de prueba recibe como par\u00e1metros los datos a probar y el resultado de la prueba como \u00faltimo par\u00e1metro. El siguiente ejemplo comprueba con diferentes datos el funcionamiento de muestraResumen : <?php /** * @dataProvider cintasProvider */ public function testMuestraResumenConProvider ( $titulo , $id , $precio , $duracion , $esperado ) { $cinta = new CintaVideo ( $titulo , $id , $precio , $duracion ); $this -> expectOutputString ( $esperado ); $cinta -> muestraResumen (); } public function cintasProvider () { return [ \"cazafantasmas\" => [ \"Los cazafantasmas\" , 23 , 3.5 , 107 , \"<br>Pel\u00edcula en VHS:<br>Los cazafantasmas<br>3.5 \u20ac(IVA no incluido)<br>Duraci\u00f3n: 107 minutos\" ], \"superman\" => [ \"Superman\" , 24 , 3 , 188 , \"<br>Pel\u00edcula en VHS:<br>Superman<br>3 \u20ac (IVA no incluido)<br>Duraci\u00f3n: 188 minutos\" ], ]; }","title":"Proveedores de datos"},{"location":"05herramientas.html#probando-excepciones","text":"Las pruebas adem\u00e1s de comprobar que las clases funcionan como se espera, han de cubrir todos los casos posibles. As\u00ed pues, debemos poder hacer pruebas que esperen que se lance una excepci\u00f3n (y que el mensaje contenga cierta informaci\u00f3n): Para ello, se utilizan las siguiente expectativas: expectException(Excepcion::class) expectExceptionCode(codigoExcepcion) expectExceptionMessage(mensaje) Del mismo modo que antes, primero se pone la expectativa, y luego se provoca que se lance la excepci\u00f3n: <?php public function testAlquilarCupoLleno () { $soporte1 = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $soporte2 = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); $soporte3 = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); $soporte4 = new Dvd ( \"El Imperio Contraataca\" , 4 , 3 , \"es,en\" , \"16:9\" ); $cliente1 = new Cliente ( \"Bruce Wayne\" , 23 ); $cliente1 -> alquilar ( $soporte1 ); $cliente1 -> alquilar ( $soporte2 ); $cliente1 -> alquilar ( $soporte3 ); $this -> expectException ( CupoSuperadoException :: class ); $cliente1 -> alquilar ( $soporte4 ); }","title":"Probando excepciones"},{"location":"05herramientas.html#cobertura-de-codigo","text":"La cobertura de pruebas indica la cantidad de c\u00f3digo que las pruebas cubren, siendo recomendable que cubran entre el 95 y el 100%. Una de las m\u00e9tricas asociadas a los informes de cobertura es el CRAP (An\u00e1lisis y Predicciones sobre el Riesgo en Cambios), el cual mide la cantidad de esfuerzo, dolor y tiempo requerido para mantener una porci\u00f3n de c\u00f3digo. Esta m\u00e9trica debe mantenerse con un valor inferior a 5. Requisito xdebug Aunque ya viene instalado dentro de PHPUnit, para que funcione la cobertura del c\u00f3digo, es necesario que el c\u00f3digo PHP se ejecute con XDEBUG, y e indicarle a Apache que as\u00ed es (colocando en el archivo de configuraci\u00f3n php.ini la directiva xdebug.mode=coverage ). A\u00f1adimos en composer.json un nuevo script : \"coverage\" : \"phpunit --coverage-html coverage --coverage-filter app tests\" Y posteriormente ejecutamos composer coverage Por ejemplo, si accedemos a la clase CintaVideo con la prueba que hab\u00edamos realizado anteriormente, podemos observar la cobertura que tiene al 100% y que su CRAP es 2. Informe de cobertura de la clase CintaVideo Temas pendientes Dependencia entre casos de prueba con el atributo @depends Completamente configurable mediante el archivo phpxml.xml : https://phpunit.readthedocs.io/es/latest/configuration.html Preparando las pruebas con setUpBeforeClass() y tearDownAfterClass() Objetos y pruebas Mock (dobles) con createMock()","title":"Cobertura de c\u00f3digo"},{"location":"05herramientas.html#referencias","text":"Tutorial de Composer Web Scraping with PHP \u2013 How to Crawl Web Pages Using Open Source Tools PHP Monolog Unit Testing con PHPUnit \u2014 Parte 1 , de Emiliano Zublena.","title":"Referencias"},{"location":"05herramientas.html#actividades","text":"","title":"Actividades"},{"location":"05herramientas.html#monolog_1","text":"Crea un nuevo proyecto con Composer llamado Monologos : Incluye como librer\u00eda la \u00faltima versi\u00f3n de Monolog. Crea la clase Dwes\\Monologos\\HolaMonolog . Define una propiedad privada nombrada miLog para guardar el log. Define en el constructor un RotatingFileHandler que escriba en la carpeta logs del proyecto, y que almacene los mensajes a partir de debug . Crea los m\u00e9todos saludar y despedir que hagan un log de tipo info con la acci\u00f3n correspondiente. Siguiendo con el proyecto Monologos : Crea un archivo llamado inicio.php que permita probar HolaMonolog . Comprueba que los mensajes aparecen en el log . Cambia el nivel para que el manejador solo muestre los mensajes a partir de warning . Vuelve a ejectuar inicio.php y comprueba el archivo de log. Modifica la clase HolaMonolog : En el constructor, a\u00f1ade a la pila un manejador que escriba a la salida de error conjunto al procesador de introspecci\u00f3n, mostrando mensajes desde el nivel debug . A\u00f1ade una propiedad denominada hora , la cual se inicializa \u00fanicamente como par\u00e1metro del constructor. Si la hora es inferior a 0 o mayor de 24, debe escribir un log de warning con un mensaje apropiado. Modifica los m\u00e9todos saludar y despedir para hacerlo acorde a la propiedad hora (buenos d\u00edas, buenas tardes, hasta ma\u00f1ana, etc...)","title":"Monolog"},{"location":"05herramientas.html#proyecto-videoclub-iv","text":"Como ya tenemos Composer instalado: Inicial\u00edzalo dentro de tu proyecto Videoclub Incluye Monolog y PhpUnit , cada una en su lugar adecuado. A\u00f1ade el autoload al archivo composer.json , y haz los cambios necesarios en las clases para utilizar el autoload de Composer . Sube los cambios a GitHub y crea la etiqueta v0.511 . Modifica la clase Cliente para introducir un Logger de Monolog . A\u00f1ade el log como una propiedad de la clase e inicial\u00edzalo en el constructor, con el nombre del canal VideoclubLogger . Se debe almacenar en logs/videoclub.log mostrando todos los mensajes desde debug . Antes de lanzar cualquier excepci\u00f3n, debe escribir un log de tipo warning . Sustituir los echo que haya en el c\u00f3digo, que ahora pasar\u00e1n por el log con el nivel info, a excepci\u00f3n del m\u00e9todo muestraResumen que seguir\u00e1 haciendo echo . Vuelve a hacer lo mismo que en el ejercicio anterior, pero ahora con la clase Videoclub . Adem\u00e1s: Siempre que se llame a un m\u00e9todo del log, se le pasar\u00e1 como segundo par\u00e1metro la informaci\u00f3n que dispongamos. Ejecuta el archivo de prueba y comprueba que el log se rellena correctamente. Vamos a refactorizar el c\u00f3digo com\u00fan de inicializaci\u00f3n de Monolog que tenemos repetidos en los constructores a una factor\u00eda de Monolog , la cual colocaremos en \\Dwes\\Videoclub\\Util\\LogFactory . Comprueba que sigue funcionando correctamente. Modifica la factor\u00eda para que devuelva LogInterface y comprueba que sigue funcionando. Sube los cambios a GitHub con la etiqueta v0.515 .","title":"Proyecto Videoclub IV"},{"location":"05herramientas.html#phpdocumentor","text":"Comprueba que en el contenedor de Docker funciona phpDocumentor . Ejecuta phpdoc sobre tu proyecto Monolog y comprueba el api que se crea. Comenta tanto la clase como los m\u00e9todos, y posteriormente, vuelve a ejecutar phpdoc. Documenta el proyecto Videoclub , y genera la documentaci\u00f3n. Empieza por las clases de Soporte y sus hijos. Comprueba el resultado. Luego sigue con Cliente y finalmente Videoclub .","title":"phpDocumentor"},{"location":"05herramientas.html#web-scraping_1","text":"A partir de los datos de http://www.seleccionbaloncesto.es , calcula la altura y edad media del equipo de baloncesto masculino. Observa que tienes los datos dentro de una tabla debajo de las noticias. Volviendo al Videoclub, en Soporte a\u00f1ade una propiedad llamada metacritic para almacenar la URL de cada soporte. A continuaci\u00f3n, modifica los m\u00e9todos incluirXXX de Videoclub para que admitan como primer par\u00e1metro dicha URL. Tras ello, modifica el fichero inicio3.php para pasarle la URL de cada soporte (para ello deber\u00e1s consultarlos en Metacritic haciendo b\u00fasquedas manuales). Por ejemplo, en el caso de la pel\u00edcula Cazafantasmas, su URL es https://www.metacritic.com/movie/ghostbusters . Finalmente, a\u00f1ade un m\u00e9todo abstracto en Soporte llamado getPuntuacion , que haciendo uso de Web Scraping se conecte a Metacritic y obtenga su puntuaci\u00f3n. Modifica inicio3.php para obtener todos los alquileres de un cliente mediante getAlquileres() : array , y para cada uno de ellos, adem\u00e1s del t\u00edtulo, muestra su puntuaci\u00f3n.","title":"Web Scraping"},{"location":"05herramientas.html#phpunit","text":"A partir de la clase HolaMonolog , modifica los m\u00e9todos para que adem\u00e1s de escribir en en log, devuelvan el saludo como una cadena. Crea la clase HolaMonologTest y a\u00f1ade diferentes casos de prueba para comprobar que los saludos y despedidas son acordes a la hora con la que se crea la clase. Vamos a simular Test Driven Development . Queremos que nuestra aplicaci\u00f3n almacene los \u00faltimos tres saludos que ha realizado. Para ello: Crea las prueba necesarias (invoca al m\u00e9todo saludar varias veces y llama al m\u00e9todo que te devuelva los saludos almacenados) Implementa el c\u00f3digo para pasar las pruebas Refactoriza el c\u00f3digo Crea una nueva prueba que utilice proveedores de datos para comprobar esta \u00faltima funcionalidad, pas\u00e1ndole: Un saludo. Tres saludos. Cuatro saludos. \u00bfRecuerdas que si la hora es negativa o superior a 24 escrib\u00edamos en el log un warning ? Ahora debe lanzar una excepci\u00f3n de tipo InvalidArgumentException (como la excepci\u00f3n forma para de PHP, hay que poner su FQN: \\InvalidArgumentException ). Vuelve a aplicar TDD y completa tus casos de prueba. Comenta la \u00faltima prueba realizada (la comprobaci\u00f3n de las excepciones) y realiza un informe de cobertura de pruebas. Analiza los resultados obtenidos. Elimina los \u00faltimos comentarios sobre la \u00faltima prueba y vuelve a generar y analizar el informe de cobertura.","title":"phpUnit"},{"location":"05herramientas.html#proyecto-videoclub-v","text":"El objetivo de los siguientes ejercicios es conseguir de manera incremental una cobertura de pruebas superior al 95%. Crea pruebas dentro de la carpeta tests para las clases Soporte , CintaVideo , Dvd y Juego . Recuerda respetar el espacio de nombres. Los m\u00e9todos muestraResumen , tras hacer echo de los mensajes, deben devolver una cadena con el propio mensaje. Crea pruebas para la clase Cliente , aprovechando todo el c\u00f3digo que ten\u00edamos para comprobar la funcionalidad. Utiliza proveedores de datos para a\u00f1adir conjuntos de datos mayores que los empleados. Comprueba que funciona con diferentes cupos, que al intentar alquilar un soporte marcado como ya alquilado debe lanzar una excepci\u00f3n, que no coincidan los ids de los soportes, etc... Crea las pruebas para la clase Videoclub . Ten en cuenta los \u00faltimos m\u00e9todos a\u00f1adidos que permit\u00edan alquilar y devolver soportes, tanto de manera individual como mediante un array. Crea el informe de cobertura. Una vez creado, analiza los datos de cobertura (>= 90%) y comprueba el valor de CRAP, de manera que siempre sea <= 5. En caso de no cumplirse, crea nuevos casos de prueba y/o refactoriza el c\u00f3digo de tu aplicaci\u00f3n. Sube los cambios a GitHub con la etiqueta v0.554 .","title":"Proyecto Videoclub V"},{"location":"05herramientas.html#ampliacion","text":"Queremos que en Videoclub , cuando un cliente no existe (tanto al alquilar como al devolver) se lance una nueva excepci\u00f3n: ClienteNoExisteException . Adem\u00e1s, dado el n\u00famero creciente de excepciones, queremos mover las excepciones al namespace Dwes\\Videoclub\\Exception . Siguiendo TDD, primero crea las pruebas, y luego modifica el c\u00f3digo de aplicaci\u00f3n. Vuelve a generar el informe de cobertura y comprueba la calidad de nuestras pruebas. \u00bfNadie se ha dado cuenta que en los Dvd no estamos almacenando su duraci\u00f3n? Haz todos los cambios necesarios, primero en las pruebas y luego en el c\u00f3digo. Tras a\u00f1os luchando contra la tecnolog\u00eda, decidimos introducir los Blu-ray en nuestra empresa. Hemos decido que Bluray herede de Soporte . Adem\u00e1s del t\u00edtulo y la duracion , nos interesa almacenar si es4k . Haz todos los cambios necesarios, primero en las pruebas y luego en el c\u00f3digo. Sube los cambios a GitHub con la etiqueta v0.563 .","title":"Ampliaci\u00f3n"},{"location":"06accesoDatos.html","text":"img { margin: 20px 0; border-radius: 8px; } .alert { color: #BD1550; } .warning { color: #E97F02; } .success { color: #8A9B0F; } .center { text-align: center; } .right { text-align: right; } .img-small { max-width: 200px; margin: auto; } .img-medium { max-width: 400px; margin: auto; } .img-large { max-width: 800px; margin: auto; } .leyenda { font-size: small; margin: 10px 0; } Acceso a datos \u00b6 En esta unidad vamos a aprender a acceder a datos que se encuentran en un servidor; recuperando, editando y creando dichos datos a trav\u00e9s de una base de datos. A trav\u00e9s de las distintas capas o niveles, de las cuales 2 de ellas ya conocemos ( Apache , PHP ) y MySQL la que vamos a estudiar en este tema. Instalaci\u00f3n \u00b6 A trav\u00e9s de XAMPP es muy sencillo, simplemente nos descargar\u00edamos el programa y lo activar\u00edamos. Para descargar XAMPP pulsa aqu\u00ed . Con Docker nos descargaremos esta imagen de docker y lanzamos docker-compose up -d Si todo ha salido bien y el contenedor est\u00e1 en marcha, podremos visitar la p\u00e1gina de phpMyAdmin de la siguiente manera http://localhost:8000 Para acceder debemos utilizar las siguientes credenciales que vienen configuradas en el alrchivo docker-compose.yml usuario: root contrase\u00f1a: 1234 Estructura de una base de datos \u00b6 Sabemos que una base de datos tiene muchos campos con sus nombres y valores, pero adem\u00e1s sabemos que la base de datos debe tener un nombre. por tanto tendr\u00edamos la siguiente estructura para una base de datos: NombreBaseDeDatos |__Tabla-#1 | |__DatosTabla-#1 | |__Tabla-#2 | |__DatosTabla-#2 | |__Tabla-#3 | |__DatosTabla-#3 [...] Ve\u00e1moslo en un ejemplo real Ryanair |__pasajero | |__id[*] | |__nombre | |__apellidos | |__edad | |__id_vuelo[^] | |__vuelo | |__id[*] | |__n_plazas | |__disponible | |__id_pais[^] | |__pais |__id[*] |__nombre [*] Clave primaria [^] Clave For\u00e1nea CholloSevero \u00b6 Como muy bien hab\u00e9is elegido, a lo largo de esta unidad vamos a trabajar con una base de datos que iremos confeccionando conforme avancemos, donde almacenaremos la informaci\u00f3n relacionada con ofertas que publiquen los usuarios y los listaremos en funci\u00f3n de varios filtros; nuevos, m\u00e1s votados, m\u00e1s vistos, m\u00e1s comentados entre otros, al m\u00e1s puro estilo Chollometro . SQL \u00b6 Este lenguaje de consulta estructurada ( Structured Query Language ) es el que vamos a utilizar para realizar las consultas a nuestras bases de datos para mostrar el contenido en las distintas interfaces web que creemos a lo largo de la unidad. Si quieres saber m\u00e1s detalles visita Wiki SQL Ejemplo de una sentencia SQL donde seleccionamos todas las filas y columnas de nuestra tabla llamada 'pais' SELECT * FROM pais Estas sentencias pueden invocarse desde la consola de comandos mediante el int\u00e9rprete mysql (previamente instalado en el sistema) o a trav\u00e9s de la herramienta phpMyAdmin. Las sentencias SQL tambi\u00e9n las podemos usar dentro de nuestro c\u00f3digo php, de tal manera que cuando se cargue nuestra interfaz web, lance una sentecia SQL para mostrar los datos que queramos. <?php // Listado de clientes, ordenados por DNI de manera ASCendente $clientesOrdenadosPorDNI = \"SELECT * FROM `pasajero` ORDER BY `dni`\" ASC ; ?> phpMyAdmin \u00b6 Este software funciona bajo Apache y PHP y es m\u00e1s que nada una interfaz web para gestionar las bases de datos que tengamos disponibles en nuestro servidor local. Muchos hostings ofrecen esta herramienta por defecto para poder gestionar las BBDD que tengamos configuradas bajo nuestra cuenta. Creando una base de datos dentro de phpMyAdmin \u00b6 Para crear una nueva base de datos debemos entrar en phpMyAdmin como usuario root y pinchar en la opci\u00f3n Nueva del men\u00fa de la izquierda. En la nueva ventana de creaci\u00f3n pondremos un nombre a nuestra bbdd. Tambi\u00e9n estableceremos el cotejamiento utf8m4_unicode_ci para que nuestra bbdd soporte todo tipo de caracteres (como los asi\u00e1ticos) e incluso emojis ;) Le damos al bot\u00f3n de Crear para crear la bbdd y empezar a escribir las distintas tablas que vayamos a introducir en ella. El sistema generar\u00e1 el c\u00f3digo SQL para crear todo lo que le hemos puesto y crear\u00e1 la base de datos con las tablas que le hayamos metido. CREATE TABLE ` persona ` . ( ` id ` INT NOT NULL AUTO_INCREMENT , ` nombre ` TINYTEXT NOT NULL , ` apellidos ` TEXT NOT NULL , ` telefono ` TINYTEXT NOT NULL , PRIMARY KEY ( ` id ` )) ENGINE = InnoDB ; Opciones en phpMyAdmin \u00b6 Cuando seleccionamos una base de datos de la lista, el sistema nos muestra varias pesta\u00f1as con las cuales interactuar con la base de datos en cuesti\u00f3n: Estructura : Podemos ver las distintas tablas que consolidan nuestra base de datos SQL : Por si queremos inyectar c\u00f3digo SQL para que el sistema lo interprete Buscar : Sirve para buscar por t\u00e9rminos, en nuestra base de datos, aplicando distintos filtros de b\u00fasqueda Generar consulta : parecido a SQL pero de una manera m\u00e1s gr\u00e1fica, sin tener que saber nada del lenguaje Exportar e importar : Como su nombre indica, para hacer cualquiera de las 2 operaciones sobre la base de datos Operaciones : Distintas opciones avanzadas para realizar en nuestra base de datos, de la cual destacaremos la opci\u00f3n Cotejamiento donde podremos cambiar el cotejamiento de nuestra tabla pero OJO CON \u00c9STO porque podemos eliminar datos sin querer, ya que al cambiar el cotejamiento podemos suprimir caracteres no soportados por el nuevo cotejamiento No vamos a profundizar en el resto de opciones pero, en la pesta\u00f1a M\u00e1s existe la opci\u00f3n Dise\u00f1ador para poder editar las relaciones entre tablas de una manera gr\u00e1fica (pinchando y arrastrando) que veremos m\u00e1s adelante. MySQLi \u00b6 PHP hace uso de esta extensi\u00f3n mejorada para poder comunicarse con las bases de datos, ya sean MySQL (4.1 o superior) o MariaDB. Cualquier consulta que queramos hacer a una base de datos necesitaremos hacer uso de la extensi\u00f3n mysqli() Veamos como conectarnos con una base de datos a trav\u00e9s del c\u00f3digo PHP <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 // \"SERVIDOR\", \"USUARIO\", \"CONTRASE\u00d1A\", \"BASE DE DATOS\" $conexion = mysqli_connect ( \"d939ebf6a741\" , \"tuUsuario\" , \"1234\" , \"pruebas\" ); // COMPROBAMOS LA CONEXI\u00d3N if ( mysqli_connect_errno ()) { echo \"Failed to connect to MySQL: \" . mysqli_connect_error (); exit (); } echo \"<h1>Bienvenid@ a MySQL !!</h1>\" ; ?> servidor : El servidor donde se encuentra la base de datos que queremos usar suele ser localhost , pero en nuestro caso, al utilizar Docker ser\u00e1 el nombre de la imagen mysql:8.0 que aparece al dejar el rat\u00f3n encima en el Visual Studio Code usuarioDB : El usuario de la base de datos passwordDB : La contrase\u00f1a para ese usuario de la base de datos baseDeDatos : Nombre de la base de datos que queramos usar Si todo ha salido bien habr\u00e9is visto un mensaje diciendo Bienvenid@ a MySQL !! Recuperando datos de una BD \u00b6 Ahora que ya sabemos c\u00f3mo conectarnos a una base de datos alojada en nuestro servidor, lo que necesitamos saber es c\u00f3mo recuperar datos almacenados en la base de datos. Durante la instalaci\u00f3n de la imagen de Docker, se ha creado una tabla llamada Pruebas que contiene varios registros de distintas personas. Vamos a recuperar esos datos para ver de qu\u00e9 forma se hace con PHP. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $conexion = mysqli_connect ( \"d939ebf6a741\" , \"lupa\" , \"1234\" , \"pruebas\" ); // COMPROBAMOS LA CONEXI\u00d3N if ( mysqli_connect_errno ()) { echo \"Failed to connect to MySQL: \" . mysqli_connect_error (); exit (); } // CONSULTA A LA BASE DE DATOS $consulta = \"SELECT * FROM `Person`\" ; $listaUsuarios = mysqli_query ( $conexion , $consulta ); // COMPROBAMOS SI EL SERVIDOR NOS HA DEVUELTO RESULTADOS if ( $listaUsuarios ) { // RECORREMOS CADA RESULTADO QUE NOS DEVUELVE EL SERVIDOR foreach ( $listaUsuarios as $usuario ) { echo \" $usuario[id] $usuario[name] <br> \" ; } } ?> Si todo ha salido bien, por pantalla ver\u00e1s el siguiente listado \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 http://localhost/pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 1 William 2 Marc 3 John 4 Antonio Moreno PHP Data Objects :: PDO \u00b6 De la misma manera que hemos visto con mysqli, PHP Data Objects (o PDO) es un driver de PHP que se utiliza para trabajar bajo una interfaz de objetos con la base de datos. A d\u00eda de hoy es lo que m\u00e1s se utiliza para manejar informaci\u00f3n desde una base de datos, ya sea relacional o no relacional. De igual manera que pasaba con los objetos en PHP nativos, en la interfaz de MySQL la cosa cambia la hora de conectarnos con una base de datos. <?php $conexion = new PDO ( 'mysql:host=localhost; dbname=dwes' , 'dwes' , 'abc123' ); Adem\u00e1s, con PDO podemos usar las excepciones con try catch para gestionar los errores que se produzcan en nuestra aplicaci\u00f3n, para ello, como hac\u00edamos antes, debemos encapsular el c\u00f3digo entre bloques try / catch. <?php $dsn = 'mysql:dbname=prueba;host=127.0.0.1' ; $usuario = 'usuario' ; $contrase\u00f1a = 'contrase\u00f1a' ; try { $mbd = new PDO ( $dsn , $usuario , $contrase\u00f1a ); $mbd -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); } catch ( PDOException $e ) { echo 'Fall\u00f3 la conexi\u00f3n: ' . $e -> getMessage (); } En primer lugar, creamos la conexi\u00f3n con la base de datos a trav\u00e9s del constructor PDO pas\u00e1ndole la informaci\u00f3n de la base de datos. En segundo lugar, establecemos los par\u00e1metros para manejar las excepciones, en este caso hemos utilizado: PDO::ATTR_ERRMODE indic\u00e1ndole a PHP que queremos un reporte de errores. PDO::ERRMODE_EXCEPTION con este atributo obligamos a que lance excepciones, adem\u00e1s de ser la opci\u00f3n m\u00e1s humana y legible que hay a la hora de controlar errores. Cualquier error que se lance a trav\u00e9s de PDO, el sistema lanzar\u00e1 una PDOException . Fichero de configuraci\u00f3n de la BD \u00b6 De la misma manera que creamos nuestro archivo de funciones funciones-php y albergamos todas las funciones que se usan de manera global en la aplicaci\u00f3n, podemos establecer un archivo de constantes donde definamos los par\u00e1metros de conexi\u00f3n con la base de datos. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 conexion.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 constDSN = \"mysql:host=localhost;dbname=dwes\" ; constUSUARIO = \"dwes\" ; constPASSWORD = \"abc123\" ; /* \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 NO SUBAS ESTE ARCHIVO A git \u2592\u2592\u2592\u2592\u2592 \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 */ Este archivo contiene informaci\u00f3n muy sensible as\u00ed que no es recomendable que subas este archivo a git. Sentencias preparadas \u00b6 Se trata de sentencias que se establecen como si fueran plantillas de la SQL que vamos a lanzar, aceptando par\u00e1metros que son establecidos a posteriori de la declaraci\u00f3n de la sentencia preparada. Las sentencias preparadas evitan la injecci\u00f3n de SQL (SQL Injection) y mejoran el rendimiento de nuestras aplicaci\u00f3nes o p\u00e1ginas web. <?php $sql = \"INSERT INTO Clientes VALUES (?, ?, ?, ?)\" ; Cada interrogante es un par\u00e1metro que estableceremos despu\u00e9s, unas cuantas l\u00edneas m\u00e1s abajo. Una vez tenemos la plantilla de nuestra consulta, debemos seguir con la preparaci\u00f3n junto con 3 m\u00e9todos m\u00e1s de PHP para su completa ejecuci\u00f3n: prepare: prepara la sentenci\u00e1n antes de ser ejecutada bind : el tipo de uni\u00f3n (bind) de dato que puede ser mediante ' ? ' o ' :parametro ' execute se ejecuta la consulta uniendo la plantilla con las bariables o par\u00e1metros que hemos establecido. Ejemplo par\u00e1metros \u00b6 <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Borrando con par\u00e1metros \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $cantidad = $_GET [ \"cantidad\" ]; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"DELETE FROM stock WHERE unidades = ?\" ; $sentencia = $conexion -> prepare ( $sql ); $isOk = $sentencia -> execute ([ $cantidad ]); $cantidadAfectada = $sentencia -> rowCount (); echo $cantidadAfectada ; } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null Ejemplo bindParam \u00b6 Muy parecido a utilizar par\u00e1metros pero esta vez la variable est\u00e1 dentro de la sentencia SQL, en este caso la hemos llamado :cant <?php include \"config/database.inc.php\" ; $conexion = null ; try { $cantidad = $_GET [ \"cantidad\" ] ?? 0 ; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"DELETE FROM stock WHERE unidades = :cant\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> bindParam ( \":cant\" , $cantidad ); $isOk = $sentencia -> execute (); $cantidadAfectada = $sentencia -> rowCount (); echo $cantidadAfectada ; } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; bindParam VS bindValue \u00b6 Utilizaremos bindValue() cuando tengamos que insertar datos s\u00f3lo una vez, en cambio, deberemos usar bindParam() cuando tengamos que pasar datos m\u00faltiples, como por ejemplo, un array. <?php // se asignan nombre a los par\u00e1metros $sql = \"DELETE FROM stock WHERE unidades = :cant\" ; $sentencia = $conexion -> prepare ( $sql ); // bindParam enlaza por referencia $cantidad = 0 ; $sentencia -> bindParam ( \":cant\" , $cantidad ); $cantidad = 1 ; // se eliminan con cant = 1 $isOk = $sentencia -> execute (); // bindValue enlaza por valor $cantidad = 0 ; $sentencia -> bindValue ( \":cant\" , $cantidad ); $cantidad = 1 ; // se eliminan con cant = 0 $isOk = $sentencia -> execute (); Para m\u00e1s informaci\u00f3n y uso de las variables PDO consulta el manual de PHP . Insertando registros \u00b6 A la hora de insertar registros en una base de datos, debemos tener en cuenta que en la tabla puede haber valores autoincrementados. Para salvaguardar \u00e9sto, lo que debemos hacer es dejar ese cambpo autoincrementado vac\u00edo, pero a la hora de hacer la conexi\u00f3n, debemos recuperarlo con el m\u00e9todo lastInsertId() . <?php $nombre = $_GET [ \"nombre\" ] ?? \"SUCURSAL X\" ; $telefono = $_GET [ \"telefono\" ] ?? \"636123456\" ; $sql = \"INSERT INTO tienda(nombre, tlf) VALUES (:nombre, :telefono)\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> bindParam ( \":nombre\" , $nombre ); $sentencia -> bindParam ( \":telefono\" , $telefono ); $isOk = $sentencia -> execute (); $idGenerado = $conexion -> lastInsertId (); echo $idGenerado ; Consultando registros \u00b6 A la hora de recuperar los resultados de una consulta, bastar\u00e1 con invocar al m\u00e9todo PDOStatement::fetch para listar las filas generadas por la consulta. Pero debemos elegir el tipo de dato que queremos recibir entre los 3 que hay disponibles: PDO::FETCH_ASSOC: array indexado cuyos keys son el nombre de las columnas. PDO::FETCH_NUM: array indexado cuyos keys son n\u00fameros. PDO::FETCH_BOTH: valor por defecto. Devuelve un array indexado cuyos keys son tanto el nombre de las columnas como n\u00fameros. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"select * from tienda\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_ASSOC ); $sentencia -> execute (); while ( $fila = $sentencia -> fetch ()){ echo \"Codigo:\" . $fila [ \"cod\" ] . \"<br />\" ; echo \"Nombre:\" . $fila [ \"nombre\" ] . \"<br />\" ; echo \"Tel\u00e9fono:\" . $fila [ \"tlf\" ] . \"<br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Recuperando datos con una matriz como resultado de nuestra consulta <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_ASSOC ); $sentencia -> execute (); $tiendas = $sentencia -> fetchAll (); foreach ( $tiendasas$tienda ) { echo \"Codigo:\" . $tienda [ \"cod\" ] . \"<br />\" ; echo \"Nombre:\" . $tienda [ \"nombre\" ] . \"<br />\" ; } Pero si lo que queremos es leer datos con forma de objeto utilizando PDO::FETCH_OBJ , debemos crear un objeto con propiedades p\u00fablicas con el mismo nombre que las columnas de la tabla que vayamos a consultar. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 consulta con formato de objeto \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_OBJ ); $sentencia -> execute (); while ( $t = $sentencia -> fetch ()) { echo \"Codigo:\" . $t -> cod . \"<br />\" ; echo \"Nombre:\" . $t -> nombre . \"<br />\" ; echo \"Tel\u00e9fono:\" . $t -> tlf . \"<br />\" ; } Consultas con modelos \u00b6 Llevamos tiempo creando clases en PHP y las consultas tambi\u00e9n admiten este tipo de datos mediante el uso de PDO::FETCH_CLASS Si usamos este m\u00e9todo, debemos tener en cuenta que los nombres de los atributos privados deben coincidir con los nombres de las columnas de la tabla que vayamos a manejar. As\u00ed pues, si por lo que sea cambiamos la estructura de la tabla DEBEMOS CAMBIAR nuestra clase para que todo siga funcionando. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 clase Tienda \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 classTienda { private int $cod ; private string $nombre ; private ? string $tlf ; public function getCodigo () : int { return $this -> cod ; } public function getNombre () : string { return $this -> nombre ; } public function getTelefono () : ? string { return $this -> tlf ; } } <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Consultando a trav\u00e9s de la clase Tienda \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda\" ; $sentencia = $conexion -> prepare ( $sql ); // Aqu\u00ed 'Tienda' es el nombre de nuestra clase $sentencia -> setFetchMode ( PDO :: FETCH_CLASS , \"Tienda\" ); $sentencia -> execute (); while ( $t = $sentencia -> fetch ()) { echo \"Codigo: \" . $t -> getCodigo () . \"<br />\" ; echo \"Nombre: \" . $t -> getNombre () . \"<br />\" ; echo \"Tel\u00e9fono: \" . $t -> getTelefono () . \"<br />\" ; var_dump ( $t ); } Pero \u00bfqu\u00e9 pasa si nuestras clases tienen constructor? pues que debemos indicarle, al m\u00e9todo FECTH, que rellene las propiedades despu\u00e9s de llamar al constructor y para ello hacemos uso de PDO::FETCH_PROPS_LATE . <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Consulta para una clase con constructor \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_CLASS | PDO :: FETCH_PROPS_LATE , Tienda :: class ); $sentencia -> execute (); $tiendas = $sentencia -> fetchAll (); Consultas con LIKE \u00b6 Para utilizar el comod\u00edn LIKE u otros comodines, debemos asociarlo al dato y NUNCA en la propia consulta. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Utilizando comodines :: LIKE \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda where nombre like :nombre or tlf like :tlf\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_CLASS | PDO :: FETCH_PROPS_LATE , Tienda :: class ); $cadBuscar = \"%\" . $busqueda . \"%\" ; $sentencia -> execute ([ \"nombre\" => $cadBuscar , \"tlf\" => $cadBuscar ]); $result = $sentencia -> fetchAll (); Ten\u00e9is una lista de ejemplos muy completa en la documentaci\u00f3n oficial . Login & Password \u00b6 Para manejar un sistema completo de login y password con contrase\u00f1as cifradas, necesitamos un m\u00e9todo que cifre esos strings que el usuario introduce como contrase\u00f1a; tanto en el formulario de registro como en el del login, ya que al codificar una contrase\u00f1a, despu\u00e9s tenemos que decodificarla para comprobar que ambas contras\u00f1eas (la que instroduce el usuario en el login y la que tenemos en la base de datos) coincidan. Necesitamos pues: password_hash() para almacenar la contrase\u00f1a en la base de datos a la hora de hacer el INSERT PASSWORD_DEFAULT almacenamos la contrase\u00f1a usando el m\u00e9todo de encriptaci\u00f3n bcrypt PASSWORD_BCRYPT almacenamos la contrase\u00f1a usando el algoritmo CRYPT_BLOWFISH compatible con crypt() password_verify() para verificar el usuario y la contrase\u00f1a <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Almacenando usuario y password en BD \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $usu = $_POST [ \"usuario\" ]; $pas = $_POST [ \"password\" ]; $sql = \"INSERT INTO usuarios(usuario, password) VALUES (:usuario, :password)\" ; $sentencia = $conexion -> prepare ( $sql ); $isOk = $sentencia -> execute ([ \"usuario\" => $usu , \"password\" => password_hash ( $pas , PASSWORD_DEFAULT ) ]); Ahora que tenemos el usuario codificado y guardado en la base de datos, vamos a recuperarlo para poder loguearlo correctamente. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Recuperando usuario y password en BD \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $usu = $_POST [ \"login\" ] ?? \"\" ; $sql = \"select * from usuarios where usuario = ?\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> execute ([ $usu ]); $usuario = $sentencia -> fetch (); if ( $usuario && password_verify ( $_POST [ 'pass' ], $usuario [ 'password' ])) { echo \"OK!\" ; } else { echo \"KO\" ; } Acceso a ficheros \u00b6 Gracias a la funcion fopen() desde PHP podemos abrir archivos que se encuentren en nuestros servidor o una URL. A esta funci\u00f3n hay que pasarle 2 par\u00e1metros; el nombre del archivo que queremos abrir y el modo en el que se abrir\u00e1 $fp = fopen(\"miarchivo.txt\", \"r\"); Muchas veces no podemos abrir el archivo porque \u00e9ste no se encuentra o no tenemos acceso a \u00e9l, por eso es recomendable comprobar que podemos hacerlo if (!$fp = fopen(\"miarchivo.txt\", \"r\")){ echo \"No se ha podido abrir el archivo\"; } Modos de apertura de ficheros \u00b6 r : Modo lectura. Puntero al principio del archivo. r+ : Apertura para lectura y escritura. Puntero al principio del archivo w : Apertura para escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear. w+ : Apertura para lectura y escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear. a : Apertura para escritura. Puntero al final del archivo. Si no existe se intenta crear. a+ : Apertura para lectura y escritura. Puntero al final del archivo. Si no existe se intenta crear. x : Creaci\u00f3n y apertura para s\u00f3lo escritura. Puntero al principio del archivo. Si el archivo ya existe dar\u00e1 error E_WARNING. Si no existe se intenta crear. x+ : Creaci\u00f3n y apertura para lectura y escritura. Mismo comportamiento que x. c : Apertura para escritura. Si no existe se crea. Si existe no se sobreescribe ni da ning\u00fan error. Puntero al principio del archivo. c+ : Apertura para lectura y escritura. Mismo comportamiento que C. b : Cuando se trabaja con archivos binarios como jpg, pdf, png y dem\u00e1s. Se suele colocar al final del modo, es decir rb, r+b, x+b, wb... Operaciones con archivos \u00b6 Para poder leer un archivo necesitamos usar la funci\u00f3n fread() de PHP // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Abriendo un archivo y leyendo su contenido \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\"; $fp = fopen($file, \"r\"); // filesize() nos devuelve el tama\u00f1o del archivo en cuesti\u00f3n $contents = fread($fp, filesize($file)); // Cerramos la conexi\u00f3n con el archivo fclose(); Si lo que queremos es escribir en un archivo, deberemos hacer uso de la funci\u00f3n fwrite() // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Escribiendo en un archivo \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\"; $texto = \"Hola que tal\"; $fp = fopen($file, \"w\"); fwrite($fp, $texto); fclose($fp); Informaci\u00f3n de un fichero \u00b6 Con PHP y su m\u00e9todo stat() podemos obtener informaci\u00f3n sobre los archivos que le indiquemos. Este m\u00e9todo devuelve hasta un total de 12 elementos con ifnormaci\u00f3n acerca de nuestro archivo. 0 dev n\u00famero de dispositivo 1 ino n\u00famero de i-nodo 2 mode modo de protecci\u00f3n del i-nodo 3 nlink n\u00famero de enlaces 4 uid ID de usuario del propietario 5 gid ID de grupo del propietario 6 rdev tipo de dispositivo, si es un dispositivo i-nodo 7 size tama\u00f1o en bytes 8 atime momento del \u00faltimo acceso (tiempo Unix) 9 mtime momento de la \u00faltima modificaci\u00f3n (tiempo Unix) 10 ctime momento de la \u00faltima modificaci\u00f3n del i-nodo (tiempo Unix) 11 blksize tama\u00f1o del bloque E/S del sistema de ficheros 12 blocks n\u00famero de bloques de 512 bytes asignados Unos ejemplos... <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Informaci\u00f3n del archivo \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\" ; $texto = \"Todos somos muy ignorantes, lo que ocurre es que no todos ignoramos las mismas cosas.\" ; $fp = fopen ( $file , \"w\" ); fwrite ( $fp , $texto ); $datos = stat ( $file ); echo $datos [ 3 ] . \"<br>\" ; // N\u00famero de enlaces, 1 echo $datos [ 7 ] . \"<br>\" ; // Tama\u00f1o en bytes, 85 echo $datos [ 8 ] . \"<br>\" ; // Momento de \u00faltimo acceso, 1444138104 echo $datos [ 9 ] . \"<br>\" ; // Momento de \u00faltima modificaci\u00f3n, 1444138251 ?> Echa un vistazo a las funciones de directorios que tiene PHP, es muy interesante. Archivos PDF \u00b6 Con PHP podemos manejar todo tipo de archivos como ya hemos visto pero, \u00bfqu\u00e9 pasa si queremos generar ficheros PDF con datos sacados de una base de datos? Gracias a una clase escrita en PHP, podemos generar archivos PDF sin necesidad de instalar librer\u00edas adicionales en nuestro servidor. Para ello, como tenemos composer dentro de nuestra imagen de Docker, usaremos composer para instalar esta dependencia. Acu\u00e9rdate que debemes haber hecho composer init para empezar un proyecto con composer, de lo contrario no podr\u00e1s a\u00f1adir ning\u00fan paquete. Veamos un ejemplo de Hello World convertido a PDF <?php ob_end_clean (); require ( 'fpdf/fpdf.php' ); // Instanciamos la clase // P = Portrait | mm = unidades en mil\u00edmetros | A4 = formato $pdf = new FPDF ( 'P' , 'mm' , 'A4' ); // A\u00f1adimos una p\u00e1gina $pdf -> AddPage (); // Establecemos la fuente y el tama\u00f1o de letra $pdf -> SetFont ( 'Arial' , 'B' , 18 ); // Imprimimos una celda con el texto que nosotros queramos $pdf -> Cell ( 60 , 20 , 'Hello World!' ); // Terminamos el PDF $pdf -> Output (); ?> Hay muchos ejemplos y tutoriales, as\u00ed como documentaci\u00f3n de la clase FPDF en la p\u00e1gina oficial. Visita la secci\u00f3n de tutoriales y el manual para sacar mayor partido a esta clase. <?php require ( 'fpdf/fpdf.php' ); class PDF extends FPDF { // Cabecera function Header () { // A\u00f1adimos un logotipo $this -> Image ( 'logo.png' , 10 , 8 , 33 ); // establecemos la fuente y el tama\u00f1o $this -> SetFont ( 'Arial' , 'B' , 20 ); // Movemos el contenido un poco a la derecha $this -> Cell ( 80 ); // Pintamos la celda $this -> Cell ( 50 , 10 , 'Cabecera' , 1 , 0 , 'C' ); // Pasamos a la siguiente l\u00ednea $this -> Ln ( 20 ); } // Pie de p\u00e1gina function Footer () { // Nos posicionamos a 1.5 cm desde abajo del todo de la p\u00e1gina $this -> SetY ( - 15 ); // Arial italic 8 $this -> SetFont ( 'Arial' , 'I' , 8 ); // N\u00famero de p\u00e1gina $this -> Cell ( 0 , 10 , 'P\u00e1gina ' . $this -> PageNo () . '/{nb}' , 0 , 0 , 'C' ); } } // Instanciamos la clase $pdf = new PDF (); // Definimos un alias para la numeraci\u00f3n de p\u00e1ginas $pdf -> AliasNbPages (); $pdf -> AddPage (); $pdf -> SetFont ( 'Times' , '' , 14 ); for ( $i = 1 ; $i <= 30 ; $i ++ ) $pdf -> Cell ( 0 , 10 , 'N\u00famero de l\u00ednea ' . $i , 0 , 1 ); $pdf -> Output (); ?> Actividades \u00b6 MySQLi \u00b6 Crea una nueva base de datos con el nombre lol y cotejamiento de datos utf8mb4_unicode_ci . En nuestra base de datos lol que acabamos de crear, vamos a crear la tabla campeon con los siguientes campos. id [*] nombre rol dificultad descripcion Acu\u00e9rdate que [*] significa que es clave primaria y no olvides poner el tipo de datos de cada uno de los campos. Rellena la tabla campeon con, al menos 5 registros, con los datos que t\u00fa quieras o si lo prefieres, puedes basarte en la p\u00e1gina oficial del juego pero \u00a1\u00a1 NO TE PONGAS A JUGAR !! Crea el archivo 604campeones.php donde listes todos los campeones del LOL que has metido en tu base de datos. Acu\u00e9rdate que para ello deberas hacer una conexi\u00f3n con la base de datos y un foreach para cada campe\u00f3n que tengas albergado en la tabla campeon . Modifica el archivo 604campeones.php y gu\u00e1rdalo como 606campeones.php pero pon al lado de cada uno de los campeones listados un bot\u00f3n para editar y otro para borrar . Cada uno de esos botones har\u00e1 la correspondiente funci\u00f3n dependiendo del id del campe\u00f3n seleccionado. Al pinchar en editar, el usuario ser\u00e1 redirigido al archivo 605editando.php donde mostrar\u00e1 un formulario con los campos rellenos por los datos del campe\u00f3n seleccionado. Al darle al bot\u00f3n de guardar los datos se guardar\u00e1n en la base de datos y el usuario ser\u00e1 redirigido a la lista de campones para poder ver los cambios. Al pinchar en borrar, el usuario ser\u00e1 preguntado a trav\u00e9s de un mensaje de JavaScript (prompt) si est\u00e1 seguro de que quiere borrar al campe\u00f3n seleccionado. En el mensaje de confirmaci\u00f3n debe aparecer el nombre del campe\u00f3n seleccionado . Si el usuario pincha en Aceptar el campe\u00f3n ser\u00e1 eliminado de la base de datos y el usuario ser\u00e1 redirigido nuevamente al listado de campeones para comprobar que, efectivamente dicho campe\u00f3n se ha eliminado de la lista. Filtros y comodines \u00b6 modifica el archivo 604campeones.php y gu\u00e1rdalo como 606campeones.php para que se muestre como una tabla con las columnas de la propia tabla de la base de datos, es decir; id, nombre, rol, dificultad, descripci\u00f3n. Al lado de cada nombre de cada columna, pon 2 iconos que sean \u02c4 \u02c5 y que cada uno de ellos ordene el listado en funci\u00f3n de cu\u00e1l se haya pinchado. Si se ha pulsado en Nombre el icono de \u02c4, el listado debe aparecer ordenado por nombre ascendente. Si por el contrario se ha pulsado \u02c5 tendr\u00e1 que ordenarse por nombre descendente. Ten en cuenta que cada icono debe llevar consigo un enlace al listado que contenga par\u00e1metros en la URL que satisfagan las opciones seleccionadas as\u00ed que haced uso de $_GET para poder capturarlos y escribid las consultas SQL que sean necesarias para hacer cada uno de los filtros. Puedes usar Font Awesome para los iconos pero es algo opcional PDO \u00b6 Aprovecha lo que hiciste de los ejercicios 601 al 604 pero esta vez utilizando PDO::FETCH_ASSOC . Crea una tabla nueva dentro de la base de datos lol que ya tienes y crea un sistema de login con usuarios. Introduce en la base de datos al menos 3 usuarios diferentes con sus contrase\u00f1as distintas. Recuerda que: La tabla nueva ha de llamarse usuario Los campos a crear en la nueva tabla deben ser id [*] nombre usuario password email Las contrase\u00f1as deben ser cifradas antes de guardar el datos en la base de datos. Crea el formulario 608registro.php donde el usuario introduzca los datos de registro y vinc\u00falalo con 608nuevoUsuario.php para que recoja los datos mediante POST y los inserte en la base de datos si todo ha ido bien. Queda PROHIBID\u00cdSIMO acceder a 608nuevoUsuario.php sin el formulario rellenado. La sentencia de INSERT debe estar controlada para que no pueda introducirse ning\u00fan dato en blanco. Ten en cuenta que est\u00e1s modificando la base de datos y no queremos campos mal rellenados. Si todo ha ido bien, muestra un mensaje por pantalla diciendo El usuario XXX ha sido introducido en el sistema con la contrase\u00f1a YYY . Ficheros \u00b6 M\u00e9tete en loremipsum.com y genera un texto de 3 p\u00e1rrafos. Copia el texto generado y gu\u00e1rdalo en un archivo nuevo llamado 609loremIpsum.txt . Genera un archivo php llamado 609loremIpsum.php y muestra por pantalla el texto del archivo txt que acabas de crear, su tama\u00f1o en Kilobytes , la fecha de su \u00faltima modificaci\u00f3n y el ID de usuario que cre\u00f3 el archivo. Vuelve a cargar el archivo 606campeones.php y ren\u00f3mbralo a 610campeones.php pero en vez de mostrar la tabla por pantalla, genera un archivo CSV 610campeones.csv y otro 610campeonesCSV.php donde saques por pantalla el contenido del archivo 610campeones.csv . Proyecto CholloSevero \u00b6 Estructura el proyecto y piensa en las tablas y bases de datos que necesit\u00e9is para crear el proyecto. Crea los UML necesarios con nombres como 615UMLnombreTabla metiendo todos los campos que se necesiten as\u00ed como las relaciones que creas necesarias. Establece un sistema de archivos para el proyecto, teniendo en cuenta que van a haber im\u00e1genes, css, funciones php, constantes e incluso javaScript (pero algo b\u00e1sico) para controlar los eventos del usuario a lo largo de la interfaz. Crea un sistema de login/password con los roles administrador y usuario . De momento que se validen los usuarios correctamente utilizando encriptaci\u00f3n en la contrase\u00f1a. Administrador : Puede ver todos los usuarios registrados as\u00ed como los administradores y los chollos creados en la base de datos. Usuario : Puede ver sus propios chollos, editarlos y borrarlos, adem\u00e1s de crear nuevos. Crea la vista para poner nuevos chollos y recuerda s\u00f3lo pueden entrar a esta vista usuarios registrados o administradores . Crea la vista donde se muestren todos los chollos creados. Esta vista puede verla cualquier usuario, registrado o no en el sistema. Ten en cuenta que esta vista ser\u00e1 la vista general de la web as\u00ed que puedes llamarla index.php donde despu\u00e9s aplicaremos filtros por $_GET.","title":"6.- Acceso a Datos"},{"location":"06accesoDatos.html#acceso-a-datos","text":"En esta unidad vamos a aprender a acceder a datos que se encuentran en un servidor; recuperando, editando y creando dichos datos a trav\u00e9s de una base de datos. A trav\u00e9s de las distintas capas o niveles, de las cuales 2 de ellas ya conocemos ( Apache , PHP ) y MySQL la que vamos a estudiar en este tema.","title":"Acceso a datos"},{"location":"06accesoDatos.html#instalacion","text":"A trav\u00e9s de XAMPP es muy sencillo, simplemente nos descargar\u00edamos el programa y lo activar\u00edamos. Para descargar XAMPP pulsa aqu\u00ed . Con Docker nos descargaremos esta imagen de docker y lanzamos docker-compose up -d Si todo ha salido bien y el contenedor est\u00e1 en marcha, podremos visitar la p\u00e1gina de phpMyAdmin de la siguiente manera http://localhost:8000 Para acceder debemos utilizar las siguientes credenciales que vienen configuradas en el alrchivo docker-compose.yml usuario: root contrase\u00f1a: 1234","title":"Instalaci\u00f3n"},{"location":"06accesoDatos.html#estructura-de-una-base-de-datos","text":"Sabemos que una base de datos tiene muchos campos con sus nombres y valores, pero adem\u00e1s sabemos que la base de datos debe tener un nombre. por tanto tendr\u00edamos la siguiente estructura para una base de datos: NombreBaseDeDatos |__Tabla-#1 | |__DatosTabla-#1 | |__Tabla-#2 | |__DatosTabla-#2 | |__Tabla-#3 | |__DatosTabla-#3 [...] Ve\u00e1moslo en un ejemplo real Ryanair |__pasajero | |__id[*] | |__nombre | |__apellidos | |__edad | |__id_vuelo[^] | |__vuelo | |__id[*] | |__n_plazas | |__disponible | |__id_pais[^] | |__pais |__id[*] |__nombre [*] Clave primaria [^] Clave For\u00e1nea","title":"Estructura de una base de datos"},{"location":"06accesoDatos.html#chollosevero","text":"Como muy bien hab\u00e9is elegido, a lo largo de esta unidad vamos a trabajar con una base de datos que iremos confeccionando conforme avancemos, donde almacenaremos la informaci\u00f3n relacionada con ofertas que publiquen los usuarios y los listaremos en funci\u00f3n de varios filtros; nuevos, m\u00e1s votados, m\u00e1s vistos, m\u00e1s comentados entre otros, al m\u00e1s puro estilo Chollometro .","title":"CholloSevero"},{"location":"06accesoDatos.html#sql","text":"Este lenguaje de consulta estructurada ( Structured Query Language ) es el que vamos a utilizar para realizar las consultas a nuestras bases de datos para mostrar el contenido en las distintas interfaces web que creemos a lo largo de la unidad. Si quieres saber m\u00e1s detalles visita Wiki SQL Ejemplo de una sentencia SQL donde seleccionamos todas las filas y columnas de nuestra tabla llamada 'pais' SELECT * FROM pais Estas sentencias pueden invocarse desde la consola de comandos mediante el int\u00e9rprete mysql (previamente instalado en el sistema) o a trav\u00e9s de la herramienta phpMyAdmin. Las sentencias SQL tambi\u00e9n las podemos usar dentro de nuestro c\u00f3digo php, de tal manera que cuando se cargue nuestra interfaz web, lance una sentecia SQL para mostrar los datos que queramos. <?php // Listado de clientes, ordenados por DNI de manera ASCendente $clientesOrdenadosPorDNI = \"SELECT * FROM `pasajero` ORDER BY `dni`\" ASC ; ?>","title":"SQL"},{"location":"06accesoDatos.html#phpmyadmin","text":"Este software funciona bajo Apache y PHP y es m\u00e1s que nada una interfaz web para gestionar las bases de datos que tengamos disponibles en nuestro servidor local. Muchos hostings ofrecen esta herramienta por defecto para poder gestionar las BBDD que tengamos configuradas bajo nuestra cuenta.","title":"phpMyAdmin"},{"location":"06accesoDatos.html#creando-una-base-de-datos-dentro-de-phpmyadmin","text":"Para crear una nueva base de datos debemos entrar en phpMyAdmin como usuario root y pinchar en la opci\u00f3n Nueva del men\u00fa de la izquierda. En la nueva ventana de creaci\u00f3n pondremos un nombre a nuestra bbdd. Tambi\u00e9n estableceremos el cotejamiento utf8m4_unicode_ci para que nuestra bbdd soporte todo tipo de caracteres (como los asi\u00e1ticos) e incluso emojis ;) Le damos al bot\u00f3n de Crear para crear la bbdd y empezar a escribir las distintas tablas que vayamos a introducir en ella. El sistema generar\u00e1 el c\u00f3digo SQL para crear todo lo que le hemos puesto y crear\u00e1 la base de datos con las tablas que le hayamos metido. CREATE TABLE ` persona ` . ( ` id ` INT NOT NULL AUTO_INCREMENT , ` nombre ` TINYTEXT NOT NULL , ` apellidos ` TEXT NOT NULL , ` telefono ` TINYTEXT NOT NULL , PRIMARY KEY ( ` id ` )) ENGINE = InnoDB ;","title":"Creando una base de datos dentro de phpMyAdmin"},{"location":"06accesoDatos.html#opciones-en-phpmyadmin","text":"Cuando seleccionamos una base de datos de la lista, el sistema nos muestra varias pesta\u00f1as con las cuales interactuar con la base de datos en cuesti\u00f3n: Estructura : Podemos ver las distintas tablas que consolidan nuestra base de datos SQL : Por si queremos inyectar c\u00f3digo SQL para que el sistema lo interprete Buscar : Sirve para buscar por t\u00e9rminos, en nuestra base de datos, aplicando distintos filtros de b\u00fasqueda Generar consulta : parecido a SQL pero de una manera m\u00e1s gr\u00e1fica, sin tener que saber nada del lenguaje Exportar e importar : Como su nombre indica, para hacer cualquiera de las 2 operaciones sobre la base de datos Operaciones : Distintas opciones avanzadas para realizar en nuestra base de datos, de la cual destacaremos la opci\u00f3n Cotejamiento donde podremos cambiar el cotejamiento de nuestra tabla pero OJO CON \u00c9STO porque podemos eliminar datos sin querer, ya que al cambiar el cotejamiento podemos suprimir caracteres no soportados por el nuevo cotejamiento No vamos a profundizar en el resto de opciones pero, en la pesta\u00f1a M\u00e1s existe la opci\u00f3n Dise\u00f1ador para poder editar las relaciones entre tablas de una manera gr\u00e1fica (pinchando y arrastrando) que veremos m\u00e1s adelante.","title":"Opciones en phpMyAdmin"},{"location":"06accesoDatos.html#mysqli","text":"PHP hace uso de esta extensi\u00f3n mejorada para poder comunicarse con las bases de datos, ya sean MySQL (4.1 o superior) o MariaDB. Cualquier consulta que queramos hacer a una base de datos necesitaremos hacer uso de la extensi\u00f3n mysqli() Veamos como conectarnos con una base de datos a trav\u00e9s del c\u00f3digo PHP <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 // \"SERVIDOR\", \"USUARIO\", \"CONTRASE\u00d1A\", \"BASE DE DATOS\" $conexion = mysqli_connect ( \"d939ebf6a741\" , \"tuUsuario\" , \"1234\" , \"pruebas\" ); // COMPROBAMOS LA CONEXI\u00d3N if ( mysqli_connect_errno ()) { echo \"Failed to connect to MySQL: \" . mysqli_connect_error (); exit (); } echo \"<h1>Bienvenid@ a MySQL !!</h1>\" ; ?> servidor : El servidor donde se encuentra la base de datos que queremos usar suele ser localhost , pero en nuestro caso, al utilizar Docker ser\u00e1 el nombre de la imagen mysql:8.0 que aparece al dejar el rat\u00f3n encima en el Visual Studio Code usuarioDB : El usuario de la base de datos passwordDB : La contrase\u00f1a para ese usuario de la base de datos baseDeDatos : Nombre de la base de datos que queramos usar Si todo ha salido bien habr\u00e9is visto un mensaje diciendo Bienvenid@ a MySQL !!","title":"MySQLi"},{"location":"06accesoDatos.html#recuperando-datos-de-una-bd","text":"Ahora que ya sabemos c\u00f3mo conectarnos a una base de datos alojada en nuestro servidor, lo que necesitamos saber es c\u00f3mo recuperar datos almacenados en la base de datos. Durante la instalaci\u00f3n de la imagen de Docker, se ha creado una tabla llamada Pruebas que contiene varios registros de distintas personas. Vamos a recuperar esos datos para ver de qu\u00e9 forma se hace con PHP. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $conexion = mysqli_connect ( \"d939ebf6a741\" , \"lupa\" , \"1234\" , \"pruebas\" ); // COMPROBAMOS LA CONEXI\u00d3N if ( mysqli_connect_errno ()) { echo \"Failed to connect to MySQL: \" . mysqli_connect_error (); exit (); } // CONSULTA A LA BASE DE DATOS $consulta = \"SELECT * FROM `Person`\" ; $listaUsuarios = mysqli_query ( $conexion , $consulta ); // COMPROBAMOS SI EL SERVIDOR NOS HA DEVUELTO RESULTADOS if ( $listaUsuarios ) { // RECORREMOS CADA RESULTADO QUE NOS DEVUELVE EL SERVIDOR foreach ( $listaUsuarios as $usuario ) { echo \" $usuario[id] $usuario[name] <br> \" ; } } ?> Si todo ha salido bien, por pantalla ver\u00e1s el siguiente listado \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 http://localhost/pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 1 William 2 Marc 3 John 4 Antonio Moreno","title":"Recuperando datos de una BD"},{"location":"06accesoDatos.html#php-data-objects-pdo","text":"De la misma manera que hemos visto con mysqli, PHP Data Objects (o PDO) es un driver de PHP que se utiliza para trabajar bajo una interfaz de objetos con la base de datos. A d\u00eda de hoy es lo que m\u00e1s se utiliza para manejar informaci\u00f3n desde una base de datos, ya sea relacional o no relacional. De igual manera que pasaba con los objetos en PHP nativos, en la interfaz de MySQL la cosa cambia la hora de conectarnos con una base de datos. <?php $conexion = new PDO ( 'mysql:host=localhost; dbname=dwes' , 'dwes' , 'abc123' ); Adem\u00e1s, con PDO podemos usar las excepciones con try catch para gestionar los errores que se produzcan en nuestra aplicaci\u00f3n, para ello, como hac\u00edamos antes, debemos encapsular el c\u00f3digo entre bloques try / catch. <?php $dsn = 'mysql:dbname=prueba;host=127.0.0.1' ; $usuario = 'usuario' ; $contrase\u00f1a = 'contrase\u00f1a' ; try { $mbd = new PDO ( $dsn , $usuario , $contrase\u00f1a ); $mbd -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); } catch ( PDOException $e ) { echo 'Fall\u00f3 la conexi\u00f3n: ' . $e -> getMessage (); } En primer lugar, creamos la conexi\u00f3n con la base de datos a trav\u00e9s del constructor PDO pas\u00e1ndole la informaci\u00f3n de la base de datos. En segundo lugar, establecemos los par\u00e1metros para manejar las excepciones, en este caso hemos utilizado: PDO::ATTR_ERRMODE indic\u00e1ndole a PHP que queremos un reporte de errores. PDO::ERRMODE_EXCEPTION con este atributo obligamos a que lance excepciones, adem\u00e1s de ser la opci\u00f3n m\u00e1s humana y legible que hay a la hora de controlar errores. Cualquier error que se lance a trav\u00e9s de PDO, el sistema lanzar\u00e1 una PDOException .","title":"PHP Data Objects :: PDO"},{"location":"06accesoDatos.html#fichero-de-configuracion-de-la-bd","text":"De la misma manera que creamos nuestro archivo de funciones funciones-php y albergamos todas las funciones que se usan de manera global en la aplicaci\u00f3n, podemos establecer un archivo de constantes donde definamos los par\u00e1metros de conexi\u00f3n con la base de datos. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 conexion.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 constDSN = \"mysql:host=localhost;dbname=dwes\" ; constUSUARIO = \"dwes\" ; constPASSWORD = \"abc123\" ; /* \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 NO SUBAS ESTE ARCHIVO A git \u2592\u2592\u2592\u2592\u2592 \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 */ Este archivo contiene informaci\u00f3n muy sensible as\u00ed que no es recomendable que subas este archivo a git.","title":"Fichero de configuraci\u00f3n de la BD"},{"location":"06accesoDatos.html#sentencias-preparadas","text":"Se trata de sentencias que se establecen como si fueran plantillas de la SQL que vamos a lanzar, aceptando par\u00e1metros que son establecidos a posteriori de la declaraci\u00f3n de la sentencia preparada. Las sentencias preparadas evitan la injecci\u00f3n de SQL (SQL Injection) y mejoran el rendimiento de nuestras aplicaci\u00f3nes o p\u00e1ginas web. <?php $sql = \"INSERT INTO Clientes VALUES (?, ?, ?, ?)\" ; Cada interrogante es un par\u00e1metro que estableceremos despu\u00e9s, unas cuantas l\u00edneas m\u00e1s abajo. Una vez tenemos la plantilla de nuestra consulta, debemos seguir con la preparaci\u00f3n junto con 3 m\u00e9todos m\u00e1s de PHP para su completa ejecuci\u00f3n: prepare: prepara la sentenci\u00e1n antes de ser ejecutada bind : el tipo de uni\u00f3n (bind) de dato que puede ser mediante ' ? ' o ' :parametro ' execute se ejecuta la consulta uniendo la plantilla con las bariables o par\u00e1metros que hemos establecido.","title":"Sentencias preparadas"},{"location":"06accesoDatos.html#ejemplo-parametros","text":"<?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Borrando con par\u00e1metros \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $cantidad = $_GET [ \"cantidad\" ]; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"DELETE FROM stock WHERE unidades = ?\" ; $sentencia = $conexion -> prepare ( $sql ); $isOk = $sentencia -> execute ([ $cantidad ]); $cantidadAfectada = $sentencia -> rowCount (); echo $cantidadAfectada ; } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null","title":"Ejemplo par\u00e1metros"},{"location":"06accesoDatos.html#ejemplo-bindparam","text":"Muy parecido a utilizar par\u00e1metros pero esta vez la variable est\u00e1 dentro de la sentencia SQL, en este caso la hemos llamado :cant <?php include \"config/database.inc.php\" ; $conexion = null ; try { $cantidad = $_GET [ \"cantidad\" ] ?? 0 ; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"DELETE FROM stock WHERE unidades = :cant\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> bindParam ( \":cant\" , $cantidad ); $isOk = $sentencia -> execute (); $cantidadAfectada = $sentencia -> rowCount (); echo $cantidadAfectada ; } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ;","title":"Ejemplo bindParam"},{"location":"06accesoDatos.html#bindparam-vs-bindvalue","text":"Utilizaremos bindValue() cuando tengamos que insertar datos s\u00f3lo una vez, en cambio, deberemos usar bindParam() cuando tengamos que pasar datos m\u00faltiples, como por ejemplo, un array. <?php // se asignan nombre a los par\u00e1metros $sql = \"DELETE FROM stock WHERE unidades = :cant\" ; $sentencia = $conexion -> prepare ( $sql ); // bindParam enlaza por referencia $cantidad = 0 ; $sentencia -> bindParam ( \":cant\" , $cantidad ); $cantidad = 1 ; // se eliminan con cant = 1 $isOk = $sentencia -> execute (); // bindValue enlaza por valor $cantidad = 0 ; $sentencia -> bindValue ( \":cant\" , $cantidad ); $cantidad = 1 ; // se eliminan con cant = 0 $isOk = $sentencia -> execute (); Para m\u00e1s informaci\u00f3n y uso de las variables PDO consulta el manual de PHP .","title":"bindParam VS bindValue"},{"location":"06accesoDatos.html#insertando-registros","text":"A la hora de insertar registros en una base de datos, debemos tener en cuenta que en la tabla puede haber valores autoincrementados. Para salvaguardar \u00e9sto, lo que debemos hacer es dejar ese cambpo autoincrementado vac\u00edo, pero a la hora de hacer la conexi\u00f3n, debemos recuperarlo con el m\u00e9todo lastInsertId() . <?php $nombre = $_GET [ \"nombre\" ] ?? \"SUCURSAL X\" ; $telefono = $_GET [ \"telefono\" ] ?? \"636123456\" ; $sql = \"INSERT INTO tienda(nombre, tlf) VALUES (:nombre, :telefono)\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> bindParam ( \":nombre\" , $nombre ); $sentencia -> bindParam ( \":telefono\" , $telefono ); $isOk = $sentencia -> execute (); $idGenerado = $conexion -> lastInsertId (); echo $idGenerado ;","title":"Insertando registros"},{"location":"06accesoDatos.html#consultando-registros","text":"A la hora de recuperar los resultados de una consulta, bastar\u00e1 con invocar al m\u00e9todo PDOStatement::fetch para listar las filas generadas por la consulta. Pero debemos elegir el tipo de dato que queremos recibir entre los 3 que hay disponibles: PDO::FETCH_ASSOC: array indexado cuyos keys son el nombre de las columnas. PDO::FETCH_NUM: array indexado cuyos keys son n\u00fameros. PDO::FETCH_BOTH: valor por defecto. Devuelve un array indexado cuyos keys son tanto el nombre de las columnas como n\u00fameros. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"select * from tienda\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_ASSOC ); $sentencia -> execute (); while ( $fila = $sentencia -> fetch ()){ echo \"Codigo:\" . $fila [ \"cod\" ] . \"<br />\" ; echo \"Nombre:\" . $fila [ \"nombre\" ] . \"<br />\" ; echo \"Tel\u00e9fono:\" . $fila [ \"tlf\" ] . \"<br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Recuperando datos con una matriz como resultado de nuestra consulta <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_ASSOC ); $sentencia -> execute (); $tiendas = $sentencia -> fetchAll (); foreach ( $tiendasas$tienda ) { echo \"Codigo:\" . $tienda [ \"cod\" ] . \"<br />\" ; echo \"Nombre:\" . $tienda [ \"nombre\" ] . \"<br />\" ; } Pero si lo que queremos es leer datos con forma de objeto utilizando PDO::FETCH_OBJ , debemos crear un objeto con propiedades p\u00fablicas con el mismo nombre que las columnas de la tabla que vayamos a consultar. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 consulta con formato de objeto \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_OBJ ); $sentencia -> execute (); while ( $t = $sentencia -> fetch ()) { echo \"Codigo:\" . $t -> cod . \"<br />\" ; echo \"Nombre:\" . $t -> nombre . \"<br />\" ; echo \"Tel\u00e9fono:\" . $t -> tlf . \"<br />\" ; }","title":"Consultando registros"},{"location":"06accesoDatos.html#consultas-con-modelos","text":"Llevamos tiempo creando clases en PHP y las consultas tambi\u00e9n admiten este tipo de datos mediante el uso de PDO::FETCH_CLASS Si usamos este m\u00e9todo, debemos tener en cuenta que los nombres de los atributos privados deben coincidir con los nombres de las columnas de la tabla que vayamos a manejar. As\u00ed pues, si por lo que sea cambiamos la estructura de la tabla DEBEMOS CAMBIAR nuestra clase para que todo siga funcionando. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 clase Tienda \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 classTienda { private int $cod ; private string $nombre ; private ? string $tlf ; public function getCodigo () : int { return $this -> cod ; } public function getNombre () : string { return $this -> nombre ; } public function getTelefono () : ? string { return $this -> tlf ; } } <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Consultando a trav\u00e9s de la clase Tienda \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda\" ; $sentencia = $conexion -> prepare ( $sql ); // Aqu\u00ed 'Tienda' es el nombre de nuestra clase $sentencia -> setFetchMode ( PDO :: FETCH_CLASS , \"Tienda\" ); $sentencia -> execute (); while ( $t = $sentencia -> fetch ()) { echo \"Codigo: \" . $t -> getCodigo () . \"<br />\" ; echo \"Nombre: \" . $t -> getNombre () . \"<br />\" ; echo \"Tel\u00e9fono: \" . $t -> getTelefono () . \"<br />\" ; var_dump ( $t ); } Pero \u00bfqu\u00e9 pasa si nuestras clases tienen constructor? pues que debemos indicarle, al m\u00e9todo FECTH, que rellene las propiedades despu\u00e9s de llamar al constructor y para ello hacemos uso de PDO::FETCH_PROPS_LATE . <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Consulta para una clase con constructor \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_CLASS | PDO :: FETCH_PROPS_LATE , Tienda :: class ); $sentencia -> execute (); $tiendas = $sentencia -> fetchAll ();","title":"Consultas con modelos"},{"location":"06accesoDatos.html#consultas-con-like","text":"Para utilizar el comod\u00edn LIKE u otros comodines, debemos asociarlo al dato y NUNCA en la propia consulta. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Utilizando comodines :: LIKE \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM tienda where nombre like :nombre or tlf like :tlf\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_CLASS | PDO :: FETCH_PROPS_LATE , Tienda :: class ); $cadBuscar = \"%\" . $busqueda . \"%\" ; $sentencia -> execute ([ \"nombre\" => $cadBuscar , \"tlf\" => $cadBuscar ]); $result = $sentencia -> fetchAll (); Ten\u00e9is una lista de ejemplos muy completa en la documentaci\u00f3n oficial .","title":"Consultas con LIKE"},{"location":"06accesoDatos.html#login-password","text":"Para manejar un sistema completo de login y password con contrase\u00f1as cifradas, necesitamos un m\u00e9todo que cifre esos strings que el usuario introduce como contrase\u00f1a; tanto en el formulario de registro como en el del login, ya que al codificar una contrase\u00f1a, despu\u00e9s tenemos que decodificarla para comprobar que ambas contras\u00f1eas (la que instroduce el usuario en el login y la que tenemos en la base de datos) coincidan. Necesitamos pues: password_hash() para almacenar la contrase\u00f1a en la base de datos a la hora de hacer el INSERT PASSWORD_DEFAULT almacenamos la contrase\u00f1a usando el m\u00e9todo de encriptaci\u00f3n bcrypt PASSWORD_BCRYPT almacenamos la contrase\u00f1a usando el algoritmo CRYPT_BLOWFISH compatible con crypt() password_verify() para verificar el usuario y la contrase\u00f1a <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Almacenando usuario y password en BD \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $usu = $_POST [ \"usuario\" ]; $pas = $_POST [ \"password\" ]; $sql = \"INSERT INTO usuarios(usuario, password) VALUES (:usuario, :password)\" ; $sentencia = $conexion -> prepare ( $sql ); $isOk = $sentencia -> execute ([ \"usuario\" => $usu , \"password\" => password_hash ( $pas , PASSWORD_DEFAULT ) ]); Ahora que tenemos el usuario codificado y guardado en la base de datos, vamos a recuperarlo para poder loguearlo correctamente. <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Recuperando usuario y password en BD \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $usu = $_POST [ \"login\" ] ?? \"\" ; $sql = \"select * from usuarios where usuario = ?\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> execute ([ $usu ]); $usuario = $sentencia -> fetch (); if ( $usuario && password_verify ( $_POST [ 'pass' ], $usuario [ 'password' ])) { echo \"OK!\" ; } else { echo \"KO\" ; }","title":"Login &amp; Password"},{"location":"06accesoDatos.html#acceso-a-ficheros","text":"Gracias a la funcion fopen() desde PHP podemos abrir archivos que se encuentren en nuestros servidor o una URL. A esta funci\u00f3n hay que pasarle 2 par\u00e1metros; el nombre del archivo que queremos abrir y el modo en el que se abrir\u00e1 $fp = fopen(\"miarchivo.txt\", \"r\"); Muchas veces no podemos abrir el archivo porque \u00e9ste no se encuentra o no tenemos acceso a \u00e9l, por eso es recomendable comprobar que podemos hacerlo if (!$fp = fopen(\"miarchivo.txt\", \"r\")){ echo \"No se ha podido abrir el archivo\"; }","title":"Acceso a ficheros"},{"location":"06accesoDatos.html#modos-de-apertura-de-ficheros","text":"r : Modo lectura. Puntero al principio del archivo. r+ : Apertura para lectura y escritura. Puntero al principio del archivo w : Apertura para escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear. w+ : Apertura para lectura y escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear. a : Apertura para escritura. Puntero al final del archivo. Si no existe se intenta crear. a+ : Apertura para lectura y escritura. Puntero al final del archivo. Si no existe se intenta crear. x : Creaci\u00f3n y apertura para s\u00f3lo escritura. Puntero al principio del archivo. Si el archivo ya existe dar\u00e1 error E_WARNING. Si no existe se intenta crear. x+ : Creaci\u00f3n y apertura para lectura y escritura. Mismo comportamiento que x. c : Apertura para escritura. Si no existe se crea. Si existe no se sobreescribe ni da ning\u00fan error. Puntero al principio del archivo. c+ : Apertura para lectura y escritura. Mismo comportamiento que C. b : Cuando se trabaja con archivos binarios como jpg, pdf, png y dem\u00e1s. Se suele colocar al final del modo, es decir rb, r+b, x+b, wb...","title":"Modos de apertura de ficheros"},{"location":"06accesoDatos.html#operaciones-con-archivos","text":"Para poder leer un archivo necesitamos usar la funci\u00f3n fread() de PHP // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Abriendo un archivo y leyendo su contenido \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\"; $fp = fopen($file, \"r\"); // filesize() nos devuelve el tama\u00f1o del archivo en cuesti\u00f3n $contents = fread($fp, filesize($file)); // Cerramos la conexi\u00f3n con el archivo fclose(); Si lo que queremos es escribir en un archivo, deberemos hacer uso de la funci\u00f3n fwrite() // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Escribiendo en un archivo \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\"; $texto = \"Hola que tal\"; $fp = fopen($file, \"w\"); fwrite($fp, $texto); fclose($fp);","title":"Operaciones con archivos"},{"location":"06accesoDatos.html#informacion-de-un-fichero","text":"Con PHP y su m\u00e9todo stat() podemos obtener informaci\u00f3n sobre los archivos que le indiquemos. Este m\u00e9todo devuelve hasta un total de 12 elementos con ifnormaci\u00f3n acerca de nuestro archivo. 0 dev n\u00famero de dispositivo 1 ino n\u00famero de i-nodo 2 mode modo de protecci\u00f3n del i-nodo 3 nlink n\u00famero de enlaces 4 uid ID de usuario del propietario 5 gid ID de grupo del propietario 6 rdev tipo de dispositivo, si es un dispositivo i-nodo 7 size tama\u00f1o en bytes 8 atime momento del \u00faltimo acceso (tiempo Unix) 9 mtime momento de la \u00faltima modificaci\u00f3n (tiempo Unix) 10 ctime momento de la \u00faltima modificaci\u00f3n del i-nodo (tiempo Unix) 11 blksize tama\u00f1o del bloque E/S del sistema de ficheros 12 blocks n\u00famero de bloques de 512 bytes asignados Unos ejemplos... <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 Informaci\u00f3n del archivo \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\" ; $texto = \"Todos somos muy ignorantes, lo que ocurre es que no todos ignoramos las mismas cosas.\" ; $fp = fopen ( $file , \"w\" ); fwrite ( $fp , $texto ); $datos = stat ( $file ); echo $datos [ 3 ] . \"<br>\" ; // N\u00famero de enlaces, 1 echo $datos [ 7 ] . \"<br>\" ; // Tama\u00f1o en bytes, 85 echo $datos [ 8 ] . \"<br>\" ; // Momento de \u00faltimo acceso, 1444138104 echo $datos [ 9 ] . \"<br>\" ; // Momento de \u00faltima modificaci\u00f3n, 1444138251 ?> Echa un vistazo a las funciones de directorios que tiene PHP, es muy interesante.","title":"Informaci\u00f3n de un fichero"},{"location":"06accesoDatos.html#archivos-pdf","text":"Con PHP podemos manejar todo tipo de archivos como ya hemos visto pero, \u00bfqu\u00e9 pasa si queremos generar ficheros PDF con datos sacados de una base de datos? Gracias a una clase escrita en PHP, podemos generar archivos PDF sin necesidad de instalar librer\u00edas adicionales en nuestro servidor. Para ello, como tenemos composer dentro de nuestra imagen de Docker, usaremos composer para instalar esta dependencia. Acu\u00e9rdate que debemes haber hecho composer init para empezar un proyecto con composer, de lo contrario no podr\u00e1s a\u00f1adir ning\u00fan paquete. Veamos un ejemplo de Hello World convertido a PDF <?php ob_end_clean (); require ( 'fpdf/fpdf.php' ); // Instanciamos la clase // P = Portrait | mm = unidades en mil\u00edmetros | A4 = formato $pdf = new FPDF ( 'P' , 'mm' , 'A4' ); // A\u00f1adimos una p\u00e1gina $pdf -> AddPage (); // Establecemos la fuente y el tama\u00f1o de letra $pdf -> SetFont ( 'Arial' , 'B' , 18 ); // Imprimimos una celda con el texto que nosotros queramos $pdf -> Cell ( 60 , 20 , 'Hello World!' ); // Terminamos el PDF $pdf -> Output (); ?> Hay muchos ejemplos y tutoriales, as\u00ed como documentaci\u00f3n de la clase FPDF en la p\u00e1gina oficial. Visita la secci\u00f3n de tutoriales y el manual para sacar mayor partido a esta clase. <?php require ( 'fpdf/fpdf.php' ); class PDF extends FPDF { // Cabecera function Header () { // A\u00f1adimos un logotipo $this -> Image ( 'logo.png' , 10 , 8 , 33 ); // establecemos la fuente y el tama\u00f1o $this -> SetFont ( 'Arial' , 'B' , 20 ); // Movemos el contenido un poco a la derecha $this -> Cell ( 80 ); // Pintamos la celda $this -> Cell ( 50 , 10 , 'Cabecera' , 1 , 0 , 'C' ); // Pasamos a la siguiente l\u00ednea $this -> Ln ( 20 ); } // Pie de p\u00e1gina function Footer () { // Nos posicionamos a 1.5 cm desde abajo del todo de la p\u00e1gina $this -> SetY ( - 15 ); // Arial italic 8 $this -> SetFont ( 'Arial' , 'I' , 8 ); // N\u00famero de p\u00e1gina $this -> Cell ( 0 , 10 , 'P\u00e1gina ' . $this -> PageNo () . '/{nb}' , 0 , 0 , 'C' ); } } // Instanciamos la clase $pdf = new PDF (); // Definimos un alias para la numeraci\u00f3n de p\u00e1ginas $pdf -> AliasNbPages (); $pdf -> AddPage (); $pdf -> SetFont ( 'Times' , '' , 14 ); for ( $i = 1 ; $i <= 30 ; $i ++ ) $pdf -> Cell ( 0 , 10 , 'N\u00famero de l\u00ednea ' . $i , 0 , 1 ); $pdf -> Output (); ?>","title":"Archivos PDF"},{"location":"06accesoDatos.html#actividades","text":"","title":"Actividades"},{"location":"06accesoDatos.html#mysqli_1","text":"Crea una nueva base de datos con el nombre lol y cotejamiento de datos utf8mb4_unicode_ci . En nuestra base de datos lol que acabamos de crear, vamos a crear la tabla campeon con los siguientes campos. id [*] nombre rol dificultad descripcion Acu\u00e9rdate que [*] significa que es clave primaria y no olvides poner el tipo de datos de cada uno de los campos. Rellena la tabla campeon con, al menos 5 registros, con los datos que t\u00fa quieras o si lo prefieres, puedes basarte en la p\u00e1gina oficial del juego pero \u00a1\u00a1 NO TE PONGAS A JUGAR !! Crea el archivo 604campeones.php donde listes todos los campeones del LOL que has metido en tu base de datos. Acu\u00e9rdate que para ello deberas hacer una conexi\u00f3n con la base de datos y un foreach para cada campe\u00f3n que tengas albergado en la tabla campeon . Modifica el archivo 604campeones.php y gu\u00e1rdalo como 606campeones.php pero pon al lado de cada uno de los campeones listados un bot\u00f3n para editar y otro para borrar . Cada uno de esos botones har\u00e1 la correspondiente funci\u00f3n dependiendo del id del campe\u00f3n seleccionado. Al pinchar en editar, el usuario ser\u00e1 redirigido al archivo 605editando.php donde mostrar\u00e1 un formulario con los campos rellenos por los datos del campe\u00f3n seleccionado. Al darle al bot\u00f3n de guardar los datos se guardar\u00e1n en la base de datos y el usuario ser\u00e1 redirigido a la lista de campones para poder ver los cambios. Al pinchar en borrar, el usuario ser\u00e1 preguntado a trav\u00e9s de un mensaje de JavaScript (prompt) si est\u00e1 seguro de que quiere borrar al campe\u00f3n seleccionado. En el mensaje de confirmaci\u00f3n debe aparecer el nombre del campe\u00f3n seleccionado . Si el usuario pincha en Aceptar el campe\u00f3n ser\u00e1 eliminado de la base de datos y el usuario ser\u00e1 redirigido nuevamente al listado de campeones para comprobar que, efectivamente dicho campe\u00f3n se ha eliminado de la lista.","title":"MySQLi"},{"location":"06accesoDatos.html#filtros-y-comodines","text":"modifica el archivo 604campeones.php y gu\u00e1rdalo como 606campeones.php para que se muestre como una tabla con las columnas de la propia tabla de la base de datos, es decir; id, nombre, rol, dificultad, descripci\u00f3n. Al lado de cada nombre de cada columna, pon 2 iconos que sean \u02c4 \u02c5 y que cada uno de ellos ordene el listado en funci\u00f3n de cu\u00e1l se haya pinchado. Si se ha pulsado en Nombre el icono de \u02c4, el listado debe aparecer ordenado por nombre ascendente. Si por el contrario se ha pulsado \u02c5 tendr\u00e1 que ordenarse por nombre descendente. Ten en cuenta que cada icono debe llevar consigo un enlace al listado que contenga par\u00e1metros en la URL que satisfagan las opciones seleccionadas as\u00ed que haced uso de $_GET para poder capturarlos y escribid las consultas SQL que sean necesarias para hacer cada uno de los filtros. Puedes usar Font Awesome para los iconos pero es algo opcional","title":"Filtros y comodines"},{"location":"06accesoDatos.html#pdo","text":"Aprovecha lo que hiciste de los ejercicios 601 al 604 pero esta vez utilizando PDO::FETCH_ASSOC . Crea una tabla nueva dentro de la base de datos lol que ya tienes y crea un sistema de login con usuarios. Introduce en la base de datos al menos 3 usuarios diferentes con sus contrase\u00f1as distintas. Recuerda que: La tabla nueva ha de llamarse usuario Los campos a crear en la nueva tabla deben ser id [*] nombre usuario password email Las contrase\u00f1as deben ser cifradas antes de guardar el datos en la base de datos. Crea el formulario 608registro.php donde el usuario introduzca los datos de registro y vinc\u00falalo con 608nuevoUsuario.php para que recoja los datos mediante POST y los inserte en la base de datos si todo ha ido bien. Queda PROHIBID\u00cdSIMO acceder a 608nuevoUsuario.php sin el formulario rellenado. La sentencia de INSERT debe estar controlada para que no pueda introducirse ning\u00fan dato en blanco. Ten en cuenta que est\u00e1s modificando la base de datos y no queremos campos mal rellenados. Si todo ha ido bien, muestra un mensaje por pantalla diciendo El usuario XXX ha sido introducido en el sistema con la contrase\u00f1a YYY .","title":"PDO"},{"location":"06accesoDatos.html#ficheros","text":"M\u00e9tete en loremipsum.com y genera un texto de 3 p\u00e1rrafos. Copia el texto generado y gu\u00e1rdalo en un archivo nuevo llamado 609loremIpsum.txt . Genera un archivo php llamado 609loremIpsum.php y muestra por pantalla el texto del archivo txt que acabas de crear, su tama\u00f1o en Kilobytes , la fecha de su \u00faltima modificaci\u00f3n y el ID de usuario que cre\u00f3 el archivo. Vuelve a cargar el archivo 606campeones.php y ren\u00f3mbralo a 610campeones.php pero en vez de mostrar la tabla por pantalla, genera un archivo CSV 610campeones.csv y otro 610campeonesCSV.php donde saques por pantalla el contenido del archivo 610campeones.csv .","title":"Ficheros"},{"location":"06accesoDatos.html#proyecto-chollosevero","text":"Estructura el proyecto y piensa en las tablas y bases de datos que necesit\u00e9is para crear el proyecto. Crea los UML necesarios con nombres como 615UMLnombreTabla metiendo todos los campos que se necesiten as\u00ed como las relaciones que creas necesarias. Establece un sistema de archivos para el proyecto, teniendo en cuenta que van a haber im\u00e1genes, css, funciones php, constantes e incluso javaScript (pero algo b\u00e1sico) para controlar los eventos del usuario a lo largo de la interfaz. Crea un sistema de login/password con los roles administrador y usuario . De momento que se validen los usuarios correctamente utilizando encriptaci\u00f3n en la contrase\u00f1a. Administrador : Puede ver todos los usuarios registrados as\u00ed como los administradores y los chollos creados en la base de datos. Usuario : Puede ver sus propios chollos, editarlos y borrarlos, adem\u00e1s de crear nuevos. Crea la vista para poner nuevos chollos y recuerda s\u00f3lo pueden entrar a esta vista usuarios registrados o administradores . Crea la vista donde se muestren todos los chollos creados. Esta vista puede verla cualquier usuario, registrado o no en el sistema. Ten en cuenta que esta vista ser\u00e1 la vista general de la web as\u00ed que puedes llamarla index.php donde despu\u00e9s aplicaremos filtros por $_GET.","title":"Proyecto CholloSevero"},{"location":"07frameworks.html","text":"img { margin: 20px 0; border-radius: 8px; } .alert { color: #BD1550; } .warning { color: #E97F02; } .success { color: #8A9B0F; } .center { text-align: center; } .right { text-align: right; } .img-small { max-width: 200px; margin: auto; } .img-medium { max-width: 400px; margin: auto; } .img-large { max-width: 800px; margin: auto; } .leyenda { font-size: small; margin: 10px 0; } Frameworks PHP. Laravel \u00b6 Duraci\u00f3n estimada: 40 sesiones Puesta en marcha \u00b6 Lo primero de todo es crear una carpeta con el nombre del proyecto que vayamos a crear y nos metemos en ella. Vamos a utilizar la imagen de Bitnami ya preparada, as\u00ed que lo que hacer ahora es descargar el archivo docker-compose.yml del repositorio de Github oficial. Una vez descargado el archivo en nuestra carpeta que acabamos de crear con el nombre del proyecto, lanzamos el siguiente comando por consola para instalar todas las dependencias y crear las im\u00e1genes de Docker correspondientes. docker-compose -p Laravel up -d Si todo ha salido bien podr\u00e1s ver en el Visual Studio Code que se han creado 2 im\u00e1genes y que el servidor web de Laravel est\u00e1 funcionando bajo la siguiente URL. http://localhost:8000 Si por alguna extra\u00f1a raz\u00f3n est\u00e1s en Windows y no te funciona una de las 2 im\u00e1genes, puede ser debido a la instalci\u00f3n de composer dentro de la imagen de Laravel. Para solucionarlo, nos vamos a la carpeta del proyecto que se te habr\u00e1 creado por defecto al hacer docker-compose, en este caso y si no has modificado el archivo .yml la carpeta del proyecto sera my-proyect y dentro de ella eliminamos la carpeta vendor . Cuando hayamos eliminado dicha carpeta, necesitaremos instalar Composer de manera global en nuestro sistema Windows. Para ello. b\u00e1jate el instalador desde este enlace . Una vez lo instales ya ser\u00e1s capaz de lanzar el comando composer desde cualquier consola de Windows. Por \u00faltimo, abrimos una consola dentro de la carpeta my-project o el nombre que le hayas puesto a la carpeta del proyecto de Laravel y ejecutamos el siguiente comando. composer install Para terminar tan s\u00f3lo tendremos que volver a ejecutar el contenedor de Laravel desde Docker. VSCode extensiones \u00b6 Recomendable instalar los siguientes plugins para Visual Studio Code Laravel Blade Snippets Carpetas en Laravel \u00b6 Al crear un nuevo proyecto con este framework, Laravel crea una serie de carpetas por defecto. Esta estructura de carpetas es la recomendada para utilizar Laravel. Public \u00b6 Esta es la carpeta m\u00e1s importante ya que es donde se ponen todos los archivos que el cliente va a mostrar al usuario cuando introduzcamos la URL de nuestro sitio web. Normalmente se carga el archivo index.php por defecto. Routes \u00b6 Otra de las carpetas que m\u00e1s vamos a usar a lo largo de este curso de Laravel. En ella se albergan todas las rutas (redirecciones web) de nuestro proyecto, pero m\u00e1s concretamente en el archivo web.php Dada una ruta \u2192 se cargar\u00e1 una vista Resources \u00b6 Esta es nuestra carpeta de recursos donde guardaremos los siguientes archivos, que tambi\u00e9n, est\u00e1n separados por sus carpetas... como cada nombre indica: css Archivos CSS js Archivos JS (JavaScript) lang Archivos relacionados con el idioma del sitio (variables & strings) views Archivos de nuestras vistas, lo que las rutas cargan Rutas \u00b6 Las rutas en Laravel (y en casi cualquier Framework) sirven para redireccionar al cliente (o navegador) a las vistas que nosotros queramos. Estas rutas se configuran en el archivo public/routes/web.php donde se define la ruta que el usuario pone en la URL despu\u00e9s del dominio y se retorna la vista que se quiere cargar al introducir dicha direcci\u00f3n en el navegador. <?php // Ruta por defecto para cargar la vista welcome cuando el usuario introduce simplemente el dominio Route :: get ( '/' , function () { return view ( 'welcome' ); }); En el ejemplo de arriba vamos a cargar la vista llamada welcome que hace referencia a la vista resources/views/welcome.blade.php Alias \u00b6 Es interesante darle un alias o un nombre a nuestras rutas para poder utilizar dichos alias en nuestras plantillas de Laravel que veremos m\u00e1s adelante. Para ello, basta con utilizar la palabra name al final de la estructura de la ruta y darle un nombre que queramos; normalmente descriptivo y asociado a la vista que tiene que cargar el enroutador de Laravel. <?php Route :: get ( '/users' , function () { return view ( 'users' ); }) -> name ( 'usuarios' ); Despu\u00e9s veremos que es muy \u00fatil ya que a la hora de refactorizar o hacer un cambio, si tenemos enlaces o men\u00fas de navegaci\u00f3n que apuntan a esta ruta, s\u00f3lo tendr\u00edamos que cambiar el par\u00e1metro dentro del get() y no tener que ir archivo por archivo. Laravel nos proporciona una manera m\u00e1s c\u00f3moda a la hora de cargar una vista si no queremos par\u00e1metros ni condiciones. Tan s\u00f3lo definiremos la siguiente l\u00ednea que hace referencia la ruta datos en la URL y va a cargar el archivo usuarios.php de nuestra carpeta views como le hemos indicado en el segundo par\u00e1metro. <?php /* http://localhost/datos/ */ Route :: view ( 'datos' , 'usuarios' ); Pero no s\u00f3lo podemos retornar una vista sino, desde un simple string a m\u00f3dulos propios de Laravel. Par\u00e1metros \u00b6 Ya hemos visto que con PHP podemos pasar par\u00e1metros a trav\u00e9s de la URL, como si fueran variables, que las recuper\u00e1bamos a trav\u00e9s del m\u00e9todo GET o POST. Con Laravel tambi\u00e9n podemos introducir par\u00e1metros pero de una forma m\u00e1s vistosa y ordenada, de tal manera que sea visualmente m\u00e1s c\u00f3modo de recordar y de indexar por los motores de b\u00fasqueda como Google. http://localhost/cliente/324 Para configurar este tipo de rutas en nuestro archivo de rutas public/routes/web.php haremos lo siguiente. <?php Route :: get ( 'cliente/{id}' , function ( $id ) { return ( 'Cliente con el id: ' . $id ); }); \u00bfQu\u00e9 pasa si no introducimos un id y s\u00f3lo navegamos hasta cliente/ ? ... Nos va a devolver un 404 Para resolver \u00e9sto, podemos definir una ruta por defecto en caso de que el id (o par\u00e1metro) no sea pasado. Para ello usaremos el s\u00edmbolo ? en nuestro nombre de ruta e inicializaremos la variable con el valor que queramos. <?php Route :: get ( 'cliente/{id?}' , function ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); }); Ahora tenemos otro problema, porque estamos filtrando por id del cliente que, normalmente es un n\u00famero, pero si metemos un par\u00e1metro que no sea un n\u00famero, vamos a obtener un resultado no deseado. Para resolver este caso haremos uso de la cl\u00e1usula where junto con una expresi\u00f3n regular n\u00famerica. <?php Route :: get ( 'cliente/{id?}' , function ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); }) -> where ( 'id' , '[0-9]+' ); Adem\u00e1s, podemos pasarle variables a nuestra URL para luego utilzarlas en nuestros archivos de plantillas o en archivos .php haciendo uso de un array asociativo. Veamos un ejemplo con la forma reducida para ahorrarnos c\u00f3digo <?php Route :: view ( 'datos' , 'usuarios' , [ 'id' => 5446 ]); ... y el archivo resources/views/usuarios.php debe tener algo parecido a \u00e9sto <!-- Estructura t\u00edpica de un archivo HTML5 --> < p > Usuario con id: <?= $id ?> </ p > <!-- ... --> Con las plantillas de Laravel blade.php veremos c\u00f3mo simplificar a\u00fan m\u00e1s nuestro c\u00f3digo. Para m\u00e1s informaci\u00f3n acerca de las rutas, par\u00e1metros y expresiones regulares en las rutas puedes echar un vistazo a la documentaci\u00f3n oficial de rutas que contiene numerosos ejemplos. Plantillas o Templates \u00b6 A trav\u00e9s de las plantillas de Laravel vamos a escribir menos c\u00f3digo PHP y vamos a tener nuestros archivos mejor organizados. Blade es el sistema de plantillas que trae Laravel, por eso los archivos de plantillas que guardamos en el directorio de views llevan la extensi\u00f3n blade.php . De esta manera sabemos inmediatamente que se trata de una plantilla de Laravel y que forma parte de una vista que se mostrar\u00e1 en el navegador. Directivas \u00b6 Laravel tiene un gran n\u00famero de directivas que podemos utilizar para ahorrarnos mucho c\u00f3digo repetitivo entre otras funciones. Digamos que las directivas son peque\u00f1as funciones ya escritas que aceptan par\u00e1metros y que cada una de ellas hace una funci\u00f3n diferente dentro de Laravel. @yield Define el contenido din\u00e1mico que se va a cargar. Se usa conjuntamente con @section @section y @endsection bloque de c\u00f3digo din\u00e1mico @extends importa el contenido de una plantilla ya creada Separando c\u00f3digo \u00b6 Veamos un ejemplo de c\u00f3mo hacer uso del poder de Laravel para crear plantillas y no repetir c\u00f3digo. Supongamos que tenemos ciertas estructuras HTML repetidas como puede ser una cabecera header , un men\u00fa de navegaci\u00f3n nav y un par de secciones que hacen uso de este mismo c\u00f3digo. Supongamos que tenemos 2 apartados en la web: Blog Fotos Primero de todo tendremos que generar un archivo que haga de plantilla de nuestro sitio web. Para ello creamos el archivo plantilla.blade.php dentro de nuestro directorio de plantillas resources/views . Dicho archivo va a contener el t\u00edpico c\u00f3digo de una p\u00e1gina simple de HTML y en el body a\u00f1adiremos nuestros contenido est\u00e1tico y din\u00e1mico. < body > <!-- CONTENIDO EST\u00c1TICO PARA TODAS LAS SECCIONES --> < h1 > Bienvenid@s a Laravel </ h1 > < hr > <!-- MEN\u00da --> < nav > < a href = {{ route (' noticias ') }} > Blog </ a > | < a href = {{ route (' galeria ') }} > Fotos </ a > </ nav > <!-- CONTENIDO DIN\u00c1MICO EN FUNCI\u00d3N DE LA SECCI\u00d3N QUE SE VISITA --> < header > @yield('apartado') </ header > </ body > Cada secci\u00f3n que haga uso de esta plantilla contendr\u00e1 el texto est\u00e1tico Bienvenid@s a Laravel seguido de un men\u00fa de navegaci\u00f3n con enlaces a cada una de las secciones y el contenido din\u00e1mico de cada secci\u00f3n. Ahora crearemos los archivos din\u00e1micos de cada una de las secciones, en nuestro caso blog.blade.php y fotos.blade.php <?php // blog.blade.php @ extends ( 'plantilla' ) @ section ( 'apartado' ) < h2 > Est\u00e1s en BLOG </ h2 > @ endsection Importamos el contenido de plantilla bajo la directiva @extends para que cargue los elementos est\u00e1ticos que hemos declarado y con la directiva @section y @endsection definimos el bloque de c\u00f3digo din\u00e1mico, en funci\u00f3n de la secci\u00f3n que estemos visitando. Ahora casi lo mismo para la secci\u00f3n de fotos <?php // fotos.blade.html @ extends ( 'plantilla' ) @ section ( 'apartado' ) < h2 > Est\u00e1s en FOTOS </ h2 > @ endsection El \u00faltimo paso que nos queda es configurar el archivo de rutas routes/web.php <?php // web.php Route :: view ( 'blog' , 'blog' ) -> name ( 'noticias' ); Route :: view ( 'fotos' , 'fotos' ) -> name ( 'galeria' ); De esta manera podremos hacer uso del men\u00fa de navegaci\u00f3n que hemos puesto en nuestra plantilla y gracias a los alias noticias y galeria , la URL ser\u00e1 m\u00e1s amigable. Estructuras de control \u00b6 Como en todo buen lenguaje de programaci\u00f3n, en Laravel tambi\u00e9n tenemos estructuras de control. En Blade (plantillas de Laravel) siempre que iniciemos un bloque de estructura de control DEBEMOS cerrarla @foreach ~ @endforeach lo usamos para recorrer arrays @if ~ @endif para comprobar condiciones l\u00f3gicas @switch ~ @endswitch en funci\u00f3n del valor de una variable ejecutar un c\u00f3digo @case define la casu\u00edstica del switch @break rompe la ejecuci\u00f3n del c\u00f3digo en curso @default si ninguna casu\u00edstica se cumple <?php $equipo = [ 'Mar\u00eda' , 'Alfredo' , 'William' , 'Ver\u00f3nica' ]; @ foreach ( $equipo as $nombre ) < p > {{ $nombre }} </ p > @ endforeach Acordaros que podemos pasar variables a trav\u00e9s de las rutas como si fueran par\u00e1metros. Pero en este caso, vamos a ver otra directiva m\u00e1s; el uso de @compact . <?php // Uso de @compact $equipo = [ 'Mar\u00eda' , 'Alfredo' , 'William' , 'Ver\u00f3nica' ]; // Route::view('nosotros', ['equipo' => 'equipo']); Route :: view ( 'nosotros' , @ compact ( 'equipo' )); Controladores \u00b6 Los controladores son el lugar perfecto para definir la l\u00f3gica de negocio de nuestra aplicaci\u00f3n o sitio web. Hace de intermediario entre la vista (lo que vemos con nuestro navegador o cliente) y el servidor donde la app est\u00e1 alojada. Por defecto, los controladores se guardan en una carpeta espec\u00edfica situada en app/Http/Controllers y tienen extensi\u00f3n .php . Para crear un controlador nuevo debemos hacer uso de nuestro querido aut\u00f3mata artisan donde le diremos que cree un controlador con el nombre que nosotros queramos. Abrimos la consola y nos situamos en la ra\u00edz de nuestro proyecto php artisan make:controller PagesController Si todo ha salido bien, recibiremos un mensaje por consola con que todo ha ido bien y podremos comprobar que, efectivamente se ha creado el archivo PagesController.php con una estructura b\u00e1sica de controlador, dentro de la carpeta Controllers que hemos descrito anteriormente. Ahora podemos modificar nuestro archivo de rutas web.pbp para dejarlo limpio de l\u00f3gica y trasladar \u00e9sta a nuestro nuevo controlador. La idea de \u00e9sto es dejar el archivo web.php tan limpio como podamos para que, de un vistazo, se entienda todo perfectamente. RECUERDA que s\u00f3lo movemos la l\u00f3gica, mientras que las cl\u00e1usulas como where y name las seguimos dejando en el archivo de rutas web.php Veamos c\u00f3mo quedar\u00eda un refactor del archivo de rutas utilizando un Controller como el que acabamos de crear Ahora nos quedar\u00eda de la siguiente manera <?php // web.php (v2.0) \u2592\u2592\u2592\u2592 Refactorizado use App\\Http\\Controllers\\PagesController ; use Illuminate\\Support\\Facades\\Route ; Route :: get ( '/' , [ PagesController :: class , 'inicio' ]); Route :: get ( 'datos' , [ PagesController :: class , 'datos' ]); Route :: get ( 'cliente/{id?}' , [ PagesController :: class , 'cliente' ]) -> where ( 'id' , '[0-9]+' ); Route :: get ( 'nosotros/{nosotros?}' , [ PagesController :: class , 'nosotros' ]) -> name ( 'nosotros' ); y en nuestro archivo controlador lo dejar\u00edamos de la siguiente manera <?php // PagesController.php namespace App\\Http\\Controllers ; class PagesController extends Controller { public function inicio () { return view ( 'welcome' ); } public function datos () { return view ( 'usuarios' , [ 'id' => 56 ]); } public function cliente ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); } public function nosotros ( $nombre = null ) { $equipo = [ 'Paco' , 'Enrique' , 'Maria' , 'Veronica' ]; return view ( 'nosotros' , @ compact ( 'equipo' , 'nombre' )); } } Migraciones & Eloquent \u00b6 Con las migraciones vamos a gestionar la base de datos de nuestro sitio web; tanto crear nuevas BBDD como editarlas desde Laravel. Las migraciones de un sitio hecho con Laravel se alojan en la ruta database/migrations y tienen extensi\u00f3n .php . Si te fijas, nada m\u00e1s instalar Laravel con la imagen de Bitnami, se han creado varios archivos de migraciones que podemos usar, pero de momento los dejamos ah\u00ed y NO LOS BORRAMOS porque son muy \u00fatiles. Archivos .env \u00b6 Es de uso com\u00fan trabajr con archivos de entorno llamados tambi\u00e9n archivos .env . Normalmente, eun unproyecto real puedes encontrarte con varios archivos de este tipo en funci\u00f3n del despliegue que se quiera hacer; como por ejemplo: test.env config. para desplegar en entorno seguro de pruebas release.env config. para desplegar cambios de versi\u00f3n que se env\u00eda a los beta testers production.env config. para desplegar el c\u00f3digo ya probado al resto del mundo. En nuestro caso, como no vamos a desplegar nada, s\u00f3lo vamos a usar un \u00fanico archivo .env y en cuesti\u00f3n de las migraciones vamos a fijarnos a partir de la l\u00ednea 11 donde dice: DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=blog DB_USERNAME=root DB_PASSWORD= En este archivo debemos configurar los datos de nuestro servidor MySQL y rellenarlo con la informaci\u00f3n correspondiente a nuestra base de datos ya creada Una vez tengamos \u00e9sto, lo que nos queda es ejecutar el comando de las migraciones a trav\u00e9s del CLI artisan php artisan migrate Si todo ha salido bien obtendremos el siguiente resultado donde podremos observar que todas las migraciones se han insertado correctamente en la base de datos. Si nos vamos al cliente que utilicemos para manejar la base de datos (phpMyAdmin por ejemplo) veremos que en nuestra base de datos se han creado todas las tablas de la migraci\u00f3n que hemos ejecutado y adem\u00e1s una tabla que se llama migrations . La tabla migrations es simplemente un registro de todas las migraciones llevadas a cabo. Adem\u00e1s, podemos hacer un rollback en caso de que queramos reestablecer nuestra base de datos. php artisan migrate:rollback O si preferimos hacer un reset para dejarla limpia php artisan migrate:reset Modelos \u00b6 Gracias a Eloquent y su integraci\u00f3n con Laravel, podremos crear modelos de datos de una manera automatizada a trav\u00e9s de artisan Ahora que ya sabemos manejar las migraciones es hora de crear nuestras propias migraciones pero a trav\u00e9s de Eloquent. A trav\u00e9s de la instrucci\u00f3n make:model creamos un nuevo modelo de datos, a continuaci\u00f3n ponemos el nombre siempre empezando en May\u00fasucla y en SINGULAR y pasamos el par\u00e1metro relacionado con las migraciones -m . php artisan make:model Nota -m Si todo ha salido bien, veremos en nuestro directorio de migraciones database/migrations un nuevo archivo que se llama 2022_01_07_81237_create_notas_table.php . El siguiente paso es ver nuestro archivo de migraciones y editarlo para que contenga las tablas que nosotros queramos. Si lo visualizamos tan s\u00f3lo tendr\u00e1 la estructura b\u00e1sica con un par de tablas. Vamos a a\u00f1adir un par de tablas m\u00e1s. <?php Schema :: create ( 'notas' , function ( Blueprint $table ) { $table -> id (); $table -> timestamps (); $table -> string ( 'nombre' ); $table -> text ( 'descripcion' ); }); En esta Schema podemos poner todas las tablas que nosotros queramos y establecer el tipo de dato para cada una de ellas, as\u00ed como el nombre. Una vez que estamos satisfechos con nuestro esquema debemos volver a ejecutar el c\u00f3digo de migraci\u00f3n a trav\u00e9s de artisan para que se introduzca esta nueva informaci\u00f3n en la base de datos. Para ver todos los tipos de datos que maneja Eloquent puedes visitar la documentaci\u00f3n oficial . Recuperando datos \u00b6 Ya tenemos nuestra base de datos creada con nuestras tablas migradas, ahora s\u00f3lo falta rellenar esas tablas con datos para poder pintarlos en nuestro c\u00f3digo HTML. Rellenamos las tablas a trav\u00e9s del cliente de MySQL que m\u00e1s nos guste: PHP MyAdmin MySQL Workbench HeidiSQL * SquirrelSQL Ahora tendremos que irnos a una vista ya creada o creamos una nueva y solicitamos los datos desde el HTML. \u00bfNos acordamos del PagesController ? pues hacer uso de su magia junto con las rutas que creamos en web.php <?php // estamos en \u2593\u2593\u2593 web.php Route :: get ( 'notas' , [ PagesController :: class , 'notas' ]); Antes de intentar entrar, debemos configurar nuestro controlador de la siguiente manera: <?php // estamos en \u2593\u2593\u2593 PagesController.php public function notas () { $notas = Nota :: all (); return view ( 'notas' , compact ( 'notas' )); } El \u00faltimo paso ser\u00eda, crear la vista con la tabla que pinte los datos a trav\u00e9s de la variable que le pasamos por par\u00e1metro en la ruta que acabamos de describir. <?php // estamos en \u2593\u2593\u2593 notas.blade.php < h1 > Notas desde base de datos </ h1 > < table border = \"1\" > < thead > < tr > < th > Nombre </ th > < th > Descripci\u00f3n </ th > </ tr > </ thead > @ foreach ( $notas as $nota ) < tr > < td > {{ $nota -> nombre }} </ td > < td > {{ $nota -> descripcion }} </ td > </ tr > @ endforeach </ table > Hay que fijarse bien en los nombres de las columnas que tienen nuestras bases de datos, es justo lo que va despu\u00e9s de -> y siempre rodeado por los s\u00edmbolos {{ }} ya que estamos en un archivo de plantilla. \u00bfQu\u00e9 pasar\u00eda si s\u00f3lo queremos acceder a un \u00fanico elemento? como si hici\u00e9semos un SELECT * from usuarios where id = 1 Para \u00e9so, tenemos una instrucci\u00f3n espec\u00edfica en Eloquent que nos soluciona el problema. En este caso usaremos la instrucci\u00f3n findOrFail y como buenos usuarios de Laravel, lo utilizaremos dentro del controlador. <?php // estamos en \u2593\u2593\u2593 PagesController.php public function detalle ( $id ) { $nota = Nota :: findOrFail ( $id ); return view ( 'notas.detalle' , compact ( 'nota' )); } Hay que acordarse que debemos configurar la ruta en nuestro archivo de rutas. <?php // estamos en \u2593\u2593\u2593 web.php Route :: get ( 'notas/{id?}' , [ PagesController :: class , 'detalle' ]) -> name ( 'notas.detalle' ); Y por \u00faltimo, debemos crear la plantilla, pero como es un archivo de detalle o que est\u00e1 relacionado con otra plantilla ya creada, podemos crear una carpeta con el nombre de la plantilla y dentro, el archivo de plantilla en cuesti\u00f3n. De tal manera que quedar\u00eda as\u00ed resources/views/notas/detalle.blade.php <?php // estamos en \u2593\u2593\u2593 detalle.blade.php @ extends ( 'plantilla' ) @ section ( 'apartado' ) < h1 > Detalle de la nota </ h1 > < h3 > ID : {{ $nota -> id }} </ h3 > < h3 > Nombre : {{ $nota -> nombre }} </ h3 > < h3 > Descripci\u00f3n : {{ $nota -> descripcion }} </ h3 > @ endsection Modificar tablas sin perder datos \u00b6 Uno de los dilemas que tenemos a la hora de manejar las bases de datos con Laravel y Eloquent, es que a veces cometemos errores y queremos introducir una nueva columna dentro de nuestra tabla o modificar una de esas columnas SIN PERDER LOS DATOS DE LA BASE DE DATOS . Imaginemos que en nuestra tabla notas queremos agregar una columna con el nombre autor . Lo primero de todo es crear una nueva migraci\u00f3n para realizar este cambio. Para ello, haremos uso de nuestro querido artisan y debemos crear el nombre de esta migraci\u00f3n con la siguiente f\u00f3rmula add_fields_to_ seguidamente del nombre de la tabla que queremos modificar. php artisan migrate add_fields_to_nota Seguidamente, nos metemos en el archivo de la migraci\u00f3n que acabamos de crear y en el apartado up() debemos poner el cambio que queremos realizar y en la secci\u00f3n down() debemos hacer lo mismo pero tenemos que decirle a Eloquent que la elimine \u00bfpor qu\u00e9? para en caso de hacer migrate rollback, se cargue este nuevo campo que hemos creado. <?php public function up () { Schema :: table ( 'notas' , function ( Blueprint $table ) { $table -> string ( 'autor' ); }); } public function down () { Schema :: table ( 'notas' , function ( Blueprint $table ) { $table -> dropColumn ( 'autor' ); }); } Formularios \u00b6 Ahora que ya sabemos c\u00f3mo cargar de una base de datos, vamos a ver c\u00f3mo insertarlos con Laravel y sin escribir ni una sola l\u00ednea de SQL. Gracias al m\u00e9todo save() de Laravel podremos guardar datos que provengan de un formulario desde nuestras plantillas. Para ello, lo primero que necesitamos lo siguiente: formulario HTML que recoja los datos que el usuario introduce Una ruta que sea la encargada de recibir los datos del formulario M\u00e9todo POST para enviar los datos al servidor Un m\u00e9todo en nuestro controlador que procese los datos y los guarde a trav\u00e9s de save() La cl\u00e1usula de seguridad @csrf para evitar ataques desde otros sitios As\u00ed pues, empecemos por el formulario < form action = \"{{ route('notas.crear') }}\" method = \"POST\" > @csrf {{-- Cl\u00e1usula para obtener un token de formulario al enviarlo --}} < input type = \"text\" name = \"nombre\" placeholder = \"Nombre de la nota\" class = \"form-control mb-2\" autofocus > < input type = \"text\" name = \"descripcion\" placeholder = \"Descripci\u00f3n de la nota\" class = \"form-control mb-2\" > < button class = \"btn btn-primary btn-block\" type = \"submit\" > Crear nueva nota </ button > </ form > Como vemos, creamos 2 inputs relacionados con nuestras columnas dentro de la tabla, en este caso nombre y descripci\u00f3n El action del formulario debe apuntar a una nueva ruta que vayamos a crear y donde enviemos los datos mediante POST . Ahora crearemos la ruta en nuestro archivo de rutas web.php <?php // estamos en \u2593\u2593\u2593 web.php Route :: post ( 'notas' , [ PagesController :: class , 'crear' ]) -> name ( 'notas.crear' ); Si nos fijamos, ya no estamos haciendo uso del get sino del m\u00e9todo post y como son m\u00e9todos diferentes, podemos nombrar la ruta de la misma manera que en get ya que no habr\u00e1 conflicto. Por otro lado, necesitamos invocar nuestro PagesController famoso y decirle que vamos a utilizar el m\u00e9todo crear que bueno, todav\u00eda no existe pero que vamos a crear a contnuaci\u00f3n. No olvidemos crear un alias para poder vincularlo al action del formulario SUPER IMPORTANTE . Para terminar, editaremos nuetro archivo PagesController.php para que el controlador que estamos usando tenga el m\u00e9todo que hemos nombrado previamente. <?php // estamos en \u2593\u2593\u2593 PagesController.php use App\\Models\\Nota ; use Illuminate\\Http\\Request ; public function crear ( Request $request ) { $notaNueva = new Nota ; $notaNueva -> nombre = $request -> nombre ; $notaNueva -> descripcion = $request -> descripcion ; $notaNueva -> save (); return back () -> with ( 'mensaje' , 'Nota agregada exit\u00f3samente' ); } Nuestro m\u00e9todo crear va a recibir un objeto llamado $request (el cual podemos cambiarle el nombre perfectamente) de tipo Request por lo que DEBEMOS IMPORTAR Request para poder utilizar dicha clase de Laravel. Dentro del m\u00e9todo crear que acabamos de escribir, debemos hacer uso del modelo Nota que ya creamos en otros ejemplos e instanciarla a traves de una variable, en nuestro caso $notaNueva . De esta manera, podremos aceder a los m\u00e9todos y propiedades de la misma, por eso podemos utilizar nombre y descripcion . As\u00ed mismo, la variable $request est\u00e1 formada por los mismos nombres de input que hemos puesto en el formulario de la plantilla, si os acord\u00e1is eran name=\"nombre\" y name=\"descripcion\" . Finalmente usamos el m\u00e9todo save() para guardar estos nuevos datos en la base de datos y retornamos a la p\u00e1gina del formulario con el m\u00e9todo back() a\u00f1adiendo un mensaje con with() . Pero \u00bfd\u00f3nde va a salir este mensaje? -- lo tenemos que declarar en nuestra plantilla @if (session('mensaje')) < div class = \"mensaje-nota-creada\" > {{ session('mensaje') }} </ div > @endif Validaciones \u00b6 Laravel nos proporciona herramientas para poder validar los datos que el usuario introduce en los campos del formulario. Adem\u00e1s de poder hacerlo con la etiqueta required de HTML5, debemos validar los datos a trav\u00e9s del Framework. Para ello, necesitamos modificar varios elementos: En primer lugar, nuestro archivo controller En segundo lugar, nuestra plantilla que carga el formulario Empecemos con el controlador. A trav\u00e9s del m\u00e9todo validate() le decimos a Eloquent qu\u00e9 campos son requeridos para poder enviar el formulario. Utilizaremos para ello un array asociativo con el nombre del input y la palabra reservada required <?php // estamos en \u2593\u2593\u2593 PagesController.php $request -> validate ([ 'nombre' => 'required' , 'descripcion' => 'required' ]); Seguidamente nos moveremos a la plantilla donde est\u00e9 el formulario y a trav\u00e9s de la directiva @error crearemos un bloque html con nuestro mensaje de error por cada uno de los inputs requeridos. <?php // estamos en \u2593\u2593\u2593 notas.blade.php @ error ( 'nombre' ) < div class = \"alert alert-danger\" > No olvides rellenar el nombre </ div > @ enderror Pero \u00bfqu\u00e9 pasa cuando ha habido un error y nos muestra el mensaje que hemos escrito? Si te fijas, los campos que hab\u00edas rellenado perder\u00e1n la informaci\u00f3n, pero con Laravel podemos persistirlos sin hacer que el usuario vuelva a introducirlos. Para poder persistir los datos una vez enviados pero con alg\u00fan error de campo requerido, utilizaremos la directiva old() como value del input dentro de nuestro formulario y le pasaremos el nombre del input declarado en la etiqueta name . <?php // estamos en \u2593\u2593\u2593 notas.blade.php < input type = \"text\" name = \"nombre\" value = \"{{ old('nombre') }}\" class = \"form-control mb-2\" placeholder = \"Nombre de la nota\" autofocus > Editando registros \u00b6 Despu\u00e9s de tener campos en la base de datos, lo interesante ser\u00eda poder editarlos a trav\u00e9s de un formulario. Laravel nos proporciona las herramientas necesarias para ello; veamos pues lo que necesitamos para poder realizar el cambio a trav\u00e9s de la directiva put() . Para poder hacer el cambio de resgistros necesitamos lo siguiente: Un enlace para redirigir a la p\u00e1gina de editar, pasando el id del elemento en cuesti\u00f3n Una nueva ruta que apunte a nuestra plantilla de editar Una plantilla para poder editar con un formulario que reciba los datos a editar Una nueva funci\u00f3n dentro de nuestro controlador para poder manejar los datos ya introducidos Una nueva ruta que utilice el m\u00e9todo put() para poder actualizar los datos Un nuevo m\u00e9todo dentro de nuestro controlador para actualizar los datos nuevos introducidos <?php // estamos en \u2593\u2593\u2593 notas.blade.php < a href = \"{{ route('notas.editar', $nota ) }}\" class = \"btn btn-warning btn-sm\" > Editar </ a > Ahora creamos la ruta <?php // estamos en \u2593\u2593\u2593 wep.php Route :: get ( 'editar/{id}' , [ PagesController :: class , 'editar' ]) -> name ( 'notas.editar' ); Route :: put ( 'editar/{id}' , [ PagesController :: class , 'actualizar' ]) -> name ( 'notas.actualizar' ); Ahora necesitamos crear una nueva plantilla resources/views/notas/editar.blade.php <?php // estamos en \u2593\u2593\u2593 editar.blade.php @ extends ( 'plantilla' ) @ section ( 'apartado' ) < h2 > Editando la nota {{ $nota -> id }} </ h2 > @ if ( session ( 'mensaje' )) < div class = \"alert alert-success\" > {{ session ( 'mensaje' )}} </ div > @ endif < form action = \"{{ route('notas.actualizar', $nota -> id) }}\" method = \"POST\" > @ method ( 'PUT' ) {{ -- Necesitamos cambiar al m\u00e9todo PUT para editar -- }} @ csrf {{ -- Cl\u00e1usula para obtener un token de formulario al enviarlo -- }} @ error ( 'nombre' ) < div class = \"alert alert-danger\" > El nombre es obligatorio </ div > @ enderror @ error ( 'descripcion' ) < div class = \"alert alert-danger\" > La descripci\u00f3n es obligatoria </ div > @ enderror < input type = \"text\" name = \"nombre\" class = \"form-control mb-2\" value = \"{{ $nota -> nombre }}\" placeholder = \"Nombre de la nota\" autofocus > < input type = \"text\" name = \"descripcion\" placeholder = \"Descripci\u00f3n de la nota\" class = \"form-control mb-2\" value = \"{{ $nota -> descripcion }}\" > < button class = \"btn btn-primary btn-block\" type = \"submit\" > Guardar cambios </ button > </ form > @ endsection Y por \u00faltimo, modificamos nuestro PagesController <?php // estamos en \u2593\u2593\u2593 PagesController.php public function editar ( $id ) { $nota = Nota :: findOrFail ( $id ); return view ( 'notas.editar' , compact ( 'nota' )); } public function actualizar ( Request $request , $id ) { $request -> validate ([ 'nombre' => 'required' , 'descripcion' => 'required' ]); $notaActualizar = Nota :: findOrFail ( $id ); $notaActualizar -> nombre = $request -> nombre ; $notaActualizar -> descripcion = $request -> descripcion ; $notaActualizar -> save (); return back () -> with ( 'mensaje' , 'Nota actualizada' ); } Eliminando registros \u00b6 A la hora de eliminar un registro nuevo, no necesitamos crear una plantilla nueva ya que podemos mandar la instrucci\u00f3n directamente a trav\u00e9s de otro formulario. Por lo tanto, para eliminar un registro de la base de datos utilizaremos lo siguiente. Un formulario b\u00e1sico con un \u00fanico bot\u00f3n de eliminar Usaremos el m\u00e9todo DELETE para sobreescribir el m\u00e9todo del formulario HTML Una ruta nueva para controlar el action de este nuevo formulario Un nuevo m\u00e9todo dentro de nuestro Controlador que lleve la l\u00f3gica para borrar el registro Vamos a ver c\u00f3mo meter ese formulario dentro de nuestro listado de notas <?php // estamos en \u2593\u2593\u2593 notas.blade.php < form action = \"{{ route('notas.eliminar', $nota ) }}\" method = \"POST\" class = \"d-inline\" > @ method ( 'DELETE' ) @ csrf < button class = \"btn btn-danger btn-sm\" type = \"submit\" > Eliminar </ button > </ form > Ahora que ya tenemos montado el formulario en nuestra plantilla, pasemos a crear la ruta que hemos colocado en el action del formulario para borrar elementos. <?php // estamos en \u2593\u2593\u2593 web.php Route :: delete ( 'eliminar/{id}' , [ PagesController :: class , 'eliminar' ]) -> name ( 'notas.eliminar' ); El \u00faltimo paso que nos queda es modificar el PagesController <?php // estamos en \u2593\u2593\u2593 PagesController.php public function eliminar ( $id ) { $notaEliminar = Nota :: findOrFail ( $id ); $notaEliminar -> delete (); return back () -> with ( 'mensaje' , 'Nota Eliminada' ); } Si todo ha salido bien, habremos creado un sitio en Laravel y Eloquent que es capaz de hacer un CRUD validando campos en formularios e insertando datos reales en una base de datos. Paginaci\u00f3n \u00b6 Para a\u00f1adir paginaci\u00f3n a nuestros resultados, Eloquent tiene un m\u00e9todo que se llama paginate() donde le pasamos un n\u00famero entero como par\u00e1metro para indicarle el n\u00famero de resultados que queremos por p\u00e1gina. <?php // estamos en \u2593\u2593\u2593 PagesController.php public function notas () { // $notas = Nota::all(); $notas = Nota :: paginate ( 5 ); return view ( 'notas' , compact ( 'notas' )); } Ahora veremos ciertos elementos HTML que se han generado en nuestra vista, \u00e9sto es porque Laravel hace uso de una librer\u00eda de paginaci\u00f3n situada en la carpeta vendor/laravel/framework/src/illuminate/Pagination Si os met\u00e9is en el directorio y abr\u00eds el archivo tailwind.blade.php ver\u00e9is la estructura HTML que os sale en la vista. Pod\u00e9is modificar este archivo a vuestro antojo, pero es recomendable guardarse una copia del mismo. Existe otra dependencia en resources/lang/en/pagination.php donde encontrar\u00e1s el idioma para la paginaci\u00f3n. Autenticaci\u00f3n \u00b6 Para la utenticaci\u00f3n de usuarios necesitamos instalar unas cuantas dependencias ya preparadas para ello. No es necesarios crear un proyecto nuevo pero nosotros vamos a hacerlo para tener uno con autenticaci\u00f3n y otro no, el que ya hicimos al principio. Primero de todo, vamos a crear un nuevo proyecto en Laravel que se llame notas_auth y nos metemos dentro de la carpeta del mismo cuando el script haya terminado. Dentro de la carpeta notas_auth lanzamos los siguientes comandos. composer require laravel/ui php artisan ui vue --auth Para terminar, lanzaremos el comando migrate que ya conocemos... SI EST\u00c1S WINDOWS fuera de la imagen de Docker (utilizando xampp o parecidos) debes crear una nueva base de datos y posteriormente modificiar el archivo .env poniendo el nombre de esa base de datos que acabas de crear. php artisan migrate Si todo ha salido bien, podr\u00e1s ver en la carpeta resources/views una carpeta que se llama auth y un controlador nuevo que llama HomeController Restringir una ruta \u00b6 Si nos fijamos, en el nuevo controlador que se ha creado HomeController podemos ver unas l\u00edneas al principio del archivo que son las que determinan si la ruta est\u00e1 restringida a usuarios registrados y logueados. <?php public function __construct () { $this -> middleware ( 'auth' ); } Mediante el uso del middleware llamado auth establecemos que todas las rutas que hagan uso de este controlador deban pasar por el login para mostrar el contenido. Por lo tanto, en nuestros proyectos es recomendable utilizar diferentes controladores para diferentes vistas; las que est\u00e9n reestringidas por el login y las que no. Datos del usuario \u00b6 Siempre que queramos acceder a cualquier dato del usuario logueado, utilizaremos el m\u00e9todo auth() para sacar por pantalla la informaci\u00f3n o para utilizar l\u00f3gica a la hora de guardar datos en la base de datos en funci\u00f3n de un usuario, un email o el campo que sea. Imaginemos que tenemos una ruta donde accedemos a dicha informaci\u00f3n <?php public function notas () { return auth () -> user (); // return auth()->user() -> name; // return auth()->user() -> email; // ... } Si visitamos esta ruta con nuestro login y password, nos aparecer\u00e1 por pantalla toda la informaci\u00f3n de nuestro user a excepci\u00f3n de la contrase\u00f1a y, aunque as\u00ed fuera porque se lo forzamos, \u00e9sta aparecer\u00e1 encriptada. Relaciones con Eloquent \u00b6 A trav\u00e9s de Eloquent vamos a poder gestionar las relaciones entre nuestras tablas de la base de datos de una manera muy sencilla y sin sentencias SQL. Uno a uno (1 a 1) \u00b6 Para crear este tipo de relaciones en Eloquent y Laravel, debemos tener creadas las tablas que vayamos a relacionar y establecer la relaci\u00f3n entre ellas a trav\u00e9s del m\u00e9todo hasOne . Supongamos que tenemos una tablas usuario que est\u00e1 relacionada con la tabla telefono . <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Usuario extends Model { /** * Obtener el Tel\u00e9fono asocioado con el Usuario */ public function telefono () { return $this -> hasOne ( Telefono :: class ); } } Una vez hecho \u00e9sto, para poder recuperar el dato relacionado, debemos utilizar las propiedades din\u00e1micas de Eloquent. Con estas propiedades din\u00e1micas podremos obtener dicho dato. <?php $telefono = Usuario :: find ( 1 ) -> telefono ; En este caso, Eloquent asume que en Usuario existe la clave ajena usuario_id pero \u00bfqu\u00e9 pasa si tenemos otro nombre? pues se lo pasamos como par\u00e1metro. <?php return $this -> hasOne ( Telefono :: class , 'clave_ajena' ); Uno a Uno INVERSA \u00b6 Ahora que podemos acceder al modelo tel\u00e9fono desde el modelo usuario, vamos a ver c\u00f3mo hacerlo de manera inversa, es decir, c\u00f3mo acceder desde el m\u00f3delo usuario desdel el modelo telefono gracias al m\u00e9todo belongsTo() . <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Telefono extends Model { public function usuario () { return $this -> belongsTo ( Usuario :: class ); } } Al llamar el m\u00e9todo de usuario , Eloquent intentar\u00e1 encontrar un modelo de usuario que tenga un id que coincida con la columna de usuario_id en el modelo de telefono . Eloquent determina el nombre de la clave externa examinando el nombre del m\u00e9todo de relaci\u00f3n y agregando el sufijo _id al nombre del m\u00e9todo. Entonces, asume que el modelo Telefono tiene una columna usuario_id . Sin embargo, si no se llama de esa manera, puedes pasarle como argumento el nombre de la clave. <?php public function usuario () { return $this -> belongsTo ( Usuario :: class , 'clave_ajena' ); } Uno a Muchos (1 a MM) \u00b6 En este caso, las relaciones de 1 a muchos podemos decir que en una entrada de un blog, o en un post de Facebook, hay muchos comentarios relacionados a esa misma publicaci\u00f3n. Para empezar, ya sabemos que debemos crear el modelo y en este caso usaremos el m\u00e9todo hasMany() para obtener los datos relacionados con ese post o entrada en el blog <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Post extends Model { public function comentarios () { return $this -> hasMany ( Comentario :: class ); } } Cuidado con las claves ajenas, que aqu\u00ed pasa lo mismo... Eloquent establece por defecto el sufijo _id por lo tanto, en este ejemplo buscar\u00eda por post_id . Si no queremos \u00e9so o nuestra clave ajena tiene otro nombre, se lo pasamos por par\u00e1metro en el m\u00e9todo hasMany como hac\u00edamos m\u00e1s arriba. Ahora, al haber m\u00e1s de un dato, necesitamos iterar, por tanto debemos crear un bucle para poder sacar cada dato. <?php use App\\Models\\Post ; $comentarios = Post :: find ( 1 ) -> comentarios ; foreach ( $comentarios as $comentario ) { // Lo que sea que hagamos con esos datos } Adem\u00e1s, como todas las relaciones son sentencias SQL, podemos anidar varios filtros en funci\u00f3n de lo que queramos sacar. $comentario = Post::find(1) -> comentarios() ->where('titulo', 'lo que sea') ->first(); Uno a Muchos INVERSA \u00b6 Ahora que podemos acceder a todos los comentarios de una publicaci\u00f3n, definamos una relaci\u00f3n para permitir que un comentario acceda a su publicaci\u00f3n principal. <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Comentario extends Model { public function post () { return $this -> belongsTo ( Post :: class ); } } Y ahora, a trav\u00e9s de la propiedad de relaci\u00f3n din\u00e1mica... <?php use App\\Models\\Comentario ; $comentario = Comentario :: find ( 1 ); return $comentario -> post -> titulo ; Pasar\u00eda lo mismo con el nombre de la clave ajena, si no se llama de la misma manera que Eloquent establece con el sufijo _id podemos pasarle como par\u00e1metro el nombre de la clave donde debe buscar. Muchos a Muchos (MM a MM) \u00b6 Este tipo de relaciones son las m\u00e1s complicadas ya que, en un Blog del estilo Wordpress por ejemplo, un usuario puede tener muchos roles (lector, autor, administrador) pero un rol pueden tenerlo varios usuarios, es decir, puede haber muchos usuarios administradores, otros lectores y dem\u00e1s. Para realizar este tipo de relaciones necesitar\u00edamos 3 tablas diferentes. usuarios [ id, nombre] roles [id, nombre] rol_usuario [usuario_id, rol_id] (Tabla Pivote) Lo primero de todo, vamos a crear las tablas con sus modelos a excepci\u00f3n de la tabla pivote rol_usuario que s\u00f3lo crearemos la tabla, sin su modelo php artisan make:migration create_rol_usuario_table --create=rol_usuario Y la estructura de dicha seria de la siguiente manera... <?php public function up () { Schema :: create ( 'rol_usuario' , function ( Blueprint $table ) { $table -> bigIncrements ( 'id' ); $table -> unsignedInteger ( 'usuario_id' ); $table -> unsignedInteger ( 'rol_id' ); $table -> timestamps (); }); } Ahora que ya tenemos todo listo, las relaciones de Muchos a Muchos vienen definidas por un m\u00e9todo que devuelve el resultado de usar el m\u00e9todo belongsToMany() <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Usuario extends Model { public function roles () { return $this -> belongsToMany ( Rol :: class ); } } Una vez que tengamos las relaciones definidas, accederemos a ellas mediante las propiedades din\u00e1micas de rol <?php use App\\Models\\Usuario ; $usuario = Usuario :: find ( 1 ); foreach ( $usuario -> roles as $rol ) { // nuestro c\u00f3digo } Acordaros que podemos encadenar comandos sql a trav\u00e9s de los m\u00e9todos de Eloquent <?php $roles = Usuario :: find ( 1 ) -> roles () -> orderBy ( 'nombre' ) -> get (); Muchos a Muchos INVERSA \u00b6 Para definir el \"inverso\" de una relaci\u00f3n de muchos a muchos, debemos establecer un m\u00e9todo en el modelo relacionado que tambi\u00e9n devuelva el resultado del m\u00e9todo belongsToMany . Seg\u00fan el ejemplo que estamos siguiendo... <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Rol extends Model { public function usuarios () { return $this -> belongsToMany ( Usuario :: class ); } } Vamos a hacer un ejemplo con una APP que gestiones alumnos y asignaturas, de tal manera que MUCHOS ALUMNOS pueden cursar MUCHAS ASIGNATURAS \u00bfQu\u00e9 necesitamos para este ejemplo? 3 migraciones para crear las tablas Alumnos /// Materias /// AlumnoMateria Modificar los archivos de las migraciones create_alumnos_table y create_materias_table . Crear la base de datos muchos_a_muchos Ejecutar las Migraciones 2 modelos para Alumnos /// Materias M\u00e9todo dentro de Alumno para crear la relaci\u00f3n Alumno -> Materia Crear el controlador para la vista Crear la ruta de nuestra vista Rellenar la base de datos Crear la vista con los datos 3 MIGRACIONES php artisan make:migration create_alumnos_table php artisan make:migration create_materias_table php artisan make:migration create_alumno_materia_table MODIFICANDO LAS MIGRACIONES create_alumnos_table.php create_materias_table.php create_alumno_materia_table.php <?php public function up () { Schema :: create ( 'alumnos' , function ( Blueprint $table ) { $table -> id (); $table -> string ( 'nombre' ); $table -> timestamps (); }); } <?php public function up () { Schema :: create ( 'materias' , function ( Blueprint $table ) { $table -> id (); $table -> string ( 'nombre' ); $table -> timestamps (); }); } <?php public function up () { Schema :: create ( 'alumno_materia' , function ( Blueprint $table ) { $table -> id (); $table -> foreignId ( 'alumno_id' ) -> nullable () -> constrained ( 'alumnos' ) -> cascadeOnUpdate () -> nullOnDelete (); $table -> foreignId ( 'materia_id' ) -> nullable () -> constrained ( 'materias' ) -> cascadeOnUpdate () -> nullOnDelete (); $table -> timestamps (); }); } CREAMOS LA BASE DE DATOS Para este ejemplo, vamos a crear una base de datos que se llame muchos_a_muchos desde la consola de MySQL o MariaDB. CREATE TABLE `muchos_a_muchos` EJECUTANDO LAS MIGRACIONES Ya tenemos las migraciones creadas y la base de datos lista para insertar el contenido de las migraciones que hemos escrito m\u00e1s arriba, lo que nos queda es ejecutar las migraciones para volcar toda la estructura en nuestra nueva base de datos. php artisan migrate 2 MODELOS PARA ALUMNOS Y MATERIAS php artisan make:model Alumno php artisan make:model Materia M\u00c9TODOS PARA CREAR LAS RELACIONES ALUMNO <-> MATERIA Alumno.php Materia.php <?php public function materias () { return $this -> belongsToMany ( Materia :: class , 'alumno_materia' ); } <?php public function alumnos () { return $this -> belongsToMany ( Alumno :: class , 'alumno_materia' ); } CREANDO EL CONTROLADOR DE LA VISTA Necesitamos un controlador para redireccionar las rutas a las vistas que nosotros queramos, para ello crearemos el controlador RelacionController php artisan make:controller RelacionController CREANDO RUTAS Ahora que ya tenemos nuestro controlador, vamos a crear una \u00fanica vista para mostrar el ejemplo de la relaci\u00f3n MUCHOS a MUCHOS, en este caso un alumno determinado. Adem\u00e1s, en nuestro controlador RelacionController vamos a escribir el c\u00f3digo necesario para que nos devuelva los datos relacionados con el alumno con id 1 y la materia con id 2 . web.php RelacionController.php <?php use App\\Http\\Controllers\\RelacionController ; use Illuminate\\Support\\Facades\\Route ; Route :: get ( 'muchos' , [ RelacionController :: class , 'index' ]); <?php namespace App\\Http\\Controllers ; use App\\Models\\Alumno ; use App\\Models\\Materia ; use Illuminate\\Http\\Request ; class RelacionController extends Controller { public function index () { $alumno = Alumno :: find ( 1 ); $materia = Materia :: find ( 2 ); return view ( 'muchos' , compact ( 'alumno' , 'materia' )); } } RELLENANDO LA BASE DE DATOS Necesitamos meter algunos registros en nuestra base de datos, por tanto, vamos a crear varios datos en nuestro sistema con las siguientes sentencias SQL. Tabla Alumnos Tabla Materias Tabla Alumno_Materia INSERT INTO alumnos ( ` nombre ` ) VALUES ( 'Antonio' ), ( 'Laura' ), ( 'Marta' ), ( 'Pedro' ); INSERT INTO materias ( ` nombre ` ) VALUES ( 'Programacion' ), ( 'Interfaces' ), ( 'JavaScript' ), ( 'Sistemas' ); INSERT INTO alumno_materia ( ` alumno_id ` , ` materia_id ` ) VALUES ( 1 , 2 ), ( 1 , 4 ), ( 3 , 2 ), ( 3 , 1 ), ( 2 , 3 ), ( 2 , 4 ), ( 4 , 4 ), ( 4 , 1 ); CREANDO LA VISTA CON LOS DATOS El \u00faltimo paso que vamos a hacer es, listar los datos relacionados en una vista o plantilla Blade sencilla. Para ello nos creamos el archivo muchos.blade.php ya que es el nombre que hemos puesto en nuestro archivo de rutas. Alumnos que cursan materias Materias cursadas por alumnos < div class = \"row justify-content-center\" > < div class = \"col-auto\" > < h3 > Alumno {{ $alumno -> nombre }} est\u00e1 cursando las materias </ h3 > < table class = \"table table-striped table-hover\" > < thead class = \"bg-primary text-white\" > < th > MATERIAS </ th > </ thead > < tbody > @foreach ($alumno -> materias as $registro) < tr > < td > {{ $registro -> nombre }} </ td > </ tr > @endforeach </ tbody > </ table > </ div > </ div > < div class = \"row justify-content-center\" > < div class = \"col-auto\" > < h3 > La materia {{ $materia -> nombre }} la est\u00e1n cursando los alumnos </ h3 > < table class = \"table table-striped table-hover\" > < thead class = \"bg-primary text-white\" > < th > ALUMNOS </ th > </ thead > < tbody > @foreach ($materia -> alumnos as $registro) < tr > < td > {{ $registro -> nombre }} </ td > </ tr > @endforeach </ tbody > </ table > </ div > </ div > Actividades \u00b6 Crea un sitio web con Laravel que contenga el t\u00edtulo \"Bienvenidos a Laravel\", un texto de bienvenida (puede ser un poco de Lorem Ipsum) y a continuaci\u00f3n un men\u00fa de navegaci\u00f3n con sus correspondientes alias y los siguientes enlaces: Inicio enlace a la p\u00e1gina principal donde se visualizar\u00e1 el texto de Lorem Ipsum adem\u00e1s de los elementos est\u00e1ticos (T\u00edtulo y men\u00fa de navegaci\u00f3n). Nosotros enlace que vaya a la p\u00e1gina \"nosotros\" y muestre, adem\u00e1s de los elementos est\u00e1ticos de todo el sitio, un h2 que diga \"Est\u00e1s en la secci\u00f3n Nosotros\" Proyecto enlace que cargue una vista con el siguiente texto \"Est\u00e1s en el proyecto numero: X\" donde X es un n\u00famero entero que podamos introducirlo en la propia ruta. Si no se mete ning\u00fan n\u00famero en la ruta, por defecto tiene que ser 1; por ejemplo http://localhost:8000s/proyecto/210937 Recuerda que el t\u00edtulo y el men\u00fa de navegaci\u00f3n han de aparecer en todas las vistas que cargues. Utilizando las estructuras de control y los controladores crea un sitio web que contenga lo siguiente: Inicio p\u00e1gina principal con un t\u00edtulo que diga \"Bienvenid@s a FOTO \u2591\u2592\u2593 BLOG\" y un texto de bienvenida (con un par de frases sobra) Nosotros un t\u00edtulo de la secci\u00f3n en la que te encuentras y un listado de 3 personas diferentes que, cada uno de los nombres mostrar\u00e1 un texto descriptivo de cada persona cuando pinchemos sobre su nombre. Fotos Una secci\u00f3n que aparezca el texto \"Est\u00e1s visualizando la foto con el ID: X\" donde X es un par\u00e1metro que depender\u00e1 de la ruta que se haya introducido. Por defecto, si no se introduce dicho par\u00e1metro \u00e9ste debe valer 1. Como elementos est\u00e1ticos debe aparecer: Imagen como logtipo El t\u00edtulo FOTO \u2591\u2592\u2593 BLOG a la derecha del logotipo Men\u00fa de navegaci\u00f3n para moverse por las distintas secciones Puedes usar Bootstrap como algo opcional para practicar. Recuerda que viene incluido con la instalaci\u00f3n de Laravel. Crear el proyecto CholloSevero: Crea un nuevo repositorio para el proyecto Configura el .gitignore para no incluir en el repo los siguientes archivos y carpetas: carpeta vendor archivos .env y cualquier archivo que empiece por . excepto el .gitignore La p\u00e1gina principal del sitio debe ser un listado con todos los chollos disponibles Configura la base de datos con Eloquent, olv\u00eddate de usar la consola mysql Crea una vista para las siguientes acciones: Crear un chollo Editar un chollo La tabla Chollo debe contener las siguientes columnas: id \u00fanico y autoincremental titulo un t\u00edtulo para el chollo descripcion descripcion del chollo url un campo para introducir la URL externa del chollo categoria albergar\u00e1 la categor\u00eda de los chollos puntuacion un n\u00famero entero que indique la puntuaci\u00f3n del chollo precio para albergar el precio del chollo precio_descuento para albergar el nuevo precio disponible de tipo boolean Por lo menos, el sitio debe contener un controlador de Laravel; puedes crear tantos como creas necesarios pero m\u00ednimo debe haber uno. ::: Elementos est\u00e1ticos Como ya hemos visto, hay ciertos elementos que siempre se muestran en todas las vistas del sitio web. A continuaci\u00f3n se listan los elementos que deben estar si o si en todas las plantillas que cre\u00e9is. Logo del sitio y el t\u00edtulo Chollo \u2591\u2592\u2593 Severo Inicio | Nuevos | Destacados Un footer con vuestro nombre y alg\u00fan dato copyright del tipo \u00a9CholloSevero 2022 donde el a\u00f1o debe ser calculado a trav\u00e9s de la fecha del servidor. ::: Pag\u00edna principal Adem\u00e1s del listado de todos los chollos de la base de datos debe contener el men\u00fa de navegaci\u00f3n: Cada chollo debe ser accesible desde este listado Cada chollo debe contener una imagen que estar\u00e1 guardada en public/img Cada chollo debe contener sus botones de editar y borrar que haga las funciones que tocan. Puedes utilizar iconos para cada uno de los botones. El nombre de las im\u00e1genes debe estar compuesta por la siguiente f\u00f3rmula idChollo -chollo-severo. extension Por ejemplo: 25-chollo-severo.jpg La imagen del chollo no se sube a trav\u00e9s del formulario, la pones directamente en la carpeta. Si te animas a subirlo a trav\u00e9s del formulario, puedes hacerlo. ::: P\u00e1gina de Chollo Cuando pinchemos en uno de los chollos del listados debemos ser redireccionados a esta vista donde podremos ver toda la informaci\u00f3n del tabla chollo. Puedes maquetarla como quieras e incluso puedes basarte en la web de Chollo Metro . El campo disponible no es necesario que lo muestres en esta vista ::: P\u00e1gina de Crear un chollo Un formulario con los campos necesarios para poder crear un chollo nuevo. Adem\u00e1s, debes tener en cuenta que tienes que validar los campos, de tal manera que no se pueda enviar el formulario si se ha dejado alg\u00fan campo en blanco; dichas validaciones, adem\u00e1s de a\u00f1adir la propiedad required de HTML5 debes hacerlo con Laravel. En caso de que haya habido alg\u00fan error en el formulario debes mostrar un mensaje en la parte de arriba del mismo con el mensaje de error (por ejemplo, si el campo est\u00e1 vac\u00edo). ::: P\u00e1gina de Editar un chollo Muy parecida a la de Crear un chollo pero que puedas editar un Chollo en funci\u00f3n de su id . Acu\u00e9rdate que no puedes dejar ning\u00fan campo vac\u00edo, para ello has de utilizar las validaciones de Laravel. \u2591\u2592\u2593 COSAS A TENER EN CUENTA \u2591\u2592\u2593 - Tienes que usar Bootstrap o Material Design , aunque si lo prefieres puedes hacer tus propios archivos .css Los mensajes de error o de informaci\u00f3n deben estar estilizados para que el usuario pueda verlos con facilidad Los elementos est\u00e1ticos deben estar presentes en todas las vistas; incluidas las de editar y crear. Las plantillas que formen parte de otra ya creada deben estar en una carpeta con el nombre de la plantilla madre, como hicimos con el ejercicio de Notas : Ve haciendo commits en funci\u00f3n de las tareas que vayas acabando o que veas que el commit tiene sentido. No es buena pr\u00e1ctica subir los camios de un archivo y el siguiente commit volver a subir m\u00e1s cambios del mismo archivo (a no ser que nos hayamos saltado o equivocado en algo). El proyecto es individual y despu\u00e9s se presentar\u00e1, uno por uno al profesor para que eval\u00fae todos los aspectos del mismo. Se har\u00e1n preguntas de c\u00f3mo se ha hecho cierta cosa o por qu\u00e9 se ha determinado cierto flujo de trabajo as\u00ed que, no os copi\u00e9is porque se eval\u00faa tambi\u00e9n la presentaci\u00f3n del proyecto","title":"7.- Frameworks PHP - Laravel"},{"location":"07frameworks.html#frameworks-php-laravel","text":"Duraci\u00f3n estimada: 40 sesiones","title":"Frameworks PHP. Laravel"},{"location":"07frameworks.html#puesta-en-marcha","text":"Lo primero de todo es crear una carpeta con el nombre del proyecto que vayamos a crear y nos metemos en ella. Vamos a utilizar la imagen de Bitnami ya preparada, as\u00ed que lo que hacer ahora es descargar el archivo docker-compose.yml del repositorio de Github oficial. Una vez descargado el archivo en nuestra carpeta que acabamos de crear con el nombre del proyecto, lanzamos el siguiente comando por consola para instalar todas las dependencias y crear las im\u00e1genes de Docker correspondientes. docker-compose -p Laravel up -d Si todo ha salido bien podr\u00e1s ver en el Visual Studio Code que se han creado 2 im\u00e1genes y que el servidor web de Laravel est\u00e1 funcionando bajo la siguiente URL. http://localhost:8000 Si por alguna extra\u00f1a raz\u00f3n est\u00e1s en Windows y no te funciona una de las 2 im\u00e1genes, puede ser debido a la instalci\u00f3n de composer dentro de la imagen de Laravel. Para solucionarlo, nos vamos a la carpeta del proyecto que se te habr\u00e1 creado por defecto al hacer docker-compose, en este caso y si no has modificado el archivo .yml la carpeta del proyecto sera my-proyect y dentro de ella eliminamos la carpeta vendor . Cuando hayamos eliminado dicha carpeta, necesitaremos instalar Composer de manera global en nuestro sistema Windows. Para ello. b\u00e1jate el instalador desde este enlace . Una vez lo instales ya ser\u00e1s capaz de lanzar el comando composer desde cualquier consola de Windows. Por \u00faltimo, abrimos una consola dentro de la carpeta my-project o el nombre que le hayas puesto a la carpeta del proyecto de Laravel y ejecutamos el siguiente comando. composer install Para terminar tan s\u00f3lo tendremos que volver a ejecutar el contenedor de Laravel desde Docker.","title":"Puesta en marcha"},{"location":"07frameworks.html#vscode-extensiones","text":"Recomendable instalar los siguientes plugins para Visual Studio Code Laravel Blade Snippets","title":"VSCode extensiones"},{"location":"07frameworks.html#carpetas-en-laravel","text":"Al crear un nuevo proyecto con este framework, Laravel crea una serie de carpetas por defecto. Esta estructura de carpetas es la recomendada para utilizar Laravel.","title":"Carpetas en Laravel"},{"location":"07frameworks.html#public","text":"Esta es la carpeta m\u00e1s importante ya que es donde se ponen todos los archivos que el cliente va a mostrar al usuario cuando introduzcamos la URL de nuestro sitio web. Normalmente se carga el archivo index.php por defecto.","title":"Public"},{"location":"07frameworks.html#routes","text":"Otra de las carpetas que m\u00e1s vamos a usar a lo largo de este curso de Laravel. En ella se albergan todas las rutas (redirecciones web) de nuestro proyecto, pero m\u00e1s concretamente en el archivo web.php Dada una ruta \u2192 se cargar\u00e1 una vista","title":"Routes"},{"location":"07frameworks.html#resources","text":"Esta es nuestra carpeta de recursos donde guardaremos los siguientes archivos, que tambi\u00e9n, est\u00e1n separados por sus carpetas... como cada nombre indica: css Archivos CSS js Archivos JS (JavaScript) lang Archivos relacionados con el idioma del sitio (variables & strings) views Archivos de nuestras vistas, lo que las rutas cargan","title":"Resources"},{"location":"07frameworks.html#rutas","text":"Las rutas en Laravel (y en casi cualquier Framework) sirven para redireccionar al cliente (o navegador) a las vistas que nosotros queramos. Estas rutas se configuran en el archivo public/routes/web.php donde se define la ruta que el usuario pone en la URL despu\u00e9s del dominio y se retorna la vista que se quiere cargar al introducir dicha direcci\u00f3n en el navegador. <?php // Ruta por defecto para cargar la vista welcome cuando el usuario introduce simplemente el dominio Route :: get ( '/' , function () { return view ( 'welcome' ); }); En el ejemplo de arriba vamos a cargar la vista llamada welcome que hace referencia a la vista resources/views/welcome.blade.php","title":"Rutas"},{"location":"07frameworks.html#alias","text":"Es interesante darle un alias o un nombre a nuestras rutas para poder utilizar dichos alias en nuestras plantillas de Laravel que veremos m\u00e1s adelante. Para ello, basta con utilizar la palabra name al final de la estructura de la ruta y darle un nombre que queramos; normalmente descriptivo y asociado a la vista que tiene que cargar el enroutador de Laravel. <?php Route :: get ( '/users' , function () { return view ( 'users' ); }) -> name ( 'usuarios' ); Despu\u00e9s veremos que es muy \u00fatil ya que a la hora de refactorizar o hacer un cambio, si tenemos enlaces o men\u00fas de navegaci\u00f3n que apuntan a esta ruta, s\u00f3lo tendr\u00edamos que cambiar el par\u00e1metro dentro del get() y no tener que ir archivo por archivo. Laravel nos proporciona una manera m\u00e1s c\u00f3moda a la hora de cargar una vista si no queremos par\u00e1metros ni condiciones. Tan s\u00f3lo definiremos la siguiente l\u00ednea que hace referencia la ruta datos en la URL y va a cargar el archivo usuarios.php de nuestra carpeta views como le hemos indicado en el segundo par\u00e1metro. <?php /* http://localhost/datos/ */ Route :: view ( 'datos' , 'usuarios' ); Pero no s\u00f3lo podemos retornar una vista sino, desde un simple string a m\u00f3dulos propios de Laravel.","title":"Alias"},{"location":"07frameworks.html#parametros","text":"Ya hemos visto que con PHP podemos pasar par\u00e1metros a trav\u00e9s de la URL, como si fueran variables, que las recuper\u00e1bamos a trav\u00e9s del m\u00e9todo GET o POST. Con Laravel tambi\u00e9n podemos introducir par\u00e1metros pero de una forma m\u00e1s vistosa y ordenada, de tal manera que sea visualmente m\u00e1s c\u00f3modo de recordar y de indexar por los motores de b\u00fasqueda como Google. http://localhost/cliente/324 Para configurar este tipo de rutas en nuestro archivo de rutas public/routes/web.php haremos lo siguiente. <?php Route :: get ( 'cliente/{id}' , function ( $id ) { return ( 'Cliente con el id: ' . $id ); }); \u00bfQu\u00e9 pasa si no introducimos un id y s\u00f3lo navegamos hasta cliente/ ? ... Nos va a devolver un 404 Para resolver \u00e9sto, podemos definir una ruta por defecto en caso de que el id (o par\u00e1metro) no sea pasado. Para ello usaremos el s\u00edmbolo ? en nuestro nombre de ruta e inicializaremos la variable con el valor que queramos. <?php Route :: get ( 'cliente/{id?}' , function ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); }); Ahora tenemos otro problema, porque estamos filtrando por id del cliente que, normalmente es un n\u00famero, pero si metemos un par\u00e1metro que no sea un n\u00famero, vamos a obtener un resultado no deseado. Para resolver este caso haremos uso de la cl\u00e1usula where junto con una expresi\u00f3n regular n\u00famerica. <?php Route :: get ( 'cliente/{id?}' , function ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); }) -> where ( 'id' , '[0-9]+' ); Adem\u00e1s, podemos pasarle variables a nuestra URL para luego utilzarlas en nuestros archivos de plantillas o en archivos .php haciendo uso de un array asociativo. Veamos un ejemplo con la forma reducida para ahorrarnos c\u00f3digo <?php Route :: view ( 'datos' , 'usuarios' , [ 'id' => 5446 ]); ... y el archivo resources/views/usuarios.php debe tener algo parecido a \u00e9sto <!-- Estructura t\u00edpica de un archivo HTML5 --> < p > Usuario con id: <?= $id ?> </ p > <!-- ... --> Con las plantillas de Laravel blade.php veremos c\u00f3mo simplificar a\u00fan m\u00e1s nuestro c\u00f3digo. Para m\u00e1s informaci\u00f3n acerca de las rutas, par\u00e1metros y expresiones regulares en las rutas puedes echar un vistazo a la documentaci\u00f3n oficial de rutas que contiene numerosos ejemplos.","title":"Par\u00e1metros"},{"location":"07frameworks.html#plantillas-o-templates","text":"A trav\u00e9s de las plantillas de Laravel vamos a escribir menos c\u00f3digo PHP y vamos a tener nuestros archivos mejor organizados. Blade es el sistema de plantillas que trae Laravel, por eso los archivos de plantillas que guardamos en el directorio de views llevan la extensi\u00f3n blade.php . De esta manera sabemos inmediatamente que se trata de una plantilla de Laravel y que forma parte de una vista que se mostrar\u00e1 en el navegador.","title":"Plantillas o Templates"},{"location":"07frameworks.html#directivas","text":"Laravel tiene un gran n\u00famero de directivas que podemos utilizar para ahorrarnos mucho c\u00f3digo repetitivo entre otras funciones. Digamos que las directivas son peque\u00f1as funciones ya escritas que aceptan par\u00e1metros y que cada una de ellas hace una funci\u00f3n diferente dentro de Laravel. @yield Define el contenido din\u00e1mico que se va a cargar. Se usa conjuntamente con @section @section y @endsection bloque de c\u00f3digo din\u00e1mico @extends importa el contenido de una plantilla ya creada","title":"Directivas"},{"location":"07frameworks.html#separando-codigo","text":"Veamos un ejemplo de c\u00f3mo hacer uso del poder de Laravel para crear plantillas y no repetir c\u00f3digo. Supongamos que tenemos ciertas estructuras HTML repetidas como puede ser una cabecera header , un men\u00fa de navegaci\u00f3n nav y un par de secciones que hacen uso de este mismo c\u00f3digo. Supongamos que tenemos 2 apartados en la web: Blog Fotos Primero de todo tendremos que generar un archivo que haga de plantilla de nuestro sitio web. Para ello creamos el archivo plantilla.blade.php dentro de nuestro directorio de plantillas resources/views . Dicho archivo va a contener el t\u00edpico c\u00f3digo de una p\u00e1gina simple de HTML y en el body a\u00f1adiremos nuestros contenido est\u00e1tico y din\u00e1mico. < body > <!-- CONTENIDO EST\u00c1TICO PARA TODAS LAS SECCIONES --> < h1 > Bienvenid@s a Laravel </ h1 > < hr > <!-- MEN\u00da --> < nav > < a href = {{ route (' noticias ') }} > Blog </ a > | < a href = {{ route (' galeria ') }} > Fotos </ a > </ nav > <!-- CONTENIDO DIN\u00c1MICO EN FUNCI\u00d3N DE LA SECCI\u00d3N QUE SE VISITA --> < header > @yield('apartado') </ header > </ body > Cada secci\u00f3n que haga uso de esta plantilla contendr\u00e1 el texto est\u00e1tico Bienvenid@s a Laravel seguido de un men\u00fa de navegaci\u00f3n con enlaces a cada una de las secciones y el contenido din\u00e1mico de cada secci\u00f3n. Ahora crearemos los archivos din\u00e1micos de cada una de las secciones, en nuestro caso blog.blade.php y fotos.blade.php <?php // blog.blade.php @ extends ( 'plantilla' ) @ section ( 'apartado' ) < h2 > Est\u00e1s en BLOG </ h2 > @ endsection Importamos el contenido de plantilla bajo la directiva @extends para que cargue los elementos est\u00e1ticos que hemos declarado y con la directiva @section y @endsection definimos el bloque de c\u00f3digo din\u00e1mico, en funci\u00f3n de la secci\u00f3n que estemos visitando. Ahora casi lo mismo para la secci\u00f3n de fotos <?php // fotos.blade.html @ extends ( 'plantilla' ) @ section ( 'apartado' ) < h2 > Est\u00e1s en FOTOS </ h2 > @ endsection El \u00faltimo paso que nos queda es configurar el archivo de rutas routes/web.php <?php // web.php Route :: view ( 'blog' , 'blog' ) -> name ( 'noticias' ); Route :: view ( 'fotos' , 'fotos' ) -> name ( 'galeria' ); De esta manera podremos hacer uso del men\u00fa de navegaci\u00f3n que hemos puesto en nuestra plantilla y gracias a los alias noticias y galeria , la URL ser\u00e1 m\u00e1s amigable.","title":"Separando c\u00f3digo"},{"location":"07frameworks.html#estructuras-de-control","text":"Como en todo buen lenguaje de programaci\u00f3n, en Laravel tambi\u00e9n tenemos estructuras de control. En Blade (plantillas de Laravel) siempre que iniciemos un bloque de estructura de control DEBEMOS cerrarla @foreach ~ @endforeach lo usamos para recorrer arrays @if ~ @endif para comprobar condiciones l\u00f3gicas @switch ~ @endswitch en funci\u00f3n del valor de una variable ejecutar un c\u00f3digo @case define la casu\u00edstica del switch @break rompe la ejecuci\u00f3n del c\u00f3digo en curso @default si ninguna casu\u00edstica se cumple <?php $equipo = [ 'Mar\u00eda' , 'Alfredo' , 'William' , 'Ver\u00f3nica' ]; @ foreach ( $equipo as $nombre ) < p > {{ $nombre }} </ p > @ endforeach Acordaros que podemos pasar variables a trav\u00e9s de las rutas como si fueran par\u00e1metros. Pero en este caso, vamos a ver otra directiva m\u00e1s; el uso de @compact . <?php // Uso de @compact $equipo = [ 'Mar\u00eda' , 'Alfredo' , 'William' , 'Ver\u00f3nica' ]; // Route::view('nosotros', ['equipo' => 'equipo']); Route :: view ( 'nosotros' , @ compact ( 'equipo' ));","title":"Estructuras de control"},{"location":"07frameworks.html#controladores","text":"Los controladores son el lugar perfecto para definir la l\u00f3gica de negocio de nuestra aplicaci\u00f3n o sitio web. Hace de intermediario entre la vista (lo que vemos con nuestro navegador o cliente) y el servidor donde la app est\u00e1 alojada. Por defecto, los controladores se guardan en una carpeta espec\u00edfica situada en app/Http/Controllers y tienen extensi\u00f3n .php . Para crear un controlador nuevo debemos hacer uso de nuestro querido aut\u00f3mata artisan donde le diremos que cree un controlador con el nombre que nosotros queramos. Abrimos la consola y nos situamos en la ra\u00edz de nuestro proyecto php artisan make:controller PagesController Si todo ha salido bien, recibiremos un mensaje por consola con que todo ha ido bien y podremos comprobar que, efectivamente se ha creado el archivo PagesController.php con una estructura b\u00e1sica de controlador, dentro de la carpeta Controllers que hemos descrito anteriormente. Ahora podemos modificar nuestro archivo de rutas web.pbp para dejarlo limpio de l\u00f3gica y trasladar \u00e9sta a nuestro nuevo controlador. La idea de \u00e9sto es dejar el archivo web.php tan limpio como podamos para que, de un vistazo, se entienda todo perfectamente. RECUERDA que s\u00f3lo movemos la l\u00f3gica, mientras que las cl\u00e1usulas como where y name las seguimos dejando en el archivo de rutas web.php Veamos c\u00f3mo quedar\u00eda un refactor del archivo de rutas utilizando un Controller como el que acabamos de crear Ahora nos quedar\u00eda de la siguiente manera <?php // web.php (v2.0) \u2592\u2592\u2592\u2592 Refactorizado use App\\Http\\Controllers\\PagesController ; use Illuminate\\Support\\Facades\\Route ; Route :: get ( '/' , [ PagesController :: class , 'inicio' ]); Route :: get ( 'datos' , [ PagesController :: class , 'datos' ]); Route :: get ( 'cliente/{id?}' , [ PagesController :: class , 'cliente' ]) -> where ( 'id' , '[0-9]+' ); Route :: get ( 'nosotros/{nosotros?}' , [ PagesController :: class , 'nosotros' ]) -> name ( 'nosotros' ); y en nuestro archivo controlador lo dejar\u00edamos de la siguiente manera <?php // PagesController.php namespace App\\Http\\Controllers ; class PagesController extends Controller { public function inicio () { return view ( 'welcome' ); } public function datos () { return view ( 'usuarios' , [ 'id' => 56 ]); } public function cliente ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); } public function nosotros ( $nombre = null ) { $equipo = [ 'Paco' , 'Enrique' , 'Maria' , 'Veronica' ]; return view ( 'nosotros' , @ compact ( 'equipo' , 'nombre' )); } }","title":"Controladores"},{"location":"07frameworks.html#migraciones-eloquent","text":"Con las migraciones vamos a gestionar la base de datos de nuestro sitio web; tanto crear nuevas BBDD como editarlas desde Laravel. Las migraciones de un sitio hecho con Laravel se alojan en la ruta database/migrations y tienen extensi\u00f3n .php . Si te fijas, nada m\u00e1s instalar Laravel con la imagen de Bitnami, se han creado varios archivos de migraciones que podemos usar, pero de momento los dejamos ah\u00ed y NO LOS BORRAMOS porque son muy \u00fatiles.","title":"Migraciones &amp; Eloquent"},{"location":"07frameworks.html#archivos-env","text":"Es de uso com\u00fan trabajr con archivos de entorno llamados tambi\u00e9n archivos .env . Normalmente, eun unproyecto real puedes encontrarte con varios archivos de este tipo en funci\u00f3n del despliegue que se quiera hacer; como por ejemplo: test.env config. para desplegar en entorno seguro de pruebas release.env config. para desplegar cambios de versi\u00f3n que se env\u00eda a los beta testers production.env config. para desplegar el c\u00f3digo ya probado al resto del mundo. En nuestro caso, como no vamos a desplegar nada, s\u00f3lo vamos a usar un \u00fanico archivo .env y en cuesti\u00f3n de las migraciones vamos a fijarnos a partir de la l\u00ednea 11 donde dice: DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=blog DB_USERNAME=root DB_PASSWORD= En este archivo debemos configurar los datos de nuestro servidor MySQL y rellenarlo con la informaci\u00f3n correspondiente a nuestra base de datos ya creada Una vez tengamos \u00e9sto, lo que nos queda es ejecutar el comando de las migraciones a trav\u00e9s del CLI artisan php artisan migrate Si todo ha salido bien obtendremos el siguiente resultado donde podremos observar que todas las migraciones se han insertado correctamente en la base de datos. Si nos vamos al cliente que utilicemos para manejar la base de datos (phpMyAdmin por ejemplo) veremos que en nuestra base de datos se han creado todas las tablas de la migraci\u00f3n que hemos ejecutado y adem\u00e1s una tabla que se llama migrations . La tabla migrations es simplemente un registro de todas las migraciones llevadas a cabo. Adem\u00e1s, podemos hacer un rollback en caso de que queramos reestablecer nuestra base de datos. php artisan migrate:rollback O si preferimos hacer un reset para dejarla limpia php artisan migrate:reset","title":"Archivos .env"},{"location":"07frameworks.html#modelos","text":"Gracias a Eloquent y su integraci\u00f3n con Laravel, podremos crear modelos de datos de una manera automatizada a trav\u00e9s de artisan Ahora que ya sabemos manejar las migraciones es hora de crear nuestras propias migraciones pero a trav\u00e9s de Eloquent. A trav\u00e9s de la instrucci\u00f3n make:model creamos un nuevo modelo de datos, a continuaci\u00f3n ponemos el nombre siempre empezando en May\u00fasucla y en SINGULAR y pasamos el par\u00e1metro relacionado con las migraciones -m . php artisan make:model Nota -m Si todo ha salido bien, veremos en nuestro directorio de migraciones database/migrations un nuevo archivo que se llama 2022_01_07_81237_create_notas_table.php . El siguiente paso es ver nuestro archivo de migraciones y editarlo para que contenga las tablas que nosotros queramos. Si lo visualizamos tan s\u00f3lo tendr\u00e1 la estructura b\u00e1sica con un par de tablas. Vamos a a\u00f1adir un par de tablas m\u00e1s. <?php Schema :: create ( 'notas' , function ( Blueprint $table ) { $table -> id (); $table -> timestamps (); $table -> string ( 'nombre' ); $table -> text ( 'descripcion' ); }); En esta Schema podemos poner todas las tablas que nosotros queramos y establecer el tipo de dato para cada una de ellas, as\u00ed como el nombre. Una vez que estamos satisfechos con nuestro esquema debemos volver a ejecutar el c\u00f3digo de migraci\u00f3n a trav\u00e9s de artisan para que se introduzca esta nueva informaci\u00f3n en la base de datos. Para ver todos los tipos de datos que maneja Eloquent puedes visitar la documentaci\u00f3n oficial .","title":"Modelos"},{"location":"07frameworks.html#recuperando-datos","text":"Ya tenemos nuestra base de datos creada con nuestras tablas migradas, ahora s\u00f3lo falta rellenar esas tablas con datos para poder pintarlos en nuestro c\u00f3digo HTML. Rellenamos las tablas a trav\u00e9s del cliente de MySQL que m\u00e1s nos guste: PHP MyAdmin MySQL Workbench HeidiSQL * SquirrelSQL Ahora tendremos que irnos a una vista ya creada o creamos una nueva y solicitamos los datos desde el HTML. \u00bfNos acordamos del PagesController ? pues hacer uso de su magia junto con las rutas que creamos en web.php <?php // estamos en \u2593\u2593\u2593 web.php Route :: get ( 'notas' , [ PagesController :: class , 'notas' ]); Antes de intentar entrar, debemos configurar nuestro controlador de la siguiente manera: <?php // estamos en \u2593\u2593\u2593 PagesController.php public function notas () { $notas = Nota :: all (); return view ( 'notas' , compact ( 'notas' )); } El \u00faltimo paso ser\u00eda, crear la vista con la tabla que pinte los datos a trav\u00e9s de la variable que le pasamos por par\u00e1metro en la ruta que acabamos de describir. <?php // estamos en \u2593\u2593\u2593 notas.blade.php < h1 > Notas desde base de datos </ h1 > < table border = \"1\" > < thead > < tr > < th > Nombre </ th > < th > Descripci\u00f3n </ th > </ tr > </ thead > @ foreach ( $notas as $nota ) < tr > < td > {{ $nota -> nombre }} </ td > < td > {{ $nota -> descripcion }} </ td > </ tr > @ endforeach </ table > Hay que fijarse bien en los nombres de las columnas que tienen nuestras bases de datos, es justo lo que va despu\u00e9s de -> y siempre rodeado por los s\u00edmbolos {{ }} ya que estamos en un archivo de plantilla. \u00bfQu\u00e9 pasar\u00eda si s\u00f3lo queremos acceder a un \u00fanico elemento? como si hici\u00e9semos un SELECT * from usuarios where id = 1 Para \u00e9so, tenemos una instrucci\u00f3n espec\u00edfica en Eloquent que nos soluciona el problema. En este caso usaremos la instrucci\u00f3n findOrFail y como buenos usuarios de Laravel, lo utilizaremos dentro del controlador. <?php // estamos en \u2593\u2593\u2593 PagesController.php public function detalle ( $id ) { $nota = Nota :: findOrFail ( $id ); return view ( 'notas.detalle' , compact ( 'nota' )); } Hay que acordarse que debemos configurar la ruta en nuestro archivo de rutas. <?php // estamos en \u2593\u2593\u2593 web.php Route :: get ( 'notas/{id?}' , [ PagesController :: class , 'detalle' ]) -> name ( 'notas.detalle' ); Y por \u00faltimo, debemos crear la plantilla, pero como es un archivo de detalle o que est\u00e1 relacionado con otra plantilla ya creada, podemos crear una carpeta con el nombre de la plantilla y dentro, el archivo de plantilla en cuesti\u00f3n. De tal manera que quedar\u00eda as\u00ed resources/views/notas/detalle.blade.php <?php // estamos en \u2593\u2593\u2593 detalle.blade.php @ extends ( 'plantilla' ) @ section ( 'apartado' ) < h1 > Detalle de la nota </ h1 > < h3 > ID : {{ $nota -> id }} </ h3 > < h3 > Nombre : {{ $nota -> nombre }} </ h3 > < h3 > Descripci\u00f3n : {{ $nota -> descripcion }} </ h3 > @ endsection","title":"Recuperando datos"},{"location":"07frameworks.html#modificar-tablas-sin-perder-datos","text":"Uno de los dilemas que tenemos a la hora de manejar las bases de datos con Laravel y Eloquent, es que a veces cometemos errores y queremos introducir una nueva columna dentro de nuestra tabla o modificar una de esas columnas SIN PERDER LOS DATOS DE LA BASE DE DATOS . Imaginemos que en nuestra tabla notas queremos agregar una columna con el nombre autor . Lo primero de todo es crear una nueva migraci\u00f3n para realizar este cambio. Para ello, haremos uso de nuestro querido artisan y debemos crear el nombre de esta migraci\u00f3n con la siguiente f\u00f3rmula add_fields_to_ seguidamente del nombre de la tabla que queremos modificar. php artisan migrate add_fields_to_nota Seguidamente, nos metemos en el archivo de la migraci\u00f3n que acabamos de crear y en el apartado up() debemos poner el cambio que queremos realizar y en la secci\u00f3n down() debemos hacer lo mismo pero tenemos que decirle a Eloquent que la elimine \u00bfpor qu\u00e9? para en caso de hacer migrate rollback, se cargue este nuevo campo que hemos creado. <?php public function up () { Schema :: table ( 'notas' , function ( Blueprint $table ) { $table -> string ( 'autor' ); }); } public function down () { Schema :: table ( 'notas' , function ( Blueprint $table ) { $table -> dropColumn ( 'autor' ); }); }","title":"Modificar tablas sin perder datos"},{"location":"07frameworks.html#formularios","text":"Ahora que ya sabemos c\u00f3mo cargar de una base de datos, vamos a ver c\u00f3mo insertarlos con Laravel y sin escribir ni una sola l\u00ednea de SQL. Gracias al m\u00e9todo save() de Laravel podremos guardar datos que provengan de un formulario desde nuestras plantillas. Para ello, lo primero que necesitamos lo siguiente: formulario HTML que recoja los datos que el usuario introduce Una ruta que sea la encargada de recibir los datos del formulario M\u00e9todo POST para enviar los datos al servidor Un m\u00e9todo en nuestro controlador que procese los datos y los guarde a trav\u00e9s de save() La cl\u00e1usula de seguridad @csrf para evitar ataques desde otros sitios As\u00ed pues, empecemos por el formulario < form action = \"{{ route('notas.crear') }}\" method = \"POST\" > @csrf {{-- Cl\u00e1usula para obtener un token de formulario al enviarlo --}} < input type = \"text\" name = \"nombre\" placeholder = \"Nombre de la nota\" class = \"form-control mb-2\" autofocus > < input type = \"text\" name = \"descripcion\" placeholder = \"Descripci\u00f3n de la nota\" class = \"form-control mb-2\" > < button class = \"btn btn-primary btn-block\" type = \"submit\" > Crear nueva nota </ button > </ form > Como vemos, creamos 2 inputs relacionados con nuestras columnas dentro de la tabla, en este caso nombre y descripci\u00f3n El action del formulario debe apuntar a una nueva ruta que vayamos a crear y donde enviemos los datos mediante POST . Ahora crearemos la ruta en nuestro archivo de rutas web.php <?php // estamos en \u2593\u2593\u2593 web.php Route :: post ( 'notas' , [ PagesController :: class , 'crear' ]) -> name ( 'notas.crear' ); Si nos fijamos, ya no estamos haciendo uso del get sino del m\u00e9todo post y como son m\u00e9todos diferentes, podemos nombrar la ruta de la misma manera que en get ya que no habr\u00e1 conflicto. Por otro lado, necesitamos invocar nuestro PagesController famoso y decirle que vamos a utilizar el m\u00e9todo crear que bueno, todav\u00eda no existe pero que vamos a crear a contnuaci\u00f3n. No olvidemos crear un alias para poder vincularlo al action del formulario SUPER IMPORTANTE . Para terminar, editaremos nuetro archivo PagesController.php para que el controlador que estamos usando tenga el m\u00e9todo que hemos nombrado previamente. <?php // estamos en \u2593\u2593\u2593 PagesController.php use App\\Models\\Nota ; use Illuminate\\Http\\Request ; public function crear ( Request $request ) { $notaNueva = new Nota ; $notaNueva -> nombre = $request -> nombre ; $notaNueva -> descripcion = $request -> descripcion ; $notaNueva -> save (); return back () -> with ( 'mensaje' , 'Nota agregada exit\u00f3samente' ); } Nuestro m\u00e9todo crear va a recibir un objeto llamado $request (el cual podemos cambiarle el nombre perfectamente) de tipo Request por lo que DEBEMOS IMPORTAR Request para poder utilizar dicha clase de Laravel. Dentro del m\u00e9todo crear que acabamos de escribir, debemos hacer uso del modelo Nota que ya creamos en otros ejemplos e instanciarla a traves de una variable, en nuestro caso $notaNueva . De esta manera, podremos aceder a los m\u00e9todos y propiedades de la misma, por eso podemos utilizar nombre y descripcion . As\u00ed mismo, la variable $request est\u00e1 formada por los mismos nombres de input que hemos puesto en el formulario de la plantilla, si os acord\u00e1is eran name=\"nombre\" y name=\"descripcion\" . Finalmente usamos el m\u00e9todo save() para guardar estos nuevos datos en la base de datos y retornamos a la p\u00e1gina del formulario con el m\u00e9todo back() a\u00f1adiendo un mensaje con with() . Pero \u00bfd\u00f3nde va a salir este mensaje? -- lo tenemos que declarar en nuestra plantilla @if (session('mensaje')) < div class = \"mensaje-nota-creada\" > {{ session('mensaje') }} </ div > @endif","title":"Formularios"},{"location":"07frameworks.html#validaciones","text":"Laravel nos proporciona herramientas para poder validar los datos que el usuario introduce en los campos del formulario. Adem\u00e1s de poder hacerlo con la etiqueta required de HTML5, debemos validar los datos a trav\u00e9s del Framework. Para ello, necesitamos modificar varios elementos: En primer lugar, nuestro archivo controller En segundo lugar, nuestra plantilla que carga el formulario Empecemos con el controlador. A trav\u00e9s del m\u00e9todo validate() le decimos a Eloquent qu\u00e9 campos son requeridos para poder enviar el formulario. Utilizaremos para ello un array asociativo con el nombre del input y la palabra reservada required <?php // estamos en \u2593\u2593\u2593 PagesController.php $request -> validate ([ 'nombre' => 'required' , 'descripcion' => 'required' ]); Seguidamente nos moveremos a la plantilla donde est\u00e9 el formulario y a trav\u00e9s de la directiva @error crearemos un bloque html con nuestro mensaje de error por cada uno de los inputs requeridos. <?php // estamos en \u2593\u2593\u2593 notas.blade.php @ error ( 'nombre' ) < div class = \"alert alert-danger\" > No olvides rellenar el nombre </ div > @ enderror Pero \u00bfqu\u00e9 pasa cuando ha habido un error y nos muestra el mensaje que hemos escrito? Si te fijas, los campos que hab\u00edas rellenado perder\u00e1n la informaci\u00f3n, pero con Laravel podemos persistirlos sin hacer que el usuario vuelva a introducirlos. Para poder persistir los datos una vez enviados pero con alg\u00fan error de campo requerido, utilizaremos la directiva old() como value del input dentro de nuestro formulario y le pasaremos el nombre del input declarado en la etiqueta name . <?php // estamos en \u2593\u2593\u2593 notas.blade.php < input type = \"text\" name = \"nombre\" value = \"{{ old('nombre') }}\" class = \"form-control mb-2\" placeholder = \"Nombre de la nota\" autofocus >","title":"Validaciones"},{"location":"07frameworks.html#editando-registros","text":"Despu\u00e9s de tener campos en la base de datos, lo interesante ser\u00eda poder editarlos a trav\u00e9s de un formulario. Laravel nos proporciona las herramientas necesarias para ello; veamos pues lo que necesitamos para poder realizar el cambio a trav\u00e9s de la directiva put() . Para poder hacer el cambio de resgistros necesitamos lo siguiente: Un enlace para redirigir a la p\u00e1gina de editar, pasando el id del elemento en cuesti\u00f3n Una nueva ruta que apunte a nuestra plantilla de editar Una plantilla para poder editar con un formulario que reciba los datos a editar Una nueva funci\u00f3n dentro de nuestro controlador para poder manejar los datos ya introducidos Una nueva ruta que utilice el m\u00e9todo put() para poder actualizar los datos Un nuevo m\u00e9todo dentro de nuestro controlador para actualizar los datos nuevos introducidos <?php // estamos en \u2593\u2593\u2593 notas.blade.php < a href = \"{{ route('notas.editar', $nota ) }}\" class = \"btn btn-warning btn-sm\" > Editar </ a > Ahora creamos la ruta <?php // estamos en \u2593\u2593\u2593 wep.php Route :: get ( 'editar/{id}' , [ PagesController :: class , 'editar' ]) -> name ( 'notas.editar' ); Route :: put ( 'editar/{id}' , [ PagesController :: class , 'actualizar' ]) -> name ( 'notas.actualizar' ); Ahora necesitamos crear una nueva plantilla resources/views/notas/editar.blade.php <?php // estamos en \u2593\u2593\u2593 editar.blade.php @ extends ( 'plantilla' ) @ section ( 'apartado' ) < h2 > Editando la nota {{ $nota -> id }} </ h2 > @ if ( session ( 'mensaje' )) < div class = \"alert alert-success\" > {{ session ( 'mensaje' )}} </ div > @ endif < form action = \"{{ route('notas.actualizar', $nota -> id) }}\" method = \"POST\" > @ method ( 'PUT' ) {{ -- Necesitamos cambiar al m\u00e9todo PUT para editar -- }} @ csrf {{ -- Cl\u00e1usula para obtener un token de formulario al enviarlo -- }} @ error ( 'nombre' ) < div class = \"alert alert-danger\" > El nombre es obligatorio </ div > @ enderror @ error ( 'descripcion' ) < div class = \"alert alert-danger\" > La descripci\u00f3n es obligatoria </ div > @ enderror < input type = \"text\" name = \"nombre\" class = \"form-control mb-2\" value = \"{{ $nota -> nombre }}\" placeholder = \"Nombre de la nota\" autofocus > < input type = \"text\" name = \"descripcion\" placeholder = \"Descripci\u00f3n de la nota\" class = \"form-control mb-2\" value = \"{{ $nota -> descripcion }}\" > < button class = \"btn btn-primary btn-block\" type = \"submit\" > Guardar cambios </ button > </ form > @ endsection Y por \u00faltimo, modificamos nuestro PagesController <?php // estamos en \u2593\u2593\u2593 PagesController.php public function editar ( $id ) { $nota = Nota :: findOrFail ( $id ); return view ( 'notas.editar' , compact ( 'nota' )); } public function actualizar ( Request $request , $id ) { $request -> validate ([ 'nombre' => 'required' , 'descripcion' => 'required' ]); $notaActualizar = Nota :: findOrFail ( $id ); $notaActualizar -> nombre = $request -> nombre ; $notaActualizar -> descripcion = $request -> descripcion ; $notaActualizar -> save (); return back () -> with ( 'mensaje' , 'Nota actualizada' ); }","title":"Editando registros"},{"location":"07frameworks.html#eliminando-registros","text":"A la hora de eliminar un registro nuevo, no necesitamos crear una plantilla nueva ya que podemos mandar la instrucci\u00f3n directamente a trav\u00e9s de otro formulario. Por lo tanto, para eliminar un registro de la base de datos utilizaremos lo siguiente. Un formulario b\u00e1sico con un \u00fanico bot\u00f3n de eliminar Usaremos el m\u00e9todo DELETE para sobreescribir el m\u00e9todo del formulario HTML Una ruta nueva para controlar el action de este nuevo formulario Un nuevo m\u00e9todo dentro de nuestro Controlador que lleve la l\u00f3gica para borrar el registro Vamos a ver c\u00f3mo meter ese formulario dentro de nuestro listado de notas <?php // estamos en \u2593\u2593\u2593 notas.blade.php < form action = \"{{ route('notas.eliminar', $nota ) }}\" method = \"POST\" class = \"d-inline\" > @ method ( 'DELETE' ) @ csrf < button class = \"btn btn-danger btn-sm\" type = \"submit\" > Eliminar </ button > </ form > Ahora que ya tenemos montado el formulario en nuestra plantilla, pasemos a crear la ruta que hemos colocado en el action del formulario para borrar elementos. <?php // estamos en \u2593\u2593\u2593 web.php Route :: delete ( 'eliminar/{id}' , [ PagesController :: class , 'eliminar' ]) -> name ( 'notas.eliminar' ); El \u00faltimo paso que nos queda es modificar el PagesController <?php // estamos en \u2593\u2593\u2593 PagesController.php public function eliminar ( $id ) { $notaEliminar = Nota :: findOrFail ( $id ); $notaEliminar -> delete (); return back () -> with ( 'mensaje' , 'Nota Eliminada' ); } Si todo ha salido bien, habremos creado un sitio en Laravel y Eloquent que es capaz de hacer un CRUD validando campos en formularios e insertando datos reales en una base de datos.","title":"Eliminando registros"},{"location":"07frameworks.html#paginacion","text":"Para a\u00f1adir paginaci\u00f3n a nuestros resultados, Eloquent tiene un m\u00e9todo que se llama paginate() donde le pasamos un n\u00famero entero como par\u00e1metro para indicarle el n\u00famero de resultados que queremos por p\u00e1gina. <?php // estamos en \u2593\u2593\u2593 PagesController.php public function notas () { // $notas = Nota::all(); $notas = Nota :: paginate ( 5 ); return view ( 'notas' , compact ( 'notas' )); } Ahora veremos ciertos elementos HTML que se han generado en nuestra vista, \u00e9sto es porque Laravel hace uso de una librer\u00eda de paginaci\u00f3n situada en la carpeta vendor/laravel/framework/src/illuminate/Pagination Si os met\u00e9is en el directorio y abr\u00eds el archivo tailwind.blade.php ver\u00e9is la estructura HTML que os sale en la vista. Pod\u00e9is modificar este archivo a vuestro antojo, pero es recomendable guardarse una copia del mismo. Existe otra dependencia en resources/lang/en/pagination.php donde encontrar\u00e1s el idioma para la paginaci\u00f3n.","title":"Paginaci\u00f3n"},{"location":"07frameworks.html#autenticacion","text":"Para la utenticaci\u00f3n de usuarios necesitamos instalar unas cuantas dependencias ya preparadas para ello. No es necesarios crear un proyecto nuevo pero nosotros vamos a hacerlo para tener uno con autenticaci\u00f3n y otro no, el que ya hicimos al principio. Primero de todo, vamos a crear un nuevo proyecto en Laravel que se llame notas_auth y nos metemos dentro de la carpeta del mismo cuando el script haya terminado. Dentro de la carpeta notas_auth lanzamos los siguientes comandos. composer require laravel/ui php artisan ui vue --auth Para terminar, lanzaremos el comando migrate que ya conocemos... SI EST\u00c1S WINDOWS fuera de la imagen de Docker (utilizando xampp o parecidos) debes crear una nueva base de datos y posteriormente modificiar el archivo .env poniendo el nombre de esa base de datos que acabas de crear. php artisan migrate Si todo ha salido bien, podr\u00e1s ver en la carpeta resources/views una carpeta que se llama auth y un controlador nuevo que llama HomeController","title":"Autenticaci\u00f3n"},{"location":"07frameworks.html#restringir-una-ruta","text":"Si nos fijamos, en el nuevo controlador que se ha creado HomeController podemos ver unas l\u00edneas al principio del archivo que son las que determinan si la ruta est\u00e1 restringida a usuarios registrados y logueados. <?php public function __construct () { $this -> middleware ( 'auth' ); } Mediante el uso del middleware llamado auth establecemos que todas las rutas que hagan uso de este controlador deban pasar por el login para mostrar el contenido. Por lo tanto, en nuestros proyectos es recomendable utilizar diferentes controladores para diferentes vistas; las que est\u00e9n reestringidas por el login y las que no.","title":"Restringir una ruta"},{"location":"07frameworks.html#datos-del-usuario","text":"Siempre que queramos acceder a cualquier dato del usuario logueado, utilizaremos el m\u00e9todo auth() para sacar por pantalla la informaci\u00f3n o para utilizar l\u00f3gica a la hora de guardar datos en la base de datos en funci\u00f3n de un usuario, un email o el campo que sea. Imaginemos que tenemos una ruta donde accedemos a dicha informaci\u00f3n <?php public function notas () { return auth () -> user (); // return auth()->user() -> name; // return auth()->user() -> email; // ... } Si visitamos esta ruta con nuestro login y password, nos aparecer\u00e1 por pantalla toda la informaci\u00f3n de nuestro user a excepci\u00f3n de la contrase\u00f1a y, aunque as\u00ed fuera porque se lo forzamos, \u00e9sta aparecer\u00e1 encriptada.","title":"Datos del usuario"},{"location":"07frameworks.html#relaciones-con-eloquent","text":"A trav\u00e9s de Eloquent vamos a poder gestionar las relaciones entre nuestras tablas de la base de datos de una manera muy sencilla y sin sentencias SQL.","title":"Relaciones con Eloquent"},{"location":"07frameworks.html#uno-a-uno-1-a-1","text":"Para crear este tipo de relaciones en Eloquent y Laravel, debemos tener creadas las tablas que vayamos a relacionar y establecer la relaci\u00f3n entre ellas a trav\u00e9s del m\u00e9todo hasOne . Supongamos que tenemos una tablas usuario que est\u00e1 relacionada con la tabla telefono . <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Usuario extends Model { /** * Obtener el Tel\u00e9fono asocioado con el Usuario */ public function telefono () { return $this -> hasOne ( Telefono :: class ); } } Una vez hecho \u00e9sto, para poder recuperar el dato relacionado, debemos utilizar las propiedades din\u00e1micas de Eloquent. Con estas propiedades din\u00e1micas podremos obtener dicho dato. <?php $telefono = Usuario :: find ( 1 ) -> telefono ; En este caso, Eloquent asume que en Usuario existe la clave ajena usuario_id pero \u00bfqu\u00e9 pasa si tenemos otro nombre? pues se lo pasamos como par\u00e1metro. <?php return $this -> hasOne ( Telefono :: class , 'clave_ajena' );","title":"Uno a uno (1 a 1)"},{"location":"07frameworks.html#uno-a-uno-inversa","text":"Ahora que podemos acceder al modelo tel\u00e9fono desde el modelo usuario, vamos a ver c\u00f3mo hacerlo de manera inversa, es decir, c\u00f3mo acceder desde el m\u00f3delo usuario desdel el modelo telefono gracias al m\u00e9todo belongsTo() . <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Telefono extends Model { public function usuario () { return $this -> belongsTo ( Usuario :: class ); } } Al llamar el m\u00e9todo de usuario , Eloquent intentar\u00e1 encontrar un modelo de usuario que tenga un id que coincida con la columna de usuario_id en el modelo de telefono . Eloquent determina el nombre de la clave externa examinando el nombre del m\u00e9todo de relaci\u00f3n y agregando el sufijo _id al nombre del m\u00e9todo. Entonces, asume que el modelo Telefono tiene una columna usuario_id . Sin embargo, si no se llama de esa manera, puedes pasarle como argumento el nombre de la clave. <?php public function usuario () { return $this -> belongsTo ( Usuario :: class , 'clave_ajena' ); }","title":"Uno a Uno INVERSA"},{"location":"07frameworks.html#uno-a-muchos-1-a-mm","text":"En este caso, las relaciones de 1 a muchos podemos decir que en una entrada de un blog, o en un post de Facebook, hay muchos comentarios relacionados a esa misma publicaci\u00f3n. Para empezar, ya sabemos que debemos crear el modelo y en este caso usaremos el m\u00e9todo hasMany() para obtener los datos relacionados con ese post o entrada en el blog <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Post extends Model { public function comentarios () { return $this -> hasMany ( Comentario :: class ); } } Cuidado con las claves ajenas, que aqu\u00ed pasa lo mismo... Eloquent establece por defecto el sufijo _id por lo tanto, en este ejemplo buscar\u00eda por post_id . Si no queremos \u00e9so o nuestra clave ajena tiene otro nombre, se lo pasamos por par\u00e1metro en el m\u00e9todo hasMany como hac\u00edamos m\u00e1s arriba. Ahora, al haber m\u00e1s de un dato, necesitamos iterar, por tanto debemos crear un bucle para poder sacar cada dato. <?php use App\\Models\\Post ; $comentarios = Post :: find ( 1 ) -> comentarios ; foreach ( $comentarios as $comentario ) { // Lo que sea que hagamos con esos datos } Adem\u00e1s, como todas las relaciones son sentencias SQL, podemos anidar varios filtros en funci\u00f3n de lo que queramos sacar. $comentario = Post::find(1) -> comentarios() ->where('titulo', 'lo que sea') ->first();","title":"Uno a Muchos (1 a MM)"},{"location":"07frameworks.html#uno-a-muchos-inversa","text":"Ahora que podemos acceder a todos los comentarios de una publicaci\u00f3n, definamos una relaci\u00f3n para permitir que un comentario acceda a su publicaci\u00f3n principal. <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Comentario extends Model { public function post () { return $this -> belongsTo ( Post :: class ); } } Y ahora, a trav\u00e9s de la propiedad de relaci\u00f3n din\u00e1mica... <?php use App\\Models\\Comentario ; $comentario = Comentario :: find ( 1 ); return $comentario -> post -> titulo ; Pasar\u00eda lo mismo con el nombre de la clave ajena, si no se llama de la misma manera que Eloquent establece con el sufijo _id podemos pasarle como par\u00e1metro el nombre de la clave donde debe buscar.","title":"Uno a Muchos INVERSA"},{"location":"07frameworks.html#muchos-a-muchos-mm-a-mm","text":"Este tipo de relaciones son las m\u00e1s complicadas ya que, en un Blog del estilo Wordpress por ejemplo, un usuario puede tener muchos roles (lector, autor, administrador) pero un rol pueden tenerlo varios usuarios, es decir, puede haber muchos usuarios administradores, otros lectores y dem\u00e1s. Para realizar este tipo de relaciones necesitar\u00edamos 3 tablas diferentes. usuarios [ id, nombre] roles [id, nombre] rol_usuario [usuario_id, rol_id] (Tabla Pivote) Lo primero de todo, vamos a crear las tablas con sus modelos a excepci\u00f3n de la tabla pivote rol_usuario que s\u00f3lo crearemos la tabla, sin su modelo php artisan make:migration create_rol_usuario_table --create=rol_usuario Y la estructura de dicha seria de la siguiente manera... <?php public function up () { Schema :: create ( 'rol_usuario' , function ( Blueprint $table ) { $table -> bigIncrements ( 'id' ); $table -> unsignedInteger ( 'usuario_id' ); $table -> unsignedInteger ( 'rol_id' ); $table -> timestamps (); }); } Ahora que ya tenemos todo listo, las relaciones de Muchos a Muchos vienen definidas por un m\u00e9todo que devuelve el resultado de usar el m\u00e9todo belongsToMany() <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Usuario extends Model { public function roles () { return $this -> belongsToMany ( Rol :: class ); } } Una vez que tengamos las relaciones definidas, accederemos a ellas mediante las propiedades din\u00e1micas de rol <?php use App\\Models\\Usuario ; $usuario = Usuario :: find ( 1 ); foreach ( $usuario -> roles as $rol ) { // nuestro c\u00f3digo } Acordaros que podemos encadenar comandos sql a trav\u00e9s de los m\u00e9todos de Eloquent <?php $roles = Usuario :: find ( 1 ) -> roles () -> orderBy ( 'nombre' ) -> get ();","title":"Muchos a Muchos (MM a MM)"},{"location":"07frameworks.html#muchos-a-muchos-inversa","text":"Para definir el \"inverso\" de una relaci\u00f3n de muchos a muchos, debemos establecer un m\u00e9todo en el modelo relacionado que tambi\u00e9n devuelva el resultado del m\u00e9todo belongsToMany . Seg\u00fan el ejemplo que estamos siguiendo... <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Rol extends Model { public function usuarios () { return $this -> belongsToMany ( Usuario :: class ); } } Vamos a hacer un ejemplo con una APP que gestiones alumnos y asignaturas, de tal manera que MUCHOS ALUMNOS pueden cursar MUCHAS ASIGNATURAS \u00bfQu\u00e9 necesitamos para este ejemplo? 3 migraciones para crear las tablas Alumnos /// Materias /// AlumnoMateria Modificar los archivos de las migraciones create_alumnos_table y create_materias_table . Crear la base de datos muchos_a_muchos Ejecutar las Migraciones 2 modelos para Alumnos /// Materias M\u00e9todo dentro de Alumno para crear la relaci\u00f3n Alumno -> Materia Crear el controlador para la vista Crear la ruta de nuestra vista Rellenar la base de datos Crear la vista con los datos 3 MIGRACIONES php artisan make:migration create_alumnos_table php artisan make:migration create_materias_table php artisan make:migration create_alumno_materia_table MODIFICANDO LAS MIGRACIONES create_alumnos_table.php create_materias_table.php create_alumno_materia_table.php <?php public function up () { Schema :: create ( 'alumnos' , function ( Blueprint $table ) { $table -> id (); $table -> string ( 'nombre' ); $table -> timestamps (); }); } <?php public function up () { Schema :: create ( 'materias' , function ( Blueprint $table ) { $table -> id (); $table -> string ( 'nombre' ); $table -> timestamps (); }); } <?php public function up () { Schema :: create ( 'alumno_materia' , function ( Blueprint $table ) { $table -> id (); $table -> foreignId ( 'alumno_id' ) -> nullable () -> constrained ( 'alumnos' ) -> cascadeOnUpdate () -> nullOnDelete (); $table -> foreignId ( 'materia_id' ) -> nullable () -> constrained ( 'materias' ) -> cascadeOnUpdate () -> nullOnDelete (); $table -> timestamps (); }); } CREAMOS LA BASE DE DATOS Para este ejemplo, vamos a crear una base de datos que se llame muchos_a_muchos desde la consola de MySQL o MariaDB. CREATE TABLE `muchos_a_muchos` EJECUTANDO LAS MIGRACIONES Ya tenemos las migraciones creadas y la base de datos lista para insertar el contenido de las migraciones que hemos escrito m\u00e1s arriba, lo que nos queda es ejecutar las migraciones para volcar toda la estructura en nuestra nueva base de datos. php artisan migrate 2 MODELOS PARA ALUMNOS Y MATERIAS php artisan make:model Alumno php artisan make:model Materia M\u00c9TODOS PARA CREAR LAS RELACIONES ALUMNO <-> MATERIA Alumno.php Materia.php <?php public function materias () { return $this -> belongsToMany ( Materia :: class , 'alumno_materia' ); } <?php public function alumnos () { return $this -> belongsToMany ( Alumno :: class , 'alumno_materia' ); } CREANDO EL CONTROLADOR DE LA VISTA Necesitamos un controlador para redireccionar las rutas a las vistas que nosotros queramos, para ello crearemos el controlador RelacionController php artisan make:controller RelacionController CREANDO RUTAS Ahora que ya tenemos nuestro controlador, vamos a crear una \u00fanica vista para mostrar el ejemplo de la relaci\u00f3n MUCHOS a MUCHOS, en este caso un alumno determinado. Adem\u00e1s, en nuestro controlador RelacionController vamos a escribir el c\u00f3digo necesario para que nos devuelva los datos relacionados con el alumno con id 1 y la materia con id 2 . web.php RelacionController.php <?php use App\\Http\\Controllers\\RelacionController ; use Illuminate\\Support\\Facades\\Route ; Route :: get ( 'muchos' , [ RelacionController :: class , 'index' ]); <?php namespace App\\Http\\Controllers ; use App\\Models\\Alumno ; use App\\Models\\Materia ; use Illuminate\\Http\\Request ; class RelacionController extends Controller { public function index () { $alumno = Alumno :: find ( 1 ); $materia = Materia :: find ( 2 ); return view ( 'muchos' , compact ( 'alumno' , 'materia' )); } } RELLENANDO LA BASE DE DATOS Necesitamos meter algunos registros en nuestra base de datos, por tanto, vamos a crear varios datos en nuestro sistema con las siguientes sentencias SQL. Tabla Alumnos Tabla Materias Tabla Alumno_Materia INSERT INTO alumnos ( ` nombre ` ) VALUES ( 'Antonio' ), ( 'Laura' ), ( 'Marta' ), ( 'Pedro' ); INSERT INTO materias ( ` nombre ` ) VALUES ( 'Programacion' ), ( 'Interfaces' ), ( 'JavaScript' ), ( 'Sistemas' ); INSERT INTO alumno_materia ( ` alumno_id ` , ` materia_id ` ) VALUES ( 1 , 2 ), ( 1 , 4 ), ( 3 , 2 ), ( 3 , 1 ), ( 2 , 3 ), ( 2 , 4 ), ( 4 , 4 ), ( 4 , 1 ); CREANDO LA VISTA CON LOS DATOS El \u00faltimo paso que vamos a hacer es, listar los datos relacionados en una vista o plantilla Blade sencilla. Para ello nos creamos el archivo muchos.blade.php ya que es el nombre que hemos puesto en nuestro archivo de rutas. Alumnos que cursan materias Materias cursadas por alumnos < div class = \"row justify-content-center\" > < div class = \"col-auto\" > < h3 > Alumno {{ $alumno -> nombre }} est\u00e1 cursando las materias </ h3 > < table class = \"table table-striped table-hover\" > < thead class = \"bg-primary text-white\" > < th > MATERIAS </ th > </ thead > < tbody > @foreach ($alumno -> materias as $registro) < tr > < td > {{ $registro -> nombre }} </ td > </ tr > @endforeach </ tbody > </ table > </ div > </ div > < div class = \"row justify-content-center\" > < div class = \"col-auto\" > < h3 > La materia {{ $materia -> nombre }} la est\u00e1n cursando los alumnos </ h3 > < table class = \"table table-striped table-hover\" > < thead class = \"bg-primary text-white\" > < th > ALUMNOS </ th > </ thead > < tbody > @foreach ($materia -> alumnos as $registro) < tr > < td > {{ $registro -> nombre }} </ td > </ tr > @endforeach </ tbody > </ table > </ div > </ div >","title":"Muchos a Muchos INVERSA"},{"location":"07frameworks.html#actividades","text":"Crea un sitio web con Laravel que contenga el t\u00edtulo \"Bienvenidos a Laravel\", un texto de bienvenida (puede ser un poco de Lorem Ipsum) y a continuaci\u00f3n un men\u00fa de navegaci\u00f3n con sus correspondientes alias y los siguientes enlaces: Inicio enlace a la p\u00e1gina principal donde se visualizar\u00e1 el texto de Lorem Ipsum adem\u00e1s de los elementos est\u00e1ticos (T\u00edtulo y men\u00fa de navegaci\u00f3n). Nosotros enlace que vaya a la p\u00e1gina \"nosotros\" y muestre, adem\u00e1s de los elementos est\u00e1ticos de todo el sitio, un h2 que diga \"Est\u00e1s en la secci\u00f3n Nosotros\" Proyecto enlace que cargue una vista con el siguiente texto \"Est\u00e1s en el proyecto numero: X\" donde X es un n\u00famero entero que podamos introducirlo en la propia ruta. Si no se mete ning\u00fan n\u00famero en la ruta, por defecto tiene que ser 1; por ejemplo http://localhost:8000s/proyecto/210937 Recuerda que el t\u00edtulo y el men\u00fa de navegaci\u00f3n han de aparecer en todas las vistas que cargues. Utilizando las estructuras de control y los controladores crea un sitio web que contenga lo siguiente: Inicio p\u00e1gina principal con un t\u00edtulo que diga \"Bienvenid@s a FOTO \u2591\u2592\u2593 BLOG\" y un texto de bienvenida (con un par de frases sobra) Nosotros un t\u00edtulo de la secci\u00f3n en la que te encuentras y un listado de 3 personas diferentes que, cada uno de los nombres mostrar\u00e1 un texto descriptivo de cada persona cuando pinchemos sobre su nombre. Fotos Una secci\u00f3n que aparezca el texto \"Est\u00e1s visualizando la foto con el ID: X\" donde X es un par\u00e1metro que depender\u00e1 de la ruta que se haya introducido. Por defecto, si no se introduce dicho par\u00e1metro \u00e9ste debe valer 1. Como elementos est\u00e1ticos debe aparecer: Imagen como logtipo El t\u00edtulo FOTO \u2591\u2592\u2593 BLOG a la derecha del logotipo Men\u00fa de navegaci\u00f3n para moverse por las distintas secciones Puedes usar Bootstrap como algo opcional para practicar. Recuerda que viene incluido con la instalaci\u00f3n de Laravel. Crear el proyecto CholloSevero: Crea un nuevo repositorio para el proyecto Configura el .gitignore para no incluir en el repo los siguientes archivos y carpetas: carpeta vendor archivos .env y cualquier archivo que empiece por . excepto el .gitignore La p\u00e1gina principal del sitio debe ser un listado con todos los chollos disponibles Configura la base de datos con Eloquent, olv\u00eddate de usar la consola mysql Crea una vista para las siguientes acciones: Crear un chollo Editar un chollo La tabla Chollo debe contener las siguientes columnas: id \u00fanico y autoincremental titulo un t\u00edtulo para el chollo descripcion descripcion del chollo url un campo para introducir la URL externa del chollo categoria albergar\u00e1 la categor\u00eda de los chollos puntuacion un n\u00famero entero que indique la puntuaci\u00f3n del chollo precio para albergar el precio del chollo precio_descuento para albergar el nuevo precio disponible de tipo boolean Por lo menos, el sitio debe contener un controlador de Laravel; puedes crear tantos como creas necesarios pero m\u00ednimo debe haber uno. ::: Elementos est\u00e1ticos Como ya hemos visto, hay ciertos elementos que siempre se muestran en todas las vistas del sitio web. A continuaci\u00f3n se listan los elementos que deben estar si o si en todas las plantillas que cre\u00e9is. Logo del sitio y el t\u00edtulo Chollo \u2591\u2592\u2593 Severo Inicio | Nuevos | Destacados Un footer con vuestro nombre y alg\u00fan dato copyright del tipo \u00a9CholloSevero 2022 donde el a\u00f1o debe ser calculado a trav\u00e9s de la fecha del servidor. ::: Pag\u00edna principal Adem\u00e1s del listado de todos los chollos de la base de datos debe contener el men\u00fa de navegaci\u00f3n: Cada chollo debe ser accesible desde este listado Cada chollo debe contener una imagen que estar\u00e1 guardada en public/img Cada chollo debe contener sus botones de editar y borrar que haga las funciones que tocan. Puedes utilizar iconos para cada uno de los botones. El nombre de las im\u00e1genes debe estar compuesta por la siguiente f\u00f3rmula idChollo -chollo-severo. extension Por ejemplo: 25-chollo-severo.jpg La imagen del chollo no se sube a trav\u00e9s del formulario, la pones directamente en la carpeta. Si te animas a subirlo a trav\u00e9s del formulario, puedes hacerlo. ::: P\u00e1gina de Chollo Cuando pinchemos en uno de los chollos del listados debemos ser redireccionados a esta vista donde podremos ver toda la informaci\u00f3n del tabla chollo. Puedes maquetarla como quieras e incluso puedes basarte en la web de Chollo Metro . El campo disponible no es necesario que lo muestres en esta vista ::: P\u00e1gina de Crear un chollo Un formulario con los campos necesarios para poder crear un chollo nuevo. Adem\u00e1s, debes tener en cuenta que tienes que validar los campos, de tal manera que no se pueda enviar el formulario si se ha dejado alg\u00fan campo en blanco; dichas validaciones, adem\u00e1s de a\u00f1adir la propiedad required de HTML5 debes hacerlo con Laravel. En caso de que haya habido alg\u00fan error en el formulario debes mostrar un mensaje en la parte de arriba del mismo con el mensaje de error (por ejemplo, si el campo est\u00e1 vac\u00edo). ::: P\u00e1gina de Editar un chollo Muy parecida a la de Crear un chollo pero que puedas editar un Chollo en funci\u00f3n de su id . Acu\u00e9rdate que no puedes dejar ning\u00fan campo vac\u00edo, para ello has de utilizar las validaciones de Laravel. \u2591\u2592\u2593 COSAS A TENER EN CUENTA \u2591\u2592\u2593 - Tienes que usar Bootstrap o Material Design , aunque si lo prefieres puedes hacer tus propios archivos .css Los mensajes de error o de informaci\u00f3n deben estar estilizados para que el usuario pueda verlos con facilidad Los elementos est\u00e1ticos deben estar presentes en todas las vistas; incluidas las de editar y crear. Las plantillas que formen parte de otra ya creada deben estar en una carpeta con el nombre de la plantilla madre, como hicimos con el ejercicio de Notas : Ve haciendo commits en funci\u00f3n de las tareas que vayas acabando o que veas que el commit tiene sentido. No es buena pr\u00e1ctica subir los camios de un archivo y el siguiente commit volver a subir m\u00e1s cambios del mismo archivo (a no ser que nos hayamos saltado o equivocado en algo). El proyecto es individual y despu\u00e9s se presentar\u00e1, uno por uno al profesor para que eval\u00fae todos los aspectos del mismo. Se har\u00e1n preguntas de c\u00f3mo se ha hecho cierta cosa o por qu\u00e9 se ha determinado cierto flujo de trabajo as\u00ed que, no os copi\u00e9is porque se eval\u00faa tambi\u00e9n la presentaci\u00f3n del proyecto","title":"Actividades"},{"location":"08frameworks2.html","text":"Uso avanzado de Frameworks \u00b6 Plantillas con Blade \u00b6 Integraci\u00f3n de CSS y JS \u00b6 Autenticaci\u00f3n y autorizaci\u00f3n \u00b6 https://igomis.github.io/apunts/docs/4.8.Laravel.html Tip Pregunta Respuesta Relacion P-R Autenticaci\u00f3n Relacion con usuario en modelo Relacionar con migraciones Relacionar en vistas Proteger edit, update por Auth:id p\u00e1gina profile ... listado de preguntas y respuestas del usuario Utilizar la fuci\u00f3n diffForHumas para ellapsed time Antes se hac\u00eda as\u00ed.... Run scaffolding php artisan make:auth Crea el HomeController , que utiliza el middleware auth . Middleware \u00b6 Componente que se situa entre el enrutador y el controlador. Explicar Ejecutar las migraciones Explorar los ficheros generados Auth:routes() ??? Laravel Breeze \u00b6 Laravel Breeze es un starter kit que se compone de un conjunto de rutas, controladores y vistas necesarias para regitrar y autenticar usuarios en cualquier aplicaci\u00f3n. Las vistas est\u00e1n creadas con Laravel y los estilos con Tailwind CSS. Primero hemos de a\u00f1adir la dependencia mediante Composer: composer require laravel/breeze --dev Tras ello, ejecutaremos el comando breeze:install para generar todo el contenido necesario (rutas, vistas, controladores, recursos, ...), compilaremos todos los assets CSS y generaremos las migraciones: php artisan breeze:install npm install npm run dev php artisan migrate Mailtrap Para poder probar el env\u00edo de correo mailtrap.io, servidor de correo para pruebas para equipos de desarrollo (realmente no est\u00e1 env\u00edando los correos) i18n \u00b6","title":"Uso avanzado de Frameworks"},{"location":"08frameworks2.html#uso-avanzado-de-frameworks","text":"","title":"Uso avanzado de Frameworks"},{"location":"08frameworks2.html#plantillas-con-blade","text":"","title":"Plantillas con Blade"},{"location":"08frameworks2.html#integracion-de-css-y-js","text":"","title":"Integraci\u00f3n de CSS y JS"},{"location":"08frameworks2.html#autenticacion-y-autorizacion","text":"https://igomis.github.io/apunts/docs/4.8.Laravel.html Tip Pregunta Respuesta Relacion P-R Autenticaci\u00f3n Relacion con usuario en modelo Relacionar con migraciones Relacionar en vistas Proteger edit, update por Auth:id p\u00e1gina profile ... listado de preguntas y respuestas del usuario Utilizar la fuci\u00f3n diffForHumas para ellapsed time Antes se hac\u00eda as\u00ed.... Run scaffolding php artisan make:auth Crea el HomeController , que utiliza el middleware auth .","title":"Autenticaci\u00f3n y autorizaci\u00f3n"},{"location":"08frameworks2.html#middleware","text":"Componente que se situa entre el enrutador y el controlador. Explicar Ejecutar las migraciones Explorar los ficheros generados Auth:routes() ???","title":"Middleware"},{"location":"08frameworks2.html#laravel-breeze","text":"Laravel Breeze es un starter kit que se compone de un conjunto de rutas, controladores y vistas necesarias para regitrar y autenticar usuarios en cualquier aplicaci\u00f3n. Las vistas est\u00e1n creadas con Laravel y los estilos con Tailwind CSS. Primero hemos de a\u00f1adir la dependencia mediante Composer: composer require laravel/breeze --dev Tras ello, ejecutaremos el comando breeze:install para generar todo el contenido necesario (rutas, vistas, controladores, recursos, ...), compilaremos todos los assets CSS y generaremos las migraciones: php artisan breeze:install npm install npm run dev php artisan migrate Mailtrap Para poder probar el env\u00edo de correo mailtrap.io, servidor de correo para pruebas para equipos de desarrollo (realmente no est\u00e1 env\u00edando los correos)","title":"Laravel Breeze"},{"location":"08frameworks2.html#i18n","text":"","title":"i18n"},{"location":"09rest.html","text":"img { margin: 20px 0; border-radius: 8px; } .alert { color: #BD1550; } .warning { color: #E97F02; } .success { color: #8A9B0F; } .center { text-align: center; } .right { text-align: right; } .img-small { max-width: 200px; margin: auto; } .img-medium { max-width: 400px; margin: auto; } .img-large { max-width: 800px; margin: auto; } .leyenda { font-size: small; margin: 10px 0; } Servicios REST \u00b6 Duraci\u00f3n estimada: 32 sesiones API \u00b6 Una API (Application Programming Interface) es un conjunto de funciones y procedimientos por los cuales, una aplicaci\u00f3n externa accede a los datos, a modo de biblioteca como una capa de abstracci\u00f3n y la API se encarga de enviar el dato solicitado. Una de las caracter\u00edsticas fundamentales de las API es que son Sateless , lo que quiere decir que las peticiones se hacen y desaparecen, no hay usuarios logueados ni datos que se quedan almacenados. Ejemplos de APIs gratuitas: ChuckNorris IO OMDB PokeAPI - Pokemon RAWg - Videojuegos The Star Wars API Para hacer pruebas con estas APIs podemos implementar el c\u00f3digo para consumirlas o utilizar un cliente especial para el consumo de estos servicios. PostMan Thunder Client Insomnia Advance REST Client (desde el navegador) REST \u00b6 Con esta metodolog\u00eda llamada REST vamos a poder construir APIs para que desde un cliente externo se puedan consumir. Gracias a este standard de la arquitectura del software vamos a poder montar un API que utilice los m\u00e9todos standard GET, POST, PUT y DELETE. Creando Recurso (Resource) \u00b6 Para crear un recurso dentro de nuestra aplicaci\u00f3n hecha con Laravel, necesitamos crear un controlador del tipo resource donde establezcamos los m\u00e9todos que nosotros queramos realizar a la hora de trabajar con los datos php artisan make:controller ChollosController --resource Artisan nos crear\u00e1 un nuevo controlador en la carpeta controllers con el nombre ChollosController o el nombre que le hayamos pasado. La estructura de este archivo es un poco diferente a los controladores que ya hemos visto anteriormente. Ahora tenemos los siguientes m\u00e9todos creados de manera autom\u00e1tica: index() normalmente para listar, en nuestro caso los chollos create() para crear plantillas (no lo vamos a usar) store() para guardar los datos que pasemos a la API update() para actualizar un dato ya existente en la BDD delete() para eliminar un dato ya existente en la BDD En el caso de devolver un listado con todos los chollos, lo primero que debemos hacer es importar nuestro modelo Chollo. <?php use App\\Models\\Chollo ; Y como hemos ido haciendo en controladores anteriores, necesitamos hacer la consulta apropiada para devolver todos los chollos. CUIDADO CON EL RETURN porque ahora no estamos devolviendo una vista sino un array de datos en formato JSON. <?php public function index () { $chollos = Chollo :: all (); return $chollos ; } El \u00faltimo paso ser\u00eda configurar el archivo de rutas, pero en este caso el archivo de rutas de la api se llama api.php <?php // estamos en \u2593\u2593\u2593 api.php use App\\Http\\Controllers\\ChollosController ; use Illuminate\\Http\\Request ; use Illuminate\\Support\\Facades\\Route ; Route :: get ( '/chollos' , [ ChollosController :: class , 'index' ]); Una vez hecho \u00e9sto, debemos poner en marcha nuestro servidor. php artisan serve Ahora ya podemos usar el Postman o cualquier cliente de la misma \u00edndole para testear nuestra API a trav\u00e9s de la URL de nuestro servidor http://127.0.0.1:8000/api/chollos Recuperando datos en vista BLADE \u00b6 Ya tenemos nuestra API montada y puede ser consumida a trav\u00e9s del navegador o cualquier cliente como PostMan o Thunder Client pero lo que nos interesa ahora es poder listar la informaci\u00f3n en una vista como hac\u00edamos en el tema anterior. Lo que vamos a tener que hacer es lo siguiente Modificar el Controlador para que consuma de la API Convertir el tipo de dato que nos devuelve la API como respuesta Utilizar una estructura de control forEach dentro de nuestra vista Acceder a cada clave del objeto JSON recibido en la vista blade Vamos a modificar el controlador para que consuma de la API y convertimos los datos con el m\u00e9todo collect() . Para la llamada debemos importar Http . <?php // estamos en \u2593\u2593\u2593 CholloController.php use App\\Models\\Chollo ; // EN CASO DE API LOCAL use Illuminate\\Support\\Facades\\Http ; // INDISPENSABLE EN CASO DE API EXTERNA class RestController extends Controller { public function index () { // $restChollos = Http::get('http://localhost/api/chollos') -> collect(); // PARA API EXTERNA $chollos = Chollo :: all (); return view ( 'rest' , compact ( 'chollos' )); } } Modificamos nuestra vista blade para poder listar los datos correctamente o si lo prefieres, puedes crear una ruta nueva e incluso un nuevo controlador que se encargue de manejar las llamadas a la API. El nombre que va entre corchetes es el nombre de las columnas de la tabla de la base de datos <?php // estamos en \u2593\u2593\u2593 chollos.blade.php @ foreach ( $chollos as $chollo ) < p > ID : {{ $chollo -> id }} </ p > // Columna ID < p > Nombre : {{ $chollo -> nombre }} </ p > // Columna NOMBRE < p > Descripci\u00f3n : {{ $chollo -> descripcion }} </ p > // Columna DESCRIPCION // [...] < hr > @ endforeach Enviando datos (POST) \u00b6 En una API, para poder enviar datos y que se guarden en la base de datos, debemos usar el m\u00e9todo post bajo Http y pasarle los nuevos datos como un array asociativo, poniendo como clave el nombre de las columnas de la base de datos <?php $response = Http :: post ( 'http://localhost:8000/api/chollo-severo' , [ 'titulo' => 'Chollazo para este producto' , 'descripcion' => 'Lorem ipsum dolo...' , // [...] ]); Actividades \u00b6 Chollo Severo V 2.0 Crea un controlador nuevo que se llame RestController (o como quieras llamarlo) y escribe todos los m\u00e9todos que necesites para convertir tu app que, consume de una Base de Datos, a una Restful App que reciba los datos a trav\u00e9s de la API de tu proyecto de Chollos.","title":"8.- Servicios REST"},{"location":"09rest.html#servicios-rest","text":"Duraci\u00f3n estimada: 32 sesiones","title":"Servicios REST"},{"location":"09rest.html#api","text":"Una API (Application Programming Interface) es un conjunto de funciones y procedimientos por los cuales, una aplicaci\u00f3n externa accede a los datos, a modo de biblioteca como una capa de abstracci\u00f3n y la API se encarga de enviar el dato solicitado. Una de las caracter\u00edsticas fundamentales de las API es que son Sateless , lo que quiere decir que las peticiones se hacen y desaparecen, no hay usuarios logueados ni datos que se quedan almacenados. Ejemplos de APIs gratuitas: ChuckNorris IO OMDB PokeAPI - Pokemon RAWg - Videojuegos The Star Wars API Para hacer pruebas con estas APIs podemos implementar el c\u00f3digo para consumirlas o utilizar un cliente especial para el consumo de estos servicios. PostMan Thunder Client Insomnia Advance REST Client (desde el navegador)","title":"API"},{"location":"09rest.html#rest","text":"Con esta metodolog\u00eda llamada REST vamos a poder construir APIs para que desde un cliente externo se puedan consumir. Gracias a este standard de la arquitectura del software vamos a poder montar un API que utilice los m\u00e9todos standard GET, POST, PUT y DELETE.","title":"REST"},{"location":"09rest.html#creando-recurso-resource","text":"Para crear un recurso dentro de nuestra aplicaci\u00f3n hecha con Laravel, necesitamos crear un controlador del tipo resource donde establezcamos los m\u00e9todos que nosotros queramos realizar a la hora de trabajar con los datos php artisan make:controller ChollosController --resource Artisan nos crear\u00e1 un nuevo controlador en la carpeta controllers con el nombre ChollosController o el nombre que le hayamos pasado. La estructura de este archivo es un poco diferente a los controladores que ya hemos visto anteriormente. Ahora tenemos los siguientes m\u00e9todos creados de manera autom\u00e1tica: index() normalmente para listar, en nuestro caso los chollos create() para crear plantillas (no lo vamos a usar) store() para guardar los datos que pasemos a la API update() para actualizar un dato ya existente en la BDD delete() para eliminar un dato ya existente en la BDD En el caso de devolver un listado con todos los chollos, lo primero que debemos hacer es importar nuestro modelo Chollo. <?php use App\\Models\\Chollo ; Y como hemos ido haciendo en controladores anteriores, necesitamos hacer la consulta apropiada para devolver todos los chollos. CUIDADO CON EL RETURN porque ahora no estamos devolviendo una vista sino un array de datos en formato JSON. <?php public function index () { $chollos = Chollo :: all (); return $chollos ; } El \u00faltimo paso ser\u00eda configurar el archivo de rutas, pero en este caso el archivo de rutas de la api se llama api.php <?php // estamos en \u2593\u2593\u2593 api.php use App\\Http\\Controllers\\ChollosController ; use Illuminate\\Http\\Request ; use Illuminate\\Support\\Facades\\Route ; Route :: get ( '/chollos' , [ ChollosController :: class , 'index' ]); Una vez hecho \u00e9sto, debemos poner en marcha nuestro servidor. php artisan serve Ahora ya podemos usar el Postman o cualquier cliente de la misma \u00edndole para testear nuestra API a trav\u00e9s de la URL de nuestro servidor http://127.0.0.1:8000/api/chollos","title":"Creando Recurso (Resource)"},{"location":"09rest.html#recuperando-datos-en-vista-blade","text":"Ya tenemos nuestra API montada y puede ser consumida a trav\u00e9s del navegador o cualquier cliente como PostMan o Thunder Client pero lo que nos interesa ahora es poder listar la informaci\u00f3n en una vista como hac\u00edamos en el tema anterior. Lo que vamos a tener que hacer es lo siguiente Modificar el Controlador para que consuma de la API Convertir el tipo de dato que nos devuelve la API como respuesta Utilizar una estructura de control forEach dentro de nuestra vista Acceder a cada clave del objeto JSON recibido en la vista blade Vamos a modificar el controlador para que consuma de la API y convertimos los datos con el m\u00e9todo collect() . Para la llamada debemos importar Http . <?php // estamos en \u2593\u2593\u2593 CholloController.php use App\\Models\\Chollo ; // EN CASO DE API LOCAL use Illuminate\\Support\\Facades\\Http ; // INDISPENSABLE EN CASO DE API EXTERNA class RestController extends Controller { public function index () { // $restChollos = Http::get('http://localhost/api/chollos') -> collect(); // PARA API EXTERNA $chollos = Chollo :: all (); return view ( 'rest' , compact ( 'chollos' )); } } Modificamos nuestra vista blade para poder listar los datos correctamente o si lo prefieres, puedes crear una ruta nueva e incluso un nuevo controlador que se encargue de manejar las llamadas a la API. El nombre que va entre corchetes es el nombre de las columnas de la tabla de la base de datos <?php // estamos en \u2593\u2593\u2593 chollos.blade.php @ foreach ( $chollos as $chollo ) < p > ID : {{ $chollo -> id }} </ p > // Columna ID < p > Nombre : {{ $chollo -> nombre }} </ p > // Columna NOMBRE < p > Descripci\u00f3n : {{ $chollo -> descripcion }} </ p > // Columna DESCRIPCION // [...] < hr > @ endforeach","title":"Recuperando datos en vista BLADE"},{"location":"09rest.html#enviando-datos-post","text":"En una API, para poder enviar datos y que se guarden en la base de datos, debemos usar el m\u00e9todo post bajo Http y pasarle los nuevos datos como un array asociativo, poniendo como clave el nombre de las columnas de la base de datos <?php $response = Http :: post ( 'http://localhost:8000/api/chollo-severo' , [ 'titulo' => 'Chollazo para este producto' , 'descripcion' => 'Lorem ipsum dolo...' , // [...] ]);","title":"Enviando datos (POST)"},{"location":"09rest.html#actividades","text":"Chollo Severo V 2.0 Crea un controlador nuevo que se llame RestController (o como quieras llamarlo) y escribe todos los m\u00e9todos que necesites para convertir tu app que, consume de una Base de Datos, a una Restful App que reciba los datos a trav\u00e9s de la API de tu proyecto de Chollos.","title":"Actividades"},{"location":"planning.html","text":"Planificaci\u00f3n \u00b6 1.- Arquitecturas Web (4h) \u00b6 1.- (1) Introducci\u00f3n asignatura. Arquitecturas, decisiones de dise\u00f1o - Ejercicios 101,102 2.- (2) Herramientas. Puesta en marcha / Docker - Ejercicios 103,104 2.- El lenguaje PHP (26h) \u00b6 1.- (3) Sintaxis. Ejercicios 201-207 2.- (4) Condiciones. Ejercicios 208-213 3.- (5) Bucles. Ejercicios 220-223 - Lunes 20/10/21 4.- (6) Ejercicios 224-228 5.- (7) Arrays, asociativos. Ejercicios 230-235 6.- (8) Array bidimensionales. Ejercicios 236-238 7.- (9) Funciones, par\u00e1metros por defecto y con nombre. Ejercicios 240-242 - Lunes 27/09/21 8.- (10) Alcance y Funciones variable. Biblioteca de funciones. Ejercicios 243-245 9.- (11) Plantillas. Ejercicios 246-247. 10.- (12) Cadenas. Ejercicios 250-253 11.- (13) Subcadenas. Ejercicios 254-257 - Lunes 4/10/21 12.- (14) Math y tipos de datos. Ejercicios 260-262 13.- (15) Prueba escrita - Jueves 7/10/21 3.- PHP Orientado a Objetos (18h) \u00b6 1.- (16) Clases y objetos. Constructor. Ejercicios 300-303 - Jueves 14/10/21 2.- (17) Clases est\u00e1ticas. Herencia. Ejercicios 304-307 3.- (18) Herencia. Clases abstractas. Ejercicios 308-311 - Lunes 18/10/21 4.- (19) Interfaces. Ejercicios 312-314 5.- (20) Proyecto Videoclub I. Ejercicios 320-323 6.- (21) Proyecto Videoclub I. Ejercicios 324-328 7.- (22) M\u00e9todos encadenados. Namespaces. Ejercicios 330-332 - Lunes 25/10/21 8.- (23) Excepciones. Ejercicios 333-334 9.- (24) Proyecto Videoclub II. Ejercicios 335-337 4.- Programaci\u00f3n Web (12h) \u00b6 1.- (25) Formularios. Ejercicios 401-403 2.- (26) Upload. Cookies. Ejercicios 404-406 - Martes 2/11/21 3.- (27) Cookies. Sesi\u00f3n. Ejercicios 407-409 4.- (28) Gesti\u00f3n de usuarios. Ejercicios 410-415 5.- (29) Proyecto Videoclub III. Ejercicios 420-423 - Lunes 8/11/21 6.- (30) Proyecto Videoclub III. Ejercicios 424-426 5.- Herramientas Web (16h) \u00b6 1.- (31) Composer. Introducci\u00f3n Monolog. Ejercicio 501 2.- (32) Manejadores. Uso de logs con Monolog . Ejercicios 502 - 503 3.- (33) Proyecto Videoclub IV. Ejercicios 511 - 515 / Lunes 15/11/21 4.- (34) Documentaci\u00f3n con phpDocumentor . Ejercicios 521 - 522. 5.- (35) Webscrapping. Ejercicios 531 - 533. 6.- (36) Pruebas con PhpUnit . Ejercicios 541 - 545. 7.- (37) Proyecto Videoclub V. Ejercicios 551 - 554. - Lunes 22/11/21 8.- (38) Prueba escrita 6.- Acceso a Datos (24h) \u00b6 1.- (39) SQL. Ejercicios 601 - Jueves 25/11/21 2.- (40) PDO. Ejercicios - 3.- (41) . Ejercicios - Lunes 29/11/21 4.- (42) . Ejercicios - 5.- (43) CSV. Ejercicios - 6.- (44) PDF. Ejercicios - 7.- (45) Eloquent. Ejercicios - Martes 7/12/21 8.- (46) Migraciones. . Ejercicios - 9.- (47) . Ejercicios - 10.- (48) ORM. Ejercicios - 11.- (49) . Ejercicios - Martes 14/12/21 12.- (50) . Ejercicios - Proyecto Innova - Fase I \u00b6 Del Mi\u00e9rcoles 15 al Martes 21 de Diciembre. 7.- Frameworks PHP (32h) \u00b6 1.- (51) Introduccion a Laravel - Lunes 10/01/22 2.- (52) Rutas 3.- (53) Plantillas 4.- (54) Controladores 5.- (55) Migraciones & Eloquent Lunes 17/01/22 6.- (56) 7.- (57) 8.- (58) 9.- (59) Lunes 24/01/22 10.- (60) 11.- (61) 12.- (62) 13.- (63) Ejercicio 801 - Lunes 31/01/22 14.- (64) 15.- (65) 16.- (66) 8.- Servicios REST (22h) \u00b6 1.- (67) Lunes 7/02/22 2.- (68) 3.- (69) 4.- (70) 5.- (71) Lunes 14/02/22 6.- (72) 7.- (73) 8.- (74) 9.- (75) Lunes 21/02/22 10.- (76) 11.- (77) Prueba pr\u00e1ctica final - Jueves 24/02/22 Proyecto Innova - Fase II \u00b6 Del 25 de Febrero al 3 de Marzo. Total = 154h de sesiones lectivas + 16h de proyectos innova = 170h reales.","title":"Planificaci\u00f3n"},{"location":"planning.html#planificacion","text":"","title":"Planificaci\u00f3n"},{"location":"planning.html#1-arquitecturas-web-4h","text":"1.- (1) Introducci\u00f3n asignatura. Arquitecturas, decisiones de dise\u00f1o - Ejercicios 101,102 2.- (2) Herramientas. Puesta en marcha / Docker - Ejercicios 103,104","title":"1.- Arquitecturas Web (4h)"},{"location":"planning.html#2-el-lenguaje-php-26h","text":"1.- (3) Sintaxis. Ejercicios 201-207 2.- (4) Condiciones. Ejercicios 208-213 3.- (5) Bucles. Ejercicios 220-223 - Lunes 20/10/21 4.- (6) Ejercicios 224-228 5.- (7) Arrays, asociativos. Ejercicios 230-235 6.- (8) Array bidimensionales. Ejercicios 236-238 7.- (9) Funciones, par\u00e1metros por defecto y con nombre. Ejercicios 240-242 - Lunes 27/09/21 8.- (10) Alcance y Funciones variable. Biblioteca de funciones. Ejercicios 243-245 9.- (11) Plantillas. Ejercicios 246-247. 10.- (12) Cadenas. Ejercicios 250-253 11.- (13) Subcadenas. Ejercicios 254-257 - Lunes 4/10/21 12.- (14) Math y tipos de datos. Ejercicios 260-262 13.- (15) Prueba escrita - Jueves 7/10/21","title":"2.- El lenguaje PHP (26h)"},{"location":"planning.html#3-php-orientado-a-objetos-18h","text":"1.- (16) Clases y objetos. Constructor. Ejercicios 300-303 - Jueves 14/10/21 2.- (17) Clases est\u00e1ticas. Herencia. Ejercicios 304-307 3.- (18) Herencia. Clases abstractas. Ejercicios 308-311 - Lunes 18/10/21 4.- (19) Interfaces. Ejercicios 312-314 5.- (20) Proyecto Videoclub I. Ejercicios 320-323 6.- (21) Proyecto Videoclub I. Ejercicios 324-328 7.- (22) M\u00e9todos encadenados. Namespaces. Ejercicios 330-332 - Lunes 25/10/21 8.- (23) Excepciones. Ejercicios 333-334 9.- (24) Proyecto Videoclub II. Ejercicios 335-337","title":"3.- PHP Orientado a Objetos (18h)"},{"location":"planning.html#4-programacion-web-12h","text":"1.- (25) Formularios. Ejercicios 401-403 2.- (26) Upload. Cookies. Ejercicios 404-406 - Martes 2/11/21 3.- (27) Cookies. Sesi\u00f3n. Ejercicios 407-409 4.- (28) Gesti\u00f3n de usuarios. Ejercicios 410-415 5.- (29) Proyecto Videoclub III. Ejercicios 420-423 - Lunes 8/11/21 6.- (30) Proyecto Videoclub III. Ejercicios 424-426","title":"4.- Programaci\u00f3n Web (12h)"},{"location":"planning.html#5-herramientas-web-16h","text":"1.- (31) Composer. Introducci\u00f3n Monolog. Ejercicio 501 2.- (32) Manejadores. Uso de logs con Monolog . Ejercicios 502 - 503 3.- (33) Proyecto Videoclub IV. Ejercicios 511 - 515 / Lunes 15/11/21 4.- (34) Documentaci\u00f3n con phpDocumentor . Ejercicios 521 - 522. 5.- (35) Webscrapping. Ejercicios 531 - 533. 6.- (36) Pruebas con PhpUnit . Ejercicios 541 - 545. 7.- (37) Proyecto Videoclub V. Ejercicios 551 - 554. - Lunes 22/11/21 8.- (38) Prueba escrita","title":"5.- Herramientas Web (16h)"},{"location":"planning.html#6-acceso-a-datos-24h","text":"1.- (39) SQL. Ejercicios 601 - Jueves 25/11/21 2.- (40) PDO. Ejercicios - 3.- (41) . Ejercicios - Lunes 29/11/21 4.- (42) . Ejercicios - 5.- (43) CSV. Ejercicios - 6.- (44) PDF. Ejercicios - 7.- (45) Eloquent. Ejercicios - Martes 7/12/21 8.- (46) Migraciones. . Ejercicios - 9.- (47) . Ejercicios - 10.- (48) ORM. Ejercicios - 11.- (49) . Ejercicios - Martes 14/12/21 12.- (50) . Ejercicios -","title":"6.- Acceso a Datos (24h)"},{"location":"planning.html#proyecto-innova-fase-i","text":"Del Mi\u00e9rcoles 15 al Martes 21 de Diciembre.","title":"Proyecto Innova - Fase I"},{"location":"planning.html#7-frameworks-php-32h","text":"1.- (51) Introduccion a Laravel - Lunes 10/01/22 2.- (52) Rutas 3.- (53) Plantillas 4.- (54) Controladores 5.- (55) Migraciones & Eloquent Lunes 17/01/22 6.- (56) 7.- (57) 8.- (58) 9.- (59) Lunes 24/01/22 10.- (60) 11.- (61) 12.- (62) 13.- (63) Ejercicio 801 - Lunes 31/01/22 14.- (64) 15.- (65) 16.- (66)","title":"7.- Frameworks PHP (32h)"},{"location":"planning.html#8-servicios-rest-22h","text":"1.- (67) Lunes 7/02/22 2.- (68) 3.- (69) 4.- (70) 5.- (71) Lunes 14/02/22 6.- (72) 7.- (73) 8.- (74) 9.- (75) Lunes 21/02/22 10.- (76) 11.- (77) Prueba pr\u00e1ctica final - Jueves 24/02/22","title":"8.- Servicios REST (22h)"},{"location":"planning.html#proyecto-innova-fase-ii","text":"Del 25 de Febrero al 3 de Marzo. Total = 154h de sesiones lectivas + 16h de proyectos innova = 170h reales.","title":"Proyecto Innova - Fase II"}]}